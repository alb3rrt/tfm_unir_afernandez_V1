arXiv:2106.01347v1 [astro-ph.CO] 2 Jun 2021

Prepared for submission to JCAP
Cosmological Simulations of Number Counts
Francesca Lepori1, Julian Adamek2 and Ruth Durrer1
1Universit´e de Gen`eve, D´epartement de Physique Th´eorique and Centre for Astroparticle Physics, 24 quai Ernest-Ansermet, CH-1211 Gen`eve 4, Switzerland 2Universit¨at Zu¨rich, Institute for Computational Science, Winterthurerstrasse 190, CH-8057 Zu¨rich, Switzerland E-mail: francesca.lepori@unige.ch, julian.adamek@uzh.ch, ruth.durrer@unige.ch
Abstract. In this paper we present for the first time the angular power spectra C (z, z ) for
number counts from relativistic N-body simulations. We use the relativistic N-body code gevolution with its exact integration of lightlike geodesics which include all relativistic scalar contributions to the number counts. We compare our non-perturbative numerical results with the results from class using the Halofit approximation for the non-linear matter power spectrum. We find that the Halofit approximation is excellent for both, the density field and the convergence, but it cannot accurately model redshift-space distortions. We also find that the largest contribution to the unequal-redshift power spectra is the crosscorrelation of the density and the lensing contribution to the number count, especially for redshift bins that are far apart. Correlating the number counts with the convergence map we find that the signal is dominated by the lensing-lensing term when the convergence field redshift is not higher than the number count one, while it is dominated by the density-lensing term in the opposite case. In the present study, the issue of galaxy bias is deliberately left aside by considering only unbiased samples of matter particles from the simulations.

Contents

1 Introduction

1

2 Linear perturbation theory

2

3 Numerical Methods

4

4 Results and discussion

6

4.1 Auto-correlations in photometric bins

6

4.2 Isolating redshift-space distortions

10

4.3 Extracting lensing magnification from cross-correlations

11

4.4 Galaxy-galaxy lensing

15

5 Conclusions

15

A Effect of the window function

17

1 Introduction
In the coming years several large and deep surveys of galaxies will be carried out. Most notably the photometric survey DES which has completed five years of operation [1, 2], the spectroscopic survey DESI [3] which is already taking data, the Euclid satellite survey [4, 5] slated for launch in 2022, the Vera C. Rubin Observatory's Legacy Survey of Space and Time (LSST) which will start taking data in about two years [6, 7], the Square Kilometer Array (SKA) [8, 9] which is under construction in South Africa and Australia, and SPHEREX [10]. These surveys will contain many millions of galaxies out to redshift z 3 and it is of great importance that we profit optimally from this treasure of data to learn about the parameters describing our Universe, but also to test General Relativity itself on cosmological scales.
For this reason an accurate modelling of the distribution of galaxies and their correlation properties is needed. Since we shall be able to measure the correlation function out to very large scales, we want to include relativistic projection effects which stem from the fact that measurements are made on our past light cone which is itself perturbed by the clustering of matter. Furthermore, the positions of galaxies are measured as redshifts and angles which are affected by the proper motion of galaxies and by lensing. These effects have been taken into account fully within linear perturbation theory calculations, see Refs. [11­14] for a complete analysis and [15, 16] for relevant partial results. However, at late times and on intermediate to small scales, density perturbations grow large and linear perturbation theory is not sufficient. Some attempts to use second order relativistic perturbation theory have been made, but this seems to be quite cumbersome [17­19], see also [20] for a significant simplification.
From the side of numerical simulations, in the past years there has been a growing interest in modelling the non-linear regime of large-scale structure observables including relativistic effects [21­28]. Some of those have been detected using Newtonian N-body simulations, e.g. by measuring the dipole of the correlation function and of the power spectrum when two halo populations are cross-correlated.

­1­

In this paper, we investigate the non-linear regime of relativistic effects on the angular power spectrum of the number counts, extracted directly from relativistic N-body simulations using the code gevolution [29, 30].
In this code, the metric perturbations themselves are included at first order, while their first and second spatial derivatives are included to all orders. Recently, this code has been used to calculate the lensing shear, magnification and rotation by integrating photon geodesics [26]. Integrating the geodesics exactly to all orders in scalar metric perturbations, we produce mock catalogues giving the observed direction and redshift of chosen point sources.
Since our simulations do not capture the complicated astrophysical process of galaxy formation we sample our point sources directly from the N-body ensemble, providing an unbiased tracer of matter. Compared to previous numerical studies in the literature, the ray-tracing method that we use is non-perturbative, i.e. it does not rely on the Born approximation and it includes all relativistic scalar contributions.
The paper is organised as follows. In the next section we briefly introduce the concept of number counts from the point of view of cosmological perturbation theory. In Section 3 we describe the simulations performed for this work as well as the numerical processing of the data. In Section 4 we present and discuss our results and in Section 5 we conclude. Technical details about the impact of the survey window are presented in an appendix.
We consider a flat Friedmann-Lema^itre-Robertson-Walker (FLRW) universe where the metric is written in Poisson gauge as

ds2 = a2( ) -e2d 2 -2Bidxid + e-2ij +hij dxidxj ,

(1.1)

with  the conformal time.

2 Linear perturbation theory

Large-scale structure observations map the matter distribution across cosmic history measuring the fluctuations of tracers across the sky at different redshifts. For discrete tracers, e.g. galaxies or quasars, the observable from which we extract this information is the number counts, the fractional overdensity of the number of observed objects in a given redshift bin,

N (z, n) - N¯ (z)

(z, n) =

N¯ (z)

,

(2.1)

where n is the direction of observation, z is the observed redshift, while N (z, n) and N¯ (z) denote the number of objects per solid angle seen at position n and the average number of objects detected over the whole survey sky, respectively. Since sources lie on the past light cone of the observer, a fully relativistic prediction for the number count not only encodes information on the underlying dark matter fluctuations, but also on the tracers' peculiar velocities and the geometry of the spacetime itself through lensing, integrated Sachs-Wolfe and time-delay effects. In linear perturbation theory the observed number counts can be schematically expressed as a sum of different contributions [11­14]

 = dens + rsd +  + gr, where dens is the local overdensity,
dens = b cm

(2.2) (2.3)

­2­

proportional to the density contrast in comoving gauge cm. For unbiased tracers, the bias is simply b = 1. In our notation, the term rsd includes the linear Kaiser redshift-space distortions (RSD) [15], plus other subdominant Doppler corrections

1

H2

rsd = H(z) r(v · n) + H2 + rH (v · n) - 3HV,

(2.4)

where v is the peculiar velocity in Poisson gauge, V the velocity potential defined by v =

-V , r = o -  is the conformal distance, H = a /a is the conformal Hubble factor and

a prime denotes a derivative with respect to the conformal time  .  is the gravitational

lensing term,

r(z) r(z) - r

 = -
0

r(z)r ( + )dr,

(2.5)

where  is the Laplace operator on the sphere. The last term in Eq. (2.2), gr, includes local and integrated combinations of the Bardeen potentials:

1

2

r(z)

gr

= - 2 +  +

 H

+

r(z)

0

dr( + )+

H

2

+ H2 + r(z)H

r(z)

+

dr( +  ) .

0

(2.6)

The density and the Kaiser redshift-space distortions are often referred to as standard terms, since current clustering analysis take them into account in the physical model for the observable. The gravitational lensing contribution was also well known before the full computation of the relativistic number count was carried out and it has been detected for the first time in the Sloan Digital Sky Survey (SDSS) by cross-correlating quasars and their foreground galaxies [31]. More recently, Ref. [32] presented a detection of the lensing signal from the cross-correlation of the background galaxies and their foreground convergence field. This effect has been investigated in detail in the literature and the general consensus is that it will be crucial to model it in the analysis of future cosmological surveys [33­42]. The Doppler contribution to Eq. (2.4) is sub-dominant in the standard clustering analysis. However, it is possible to isolate this term from the density and Kaiser contributions measuring the odd multipoles of the Fourier space power spectrum and correlation function using multiple tracer techniques [43, 44]. This has been investigated with N-body simulation in Refs. [24, 25, 27] and detected from galaxy clustering measurements in Ref. [45]. Finally, the perspective of detection for the terms grouped in Eq. (2.6) has also been investigated in the literature and the present forecasts suggest that cosmological probes will not be able to see them in the foreseeable future, at least not in a single-tracer analysis [46].
We remark that the full number counts are a gauge-invariant quantity. However, the contributions that we single out here in order to separate the different physical effects that come into play are not all gauge invariant separately and, therefore, cannot be observed individually. The lensing contribution  can be measured independently by weak-lensing observations and is indeed gauge invariant, however, we note that additional lensing-like effects can occur in different gauges, see [47] for an example. Throughout this work we will consider the ensembles of N-body particles in our simulations as tracers of the distribution of dark matter and baryons. Therefore, we can safely neglect the effects of clustering bias, magnification bias and evolution bias.

­3­

Catalogue unity-2-low-z unity-2-high-z high-resolution high-resolution-2

z range [0, 0.85] [0.85, 3.5]
[0, 2] [0, 1.25]

fsky 1
0.047 0.025 0.025

Nsources 1.55 × 109 835 × 106 594 × 106 251 × 106

grid resolution 700 kpc/h 700 kpc/h 250 kpc/h 250 kpc/h

Lbox 4032 Mpc/h 4032 Mpc/h 1920 Mpc/h 1440 Mpc/h

Table 1: Summary of the properties of the catalogues used in our analysis: redshift range (z range), sky fraction (fsky), number of sources (Nsources), grid resolution and size of the simulation box (Lbox).

3 Numerical Methods
Our numerical study uses four different mock catalogues from three separate N-body simulations that all use exactly the same baseline cosmology. This allows us to cover various choices of resolution, simulation volume, survey area and redshift range so that we can check the robustness of our results with respect to such choices. One simulation has a relatively large volume of (4032 Mpc/h)3 and therefore correspondingly a low resolution of just 700 kpc/h (we used 57603 grid points and the same number of particles) which yields a mass resolution of 3 × 1010 M /h. This simulation, called unity-2, provides two mock surveys for the same observer location: a full-sky survey out to redshift z  0.85 and a wide "pencil-beam" survey covering 1932 square degrees with a redshift range from z  0.85 to z  3.5. In our second simulation, called high-resolution, we used a somewhat smaller volume of (1920 Mpc/h)3 but significantly higher resolution of 250 kpc/h (76803 grid points and particles) which yields a mass resolution better than 1.4 × 109 M /h. This simulation provides us with a mock survey of 1009 square degrees out to redshift z  2. The large redshift range is achieved by allowing the pencil-beam footprint of the survey to "wrap around" the periodic simulation box, however, making sure that no part of the simulation volume appears on the footprint more than once. This can be achieved by carefully choosing the field of view in the periodic setting. Our third simulation, called high-resolution-2, uses exactly the same resolution as the previous one, but has a somewhat smaller volume of (1440 Mpc/h)3 (hence using only 57603 grid points and particles). It provides us with another mock survey of 1009 square degrees that is statistically independent of the previous one. However, due to the smaller box size, it reaches a maximum redshift of only z  1.25. The properties of our mock surveys are summarised in Table 1.
The assumed baseline cosmology is a CDM model with three neutrino species in a minimal-mass configuration (one massless state, m1 = 0 eV, and two massive states in normal hierarchy, m2 = 0.008689 eV and m3 = 0.05 eV). The neutrinos are treated as a linear component to the stress-energy similar to how it is done in [48] for the massless case (based on an idea proposed in [49]). For neutrinos with small masses this is an excellent approximation. Our N-body ensemble therefore captures the distribution of cold dark matter and baryons while total matter would include a small correction due to the massive neutrinos. The remaining cosmological parameters are h = 0.67, c = 0.26858, b = 0.049, TCMB = 2.7255 K, and we use a nearly scale-invariant spectrum of primordial perturbations given by As = 2.215 × 10-9 and ns = 0.9619 at the pivot scale of 0.05 Mpc-1.
Our simulations are performed with the relativistic cosmological N-body code gevolution which provides metric perturbations and particle phase-space coordinates in Poisson gauge.

­4­

dN/dz Nsources

2.5

unity-2-low-z fsky = 1

unity-2-high-z fsky = 0.047

2.0

high-resolution fsky = 0.025

high-resolution-2 fsky = 0.025

1.5

1.0

0.5

0.0 0.0 0.5 1.0 1.5 2.0 2.5 3.0 3.5
z

Figure 1: The redshift distribution of the four point-source catalogues analysed in this work. The integral of the distributions is normalised to 1 in this plot.

This is naturally a weak-field gauge in cosmology which facilitates an efficient numerical integration of Einstein's equations that is at the same time very accurate. In the weak-field expansion employed in gevolution all the metric variables are kept at least to first order. In addition, terms that contain spatial gradients of the scalar gravitational potentials are kept to all orders, see [29, 30] for more details. However, this is only necessary to ensure a consistent calculation of relativistic corrections like frame dragging or gravitational slip which are very small effects in the cosmological model considered here. In particular, the effect of frame dragging (the largest correction) on the observables we want to compute remains negligible (well below 1%) and shall therefore be ignored here. Thus, for the purpose of this work, the main advantage of using the computational framework of gevolution is the fact that the simulation output has an unambiguous relativistic interpretation and can be processed efficiently using a validated pipeline.
From the particle and metric data on the past light cone we can construct the null geodesics that connect a catalogue of point sources with the observation event in each simulation. This provides us with observed positions and observed redshifts that include all relativistic and projection effects nonperturbatively. More details on the ray-tracing method employed here can be found in [26]. Our point-source catalogues consist of randomly drawn (and hence unbiased) subsamples of the N-body particles that represent cold dark matter and baryons. The reason for this choice is twofold. First, it allows us to leave aside the issue of bias which could otherwise complicate our analysis significantly. Second, we can work with a high density of point sources to beat down shot noise even at high redshift. The number of point sources, Nsource, in each catalogue is given in Table 1, and their distribution in redshift is illustrated in Figure 1.
Once the angular positions and observed redshifts of all point sources have been determined we proceed with an estimation of angular power spectra C (z, z ) of the observed

­5­

number counts as follows:
1. We select all the particles within a chosen range of observed redshifts (a redshift bin with "top-hat" selection function) and we project the number of particles npart onto a sky map pixelised with the HEALPix method [50]. A Boolean mask is applied according to the survey geometry for pencil-beam surveys.
2. We compute the average of the number of particles per pixel n¯. Note that this average is performed only over the unmasked pixels.
3. We compute the number-count fluctuation in each pixel i as i  (nipart - n¯)/n¯.
4. We estimate the angular power spectrum for the number-count map using the code PolSpice [51, 52]. This code implements a fast estimator for the angular auto or cross power spectra from one or two sky map(s) and it corrects for the effect of the mask(s) (see Appendix A for more details). In order to reduce the statistical noise, we do not resolve the individual multipoles. Instead we bin the angular power spectra in bandpowers with   fs-k1y.
For the catalogues high-resolution and high-resolution-2 we additionally compute the area distance at the observed position of the sources. For these catalogues, therefore, we also estimate convergence maps from the fluctuations of the area distance, exactly as described in Ref. [26]. The cross-correlation of number counts and convergence maps is discussed in Section 4.4.
We shall also compare our simulated spectra with predictions from perturbation theory computed with the Cosmic Linear Anisotropy Solving System (class) code [53, 54], which calculates the fully relativistic number counts in linear perturbation theory [14]. A recipe to account for non-linearities in the matter density is implemented in this approach using Halofit [55].

4 Results and discussion

4.1 Auto-correlations in photometric bins

In this section we investigate auto-correlations of the number counts in three redshift bins,

z = 0.5, 1.5, 3. It is well known that the relative importance of the contributions to the

number count depends on the width of the redshift bin and on the redshift (see e.g. [12] or

[14], especially Figs. 1 and 4). However, we cannot choose arbitrarily narrow redshift bins:

we are constrained to choose the bin width in such a way that each pixel in our map contains

a sufficient number of particles in order to limit shot noise. For a comoving number density

n, the angular density in a bin of full width 2z is roughly

N¯ = n¯Vbin

n¯

2z H (z )

(1

+

z)2d2A

(z)

,

leading to a shot-noise amplitude of Cnoise = 1/N¯  1/z. If shot noise is larger than about 1% of the physical C we can no longer neglect it. For this reason, we consider redshift bins whose half-width is z  [0.01, 0.1], which is the typical bin size of a photometric galaxy survey.
As a first test, we study the impact of the relativistic effects in the number counts extracted from our simulations for fixed bin size. In order to separate the different contributions to the number counts, for each redshift bin, we compute three maps:

­6­

· A map for the full number count, where particles in each pixel are selected according to their observed redshift and observed position in the sky (zobs, n). The observable coordinates are computed using the ray-tracing technique described in Section 3. This map includes all the relativistic effects and it is an observable.

· A map which neglects the redshift perturbation contribution in the number count, where the redshift bin is selected using the background redshift of the sources, while the pixelisation is made from the observed angular position of the sources. This map does not include number-count contributions that depend on the peculiar velocity of the sources such as RSD and Doppler effects, nor gravitational redshift perturbations, but it does include lensing magnification.

· A map which only includes the density contribution to the number count, where the comoving position of the source is translated into background redshift and angular position and used to extract the map: the particles are selected in the bin on the basis of their background redshift, and the projection in the pixelised map uses the unperturbed direction of the sources.

Note that comoving position, peculiar velocity and lensing are each gauge dependent and

hence this separation of the different effects is specific to the Poisson gauge used in this work.

Only the first type of map which uses only observables is fully invariant.

In Figs. 2 and 3 we compare the fully non-linear results with the theoretical prediction

from class [14, 53, 54] with non-linearities modelled with the Halofit prescription [55]. For a

correct comparison with the results of our simulation, we choose top-hat selection functions

with the same bin width as used to extract the number-count maps, while selection and

magnification bias are set to b = 1 and s = 0, respectively, since our particles are unbiased

tracers of the baryon and dark matter distribution and the catalogues are not magnitude

limited.

The two panels in Fig. 2 refer to different redshift bins: z = 0.5 ± 0.01 in the top panel,

and z = 3 ± 0.1 in the bottom panel, and in Fig. 3 we show z = 1.5 ± 0.05. Each panel

shows two plots: the angular power spectra (top) and the difference (in percentage) between

class and our numerical measurement (bottom). Orange, blue and green markers refer,

respectively, to the power spectrum extracted from the fully relativistic number-count map,

the map which neglects the impact of peculiar velocities in the number count, and the map

which further neglects magnification and therefore only includes density perturbations.

class predictions are represented as continuous lines and their colour follows the pat-

tern of the simulation data: orange lines include the contributions from density, lensing

magnification and RSD, blue lines includes density and lensing, while green lines includes

only density. We have checked that the class result including large-scale relativistic effects

(gr in our notation) does not visibly differ from the orange line.

The horizontal bars indicate our binning in multipole , while the vertical errorbars are

due to cosmic variance:

2

=

C.

fsky (2 + 1)

(4.1)

For all the redshift bins, we find that RSD significantly affects the angular power spectrum on large scales ( 100), while on small scales correlations are largely dominated by the density contribution. In the theoretical prediction, estimated with class, we can separate the different contributions to the RSD (the Kaiser and the Doppler terms) and we find that

­7­

density + lensing

10-4

density + lensing + rsd

12 C

10-5

(a)

10-6

CLASS Halofit unity-2-low-z

% difference

211200000

z1 = z2 = 0.5 z = 0.01 Nside = 4096

101

102

103

density

10-6

density + lensing density + lensing + rsd

12 C

10-7

CLASS Halofit unity-2-high-z

(b) 10-8 211200000 101

% difference

z1 = z2 = 3 z = 0.1 Nside = 4096

102

103

Figure 2: We show the equal-redshift power spectra C (z, z) and the relative difference
between the class Halofit approximation and our simulation in percent for two different redshifts and bin widths. The 5% difference threshold is indicated by dashed lines. We use the unity-2 catalogues and pixelise the sky into 12 Ns2ide pixels with Nside = 4096. The lensing contribution is visible by eye only for the high redshift, z = 3. For z = 0.5 it is
significantly smaller than 1%. The simulations lose power at 5 1300 for z = 0.5, indicated as vertical line in panel (a), and at 4000 for z = 3 due to insufficient spatial resolution.
At 1000 shot noise becomes relevant. Its amplitude is indicated as a dashed line on panel
(b).

­8­

12 C

10-5

density + lensing density + lensing + rsd

10-6

10-7 211200000 101

CLASS Halofit high-resolution

z1 = z2 = 1.5 z = 0.05 Nside = 4096

102

103

% difference

Figure 3: As Fig. 2 but for z = 1.5 and the high-resolution simulation. The lensing contribution is at the level of 1-2%. No loss of power due to resolution effects is visible. We see, on the contrary, that on scales > 1000 the simulations spectra exceed by roughly 5% the theoretical prediction.

the peculiar velocity contribution is dominated by the first one, while Doppler contributions are sub-percent even at z = 0.5. Lensing can be safely neglected in the auto-correlation at z = 0.5 and z = 1.5, contributing < 0.1% and < 2%, respectively. At high redshift (z = 3) the lensing contribution is of the order of 10 - 15%.
We find that the angular power spectra extracted from simulations agree well with the class Halofit prediction and that, therefore, the Halofit prescription is able to model accurately the non-linear angular power spectra for the auto-correlation considered in this analysis. This is not surprising: on small scales the angular correlations are dominated by density correlations and Halofit is a fit for the matter power spectrum accurate at the 5% level. Actually, our simulations of density fluctuations are typically 5% higher than the Halofit result. On the other hand, as we discuss below, the contribution from RSD reduces the final result in the simulations so that Halofit yields a somewhat too high total result on small, non-linear scales. For our example with z = 0.5 and z = 0.01 RSD reduce the power spectrum about 5% below the Halofit values around  1000.
In order to estimate the multipole at which resolution effects degrade the power spectrum we first estimate the effective angular resolution of our simulation for a source plane positioned at redshift z. This is given by min = x/r(z) = /(kmaxr(z)), where x denotes the grid resolution and kmax = /x is the corresponding Nyquist wavenumber. This leads to a maximum multipole of

 max(z) = min = kmaxr(z) .

(4.2)

Note, however, that at this value of we expect errors of order unity in our simulation. A

­9­

 5% accuracy is achieved roughly at 5(z) max(z)/ 20, since the error grows like k2 when approaching the Nyquist wavenumber [56]. This loss of power is well visible in the density power spectrum (blue dots) in Fig. 2a beyond 2000.
At high redshift, resolutions effects are expected to appear on smaller scales. However, we find that our measurement for the auto-correlation in this redshift regime are more strongly limited by shot noise. This is manifest from the rise of power in Fig. 2b: on scales
 600 the shot noise level (plotted in the top panel in dashed line) is  5% and, therefore, it strongly contaminates our estimation.
4.2 Isolating redshift-space distortions
While density correlations can be described quite accurately with the Halofit prescription in the non-linear regime, velocity correlations are more challenging to model. The RSD effect is computed in class from the Kaiser formula [15], PH (k)  PH (k)[1 + (n · k^)2]2, where PH denotes the Halofit power spectrum, implicitly assuming the linear relation between density and velocity. However, non-linearities affect velocities and density differently. Due to angular momentum conservation velocities actually prevent infall in the non-linear regime and reduce the power spectrum with respect to the linear Kaiser prescription. Furthermore, at intermediate scales, non-linearities affect velocities more strongly than density. Attempts have been made to model this reduction, e.g. by a Lorentzian or Gaussian kernel [57­59] on top of one or two loop corrections from perturbation theory, or by using effective field theory [60]. However, it has been shown that all these models of velocity non-linearities are quite inaccurate [61] and an accurate model for non-linear RSD, including also the small scale finger-of-god effect is still lacking. Therefore, we do not expect the Halofit prescription to be accurate for the velocity contribution to the angular power spectrum, especially at low redshift where non-linearities are strongest.
In order to study how non-linearities affect the RSD contribution to the angular power spectrum, we isolate RSD from the dominant density correlations by subtracting from the angular power spectrum of the full number count map the spectrum of the map that neglects redshift perturbations. In Fig. 4 we compare the difference of the two spectra to the class prediction of the same quantity, for three redshift bins centered at z = 0.5 with different half-widths z = 0.01, 0.02, 0.05. As is well known, the narrower the redshift bin, the more pronounced is the contribution from RSD. The figure includes scales < 300: radial correlations are smeared over a wide bin r 2z/H(z) 4580zh-1Mpc > 45h-1Mpc in this analysis, and therefore the RSD contribution on smaller scales, higher 's, is negligibly small. Furthermore, the scales considered are not affected by finite-grid resolution effects.
On these scales, the class prediction agrees with the results from our simulation for the largest bin-size considered here (z = 0.05, r  230h-1Mpc). However, for thinner bins we find that Halofit overestimates the angular correlations at the level of up to  80% at
260. Furthermore, non-linearities of velocities are relevant at the percent level already at scales of more than 50h-1Mpc at z = 0.5. Note that in a redshift bin of half width z in the C (z) scales from min  min{r, dA(z)/ } to max  (dA(z)/ )2 + r2(z) are mixed. For = 20 and z = 0.01 at z = 0.5 these scales are   [45, 69]h-1Mpc.
In summary, our simulations confirm the expectation that non-linear contributions to RSD are relevant already on very large scales [62].
­ 10 ­

,r1sd2only C

10-4

z = 0.01

z = 0.02

10-5

z = 0.05

10-6

10-7

CLASS linear

CLASS Halofit

10-8

unity-2-low-z

24688642000000000

z1 = z2 = 0.5 Nside = 4096 50 100

150

200

250

300

% difference

Figure 4: The RSD power spectra at z = 0.5 from class Halofit (solid) and from gevolution (dotted). In the bottom panel, we show the relative difference in %. The Halofit prescription significantly overestimates the fully non-linear RSD for narrow redshift bins. For the widest redshift bin, z = 0.05, the signal is very low and noisy at > 200.

4.3 Extracting lensing magnification from cross-correlations
In this section we study the unequal-redshift correlations. As is known from linear perturbation theory and is also confirmed here, the angular power spectra C (z1, z2) for z1 = z2 are dominated by the density-lensing and lensing-lensing terms [34] for large redshift separation. They therefore provide an alternative route (together with galaxy-galaxy lensing measurements) to measure the density-lensing and lensing-lensing correlations.
In order to study the non-linear regime of magnification, we consider the configuration in which this effect is by far the dominant contribution to the signal, i.e. the crosscorrelations of bins with large redshift separation. For this purpose we cross-correlate a map of the number count from the unity-2-high-z catalogue at z = 3.2, with half-width z = 0.2, with several maps from the unity-2-low-z catalogue. The low-redshift maps were extracted from redshift bins centered at z = 0.2, 0.475, 0.6, 0.69, 0.77 and with half-width z = 0.2, 0.075, 0.05, 0.04, 0.04, respectively. The high-redshift map that we use for this analysis has a sky coverage fsky  0.047, while the low-redshift catalogue covers the full-sky. However, we apply a mask on the low-redshift catalogue, so that we only include pixels from half of the sky. This way we avoid spurious correlations at high separation angles, which would occur because the high-redshift survey footprint partially overlaps with the rear half of the low-redshift sky in the periodic domain of the unity-2 simulation used here.
In Fig. 5 we compare the results from our simulation with the class predictions, from the cross-correlations of redshifts z1 = 0.2, z2 = 3.2 and z1 = 0.77, z2 = 3.2. The error-bars

­ 11 ­

10-5

lensing only

10-6

density + lensing

10-7

12 C

10-8

10-9

(a)

10-10

CLASS Halofit unity-2-low-z × unity-2-high-z

% difference

2466420000000101

z1 = 0.2, z2 = 3.2

102

103

10-5

lensing only

10-6

density + lensing

10-7

12 C

10-8

10-9

(b)

10-10

CLASS Halofit unity-2-low-z × unity-2-high-z

% difference

2466420000000101

z1 = 0.77, z2 = 3.2

102

103

Figure 5: We show the unequal redshift correlations for two redshift pairs. The first case (a) with z1 = 0.2 is dominated by the density-lensing correlations which are neglected in the green solid curve which shows the lensing-only contribution. For this lower redshift our simulations are missing power at > 500 due to finite resolution. For the second case (b) with z1 = 0.77, the density-lensing signal is still about a factor 10 larger than the lensing-only term. For this redshift our simulations lose power for 1500. The density-lensing signal is negative and indicated as dashed lines.

of the cross correlation signal are due to cosmic variance, and they have been estimated as

C12 =

C11 C22 + C12 2 ,
fsky (2 + 1)

(4.3)

­ 12 ­

z 0.6 0.8 0.95 1.05 1.175 1.325 1.475 1.625 1.8

z 0.1 0.1 0.05 0.05 0.075 0.075 0.075 0.075 0.1

Nsources (cat 1) 38342795 54204035 31790875 34578712 56375844 61354137 65568421 67943255 93919982

Nsources (cat 2) 38068704 53751424 31923809 34982269 56906758 -

Table 2: The mean redshifts and half-widths of the bins considered in the cross-correlation analysis of the high-resolution simulations. We also quote the number of observed sources Nsources in each redshift bin for the two catalogues.

where  is the width of the -bins, while we use for fsky the sky coverage of the high-redshift catalogue, i.e. we consider the sky overlap of the two catalogues. These errors are dominated by the much larger auto-correlation term (the first term in the numerator).
In the plot, we do not show the contribution from the over-density of particles alone: it is several orders of magnitude smaller than the plotted cross-correlation and therefore negligible. The main contribution to the signal is the cross-correlation between the density at low redshift and lensing magnification of the high-redshift bin. The lensing-lensing contribution is negligible for small z1, while we expect it to become more and more relevant as we cross-correlate bins at higher redshift. Already for z1 = 0.77, its contribution is at the level of 10% and more. The results from our simulation are affected by finite resolution at high . The resolution of the simulation x = 700 kpc/h translates into a Nyquist wavenumber of kmax = /x  4.5 h/Mpc, which can be converted into the maximum multipoles that we can resolve max  r(z)kmax. At z = 0.2 we have max  2560. Therefore, in Fig. 5a we see the numerical oscillations at > 2500 due to finite grid resolution of the simulation. As explained earlier, the error at max(z) is of order unity and we expect a 5% error already at about max/ 20 570. In the configurations where lensing is important, finite-grid effects can contaminate the estimation of the angular power spectrum at high redshift due to the fact that lensing is an integrated effect and, therefore, resolution error from smaller redshifts propagate into the estimated magnification at all redshifts. We have studied this in detail for the convergence field in Ref. [26], Appendix C. The power suppression due to finite resolution on small scales, clearly visible in both panels of Fig. 5, is caused by the finite resolution of our simulations.
We have also extracted the number-count cross-correlation in our high-resolution simulations. The redshift binning for the two high-resolution catalogues are given in Table 2. The high-resolution catalogues have a sky coverage of  2.5% of the sky. Therefore, when possible, we will show the angular power spectra estimated from two independent realisations. A comparison between them should give an indication of the impact of the large-scale statistical fluctuations. This source of uncertainty is investigated in detail in Appendix A. In Fig. 6a we show the cross-correlation for z1 = 0.6 and z2 = 1.8, for the high-resolution run (blue) and for the unity-2 run (orange). The dominant contribution to the angular power spectrum is the negative cross-correlation between density at low redshift and magnification

­ 13 ­

10-6
10-7 (a)
10-8
10-1901 10-6

12 C

z1 = 0.6 z2 = 1.8

CLASS Halofit

unity-2-low-z × unity-2-high-z

high-resolution

102

103

z1 = 0.6 z2 = 1.175

10-7

12 C

(b)

10-8

CLASS Halofit

high-resolution

high-resolution-2

mean

10-1901

102

103

Figure 6: In the top panel we show the number-count cross-correlation spectrum for z1 = 0.6, z2 = 1.8 from the high-resolution catalogue and the unity-2 catalogue. The latter has been computed cross-correlating the low-redshift catalogue and the high-redshift catalogues. In the bottom panel the cross-correlation for redshifts z1 = 0.6, z2 = 1.175 are shown for the two high-resolution simulations. The black data points denote the mean of the two spectra. In both figures, the dashed lines indicate negative values of the theoretical power spectrum.
at high redshift. While the two spectra agree on intermediate scales, i.e. 150 < < 1000, on large scales the high-resolution spectrum exhibits a strong loss of power. This effect is

­ 14 ­

not physical and it is due to the interplay of statistical fluctuations and finite sky coverage. On the other hand, on small scales, the spectrum estimated from the unity-2 run shows a suppression for > 1000, due to finite resolution. In this range of scales, the results from the high-resolution catalogue are more reliable and agree well with the theoretical prediction from class.
In Fig. 6b we show the cross-correlation of two far-away redshift bins from the highresolution catalogues. The black data points highlight the average between the spectra of the two independent realisations. Similarly to the configuration in Fig. 6a, the signal is dominated by the cross-correlation of density in the redshift bin z1 with the lensing contribution at z2.
4.4 Galaxy-galaxy lensing
We have also investigated the cross-correlation spectrum of number counts at redshift z1 with the convergence field at redshift z2, see Fig. 7. This correlation can be measured by correlating shear measurements and number counts. It has been noted, see e.g. [63], that this correlation does not only contain the density- term, but also a - (lensing-lensing) term. Note that this term is negative in C since the number counts are proportional to -2. When we correlate a convergence map at z2 with a number count map at z1 > z2, this correlation spectrum is mainly given by the lensing-lensing term because background overdensities are not correlated with the foreground lensing, while for z2 > z1, both the density-lensing and the lensing-lensing contributions are relevant. A first attempt to measure the lensing-lensing cross correlation by correlating the foreground convergence field with background galaxies has recently been made with the Hyper Suprime-Cam Subaru Strategic Program (HSC-SSP) data [32]. In Fig. 7a we show the cross-spectrum for z1 = z2 = 1.175 for the two independent high-resolution catalogues (pink and purple lines). The black data points denote the mean of the two measurements and its error is computed as C12 / 2, where C12 is the error on the cross-correlation for a single realisation, which has been estimated similarly to the error on the cross-correlation of the number counts at unequal-redshift bins. Blue and green lines denote theoretical predictions from class: the blue line is the cross-correlation of the the convergence map and the density contribution to the number count, while the green line includes the cross-correlation of  with both density and magnification terms to the number count. The full result is negative and dominated by the lensing-lensing term.
In Fig. 7b we show the cross spectrum for z1 = 0.6 and z2 = 1.175, using the same colours and conventions as in Fig. 7a. This spectrum is dominated by the density-lensing cross correlation, which is positive in C. On large scales, the negative lensing-lensing term leads to a small suppression of the result. Above  1000 our simulations lose power due to finite resolution: at = 3000 the suppression is  50% of the spectrum in the equal-redshift configuration, whereas it makes 20% of the signal for the cross-correlations of unequal-redshift bins, where the amplitude of the power spectrum itself is larger.
5 Conclusions
We have studied the number-count angular power spectrum from relativistic N-body simulations. As our sensitivity to very large angular scales is limited, we have mainly seen the contributions which dominate on intermediate and small scales: the density, RSD and lensing terms. While density and lensing magnification are reasonably well modeled by Halofit, RSD are not. For moderately slim redshift bins the N-body results deviate by up to 80% from the naive Kaiser prescription with Halofit. For more narrow redshift bins where RSD
­ 15 ­

10-7

10-8

1 2 C

10-9

CLASS Halofit

(a)

10-10

high-resolution high-resolution-2 mean

% difference

2466420000000 z1 = 1.175 z2 = 1.175

101

102

10-7

density density + lensing
103
density density + lensing

1 2 C

10-8

CLASS Halofit

(b)

high-resolution high-resolution-2

% difference

10642246-00000009

mean
z1 = 0.6 z2 = 1.175

101

102

103

Figure 7: The - cross-correlations are shown for two equal redshifts z1 = z2 = 1.175 in the top panel and for two unequal redshifts, z1 = 0.6 and z2 = 1.175 in the bottom panel.
are more prominent, this discrepancy is expected to be even larger. We have also found that non-linearities from RSD are relevant at the few-percent level already on very large scales. An accurate modelling of RSD is therefore very important for the analysis of large galaxy surveys.
The cross-correlations of different redshift bins allow an accurate measurement of the density-lensing correlation which is characteristic of the theory of gravity and will provide

­ 16 ­

an excellent test of General Relativity. We have also correlated convergence maps with the number counts. For a number-count map in the foreground these are also dominated by the density-lensing contribution while for a number-count map in the background and even at equal redshift they are dominated by the lensing-lensing term. Comparing this power spectrum with the corresponding shear power spectrum will represent another interesting test of General Relativity.
As we have analysed catalogues drawn directly from N-body particles in this work, we have determined the non-linear angular-redshift power spectra of cold dark matter and baryons. We could also have looked at biased tracers instead, e.g. halos. However, then the effects of non-linearities and bias would be entangled in the analysis. We therefore preferred to first look at unbiased tracers. The impact of non-linear bias (including evolution and magnification biases) in the fully relativistic number-count statistics deserves a dedicated study.

Acknowledgements
We thank Farbod Hassani for sharing simulation data that was used during early stages of the project. This work was supported by a grant from the Swiss National Supercomputing Centre (CSCS) under project ID s1035. We acknowledge financial support from the Swiss National Science Foundation.
Carbon footprint Simulations and post-processing consumed approximately 11880 kWh of electrical energy from the Swiss power grid. Using a conversion factor of 0.149 kg CO2 kWh-1 (taken from myclimate.org1) this caused emissions of 1770 kg CO2. Emissions are being fully offset through the carbon offsetting initiative of the Institute for Computational Science at University of Zurich, partnering with the myclimate Foundation.

A Effect of the window function

Typically, observations (and also our simulations) do not cover the full sky, 4, but have only partial coverage. This is taken into account with a window function in the way which we now derive.
Given a two-point correlation function on the sphere, AB(n · n ) = A(n)B(n ) , its spherical harmonic coefficients CAB can be computed as

CAB = 1 4

dd AB(n · n )P (n · n ) ,

which can also be inverted to

AB(µ) =

2 + 1 CABP (µ) , 4

(A.1) (A.2)

where µ = n · n is the scalar product of the two direction vectors. If we have only partial sky coverage, we may introduce weights wA(n), wB(n ) that
characterise the selection function, or mask, and write uncorrected harmonic coefficients as

C~AB = 1 4

dd wA(n)wB(n )AB(n · n )P (n · n ) ,

(A.3)

1Retrieved 19. February 2021

­ 17 ­

which can simply be estimated from the weighted data using the standard estimators developed for the full sky. Specifically, in the PolSpice code used in this work, the weighted map is expanded in spherical harmonic coefficients estimated from the pixel sum

~ Am,B

4 Npixels

Y
npixels

m(n)wA,B(n)A,B(n) ,

(A.4)

which are then taken in a scalar product and averaged over m to obtain the estimator of

C~AB as

C~AB

1 2 +1

~ Am~ Bm .

m

(A.5)

Note that this estimator coincides with eq. (A.3) only in the expectation value and in the

limit of large number of pixels. We shall proceed with considering the expectation value for

now but return to this point towards the end of this appendix. Applying Eq. (A.2) on the result also defines an uncorrected two-point correlation function ~AB(µ).

We may further define a power spectrum and corresponding correlation function of the

mask as

Cmask = 1 4

dd wA(n)wB(n )P (n · n ) ,

(A.6)

which evidently has a deterministic estimator.

From these ingredients we can now construct a corrected and apodised correlation func-

tion ^AB(µ) as

^AB (µ)

=

~AB (µ) mask(µ)

W

(µ)

,

(A.7)

where W (µ) is an apodisation function that needs to be zero in the range of µ where mask(µ)
is zero, i.e. where there are no pairs of pointings n, n with µ = n · n due to the mask. More generally the apodisation is applied to suppress the amplification of noise where mask(µ)
becomes small. Finally, by applying again Eq. (A.1), we arrive at the corrected power spectrum C^AB
as estimated by the PolSpice code. In the following we would like to study the relation between C^AB and the "true" CAB of the full sky.
First, by inserting the Legendre expansion of Eq. (A.2) into Eq. (A.3) we find that

^AB (µ)

=

W (µ) mask(µ)

Pn(µ)

2n + 1 (4)3

(2m

+

1)

CmAB

n,m

dd wA(n)wB(n )Pn(n·n )Pm(n·n ) .

(A.8)

Next, if we expand the weight functions into spherical harmonics, the double integral

becomes the product of two Gaunt integrals. Specifically, if we write

wA(n) = wLAM YLM (n) ,
L,M

(A.9)

and similarly for wB(n ), we find that

n+m

dd wA(n)wB(n )Pn(n · n )Pm(n · n ) = 4

wLAM (wLBM )

L=|n-m| M

Lnm 2 .
00 0 (A.10)

­ 18 ­

The harmonic coefficients C^AB can therefore be written as

C^AB =

2n + 1

2

n,m

1 -1

W

(µ)P (µ)Pn(µ) mask(µ)

dµ

2m + 4

1

n+m
CmAB
L=|n-m|

M

wLAM (wLBM )

=

K nQnmCmAB ,

n,m

Lnm 2 ,
00 0 (A.11)

where in the second line we define two kernel matrices K n, Qnm which depend only on the weights and on the apodisation,

Kn =

2n + 1 2

1 -1

W

(µ)P (µ)Pn mask(µ)

(µ)

dµ

,

2m + 1 n+m Qnm = 4

wLAM (wLBM )

L=|n-m| M

Lnm 2 .
00 0

(A.12) (A.13)

The computation of the matrix elements of K n can be simplified by defining a new function W^ (µ) = W (µ)/mask(µ), with harmonic coefficients W^ n computed in the usual way,

W^ n = 2

1 W (µ) -1 mask(µ) Pn (µ)dµ .

(A.14)

With these harmonic coefficients, the integral in Eq. (A.12) again becomes a Gaunt integral,

and hence

2n + 1 K n = 4

+n
W^ n 2n + 1

n =| -n|

nn 2 .
00 0

(A.15)

In our case we have a particularly simple weight function wA,B(n) = (n · z - µo), where z is the unit vector pointing along the z-axis, and µo is the cosine of our opening half-angle. The spherical harmonic coefficients are

wLAM,B = M0

 2L + 1 [PL-1(µo) - PL+1(µo)] ,

(A.16)

where we use the standard definition that P-1(µ) = 1. We can also write a closed expression

for mask(µ),

mask(µ) = 1 4

P

[P (µ)

-1(µo)

-

P

+1(µo)]2

.

2 +1

(A.17)

The kernel matrix Qnm becomes

2m + 1 Qnm = 4

n+m

[PL-1(µo) - PL+1(µo)]2 2L + 1

Lnm 2 .
00 0

L=|n-m|

(A.18)

In Fig. 8 we illustrate the effect of the window function on the angular power spectrum. The top panel shows the auto-correlation of the number count at z = 1.5 that we would measure from a full-sky catalogue (black continuous line) and the same power spectrum measured from a partially masked map. The latter is estimated from Eq. (A.11), where the

­ 19 ­

10-5
z1 = z2 = 1.5
10-6

1, 2 C

% difference

10-7

CLASS

with window function

4 2 0

2

4

101

102

103

Figure 8: Comparing the full sky class result with a windowed spectrum with 2.5% sky coverage calculated as described in the text. For > 10 the windowed result rapidly approaches the full sky spectrum.

two kernels K n and Qnm have been computed respectively from Eqs. (A.15) and (A.18) assuming an opening angle  = /5 and a cosine window in the form

1 + cos ()

W (µ) =

,

2

arccos µ

=

.



This setting corresponds to a sky coverage of  2.5%, which is the sky fraction covered by our high-resolution catalogues. In the bottom panel we show the difference between the two spectra: we find that the window function slightly suppresses the power spectrum estimator on large scales and that this effect is  2.5% at < 10, i.e. well within the cosmic variance uncertainty.
The windowed angular power spectrum estimator in Eq. (A.11) represents the expectation value, i.e. the mean over an infinite number of realisations. However, in our observations and simulations we have a finite number of realisations. In order to quantify the realisation noise, i.e. the amplitude of the fluctuations that we should expect when estimating the angular power spectrum from Nreal independent realisations, we test this effect with simulated maps. Starting from a theoretical spectrum at z = 1.5 we generate 100 Gaussian realisations, we apply a Boolean mask in such a way that our maps cover only 2.5% of the sky, and we estimate for each realisation the angular power spectrum with PolSpice. In Fig. 9, top panel, we show the full-sky theoretical spectrum in black, while the coloured lines are the spectra estimated from the 100 masked maps. On small scales, the amplitude of the fluctuations around the full-sky spectrum are small and average to zero, while on large scales the spectra estimated from different realisations can differ by orders of magnitude. In the bottom panel

­ 20 ­

Figure 9: Statistical fluctuations of our estimator applied to a map with partial sky coverage (fsky = 0.025). Top panel: true angular power spectrum (black) and angular power spectrum estimated from 100 Gaussian realisations, after applying the mask (coloured lines). Bottom panel: realisation noise of our estimator for Nreal realisations.

we show the realisation noise for Nreal that we quantify as

1 Nreal Cj - Ctrue

% realisation noise = 100 × Ctrue
j=1

, Nreal

(A.19)

where Ctrue is the true power spectrum while the Cj are the power spectra estimated from the 100 Gaussian realisations after applying our mask. For a single realisation (blue line) large-scales fluctuations for a map with a sky coverage fsky = 0.025 can be of order unity and are correlated significantly across a range of . Considering many realisations, these statistical fluctuations are strongly suppressed: for 100 realisation (dashed black line) they are  10 - 15% on < 10 and negligible on much smaller scales. Summing over an infinite number of realisation, the realisation noise here estimated should average out and the result should converge to the effect of the window function plotted in Fig. 8. Of course the realisation noise for 10 can also be reduced with larger sky coverage.

References
[1] DES Collaboration, T. Abbott et al., Dark energy survey year 1 results: Cosmological constraints from galaxy clustering and weak lensing, Phys.Rev.D 98 (2018), no. 4 043526, [arXiv:1708.01530].
[2] DES Collaboration, T. M. C. Abbott et al., Dark Energy Survey Year 3 Results: Cosmological Constraints from Galaxy Clustering and Weak Lensing, arXiv:2105.13549.

­ 21 ­

[3] DESI Collaboration, A. Aghamousa et al., The DESI Experiment Part I: Science,Targeting, and Survey Design, arXiv:1611.00036.
[4] Euclid Collaboration, R. Laureijs et al., Euclid Definition Study Report, arXiv:1110.3193. [5] L. Amendola et al., Cosmology and fundamental physics with the Euclid satellite, Living Rev.
Rel. 21 (2018), no. 1 2, [arXiv:1606.00180]. [6] LSST Project Collaboration, P. A. Abell et al., LSST Science Book, Version 2.0,
arXiv:0912.0201. [7] LSST Dark Energy Science Collaboration, Large Synoptic Survey Telescope: Dark Energy
Science Collaboration, ArXiv e-prints (Nov., 2012) [arXiv:1211.0310]. [8] SKA Cosmology SWG Collaboration, R. Maartens, F. B. Abdalla, M. Jarvis, and M. G.
Santos, Overview of Cosmology with the SKA, PoS AASKA14 (2015) 016, [arXiv:1501.04076]. [9] M. G. Santos et al., Cosmology with a SKA HI intensity mapping survey, arXiv:1501.03989. [10] O. Dor´e et al., Cosmology with the SPHEREX All-Sky Spectral Survey, arXiv:1412.4872. [11] J. Yoo, A. L. Fitzpatrick, and M. Zaldarriaga, New perspective on galaxy clustering as a cosmological probe: General relativistic effects, Phys. Rev. D 80 (Oct., 2009) 083514, [arXiv:0907.0707]. [12] C. Bonvin and R. Durrer, What galaxy surveys really measure, Phys. Rev. D84 (2011) 063505, [arXiv:1105.5280]. [13] A. Challinor and A. Lewis, The linear power spectrum of observed source number counts, Phys. Rev. D84 (2011) 043516, [arXiv:1105.5292]. [14] E. Di Dio, F. Montanari, J. Lesgourgues, and R. Durrer, The CLASSgal code for Relativistic Cosmological Large Scale Structure, JCAP 1311 (2013) 044, [arXiv:1307.1459]. [15] N. Kaiser, Clustering in real space and in redshift space, M.N.R.A.S. 227 (July, 1987) 1­21. [16] T. Matsubara, Correlation function in deep redshift space as a cosmological probe, Astrophys.J. 615 (2004) 573­585, [astro-ph/0408349]. [17] J. Yoo and M. Zaldarriaga, Beyond the Linear-Order Relativistic Effect in Galaxy Clustering: Second-Order Gauge-Invariant Formalism, Phys. Rev. D 90 (2014), no. 2 023513, [arXiv:1406.4140]. [18] O. Umeh, C. Clarkson, and R. Maartens, Nonlinear relativistic corrections to cosmological distances, redshift and gravitational lensing magnification. II - Derivation, Class. Quant. Grav. 31 (2014) 205001, [arXiv:1402.1933]. [19] E. Di Dio, R. Durrer, G. Marozzi, and F. Montanari, Galaxy number counts to second order and their bispectrum, JCAP 1412 (2014) 017, [arXiv:1407.0376]. [Erratum: JCAP1506,no.06,E01(2015)]. [20] J. T. Nielsen and R. Durrer, Higher order relativistic galaxy number counts: dominating terms, JCAP 03 (2017) 010, [arXiv:1606.02113]. [21] M. Borzyszkowski, D. Bertacca, and C. Porciani, LIGER: mock relativistic light-cones from Newtonian simulations, Mon. Not. Roy. Astron. Soc. 471 (2017), no. 4 3899­3914, [arXiv:1703.03407]. [22] H. Zhu, S. Alam, R. A. C. Croft, S. Ho, and E. Giusarma, N-body simulations of gravitational redshifts and other relativistic distortions of galaxy clustering, Mon. Not. Roy. Astron. Soc. 471 (2017), no. 2 2345­2356, [arXiv:1709.07859].
­ 22 ­

[23] J. T. Giblin, J. B. Mertens, G. D. Starkman, and A. R. Zentner, General Relativistic Corrections to the Weak Lensing Convergence Power Spectrum, Phys. Rev. D 96 (2017), no. 10 103530, [arXiv:1707.06640].
[24] M.-A. Breton, Y. Rasera, A. Taruya, O. Lacombe, and S. Saga, Imprints of relativistic effects on the asymmetry of the halo cross-correlation function: from linear to non-linear scales, Mon. Not. Roy. Astron. Soc. 483 (2019), no. 2 2671­2696, [arXiv:1803.04294].
[25] F. Beutler and E. Di Dio, Modeling relativistic contributions to the halo power spectrum dipole, JCAP 07 (2020), no. 07 048, [arXiv:2004.08014].
[26] F. Lepori, J. Adamek, R. Durrer, C. Clarkson, and L. Coates, Weak-lensing observables in relativistic N-body simulations, Mon. Not. Roy. Astron. Soc. 497 (2020), no. 2 2078­2095, [arXiv:2002.04024].
[27] C. Guandalin, J. Adamek, P. Bull, C. Clarkson, L. R. Abramo, and L. Coates, Observing relativistic features in large-scale structure surveys ­ I. Multipoles of the power spectrum, Mon. Not. Roy. Astron. Soc. 501 (2021), no. 2 2547­2561, [arXiv:2009.02284].
[28] L. Coates, J. Adamek, P. Bull, C. Guandalin, and C. Clarkson, Observing relativistic features in large-scale structure surveys ­ II: Doppler magnification in an ensemble of relativistic simulations, arXiv:2011.12936.
[29] J. Adamek, D. Daverio, R. Durrer, and M. Kunz, General relativity and cosmic structure formation, Nature Phys. 12 (2016) 346­349, [arXiv:1509.01699].
[30] J. Adamek, D. Daverio, R. Durrer, and M. Kunz, gevolution: a cosmological N-body code based on General Relativity, JCAP 07 (2016) 053, [arXiv:1604.06065].
[31] SDSS Collaboration, R. Scranton et al., Detection of cosmic magnification with the Sloan Digital Sky Survey, Astrophys. J. 633 (2005) 589­602, [astro-ph/0504510].
[32] X. Liu, D. Liu, Z. Gao, C. Wei, G. Li, L. Fu, T. Futamase, and Z. Fan, Detection of Cosmic Magnification via Galaxy Shear ­ Galaxy Number Density Correlation from HSC Survey Data, arXiv:2104.13595.
[33] C. Duncan, B. Joachimi, A. Heavens, C. Heymans, and H. Hildebrandt, On the complementarity of galaxy clustering with cosmic shear and flux magnification, Mon. Not. Roy. Astron. Soc. 437 (2014), no. 3 2471­2487, [arXiv:1306.6870].
[34] F. Montanari and R. Durrer, Measuring the lensing potential with tomographic galaxy number counts, JCAP 1510 (2015), no. 10 070, [arXiv:1506.01369].
[35] A. Raccanelli, F. Montanari, D. Bertacca, O. Dor´e, and R. Durrer, Cosmological Measurements with General Relativistic Galaxy Correlations, JCAP 1605 (2016), no. 05 009, [arXiv:1505.06179].
[36] W. Cardona, R. Durrer, M. Kunz, and F. Montanari, Lensing convergence and the neutrino mass scale in galaxy redshift surveys, Phys. Rev. D94 (2016), no. 4 043007, [arXiv:1603.06481].
[37] E. Di Dio, F. Montanari, A. Raccanelli, R. Durrer, M. Kamionkowski, and J. Lesgourgues, Curvature constraints from Large Scale Structure, JCAP 06 (2016) 013, [arXiv:1603.09073].
[38] C. S. Lorenz, D. Alonso, and P. G. Ferreira, Impact of relativistic effects on cosmological parameter estimation, Phys. Rev. D 97 (2018), no. 2 023537, [arXiv:1710.02477].
[39] E. Villa, E. D. Dio, and F. Lepori, Lensing convergence in galaxy clustering in CDM and beyond, Journal of Cosmology and Astroparticle Physics 2018 (Apr, 2018) 033­033.
[40] K. Tanidis, S. Camera, and D. Parkinson, Developing a unified pipeline for large-scale structure data analysis with angular power spectra ­ II. A case study for magnification bias and radio
­ 23 ­

continuum surveys, Mon. Not. Roy. Astron. Soc. 491 (2020), no. 4 4869­4883, [arXiv:1909.10539].
[41] G. Jelic-Cizmek, F. Lepori, C. Bonvin, and R. Durrer, On the importance of lensing for galaxy clustering in photometric and spectroscopic surveys, arXiv:2004.12981.
[42] N. Bellomo, J. L. Bernal, G. Scelfo, A. Raccanelli, and L. Verde, Beware of commonly used approximations. Part I. Errors in forecasts, JCAP 10 (2020) 016, [arXiv:2005.10384].
[43] P. McDonald, Gravitational redshift and other redshift-space distortions of the imaginary part of the power spectrum, Journal of Cosmology and Astroparticle Physics 2009 (nov, 2009) 026­026.
[44] C. Bonvin, L. Hui, and E. Gaztanaga, Asymmetric galaxy correlation functions, Phys. Rev. D 89 (2014), no. 8 083535, [arXiv:1309.1321].
[45] S. Alam, H. Zhu, R. A. C. Croft, S. Ho, E. Giusarma, and D. P. Schneider, Relativistic distortions in the large-scale clustering of SDSS-III BOSS CMASS galaxies, Mon. Not. Roy. Astron. Soc. 470 (2017), no. 3 2822­2833, [arXiv:1709.07855].
[46] D. Alonso, P. Bull, P. G. Ferreira, R. Maartens, and M. Santos, Ultra large-scale cosmology in next-generation experiments with single tracers, Astrophys. J. 814 (2015), no. 2 145, [arXiv:1505.07596].
[47] J. Adamek and C. Fidler, The large-scale general-relativistic correction for Newtonian mocks, JCAP 09 (2019) 026, [arXiv:1905.11721].
[48] J. Adamek, J. Brandbyge, C. Fidler, S. Hannestad, C. Rampf, and T. Tram, The effect of early radiation in N-body simulations of cosmic structure formation, Mon. Not. Roy. Astron. Soc. 470 (2017), no. 1 303­313, [arXiv:1703.08585].
[49] J. Brandbyge and S. Hannestad, Grid Based Linear Neutrino Perturbations in Cosmological N-body Simulations, JCAP 05 (2009) 002, [arXiv:0812.3149].
[50] K. M. G´orski, E. Hivon, A. J. Banday, B. D. Wandelt, F. K. Hansen, M. Reinecke, and M. Bartelman, HEALPix - A Framework for high resolution discretization, and fast analysis of data distributed on the sphere, Astrophys. J. 622 (2005) 759­771, [astro-ph/0409513].
[51] I. Szapudi, S. Prunet, D. Pogosyan, A. S. Szalay, and J. R. Bond, Fast CMB analyses via correlation functions, astro-ph/0010256.
[52] G. Chon, A. Challinor, S. Prunet, E. Hivon, and I. Szapudi, Fast estimation of polarization power spectra using correlation functions, Mon. Not. Roy. Astron. Soc. 350 (2004) 914, [astro-ph/0303414].
[53] J. Lesgourgues, The Cosmic Linear Anisotropy Solving System (CLASS) I: Overview, arXiv:1104.2932.
[54] D. Blas, J. Lesgourgues, and T. Tram, The Cosmic Linear Anisotropy Solving System (CLASS) II: Approximation schemes, JCAP 1107 (2011) 034, [arXiv:1104.2933].
[55] R. Takahashi, M. Sato, T. Nishimichi, A. Taruya, and M. Oguri, Revising the Halofit Model for the Nonlinear Matter Power Spectrum, Astrophys. J. 761 (2012) 152, [arXiv:1208.2701].
[56] S. Colombi, A. Jaffe, D. Novikov, and C. Pichon, Accurate estimators of power spectra in N-body simulations, Monthly Notices of the Royal Astronomical Society 393 (02, 2009) 511­526, [https://academic.oup.com/mnras/article-pdf/393/2/511/3041758/mnras0393-0511.pdf].
[57] A. F. Heavens, S. Matarrese, and L. Verde, The Nonlinear redshift-space power spectrum of galaxies, Mon. Not. Roy. Astron. Soc. 301 (1998) 797­808, [astro-ph/9808016].
[58] T. Matsubara, Resumming Cosmological Perturbations via the Lagrangian Picture: One-loop Results in Real Space and in Redshift Space, Phys. Rev. D77 (2008) 063530, [arXiv:0711.2521].
­ 24 ­

[59] A. Taruya, T. Nishimichi, and F. Bernardeau, Precision modeling of redshift-space distortions from a multipoint propagator expansion, Phys. Rev. D87 (2013), no. 8 083509, [arXiv:1301.3624].
[60] L. F. de la Bella, D. Regan, D. Seery, and D. Parkinson, Impact of bias and redshift-space modelling for the halo power spectrum: Testing the effective field theory of large-scale structure, arXiv:1805.12394.
[61] M. Jalilvand, B. Ghosh, E. Majerotto, B. Bose, R. Durrer, and M. Kunz, Nonlinear contributions to angular power spectra, Phys. Rev. D 101 (2020), no. 4 043530, [arXiv:1907.13109].
[62] H. S. Grasshorn Gebhardt and D. Jeong, Nonlinear redshift-space distortions in the harmonic-space galaxy power spectrum, Phys. Rev. D 102 (2020), no. 8 083521, [arXiv:2008.08706].
[63] B. Ghosh, R. Durrer, and E. Sellentin, General relativistic corrections in density-shear correlations, JCAP 06 (2018) 008, [arXiv:1801.02518].
­ 25 ­

