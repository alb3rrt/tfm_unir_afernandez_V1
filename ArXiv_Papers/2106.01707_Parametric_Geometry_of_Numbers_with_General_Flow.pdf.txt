arXiv:2106.01707v1 [math.DS] 3 Jun 2021

PARAMETRIC GEOMETRY OF NUMBERS WITH GENERAL FLOW
OMRI NISAN SOLAN
Abstract. We extend results of parametric geometry of numbers to a general diagonal flow on the space of lattices. Moreover, we compute the Hausdorff dimension of the set of trajectories with every given behavior, with respect to a nonstandard metric and thereby attain bounds on the standard ones.

1. Introduction
Let Xn be the space of rank n lattices in Rn with covolume 1, and let gt  SLn(R) be a 1-parameter diagonal flow. There is a long history of research on the behavior of gt orbits in Xn, see [6], [14], [15].
In 2011, Cheung [4] computed the Hausdorff dimension of the set of gt = exp(t diag(-2, 1, 1)) divergent trajectories in X3, and proved that the Hausdorff codimension is 2/3. Later on, many extensions of his result were proved, e.g.,

Paper [4] [8] [5] [12] [17]
[10] [1]

space X3 X3 Xn+1
Xn+m X3
general G/
Product space

flow eigenvalues

-2, 1, 1

-2, 1, 1

-n, 1, . . . , 1

-m, . . . , -m, n, . . . , n

-1, w1, w2;

w1  w2 w1 + w2 = 1

General flow flow weighted with respect to product

codimension

2

3

n

2 3

n+1



nm n+m

1 1+w1

>0 exact result

remarks using entropy method

computed on





100

 1 0 orbits

01

Date: June 4, 2021. I thank My advisor Barak Weiss and Eilon Solan for their comments, and acknowledge the support of ISF 2919 BSF 2016256.
1

2

OMRI NISAN SOLAN

In the first four results, all eigenvalues of the flow greater than 0 are equal, and so are the eigenvalues smaller than 0.
An independent research direction initiated by Schmidt and Summerer [21] and continued by Roy [18], though solving a seemingly different problem, classified the possible trajectories gt for   Xn up to equivalence. They use the

(1.1)

gt := exp(t diag(n, . . . , n, -m, . . . , -m))

action on Xn+m. We say two trajectories gt1, gt2 are equivalent if the distance between gt1, gt2 is bounded for all t > 0.
Das, Fishman, Simmons, and Urban´ski [7] merged these two research directions and proved a general result computing the Hausdorff dimensions of sets of trajectories closed under equivalence in the setting of the gt = exp(t diag(n, . . . , n, -m, . . . , -m)) action on Xn+m.
In this paper we extend the result by Das, Fishman, Simmons, and Urban´ski [7] to a set of trajectories with respect to a general one dimension diagonal action gt Xn. We compute the dimension of the set of trajectories with any desired behavior, provide exact dimension
formulas with respect to a weighted metric, which depends on gt, and conclude lower and upper bounds on the standard Hausdorff dimension.

1.1. Structural Exposition. Section 2 is dedicated to laying the preliminaries before we can formally state the main results of this paper. Sections 4-10 are dedicated to Theorem 2.30, the main theorem of this paper, which determines the Hausdorff dimension of certain families of trajectories with respect to a certain (non-standard) metric. Section 11 is dedicated to the proof Corollary 2.31, which applies Theorem 2.30 to the family of divergent trajectories.
Theorem 2.30 transforms a dynamical question on the space of lattices, to a combinatorial question on a combinatorial object, namely g-templates. In Section 4 we discussion the Hausdorff dimension of sets, and present our computational tool which translates the computation of the Hausdorff dimension to the dynamical question of computing the value of the Dimension Game introduced in [7]. In Section 5 we discuss properties of g-templates. In Sections 6 and 7 we prove geometric theorems which we will apply in the following three sections. Finally in Sections 8 and 9 we describe strategies in the dimension game of the two players, and we compute the game's value in Section 10.

1.1.1. Mathematical topics. The mathematical topics in this paper can be roughly divided into three parts.

3
(a) The geometric part. In this part of the paper we will discuss the geometric properties of the action of SLn(R) and its subgroups gt and H on the Grassmannian.
(b) The dynamical part. This part will apply theorems of the geometric part iteratively and use them to define strategies of the dimension game.
(c) The combinatorial part. This part describes the combinatorics of the g-templates, and possible operations on them.
These parts are not independent. The combinatorial objects are designed in view of the geometric theorems. The dynamical part apply iteratively the geometric theorems, and use the same geometric core. The dynamical part follows a certain combinatorial object, and will use it to control noises.
1.1.2. Dependencies. Altough the proofs of the main results depend on intuition gathered most of the chapters preceding them, in a first reading the reader can read only Sections 2, 4.4, and 5 up to Subsection 5.1, 7, the introduction of Section 8 and Sections 9 - 11.
2. Preliminaries
2.1. Geometry of Trajectories. Let Xn = SLn(R)/ SLn(Z) denote the topological space of rank n dimensional lattices in Rn with determinant 1. Denote the standard right invariant Riemannian metric on SLn(R) by dSLn(R). It induces a metric dXn on Xn.
By right invariance we obtain
(2.1) g  SLn(R),   Xn. dXn(g, ) < dSLn(R)(g, Id).
Fix a sequence of real weights
1  2  · · ·  n with 1 + · · · + n = 0,
for the rest of the paper. Denote gt := exp(t diag(1, . . . , n)) be a 1-parameter group {gt : t  R}  SLn(R). Denote by Eall := {1, . . . , n} the multiset of the weights. The multiplicity of i is the number of j such that j = i.
We say that two trajectories {gt : t  0}, {gt : t  0} are equivalent if dXn(gt, gt) is uniformly bounded for t > 0.

4

OMRI NISAN SOLAN

2.2. Auxiliary Group Actions. Set

H = h  SLn(R) : g-thgt -t-- Id
H- = h  SLn(R) : gthg-t -t-- Id H0 = {h  SLn(R) : gthg-t = h} H-0 =H-H0

- The expanding subgroup,
- The contracting subgroup, - The stable subgroup, - The nonexpanding subgroup.

Observation 2.1. Writing in coordinates we observe that

H = {h  SLn(R) : hij = ij if i  j} , H- = {h  SLn(R) : hij = ij if i  j} , H0 = {h  SLn(R) : hij = 0 if i = j} , H-0 = {h  SLn(R) : hij = 0 if i > j} .

In case the 1 < · · · < n the group H (resp. H-) is the group of lower (resp. upper) triangular matrices with 1 on the diagonal, and H0 is

the group of diagonal matrices.



Remark 2.2. Here we see the use of  to mark the end of an observation. Likewise,  will mark the end of a definition,  the end of an example, and the end of a proof.
Lemma 2.3. The multiplication map
mUL : H × H-0  SLn(R); (h, q-0)  q-0h
has dense Zariski open image that contains Id.
Proof. Since H, H-0 are algebraic groups and the intersection of the complexifications HC  HC-0 = {Id} it follows that mUL is one to one. Since dim H + dim H-0 = dim SLn(R) it follows that mUL is an open map, and hence its image is open. Since SLn(R) is irreducible as an algebraic variety it follows that the images are dense.

Observation 2.4. By Eq. (2.1) for every q  H-0,   Xn, the tra-

jectories gt, gtq are equivalent. Hence, studying the behavior of trajectories of lattices lattices in H-0H is equivalent to studying the

behavior of trajectories of lattices in H.



5

The restricted metric dH of dSLn(R) on H does not suit us as it has bad behavior with the gt action. We use instead the semi-metric d on
H defined by by

d(h1, h2) := exp (- min{t  R : dH(gth1g-t, gth2g-t)  1}) .
The semimetric d satisfies the equality
d(gth1g-t, gth2g-t) = exp(t)d(h1, h2), while dH has no such property even approximately. We will see that d is not a necessarily a metric, but there exists a constant  < 1 such that d is a metric, see Subsections 4.1 and 4.2.

2.3. The Harder-Narasimhan Filtration. The Harder-Narasimhan

filtration of a lattice was defined in [11] in the context of algebraic ge-

ometry, and adapted to lattices by Grayson [9]. Its construction for

standard lattices in Rn goes as follows.

For every lattice  < Rn, denote by covol  the Euclidean volume of

the torus span /. By convention covol{0} := 1.

Informally, the Harder-Narasimhan filtration of a lattice  is a lat-

tice filtration {0} = l0  l1  · · ·  lk =  of "minimal covolume", where rank li = li. It is the set of all sublattices    with exceptionally small covolume; if rank  = l even if we know the minimal covolume

of all lattices for every possible rank l = l, the covolume of  is still par-

ticularly

small.

Formally, we associate to every

lattice    the point p :=

(rank , log covol )  R2. For

1

every lattice   Xn define S := {p :   }. Denote the extreme points of the convex hull

1234

conv(S) by {pl : l  L} where -1 the index l is the x coordinate of

pl. For each l  L, let l  
satisfy pl = pl. By [9], the lattices {l : l  L}
form a filtration of . Further-

Figure 1. An illus-
tration of S. (Not based on a real lat-

more, l is the unique subgroup

tice)

that is associated to the point pl

for l  L.

By definition, for every l  L one has covol l < 1. The filtration FHN() := {l : l  L} is the Harder-Narasimhan Filtration. Note

that we index the elements in the filtration by their rank, and the set

of ranks is L = L().

6

OMRI NISAN SOLAN

2.4. Various Filtration Types. We will often use linear subspaces V  Rn. The Grassmannian Gr(l, n) is the space of all l dimensional subspaces V  Rn. Denote by dGr(l,n) the path metric on Gr(l, n) derived from the Riemannian metric on Gr(l, n), which is invariant to multiplication by orthogonal matrices.
The group {gt} acts on Gr(l, n). The set of invariant spaces is denoted Gr(l, n)g. For any V  Gr(l, n) the eigenvalues of the action of gt on V are exp(t) for a multiset of   Eall. Hence denote by Il the set of multisets of Eall of size l.
For every E  Il denote by Gr(l, n)gE the space of V  Gr(l, n)g such that the eigenvalues of g|V are {exp(t) :   E}.
Example 2.5. Let n = 4, Eall = {-1, 0, 0, 1}, and l = 2. Then I2 = {{-1, 0}, {-1, 1}, {0, 1}, {0, 0}}. We get that
Gr(2, 4)g{-1,0} = {span(e1, v) : 0 = v  span(e2, e3)}, Gr(2, 4)g{-1,1} = {span(e1, e4)},
Gr(2, 4)g{0,1} = {span(e4, v) : 0 = v  span(e2, e3)}, Gr(2, 4)g{0,0} = {span(e2, e3)}.


A flag is an increasing sequence of linear spaces,

V· : 0 = V0  Vl1  Vl2  · · ·  Vlk = Rn; dim Vli = li. A direction filtration is a sequence

(2.2)

E· :  = E0  El1  El2  · · ·  Elk = Eall; Eli  Ili .

Denote by L(V·) = L(E·) := {l0, . . . , lk}. A height sequence a· : 0 = a0, a1, . . . , an = 0, is a convex sequence
of numbers, that is, for every l we have

2al := al-1 - 2al + al+1  0.
The nontrivial places 1  l  n-1 of a· are those for which 2al > 0. By convention l = 0, n are also nontrivial place. Denote the set of nontrivial places by L(a·). Using convexity we can reconstruct a· from the values (al)lL(a·).
A height sequence a· is said to be compatible with a flag V· (resp. a direction filtration E·) if L(a·) = L(V·) (resp. L(a·) = L(E·)). A compatible tuple of those will be called flag with heights (resp. direction filtration with heights). We will write it by F that have the corresponding height sequence FH,·, a flag FV,· (resp. a the direction filtration FE,·).

7
The Harder-Narasimhan filtration FHN() : {l : l  L} of a lattice  yields a compatible flag FHN()V,· = span ·, and a height sequence defined by FHN()H,l = log covol l for every l  L and extended piecewise linearly for other l. For consistency we will write FHN(),l = l.
2.5. Dynamics of Linear Spaces. For every 0  l  n consider the standard L2 norm · on l Rn. Denote by Bln the set of l-blades in l Rn, that is, the set of vectors 0 = v  l Rn that can be written as v = v1  v2  · · ·  vl for v1, . . . , vl  Rn. Blades are useful for the following definition:

Definition 2.6. Let   Rn be a lattice of rank l. Let v1, ..., vl be a basis of . Define the blade of  by

Bl  := v1  v2  · · ·  vl.

It is well-defined up to sign.



We identify the real Grassmanian Gr(l, n), the space of l-dimensional subspaces of Rn, with Bln/R× by
v1  · · ·  vl  span(v1, . . . , vl).
Here R× denotes the multiplicative group of R. The group GLd(R) acts naturally on the spaces l Rn and Gr(l, n).
Recall that the connected components of the g invariant subspace Gr(l, n)g are Gr(l, n)gE for every E  Il. Define a partial order on Il by E1 E2 if for every r > 0 we have #{x  E1 : x > r}  #{x  E2 : x > r}. In other words, we can obtain E2 from E1 by increasing elements. Here the sign # denotes the number of elements in a set. We say that E1  E2 if E1 E2 and E1 = E2. Note that we have (and will use) two partial orders on multisets: multiset inclusion  and the new partial order .
The following result describes the dynamics of the gt action on Gr(l, n). Its proof appears in Subsection 6.1.
Theorem 2.7. For every  > 0, 1  l  n - 1 there is C > 0 such that for every V  Gr(l, n) we have a sequence E1  · · ·  Er  Il and a sequence of intervals a1 < b1 < a2 < b2 < · · · < ar < br such that
r-1
a1 = -, br = , ak+1 - bk < C
k=1
and for every t  (ak, bk), the space gtV is in an -neighborhood U(Gr(l, n)gEk).

8

OMRI NISAN SOLAN

Remark 2.8. Note that in Theorem 2.7 if  is large enough the theorem states nothing. On the other hand, if we take



<

0

:=

min min
1ln-1 E1=E2Il

dGr(l,n)(Gr(l, n)gE1,

Gr(l,

n)gE2 )

then we have a uniqueness property for the output. That is, if E1  · · ·  Er  Il, a1 < b1 < a2 < b2 < · · · < ar < br, and E1  · · ·  Er  Il, a1 < b1 < a2 < b2 < · · · < ar < br are two valid outputs of Theorem 2.7, then if (ai, bi)  (aj, bj) =  of 1  i  r, 1  j  r then Ei = Ej . In particular, if bi - ai > C then Ei must be one of the of the Ej.

Definition 2.9 (Exterior eigenvalues). For every E  Il denote E :=

E . This sum, as all operations on multisets, counts the elements

E which

with multiplicities. corresponds to V 

The eigenvalue of gt at Gr(l, n)gE is exp(tE).

an

l-blade

w



Bln, 

A consequence of Theorem 2.7 is the following.
Corollary 2.10. For every w  Bln there are - = t0 < · · · < tr = , and E1  . . .  Er  Il such that log gtw = exp(f (t)) + O(1), where f (t) is a piecewise linear function with f (t) = Ek for every tk-1 < t < tk.

Example 2.11 (Existence of a blade given a function). Denote by

k the number of different values of  in Eall, and denote them by

¯1 < ¯2 < · · · < ¯k. Let f : R  R be a convex piecewise-linear function, - = t0  t1  · · ·  tk =  such that df /dt(t) = r for tr-1 < t < tr. We will construct a vector v  Rn such that log gtv =

f (t) + O(1) for every t.

Denote by V the exp(t) eigenspace of gt. Fix v  V with

v = 1. Note that for some constants (a)Eall  {-}  R we have f (t) = maxEall(t +a). Therefore, the vector Eall exp(a)v satisfies the desired condition.

If C > 0 is large and tr-1 + C  t  tr - C then the only significant summand in gtv is ar gtvr , and hence gtv · R  U(Gr(1, n)g{r}.
By wedging such vectors we can attain similar results for spaces and

blades with l > 1.



2.6. A g-Template. In this section we describe information that is given in a trajectory gt up to equivalence. Though for most choices of Eall the information on the trajectory that we will provide will be equivalent to the equivalence relation on trajectories, sometimes this
information will be stronger than the equivalence relation. We will keep

9

track of some of the information provided by the Harder-Narasimhan
filtration FHN(gt), and the direction of their linear spaces. We wish to encode the "behavior of FHN(gt)" for t  0. For every
   of rank l there is a (possibly empty) set U  R such that gt = FHN(gt),l for all t  U. It will follow that U is approximately an interval.
Inspired by Theorem 2.7, we will encode the behavior of gt for t  U with multisets Id  Il. The partially ordered structure on Il will not suffice as FHN(gt) might not contain a rank l element, and FHN(gt)V,l can return to the same U(Gr(l, n)gE) many times.
It will be convenient to extend Il into a category, though we will use only the combinatorial structure of a category and not the whole
power of the theory. See Example 2.16 for an equivalent formulation
of the concepts without categories.

Definition 2.12. Let 1  l  n - 1. Define a category Il whose objects are Il  {}, where  is the null object, and that has two types of arrows.

· Transition type arrows: for a, b  Il we have a transition arrow a - b if a b. Composition of transition arrows (b - c)(a -

b) is the transition arrow a - c. For every a  Il the arrow

a - a is the identity arrow. · Null type arrows: for every a, b  Il we have a null arrow a - b.
The composition of a null arrow with any arrow is a null arrow.

By convention for l  {0, n} we denote Il = Il the unique arrow is

the identity, the single element in Il is the null element.



The object  will be used to indicate there is no l dimensional space in a flag. Transition arrows correspond to a linear space changing the gt invariant linear space it is close to, and the null arrows correspond to replacing a linear space in Harder-Narasimhan Filtration.

Definition 2.13. Extend each direction filtration E· by setting El = 

whenever El was not defined previously.

Define the category I· whose set of objects is all direction filtrations

E·, and each arrow between E· and E· is a collection of n + 1 arrows

(El  El)l=0,...,n. We say that the empty filtration   Eall is the null

element of I·, and an arrow E·  E· in I· is null if the induced arrow

El  El is null for every l = 1, ..., n - 1.



Definition 2.14. Let C be a category with a null element. For every interval I  R a category flow f : I  C is a locally constant map

10

OMRI NISAN SOLAN

f : I \ T  C for a locally finite set T  I together with the choice of a non identity arrow f-(t)  f+(t) for every point t  T , where f±(t) = lim0 f (t ± ). A point t  I is called a null point if

· t  T and f-(t)  f+(t) is the null arrow, or · f (t) is the null object.

All other points are called nontrivial points.

Points in T are called irregular point and the other are called regular

points.



Observation 2.15. Let I  R be an interval and let 0  l  n. We

can restrict every category flow fE,· : I· to its l-th entry and obtain a

category flow fE,l : I  Il.



Example 2.16. Let I = (A, B) be an open interval. A, B may be ±. A category flow f : I  Il contains the following information:
· A collection of disjoint intervals ((ai, bi))iZ in I, where Z  Z is a possibly infinite collection of consequent integers, were bi  ai+1 for every tuple of consecutive integers i, i + 1  Z. In addition the set {ai, bi : i  Z} is required to be locally finite.
· A finite set Ti = {ai = ci,0 < ci,1 < ci,2 < · · · ci,ri = bi} for every iZ
· A sequence of multisets Ei,1  Ei,2  · · ·  Ei,ri for every i  Z.
Denote
T := Ti.
iZ
Define a category flow by

f (t) = Ei,j if ci,j-1 < t < ci,j,  if t  I \ iZ [ai, bi],

and the connecting morphisms are Ei,j-1 - Ei,j at t = ci,j for every

i  Z, 1  j < ri, and the null morphism for t = ai, bi for i  Z,

provided that t  I (as opposed to t being an endpoint of I). This is

a complete description of a category flow f : I  Il.



We now define our encoding for gt trajectories, which are termed g-templates, and play a crucial role in this paper.

Definition 2.17. A g-template f over an interval I  R is a category
flow fE,· : I  I· and a continuous height sequence valued map t  fH,·(t) such that

11

(1) For every t  I which is regular for fE,·(t), the tuple (fE,·(t), fH,·(t)) forms a direction filtration with heights.
(2) For every 1  l < n and t  I which is regular and not a null point for fE,l,

(2.3)

fE,l(t)

=

d dt

fH,l(t).

Note that each fE,l : I  Il is a category flow.

Definition 2.18. Let f be a g-template on an interval I. Denote by Ul(f ) the set of nontrivial points of fE,l, and U0(f ) = Un(f ) := I. Ul(f ) is a disjoint union of open intervals (as every open subset of R), term them the nontriviality intervals of f at l.
Define the set of all nontriviality intervals by

n
Gf := 0(Ul(f )),
l=0

where 0(Ul(f )) is the set of nontriviality intervals of f at l.



Remark 2.19. We have already defined the concept of nontrivial places of a height sequence, and nontrivial points of a g-template. This is the same thing; l is a nontrivial place of fH,·(t) if and only if t is a nontrivial point of fE,l.

Example 2.20. In Figure 2 we present a g-template with Eall = {-1.2, 0.5, 0.7}. The nontriviality intervals are depicted in full lines
and the parts outside them in dashed lines.
In Figure 3, we provide two cross sections of f at the three points
t0, t1, 2. Note that the value of fH,2(t0) is defined by fH,1(t0) and convexity. Similarly fH,1(t0) is defined by fH,1(t0) and convexity.


We say that two g-templates f, f  over I  R are C-close if

(3) For every 0  l  n and t  I we have |2fH,l(t) - 2fH ,l(t)| < C.
(4) For every subinterval [a, b]  I of length |a - b|  2C with 2fH,l(t)  C and fE,l|[a,b]  E  Il, we have fE ,l|[a+C,b-C]  E. We require also the symmetric claim when swapping f and f .

The concept of C-closeness defines a metric on the set of g-templates.

We say that two g-templates are equivalent if they are C close for some

C.



12

OMRI NISAN SOLAN

Figure 2. A g-template.

t0

t1 t2

t fH,1 fH,2

fE,1 :  fE,2 : 

{-1.2}

{0.5}  {-1.2}{0.7}



{-1.2, 0.5}

{-1.2, 0.7} {0.5, 0.7}

Figure 3. The cross sections.

123

123

l

l

123 l

fH,l(t0)

fH,l(t1)

fH,l(t2)

Remark 2.21. Condition 3 is equivalent to bounding the supremum |fH,l(t) - fH ,l(t)|, with different constant. We define it as in Condition 3 for technical reasons.
g-templates are related to g-trajectories by the following definition.

Definition 2.22 (g-template matching a Lattice). Let 0 as in Remark 2.8, 0 <  < 0, C > 0 and I  R an interval. We say that a lattice   Xn (, C)-matches a g-template f on I if the following two conditions hold.
(1) For every t  R, 1  l  n - 1 we have
|FHN(gt)H,l - fH,l(t)| < C.

13

(2) For every 1  l  n-1 and interval [a, b] such that fE,l(t) = E  Il and 2fH,l(t)  C for every t  [a, b], we have FHN(gt)V,l  U(Gr(l, n)gE).

Note that such a template is unique up to g-template equivalence. If

such a template exists for I = R we denote it by f .



Observation 2.23. By the uniqueness property observed in Remark

2.8 we get that if  (, C)-matches f then for every  <  there is

C > 0 such that  (, C)-matches f .



Remark 2.24. In [20] Schmidt describes a weaker form of the g-template, which is is similar to the definition of g-templates but does not remember the multisets. It equivalent to the following definition. A g-system is a height sequence valued map fH,· : R  {height sequences} such
(1) For every 0  l  n the function t  fH,l(t) is piecewise linear. (2) For every 1  l  n - 1, t  R for which 2fH,l(t) > 0 we have
that fH,l is locally convex near t and

d dt

fH,l(t)



{E

:

E



Il}.

if

d dt

fH,l

(t)

is

defined.

Here are two examples which shows that the multisets conditions of g-templates are necessary to the existence of a lattice that (, C)matches a template.

Counter Example 2.25. Let n = 4, 1 = -2, 2 = -1, 3 = 1, 4 = 2. Define Let fH,· : R  {height sequences} be defined by

fH,·(t) =

0 tal

t  0, t > 0.

where a0 = 0, a1 = -1, a2 = -1, a3 = -1/2, a4 = 0. Then fH,l(t) is indeed piecewise linear, but there is no  that (, C)-matches f
for every , C > 0. Indeed, then there would be 0  1  2   of ranks 1, 2 respectively such that for every t  0, l = 1, 2 we have
log covol gtl = fH,l(t) + O(1). Combining Theorem 2.7 and Corollary 8.12 we get that

span gt1 -t-- Gr(1, 4)g{-1} and span gt2 -t--  Gr(2, 4)g{-2,1}.

But this contradicts the fact that no space in Gr(2, 4)g{-2,1} contains a

space in Gr(1, 4)g{-1}.



14

OMRI NISAN SOLAN

Counter Example 2.26. Let n = 4, 1 = -2, 2 = 3 = -13 = 4. Let T be arbitrarily large. Define Let fH,· : R  {height sequences} be defined by

fH,·(t) =

0 |T - t|al

|t|  T, |t| < T.

where a0 = 0, a1 = -1, a2 = -2, a3 = -1, a4 = 0. Then fH,l(t) is

indeed piecewise linear, but there is no  that (, C)-matches f for

every , C > 0, and T large enough as a fuction of C, . Indeed, then

there would be 0  2   of ranks 2 respectively such that for every t with |t|  T we have log covol gt2 = -2|T - t| + O(C). This is

incompatible with Theorem 2.7 as the only multisets E  I2 with

E = ±2 are {-1, -1} and {-2, 4} and {-1, -1} {-2, 4}.



We can now state the main results of this paper.
2.7. Results.
Theorem 2.27 (Template Existence Theorem). For every 0 <  < 0 there is C > 0 such that every   Xn (, C)-matches a g-template f on R.
Remark 2.28. Theorem 2.27 extends the results of [21] from the flow described in Eq. (1.1) to a general diagonal flow. In addition, it sharpen [20, Proposition 2.2].

Definition 2.29. For every direction filtration E·  I· denote

k

(E·) :=

( - )+,

i=1

Eli

Eli \Eli-1

where a+ = max(a, 0). For every g-template f on [0, ) define

0(f )

=

lim inf T 

1 T

T
(fE,·(t))dt,
0

and (f ) = supff 0(f ), where the supremum is over all f  which

are equivalent to f .



Let F be a set of g-templates, closed under equivalence and  be a lattice. Denote
Y,F := {h  H : f h  F }  H.
The g-template f h is define as in Definition 2.22.

15

Theorem 2.30. Let F be a set of g-templates, closed under equivalence. Then for every   Xn,

dimH(Y,F ; d) = sup (f ) = sup 0(f ),

f F

f F

where d is the expansion metric on H with respect to the conjugation by gt, see Subsection 4.2, and dimH is the Hausdorff dimension.

By Corollary 4.8 we have

D := dimH(H; d) = (  Eall) =

( - )+.

, Eall

Corollary 2.31. Denote  := Eall +. Then dimH(Sing(H, ; gt); d) = D - ,
where Sing(H, ; gt) is the set of h  H such that gth diverges, provided n  3.

Remark 2.32. Corollary 2.31 holds for n  2 if we replace the divergent condition with divergent in average. The proof is similar to the proof provided here.

We can pair both results with The Comparison Theorem 4.7. We will construct two functions, F : [0, D]  [0, N] and F : [0, N]  [0, D], where N = dim H is the standard manifold dimension of H.

Corollary 2.33. Let F be a set of g-templates, closed under equivalence. Then for every   Xn,

F -1 sup 0(f )  dimH(Y,F ; dH)  F sup 0(f ) ,

f F

f F

where dH is standard right invariant metric on H. In particular

F -1 (D - )  dimH(Sing(H, ; gt); dH)  F (D - ) ,

provided that n  3.

The following corollary extends the result of [18] to general flows form the flow of Eq. (1.1). Together with Theorem 2.27 it provides a complete classification of the possible functions t, i  FHN(gt)H,i up to a bounded constant for t  0 and 0  i  n, and complete the proof of the correction of [20, Conjectures 2.3]. The corollary follows directly from Theorem 2.30, however it does not require the Hausdorff dimension machinery the proof of Theorem 2.30 requires and we will provide a proof that does not require this machinery at Subsection 8.6.

16

OMRI NISAN SOLAN

Corollary 2.34. For every g-template f the set
Y,f := {h  H : f h  f }.
is nonempty.
2.8. Notations. For every real valued expression F we will use the notation O(F ), (F ), and (F ) to denote expressions that satisfy |O(F )| < CF, cF < (F ) < CF, (F ) > cF for constants C, c > 0 that depend only on Eall.
For two real valued expressions F, G we say that G  F if there is an implicit function  : (0, )  (0, ) such that G > (F ). This notation will allow us to state expressions of the form: "Set x  y. Then x > y3 + y". Hence, the function  is determined implicitly after the expression involving  is stated. The notation x  y can hence be used as a shorten of an argument of the form "Choose x > (y), where (y) will be determined later implicitly".
For every metric space (X, d), a point x  X and r > 0 we will denote the closed ball around x with radius r by Bd(x; r). We will use this notation even if d is not a metric, but any function d : X ×X  R.

3. Further Research
There are many directions one can hope to further understand, as suggested in [7, Section 6]. We mention here some which arise when considering general 1-parameter flows.
3.1. Comparison to the standard Hausdorff dimension. Corollary 2.33 bounds the standard Hausdorff dimension of trajectory sets in H.

Example 3.1. [17] deals with the case n = 3,1 = -1, 2 = w1, 3=

100

100

w2 where w1+w2  0. Then H = 

1 

01, H = 

1 0

01.

It was shown in [17, Theorem 1.5] that

dimH(Sing(H,

;

gt)



H;

dH )

=

2

-

1

1 + w1

,

for every lattice . By [16, Theorem 7.7, p. 104] which glues the result to H orbits, it follows that

dimH(Sing(H,

;

gt);

dH )



3

-

1

1. + w1

On the other hand, Corollary 2.33 implies that this lower bound is

tight.



17
Inspired by Example 3.1 we make the following conjecture.
Conjecture 3.2. Let F be a set of g-templates, closed under equivalence. Then for every   Xn,
dimH(Y,F ; dH) = F sup 0(f ) .
f F
A possible heuristic for the conjecture is the computation of the weighted planar Cantor-like set C, which is constructed by the following procedure with appropriate constants. Start with a box, and recursively choose k sub-boxes to every box uniformly at random. The side-lengths of the boxes are weighted, i.e., the l-th side-length of a sub-box is al < 1 times the l-th side-length of the original box. With probability 1, the standard Hausdorff dimension of C is given by the upper bound provided by the analog of Theorem 4.7, depending on the Hausdorff dimension of C with respect to the weighted metric.
3.2. Dimension in smaller sets. It is common to consider the Hausdorff dimension of trajectory sets in the subgroups H  H, as in Dani Correspondence. A natural question is the following.
Question 3.3. Let F be a set of g-templates closed under equivalence, and let   Xn. Can we provide a combinatorial expression to
dimH(Y,F  H; d)?
In general, one does not expect the codimension of the intersection in H to coincide with the codimension of the original set, i.e.,
dimH(H; d) - dimH(Y,F  H; d) = dimH(H; d) - dimH(Y,F ; d),
does not hold in general, even when it does not predict a negative dimension. Instead, we expect the dimension to be an integral with quantities of the form dimH(H  HV·; d) for various flags V·, (HV· is defined in Definition 7.1).
3.3. Different Lie groups. It seems plausible that the techniques we use here can be generalized to a general 1-parameter semisimple flow in a semisimple real Lie group G, acting on G/, where   G is a lattice. The proof of Lemma 7.16 stands out from the other parts of the paper, by being mostly a Lie-theoretic result, and its generalization may require other tools.
Let G be a complex semisimple Lie group, B the Borel subgroup, and B  P1, ..., Pr  G the maximal parabolic subgroups of G. These groups are all maximal parabolic subgroups of G up to conjugations. Let (gt)tR be a 1-parameter semisimple flow on G. Define (G/P )g :=

18

OMRI NISAN SOLAN

{p  G/P : t  R, gtp = p} to be the set of invariant points in

G/P for every parabolic subgroup P . In particular P may be the

Borel subgroup B. Let IP denote the set of connected components of

(G/P )g. Note that the quotient maps G/B  G/Pi are gt equivariant,

and hence define natural maps i : IB  IPi. For every parabolic

subgroup P and E1, E2  IP , we say that E1 E2 if there is p  G/P

such

that

lim
t-

gtp



E1

and

lim
t

gtp



E2.

Question 3.4. P  G?

· Is a partial order of IP for every parabolic

· Let E1, E2  IB. Do we have E1 E2 if and only if i(E1) i(E2) for every 1  i  r?

For the relation between parabolic subgroups of G and the cusp of G/, see [2] for the theory and [22] for an application.

4. Hausdorff Dimensions 4.1. The Expansion Metric.

Definition 4.1. Let (X, dX) be a metric space and t : X  X be a
group action R X. We say that  is a boundedly expanding action if for some 0 <  <  we have

t  R,

d dt

log

dX (tx1,

tx2)



[,

 ],

for every x1, x2  X. From now on we assume that  is a boundedly expanding action. Define d : X × X  [0, ) on X by

d(x1, x2) :=

exp(- min{t  R : dX(tx1, tx2)  1}) 0

The d is called the expansion semimetric.

if x1 = x2, if x1 = x2.


Observation 4.2. Note that

(4.1)

d(tx1, tx2) = dt(x1, x2) · exp(t),

and the unit ball with respect to d coincides with the unit ball with

respect to dX. These properties characterize d.



In this subsection we fix a boundedly expanding group action R X
denoted , and denote by 0 <  <  the corresponding quantities in Definition 4.1.

19

Lemma 4.3. If 0 < a   then d to the power of a, namely, da forms a metric.

Proof. It is clear that da is symmetric and that da(x, x) = 0 for every x  X. Since  is boundedly expanding action if follows that da(x1, x2) > 0, whenever x1 = x2. It is left to show the triangle inequality for three different points x1, x2, x3  X. Assume d0 := d(x1, x3)  d(x1, x2), d(x2, x3). By Eq. (4.1) we may assume w.l.o.g.
that d(x1, x3) = 1. Now note that since d(x1, x2) < 1 we have s12 := - log(d(x1, x2))  0. The bounded expansion property yields

- log dX (x1, x2) = log dX (s12x1, s12x2) - log dX (x1, x2)

=

s12 0

d dt

log dX(tx1, tx2)dt



s12,

and hence dX(x1, x2)  d(x1, x2)  da(x1, x2). Similarly dX(x2, x3)  da(x2, x3). Hence

da(x1, x3) = 1 = dX (x1, x3)  dX (x1, x2) + dX (x2, x3)  da(x1, x2) + da(x2, x3),

as desired.

Definition 4.4. For every set A  X recall the Hausdorff dimension with respect to the metric da, namely
dimH(A; da) := inf{d  0 : Hd(A; da) = 0},
where

Hd(A; da) = inf

i

rid

:

there is of radii

a ri

cover of A > 0 in the

with balls metric da

,

is the Hausdorff measure. Since a ball of radius r with respect to da1 is a ball of radius ra2/a1 with respect to da2 it follows that for every 0 < a1, a2 <  we have

Hd(A; da1) = inf

i

rid

:

there is a of radii ri

cover of A > 0 in the

with balls metric dag1

= inf

i

r da1 /a2 i

:

there is a of radii ri

cover of A > 0 in the

with balls metric dag2

= Hda1/a2 (A; dag2 ),

and

hence

dimH(A; da1)

=

a2 a1

dimH(A; da2).

Thus

the

quantity

dimH(A; d) := a dimH(A; da),

20

OMRI NISAN SOLAN

which is termed Hausdorff dimension of A with respect to the semi-

metric d, is independent of a.



Example 4.5. The simplest example is the following. If X = Rn and

tx = etx then d = dX and the Hausdorff dimension dimH(A; d) =

dimH(A) for every A  X.



4.2. Case of Interest. Recall that gt is a diagonal 1-parameter group, and H is the expanding group of gt, with the right invariant Riemannian metric dH. Denote t(h) := gthg-t.

Lemma 4.6. The action t is a boundedly expanding action with respect to the metric dH.

Proof. The standard Riemannian metric dSLn(R) is define by the bilinear form A, B Id = tr ABt on TId SLn(R) = ker tr, where tr : Mn×n(R)  R is the trace map, and extended to every tangent space Tp SLn(R), p  SLn(R) by right translations.
Note that the eigenspaces of the t action on TId(H) are orthogonal with respect to this bilinear form, and that the different eigenvalues are exp(t( - )), where  >   Eall.
Consequently, for every vector v  TId(H) we have

d dt

(t)v

/

v

 [, n - 1],

where  is the minimal positive distance between elements of Eall. For every point p  H define the right translation Rp-1 : H  H
to be the multiplication from the right by p-1. For every v  TpH we have

(t)v = (REt(p)-1 )(t)v = (t)(Rp-1)v  [, n - 1] · (Rp-1)v = [, n - 1] · v
In particular, t satisfies the bounded expansion property when it is tested on tangent vectors instead of distances. By the definition of the Riemannian metric, the desired result follows.

It follows that there is a constant  such that d is a metric. The notations , d, and  will hold for the rest of the paper.

4.3. Comparison with Standard Hausdorff Dimension. Let 0 <

1  · · ·  N be the differences {i - j > 0 : 1  j  i  n} in

increasing order. Let F : 0,

N i=1

i

 [0, N] be the piecewise linear

21

function defined by the values

k

F

i = k, 0  k  N,

i=1

and N

F : [0, n]  0, i

i=1
be the piecewise linear function defined by the values

N

F (k) =

i, 0  k  N.

i=N -k+1

The functions F and F -1 are related. Their graphs are composed of
intervals of equal length and slopes. In F they are ordered from the largest slope to the smallest, and in F -1 it is the other way around.

Theorem 4.7 (The Comparison Theorem). Let t the flow on H induced by conjugation with the diagonal flow gt and d be its expansion semimetric. For all sets X  H we have

(4.2) and

dimH(X; dH)  F (dimH(X; d)),

(4.3)

dimH(X; d)  F (dimH(X; dH)).

Corollary 4.8. We have dimH(H; d) = ( ,Eall - )+.
The proofs of both sides inequalities in Theorem 4.7 are similar, we will cover a ball of one semi-metric with balls of the other.
To prove the theorem we need some preparations. Denote by µ the two sided Haar measure on H.

Lemma 4.9. There are constants c1, c2 > 1 such that for every 0 < r1, r2 < 1 and h1, h2  H such that

BdH (h1; r1)  Bd(h2; r2) = ,

we have

N

µ BdH (h1; c1r1)  Bd(h1; c2r2) = 

min(r1, r2i) .

i=1

Proof. We will first show the result when h1 = h2 = Id. By Observation 2.1 every h  H has n2 - N fixed entries and N entries that can vary. Denote by  : H  RN the map that assigns to each h  H its N varying coordinates. Denote by t : RN  RN the diagonal

22

OMRI NISAN SOLAN

action multiplying the i-th coordinate by exp(ti). Note that  is action equivariant, that is, the following diagram commutes:

H  / RN

t

t





H  / RN

Since  is a manifold diffeomorphism, it distort the standard metric
by a bounded factor on any compact set in H. A direct computation
shows that  maps the Haar measure µ on H to the standard Lebesgue measure  on RN . It follows that for some 0 <  <  we have

(4.4)

[-r1, r1]N  (BdH (Id; r1))  [-r1, r1]N .

Substituting r1 = 1 and applying log r2 to Eq. (4.4)we obtain,

(4.5)

N

N

[-r2i, r2i]  (Bd (Id; r2))  [-r2i, r2i].

i=1

i=1

Combining (4.4) and (4.5) we obtain,

(4.6)

N

µ BdH (Id; r1)  Bd(Id; r2)) = 

min(r1, r2i)

i=1

We turn to prove the general case. Let c1 = 2, and c2 = 21/, where  satisfies that d is a metric.
Now let 0 < r1, r2 < 1 and h1, h2  H and assume

BdH (h1; r1)  Bd(h2; r2) = . Fix h3  BdH (h1; r1)  Bd(Id; r2). Note that
BdH (h1; 2r1)  Bd (h3; 21/ r2)  BdH (h3; r1)  Bd (h3; r2).
The lower bound follows from the right invariance of dH and d. The upper bound follows by similar means and the fact that

BdH (h1; 2r1)  Bd (h3; 21/ r2)  BdH (h3; 4r1)  Bd (h3; 4dr2).

For every d  R denote

N

N

(d) := (i - d)+, (d) := (1 - di)+.

i=1

i=1

23

Lemma 4.10. Let r < 1 and d  0. We can cover a d ball of radius r with O(r-(d)) balls of radii rd with respect to the metric dH.

Proof. Let H1  Bd(Id; r) be a maximal set of points such that dH(h1, h2)  rd for every h1, h2  H1. Consequently, {BdH (h1; rd/2) : h1  H1} are pairwise disjoint and {BdH (h1; rd) : h1  H1} cover Bd(Id; r).
Applying Lemma 4.9 to h1  H1, h2 = Id, r1 = rd/(2c1), r2 = r we
obtain

N

µ BdH (h1; rd/2)  Bd(Id; rc2) = 

min(rd, ri) .

i=1

Similarly,

N

µ BdH (h1; rd)  Bd(Id; rc2) = 

min(rd, ri) .

i=1

The claim follows from the fact that

N

µ Bd(Id; rc1) = 

ri .

i=1

The following result and its proof are analogous to Lemma 4.10.
Lemma 4.11. Let r < 1 and d  0. We can cover a dH ball of radius r with O(r-(d)) balls of radii rd with respect to the semimetric d.
Proof of the Comparison Theorem 4.7. Let X  H with d0 = dimH(X; d). Let d > d0 and let (Bd(hi; ri))iI be a cover of X with d balls such that iI rid < 1. We will cover X with dH balls. Fix d  0. By Lemma 4.10 can cover each d-ball of radius ri with  r-(d) dHballs of radius rd.
Consequently, for d  0, the d Hausdorff measure of X is at most



r -(d )

·

rdd i

=



r . -(d)+dd

iI

iI

We will derive a bound on the Hausdorff measure of X only when -(d) + dd  d. Hence we ask ourselves what is the minimal d > 0 such that for some d  0 we have -(d) + dd  d. Inverting the role of d and d, we want to show that for every d  [0, N ] we have

(4.7)

sup dd - (d) = F -1(d).
d >0

24

OMRI NISAN SOLAN

Note that  vanishes at (-, 1] and hence the supremum at Eq. (4.7) is attained at d  1 > 0 and can be taken even for all d  R. Hence it is enough to prove

(4.8)

sup dd - (d) = F -1(d).
dR

In fact, F was defined so that F -1 is the convex conjugate of , which is Eq. (4.8). Eq. (4.3) follows analogously from the fact that F -1 is the convex conjugate of .

4.4. Dimension Games. Schmidt [19] was the first to prove Hausdorff dimensions theorems via (Borel) games with a victory condition.
Das et al. [7] obtained Theorem 2.30 for simpler diagonal flows gt using a family of zero-sum games with a payoff function (and not a victory condition), which Alice tries to maximize and Bob to minimize. We here describe the game of [7] in our setting, which is termed (T, g) game.
Let T > 0 and X  H be a Borel set. Alice and Bob play a zerosum alternating-move game, where Alice plays an initialization step, and afterwards Alice and Bob play alternately, first Alice and then Bob.
In the initialization step Alice chooses h0  H and T0 > 0. Along the game, Alice and Bob generate a sequence B0  B1  · · · , where Bm = Bd(hm; exp(-Tm)) and Tm = T m + T0. Recall that d is a metric.
Formally, the game is played as follows.
Initialization step: Alice chooses h0  H, T0 > 0. Set B0 := Bd(h0; exp(-T0)) and Tm := T m + T0 for every m  1.
Alice's m-th step: Denote Bm := Bd(hm; exp(-Tm)). Alice chooses a finite set

(4.9)

Am+1  Bd(hm; (1 - exp(-T ))1/ exp(-Tm))

that satisfies that d(hm+1, hm+1) > 31/ exp(-Tm) for every two distinct elements hm+1, hm+1  Am+1. Bob's m-th step: Bob chooses hm+1  Am+1.

Remark 4.12. The coefficient (1 - exp(-T ))1/ in Eq. (4.9) ensures that Bm+1  Bm.

Denote



h

:=

lim
m

hm

=

Bm

m=0

25

and A· = (Am) m=1. The payoff which Alice want to maximize and Bob wants to minimize, is

(4.10)

(A·, h) :=

1 T

lim infm

1 m

-

m k=1

log

#Ak

if h  X,

otherwise.

Denote the value of this game by DT,g(X), i.e., Alice can guarantee any payoff less than DT,g(X), and Bob can deny payoffs higher than DT ,g (X ).
Recall that a metric space (X, dX) is called doubling if there exists M > 0 such that for every R > 0 and x  X there exist x1, . . . , xM  X such that
M
BdX (x; R)  BdX (xi; R/2).
i=1
The following Theorem is a special case of [7, Theorem 28.2]. Using [7, remark 28.3] we may apply it to any complete doubling space. (H, d) is a doubling space by the compactness of Bd (1), the right invariance of d and the behavior under the  action. Hence we obtain the following result.

Theorem 4.13. For any Borel set Y  H we have limT  DY,g(X) = dimH(Y ; d).
4.5. Dimension Game Applied to Trajectory Sets. Let F be a set of gt templates closed under equivalence, and   Xn be a lattice. To prove Theorem 2.30 we will apply Theorem 4.13 to the set Y,F := Y,F  H.
Defining the strategies seems complicated, as the resulting h of a play is known only after the game is played, and hence f h can be computed up to equivalence only at the end of the (T, g) game. Nonetheless f h can be approximated.

Observation 4.14. Since d(hm, h)  exp(-T m) it follows that

ht := gthmh-1g-t

satisfies that for every t  T m we have d(ht, Id) = O(exp(t - T m)).

Using the equality htgth = gthm we deduce that f h|(-,T m] and

f hm|(-,T m] are uniformly equivalent, where the implicit constants are

independent of m and T . In other words, after m steps of Alice and

Bob we are able to approximate f h up to time T m.



The strategies of Alice and Bob will be constructed in view of Observation 4.14. In each step they will consider f h at time T m and choose their actions to ensure a certain behavior of f h at time T (m + 1).

26

OMRI NISAN SOLAN

5. Templates Approximation
In this section we will prove two results. The first is purely combinatorial, and approximates a template with a simpler one, that will be used in Alice's strategy. The second constructs a template for every gt lattice orbit.

Definition 5.1 (Nontrivial places at time t). Let f be a g-template on I. For every t  I denote
Lf (t) := {0  l  n : t  Ul(f )} = L(fH,·(t)),
that is, Lf (t) are those l for which fE,l(t) is not null. 

Definition 5.2 (Vertices of a g-template). Let f be a g-template.

We term the irregular points t of fE,· vertices of f and irregular points of fE,l vertices of f at l. A vertex t is called null (resp. non null ) if it is a null point (resp. non null ) of the category flow fE,l.
Note that the null vertices of f at l are the endpoints of the nontriv-

iality intervals J  Ul(f ). In addition, note that there are no vertices

at l = 0, n.



Example 2.20, continued. In Figure 4 we provide a g-template with

Eall = {-1.2, 0.5, 0.7}. The green vertices are non null and the blue

vertices are null.



Figure 4. A g-template with its vertices. t

fH,1 fH,2

fE,1 :  fE,2 : 

{-1.2} t0 {0.5}  {-1.2}{0.7}



{-1.2, 0.5}

{-1.2, 0.7} {0.5, 0.7} t1

27

Definition 5.3 (C-separated g-templates). We say that f is C-separated

for C > 0 if for every null vertex t of f there is no other vertex t of f

with |t - t| < C. Moreover, t cannot be a vertex of f at two values of

l.



An implication of a template being C-separated is that it cannot change too often, and hence it will be useful in the construction of the strategy of Alice.

Observation 5.4. Let 0  l-1 < l0 < l1  n be three indices and a· be a height-sequence. If a· is linear on [l-1, l0] and on [l0, l1] then

2al

=

l0

1 - l-1 al-1

+

l1

1 -

l0 al1

-

(l1

l1 - l-1 - l0)(l0 -

l-1) al0 .



Corollary 5.5. Let f be a g-template on an interval I, let 1  l  n-1 and let t  I be a point which satisfies that 2fH,l is nondifferentiable at t. Then there exists a vertex t of f at l0 such that t is a vertex of f at l0. Moreover one of the following is true:
· l = l0. · l is adjacent to l0 in Lf (t).
Corollary 5.5 motivates the following definition.

Definition 5.6 (Vertex impact). Let t be a vertex of a g-template f at

l0. Denote by l-1 < l0 < l1 the adjacent indices of l0 in Lf (t). We say

that the vertex t at l0 impacts the indices l-1, l0, l1. The set of vertices t that impact l contains all nondifferentiable points of 2fH,l(t), though

not necessarily all such points are nondifferentiable.



Example 2.20, continued. In Figure 4 the vertex t0 at l = 1 impacts

0, 1, 2, while t1 at l = 2 impacts 0, 2, 3.



Definition 5.7 (C-Significant g-templates). We say that a g-template

f is C-significant for C > 0 if for every 1  l  n - 1 that is impacted

by a vertex t of f we have 2fH,l(t) > C or 2fH,l(t) = 0.



Remark 5.8. Let t be a vertex of a g-template f at l0. If t is a null vertex then l0 / Lf (t) even though this vertex impacts l0 itself. In this case 2fH,l0(t) = 0, and hence to check whether or not f is Csignificant, one can ignore this impact instance. We still regard this
phenomenon as impact in view of Corollary 5.5.

28

OMRI NISAN SOLAN

Lemma 5.9. For every C > 0 there exists C > 0 such that for every
g-template f on the interval I there exists a C-significant, C-separated g-template f , which is C-close to f .

The section will be divided as follows. In Subsection 5.1 we will introduce the shifting operation on g-templates. It is an operation that is able to perturb a g-template. In Subsection 5.2 introduce combinatorial tools which will be able to shift a g-template to a significant one. In Subsection 5.3 we will discuss some properties of significant templates and complete the proof of Lemma 5.9. In Subsection 5.4 we will prove Theorem 2.27.

5.1. Shifting Templates. In this subsection we define the shift operation on templates.

Definition 5.10 (Lower convex hull). Let X  R be a finite set and let f : X  R be function. The lower convex hull f conv :
[min X, max X]  R is the maximal convex function which satisfies f conv(x)  f (x) for every x  X.
The lower convex hull of a sequence a0, ..., an is the lower convex hull of the function l  al, then restricted back to {0, ..., n}.

((l  al)conv(l))nl=0.

It is sometimes called convexification.



Definition 5.11 (Shift of height sequences). Let a· be a height se-

quence, and  = (l)nl=0 be a concave sequence of numbers with 0 =

n = 0, i.e., the numbers 0 = 0, 1, . . . , n = 0 satisfy l  (l-1 +

l+1)/2. Define the shifted height sequence a· to be the lower convex

hull of the sequence (al + l)nl=0, see Example 5.13.



Remark 5.12. The shift operation is continuous in a· and , and the concavity of  implies that the shift depends only on the values of  in L(a·). This gives us an explicit formula for a· :

al =

min
l1ll2

(al1 + l1) + (1 - )(al2 + l2)

l1 +(1-)l2 =l

l1 ,l2 L(a· )

Example 5.13. Figure 5 shows a height sequence a·, a concave se-

quence  and the height sequence a· .



29
Figure 5. The graphs of a·, , al + l and on it a· . l

l

l

l

al

al + l al

Definition 5.14 (Shift of g-templates). Let f be a g-template on an interval I. A shift sequence is a sequence  = (l)nl=0, l : Ul(f )  R, of n + 1 locally constant functions, such that 0  n  0 and for every 0 = l0 < · · · < lk = n and t  Ul0(f )  · · ·  Ulk(f ) the piecewise linear function defined by li  li(t) is concave.
Let  be a shift sequence. For every t  I, let ¯(t) be any extension
of  at t to a concave sequence 0 = ¯0(t), ¯1(t), . . . , ¯n(t) = 0. Define the shifted g-template f . For every t define

fH,·(t) = (fH,·(t))¯(t),

It is independent of the choice of ¯ and continuous by Remark 5.12. Denote by Ul(f ) the set of times t for which l  supp fH (t) is a
nontrivial index. This will later coincide with Definition 2.18 of Ul(f ). Let fE,l be as follows:
· On Ul(f ) it coincides with fE,l. · Outside of Ul(f ) it is null. · The connecting morphisms on the boundary Ul(f ) are the
null arrows.

One can verify that f  is a g-template. For future use we note that

(5.1)

fH,l :=

min
l1 ll2

(fH,l1(t) + l1(t)) + (1 - )(fH,l2(t) + l1 (t)).

l1 +(1-)l2 =l

l1,l2Lf (t)



Lemma 5.15. If (l)nl=0 are bounded by C then f  is 3C-close to f .

30

OMRI NISAN SOLAN

Proof. Fix t  I. To attain fH (t) we take fH(t), increase every value by l(t) and then take the lower convex hull. It follows that that fH,l(t)  fH,l(t)  fH,l(t) + C, and hence 2fH,l(t) - 2fH,l(t)  2C. If [a, b]  I satisfies 2f |[a,b]  3C, then [a, b]  Ul(f ), and hence fE|[a,b]  fE|[a,b].
A useful shift sequence is the following.

Definition 5.16 (The independent shift sequence). Let C > 0 and let

f be a g-template on an interval I and let J  [0, C] for J  Gf , where Gf is define in Definition 2.18. By convention the unique nontriviality

intervals J of f at 0 and n has J = 0.

The independent shift sequence  with parameters C, (J)JGf is defined by l|J = l(n - l)C + J for every J  0(Ul(f )).

From now on, all shift sequences  will be independent sequences.

A useful property of this sequence is that it can change independently

on each interval.



Example 2.20, continued. Figures 6 and 7 depict shifts of the g-

template in Figure 2.20 and the original g-template in lighter colors

behind. We uses the independent shift sequence  composed of the

constant functions 0, 1, 1, 0, and 2. Notice that the nontriviality inter-

vals, i.e., the connected components of Ul shrinks in 6, and the interval

(t0, t1) even vanishes completely in 7, as the maximum of 2fH,1|(t0,t1) is 1.7, which becomes negative when we add to it 2(t) = -2. The

condition 2al + 2l  0 is a sufficient condition for l to be a trivial

place of a· , though it is not necessary. We see that the null (blue)

vertices moved, and the non null (green) did not.



5.2. Constructing a Significant Approximation. In this subsection we will develop a technique which which will enable us to solve a large system of a type of linear inequalities, and thus construct a significant approximation and a separated approximation.
The following lemma is a step in the proof of Lemma 5.9

Lemma 5.17. For every C > 0 there exists C > 0 such that for every
g-template f on the interval I there exists a C-significant g-template f , which is C-close to f .

In Subsubsection 5.2.1 we will go over the steps of the construction. In Subsubsection 5.2.2 we will provide proofs for lemmas introduced in Subsubsection 5.2.1 and in Subsubsection 5.2.3 we will characterize significant g-templates in a way that will enable us to construct such approximations.

Figure 6. A shift of a g-template.

31
t fH ,1 fH,1 fH ,2 fH,2

fE,1 :  fE,2 : 

{-1.2} {0.5}  {-1.2}{0.7}



{-1.2, 0.5} {-1.2, 0.7} {0.5, 0.7}

Figure 7. A shift of a g-template.

t fH2,1 fH2,2 fH,1
fH,2

fE,1 :  fE,2 : 

{-1.2}{0.5}

t0

t1 

{-1.2, 0.5} {-1.2, 0.7} {0.5, 0.7} 

5.2.1. The Plan. Our goal is to construct a C-significant template which is equivalent to f .
It will be attained as a shift of f by an independent shift sequence  with parameters C1, (J )JGf , where J  [0, C1] for every J  Gf . We

32

OMRI NISAN SOLAN

will see (Lemma 5.23) that the condition of being C-significant can be strengthened into a condition of the following form:

Definition 5.18. Fix C1 > C > 0,  > 0, and a "Variable set" G. An enticement on G (with parameters C1 > C, ) is an affine function
 : [0, C1]  R
J G
((J )JG) = a + aJ J ; a, aJ  R
J G
where G  G is a finite subset and |aJ |   for every J  G. We say that G is the support of the enticement . We say that a collection of values (J )JG  [0, C1] satisfies the enticement  if
((J )JG) / [0, C].
Let Z be an index set. A a solution of a collection of enticement {z : z  Z} is a tuple (J )JG that satisfies all enticements in the collection.
A collection of enticements {z : z  Z} on G is (r, R)-finitary if · For every z  Z the enticement z has a support with at most r elements. · For every G  G there are at most R enticements z with support G, where z  Z. 

We will need a collections of enticements whose index set G has a graph structure. We will now define the desired properties of the graph.

Definition 5.19 (Enticement compatibility with a graph). Let G be a

graph. An enticement  on G is compatible with the graph structure

on G if its support G is a clique in G. From now on all enticements on

a graph will be assumed to be compatible with it.



Definition 5.20 (d-constructible graph). A graph G is said to be d-

constructible if there is a filtration of full subgraphs  = G0  G1 

· · ·  G such that m Gm = G and for every vertex v  Gm \ Gm-1 we

have degGm(v)  d.



33

Lemma 5.21. Let {z : z  Z} be a collection of enticements with parameters C1 > C,  on a d-constructible graph G which are (r, R)finitary for some r, R  Z0. If

r-1
C1 > -1R
r=0

d r

C

then there is a solution for the collection of enticements.

We will define a collection of enticements for each g-template f . We

start by defining the underlying graph Gf . Recall Gf =

n-1 l=1

0(Ul(f

))

as in Definition 2.18. Two vertices J1, J2  Gf are connected by an

edge if the intervals intersect. Abusing notations we do not distinguish

between a graph and its set of vertices.

Lemma 5.22. For every g-template f the graph G is (2n-4)-constructible.

Finally we produce a collection of enticements, where the existence of
a solution (J )JGf guarantees that the g-template f  is C-significant, where  is the independent shift sequence with parameters C, (J )JGf .

Lemma 5.23. There exists  > 0 depending on Eall such that for every C1 > C > 0 the following holds. For every g-template f there exists a (4, 49 · 24n · n12)-finitary collection of enticements {z : z  Z} on Gf with parameters C1 > C,  such that for every solution (J )JX of {z : z  Z}, the g-template f  is C-significant, where  is the independent shift sequence with parameters C, (J)JGf .

Lemma 5.17 is a direct combination of Lemmas 5.23, 5.22 and 5.21. These lemmas also show that Lemma 5.17 holds with any

3
C1 > -149 · 24n · n12

2n - 4 r

C.

r=0

5.2.2. Proof of Lemmas 5.21 and 5.22.

Proof of Lemma 5.21. We will choose J one by one. For every m choose a well ordering  on Gm \ Gm-1 and merge the well orderings into a single well ordering on G, still denoted , such that G1 \ G0  G2 \ G1  · · · . Note that by the degree condition, for every J there are at most d neighbors which are less or equals to it according to .

We will construct the sequence J for every J by transfinite recursion.

Fix J  G and suppose that we already defined (J){JG:JJ}. Since

there are at most d neighbors of J which precede J under , it follows

that there are at most

r-1 r=0

d r

cliques of size at most r that contain

J and are contained in {J  G : J J}. Hence, there are at most

34

OMRI NISAN SOLAN

R

r-1 r =0

d r

enticements with a support contained in {J  G : J

J}

and contains J.

Each of the enticements imposes a linear condition on J of the form

aJ J + a / [0, C] for |aJ |  , which fails to occur on an interval of

length at most C/. Consequently, if C1 > -1CR

r-1 r=0

d r

,

then

there is a possible value of J that satisfies these enticements.

Remark 5.24. Although we used transfinite recursion, when we use this lemma the ordinal will not exceed n.

Proof of Lemma 5.22. To prove the lemma we will use the fact that no n intervals in Gf have a common intersection. Denote by A1 the set of J  Gf that are minimal with respect to interval inclusion. Note that degGf J  2n - 4 for every J  A1, as
· by the minimality condition every neighbor must contain one
of J's endpoints, and
· by the intersection condition at most n-2 intervals can contain
every endpoint.
Let G1 := Gf \ A1  G0 := G. Let A2  G1 be the set of all intervals that are minimal with respect to interval inclusion in G1. As above, for every J  A2 we have degG1(J)  2n - 4.
Continue this process and construct a decreasing sequence of subgraphs G0  G1  G2  · · · such that for every m and every J  Gm \ Gm+1 we have degGm(J)  2n - 4. We have Gn =  because the length of the maximal increasing sequence J1  J2  · · ·  Jk of elements in Gm decreases by 1 as long as Gm is nonempty. We have thus constructed the desired filtration.

5.2.3. Construction of Enticements. Throughout the section we consider a tuple of variables (J )JGf and consider the independent shift sequence  with parameters C, (J )JGf . Recall that l|J = l(n-l)C +J . For every 0  l  n define a function f~H,l : Ul(f )  R
t  Ul(f ), f~H,l(t) := fH,l(t) + l(t).
In view of Observation 5.4, we can formulate the following claim.

Claim 5.25. Let t0 be a vertex of f  that impacts l0, and assume 2fH,l0(t0) = 0. Then there exists l-1 < l0 < l1  Lf (t0), not necessarily adjacent, such that

(5.2)

2fH,l0 (t0)

=

l0

1 -

l-1

f~H ,l-1

(t0)

+

l1

1 -

l0 f~H,l1 (t0)

-

(l1

l1 - l-1 - l0)(l0 -

l-1) f~H,l0 (t0)).

In addition one of the following holds:

35

(1) For some l  {l0, l-1, l1} the time t0 is a non null vertex of f at l.
(2) For some l1/2  Lf (t0), l0 < l1/2 < l1 the time t0 is a null vertex of f , at l1/2, and moreover,

(5.3)

0

=

1 l1/2 -

l0

f~H ,l0

(t0)

+

l1

1 - l1/2

f~H ,l1

(t0)

-

(l1

l1 - l0 - l1/2)(l1/2

- l0) f~H,l1/2 (t0).

(3) For some l-1/2  Lf (t0), l-1 < l-1/2 < l0 the time t0 is a null vertex of f , at l-1/2, and moreover,

0

=

l0

1 - l-1/2

f~H ,l0

(t0)

+

l-1/2

1 -

l-1

f~H ,l-1

(t0)

-

(l0

l0 - l-1 - l-1/2)(l-1/2

-

l-1)

f~ H,l-1/2

(t0)).

Proof. Let t0 be a non null vertex of f  that impacts l0. Choose l-1 < l0 < l1 to be the indices in Lf(t) near l0. It follows that f~H,li(t) = fH,li(t) for i = 0, 1, 2, and using Observation 5.4, Eq. (5.2) holds.
Note that either f  has a vertex t0 at l0, or fH,l0 is linear near t0. If f  has a vertex t0 at l0, then it must be a non null vertex, as

2fH,l1(t0) > 0, and Case (1) holds.

it

Otherwise, fH,l0 is follows that t0 is a

linear near vertex at

t0. some

Since l =

the vertex l. Assume

t0 l

impacts l0, > l. Since

l1  Lf(t) it follows that l  l1. We distinguish between three cases. Case l = l1: The vertex t0 of f  at l1 must be a non null vertex as

l1  Lt0(f ), and Case (1) holds. Case l = l1/2 < l1: Since l1/2 / Lt0 (f ) it follows that t0 is a null

vertex of f  at l1/2. It follows that there is a connected component J

of Ul1/2(f ) such that t0 is an endpoint of J.

Therefore

f H,l1/2

(t0)

=

f~H,l1/2 (t0),

and

hence

Eq.

(5.3) holds.

This

yields Case (2).

The symmetric alternative l < l (as opposed to the assumption

above l > l), yields Cases 1 and 3.

Proof of Lemma 5.23. We will first construct a collection of entice-
ments to ensure each of the Cases (1), (2), (3) of Claim 5.25 fails to give a 2fH,l0(t0)  (0, C], for every vertex t0 which impacts l0. We will then verify that it is (4, 49 · 24n · n12)-finitary. To avoid Case (1), note that for every J  Ul(f ) there are at most l(n - l)  n2 non null vertices of f at l in an interval J  0(Ul). This is the length of the maximal sequence E0  E1  · · ·  Ek.
For every l-1 < l0 < l1, every Ji  Uli(f ), and every vertex t0  J-1  J0  J1 of f at l-1, l0 or l1, the right hand side of Eq. (5.2) defines

36

OMRI NISAN SOLAN

an enticement with support {Ji : i = -1, 0, 1 and li = 0, n},

((J )JGf

)

:= fH,l-1(t0)

+

l-1(n l0 -

- l-1)C1 l-1

+

J-1

+

fH,l1 (t0 )

+

l1(n - l1)C1 l1 - l0

+

J1

-

(l1

l1 - l-1 - l0)(l0 -

l-1) (fH,l0 (t0)

+

l0(n

-

l0)C1

+

J0 ).

In each set of three nontriviality intervals there are at most 3n2 vertices, hence there are at most 3n2 such enticements. Since some of these intervals may be for l = 0, n, we actually obtain at most 6n2 such enticements with support G  Gf with #G  3.
Case (2) is more tricky. Fix l-1 < l0 < l1/2 < l1, Ji  Uli for i = -1, 0, 1/2, 1, and linear parts ait + bi - l(n - l)C1 of fH,li(t), where J-1  J0  J1/2  J1 = . Since in Case (2) t0 is defined by Eq. (5.3).
set

(5.4)

t0

:= -

(b 1
l1/2-l0 0

+

J0 )

+

(b 1
l1-l1/2 1

+

J1 )

-

(b l1-l0
(l1 -l1/2 )(l1/2 -l0 )

1/2

+

J1/2 )

a + a - a 1
l1/2-l0 0

1 l1-l1/2 1

l1-l0 (l1 -l1/2 )(l1/2 -l0 )

1/2

=

-

(l1

-

l1/2)(b0 + J0) + (l1/2 - l0)(b1 + J1) - (l1 - l1/2)a0 + (l1/2 - l0)a1 - (l1

(l1 - l0)(b1/2 - l0)a1/2

+

J1/2 ) ,

which is the solution of

a0t0 + b0 + J0 l1/2 - l0

+

a1t0 + b1 + J1 l1 - l1/2

-

(l1

- l0)(a1/2t0 + b1/2 + J1/2) (l1 - l1/2)(l1/2 - l0)

=

0.

We need to consider only the case where t0 is well defined, that is, the denominator in Eq. (5.4) does not vanish.
Substituting Eq. (5.4) in Eq. (5.2) we obtain that it is enough to attain ((J )JGf ) / (0, C] where

((J )JGf )

:=

a-1t0

+ b-1 + l0 - l-1

J-1

+

a1t0 + b1 + J1 l1 - l0

-

(l1

- l-1)(a0t0 + b0 + (l1 - l0)(l0 - l-1)

J0 )

=

ci(bi + Ji),

i=-1,0,1/2,1

37

where

c-1

:=

l0

1 -

l-1

,

c0

:=

a1/2l1 - a-1l1 - a1l1/2 + a-1l1/2 (l1 - l1/2)a0 + (l1/2 - l0)a1 - (l1

+ -

a1l-1 - a1/2l-1 l0)a1/2)(l1 - l0)

,

c1/2

:=

-a1l0 + a-1l0 + a0l1 - a-1l1 - a0l-1 + a1l-1

(l1--2al11/l202)+a0a+1/2(ll102/+2 -a-l01)l0a2 1+-2a(l01l0-l1

l0)a1/2)(l1 - a1/2l0l1

- -

l0) , a-1l0l1

- a0l0l1/2



+2a1l0l1/2 - a-1l0l1/2 - a0l1l1/2 + a-1l1l1/2 - a0l0l-1 + 2a1l0l-1

c1 :=

-a1/2l0l-1 - a0l1l-1 + a1/2l1l-1 + 2a0l1/2l-1 - 2a1l1/2l-1 ((l1 - l1/2)a0 + (l1/2 - l0)a1 - (l1 - l0)a1/2)(l1 - l0)(l0 - l-1)

.

Note that none of ci depends on bj for i, j = -1, 0, 1/2, 1. The coefficient c1/2 is nontrivial as 1/2 appears in t0. The tricky part is that some of the ci may vanish, and hence the support of  might not contain all J-1, J0, J1/2, J1. We will get that  is an enticement with support {Ji : ci = 0 and li = 0, n}.
Note that  is not an enticement if {Ji : ci = 0 and li = 0, n} = . If this happens then ci(bi + Ji) = 0 for every i = -1, 0, 1/2, 1. Hence  = 0 and will not yield a contradiction to f being C-significant.
Consequently, if {Ji : ci = 0 and li = 0, n} =  is nonempty then  is an enticement on it. We will see that there are only finitely many
possibilities for ci and hence we may choose  so that  < |ci| whenever ci = 0.
We now count the enticements that we constructed in Case (2) given a support G.
Each ai is the slope of fH,li at some t  Uli(f ) and hence ai  {E : E  Eall} where i = -1, 0, 1/2, 1. Consequently ai has at most 2n possibilities. The values of (ci)i=-1,0,1/2,1 depend only on (li)i=-1,0,1/2,1 and (ai)i=-1,0,1/2,1, which have at most n4, (2n)4 possibilities, respectively. Consequently the tuple (ci)i=-1,0,1/2,1 has at most n4 · 24n possibilities.
For every i = -1, 0, 1/2, 1 the value bi has at most n2 possibilities, given Ji. For every set  = G  Gf of size r we need to choose the role of each J  G, there at most 24 possibilities for this choice. Altogether we have constructed at most 24 · 24n · n12 enticements with support G.
Case (3) is analogous to Case (2) and yields 24 · 24n · n12 enticements for every  = G  GF . We thus obtain at most 2 · 24 · 24n · n12 + 2n6  49 · 24n · n12.
Since we can consider only enticements on sets of intersecting inter-
vals, the enticements are compatible with the graph. By Lemma 5.21
there is a solution (J )JGf to this collection of enticements. Claim

38

OMRI NISAN SOLAN

5.25 ensures that if (J )JGf satisfy these enticements then f  is Csignificant.

5.3. Properties of Significant Templates. We provide useful properties of significant templates, which in particular will allow us to prove Lemma 5.9. Recall that the implicit constants in the notations O(-), (-), and (-) depends only on Eall (see Subsection 2.8).

Observation 5.26. For every g-template f , and 0  l  n, the function fH,l has at most 2n possible slopes depending on Eall and hence are O(1)-Lipschitz. Consequently, so is the function t  2fH,l. 

Lemma 5.27. For every C-significant g-template f on an interval I, every 0  l  n, and every connected component J of Ul(f ) which has no common endpoint with I is of length (C). Moreover, there exists J  J such that 2fH,l(t)|J  C and the total length of J \ J is O(C).
Proof. The function t  2fH,l(t) is O(1)-Lipschitz, is positive in J, and vanishes at the boundary of J. Since f is C-significant, the maximum in J must be at least C, hence we get that J is of length (C).
Moreover, the set J := {t  J : 2fH,l(t)  C} must be an interval since if it is not connected then the minimum of 2fH,l(t) on (convJ) \ J is less than C and is attained at a vertex that impacts l, which contradicts the C-significance of f .
Since the derivative of 2fH,l(t) at J \J is (1) we deduce the desired result.
Lemma 5.28. For every C-significant g-template f and interval [a, b]  R, there are most 2n3 + O((b - a)/C)) vertices of f in [a, b].
Proof. We will prove that for every l there are at most 2n2 + O((a - b)/C) vertices of f at l in [a, b]. Indeed, by Lemma 5.27 the interval I intersects at most (2 + O((a - b)/C)) connected components of Ul(f ) and each of them contains at most l · (n - l) + 2  n2 vertices. The result follows.
Lemma 5.29. There exists N = N (Eall) that satisfies the following property. For every 5C1-significant g-template f , there exists a (6, N)finitary set of enticements on Gf such that any solution of it (J )JGf satisfies that f  is C-separated, where  is the independent shift sequence with parameters C1, (J )JGf .
Proof. Consider a tuple of variables (J )JGf and consider the independent shift sequence  with parameters C, (J )JGf . Each null vertex of

39

f  at l0 is a endpoint of an interval J0  0(Ul0(f )). As in the proof of Lemma 5.23, t0 can be defined by an equation

(5.5)

l0

1 -

l-1

f~H ,l-1

(t0)

+

l1

1 -

l0 f~H,l1 (t0)

-

(l1

l1 - l-1 - l0)(l0 -

l-1) f~H,l0 (t0)

=

0.

As in the proof of Lemma 5.17, the value fli(t0) is one of at most n2 possible linear equations of the form ait0 + b0 - li(n - li)C1, and hence

t0

=

-

l0

1 -l-1

(b-1

+ -1) + a 1
l0-l-1 -1

l1

1 -l0

(b1

+

1)

-

(b l1-l-1
(l1-l0)(l0-l-1) 0

+ a - a 1 l1-l0 1

l1 -l-1 (l1-l0)(l0-l-1) 0

+

0) .

If t0  J0  J-1  J1 is a null vertex of f  at l0, then it must lie in the closure J0 \ J0 , which is at most two intervals of length O(C1), and hence there are at most O(n3) non null vertices of f that may be close to t0. For every such vertex t, the condition that t0 at distance less than O(C) from t is an enticement satisfaction condition, with a support of at most 3 intervals (not exactly 3 as l-1 or l1 may be 0 or n).
Similarly, the condition that two such null vertices are at distance less than C is an enticement satisfaction condition, with support contained in the set of the intervals involved. There may be at most 6 intervals,
three defining each null vertex. As in Lemma 5.23 we obtain a finitary set of enticements.

Proof of Lemma 5.9. Let f be a g-template. By Lemma 5.17 we may assume it is 5C1-significant. Let Z be the set of all enticements on G constructed in Lemmas 5.23 and 5.29. Both are (6, N)-finitary with N and  depending only on Eall. By Lemma 5.21 we can solve them with (J )JGf  [0, C1], provided that C1 is large enough.
The solution produces an independent shift sequence  such that f  is C-significant and C-separated by Lemmas 5.23 and 5.29, and is 3C1-close to f by Lemma 5.15.
Lemma 5.30. Let f be a C-separated and C-significant g-template on an interval I, such that fH,l(t0) = 0 for every 0  l  n and every endpoint t0 of I. Then there is 0 <  < 1 that depends only on Eall such that there is a one-to-one correspondence between nontriviality intervals of f and nontriviality intervals of f , where  is the independent shift sequence with parameters C, (J )JGf  [0, C]Gf .
Moreover, f  is C/2-significant and C/2-separated in a uniform sense in J . That is, for every (J )JGf , (J )JGf  [0, C]Gf and let ,  be the corresponding independent shift sequences. Then for every

40

OMRI NISAN SOLAN

null vertex t0 of f and every vertex t1 of f , the corresponding vertices





of f , namely t0 , t1 , satisfy |t0 , t1 |  C/2.

Proof. The first part follows from C-significance of f . The second part follows from the first.

5.4. Proof of the Template Existence Theorem 2.27. Let  be a lattice, and for every t  R consider the filtration FHN(gt). For every    of rank l denote by U the set
U = {t  R : gt  FHN(gt)}.
For many  this set is empty, yet for some it is not. The set U is not necessarily an interval.

Example 5.31. Let   X2 be a random rank 2 lattice and  =

2

1 4

Z



R3

be

a

rank

3

lattice.

Let gt = exp(t diag(-1, 1)) and

gt

=

exp(t diag(-1, 1, 0))

be

diagonal

flows.

For

every

t

we

have

1 4

Ze3



gt = 2(gt)

1 4

Z.

Since

gt

act

ergodicly

on X2

it

follows

that gt

equidistributes in X2 for t   with probability one, and hence enter and leaves FHN(gt) infinitely many times as t  .

1 4

Ze3



For every  denote by V := 0(U) the set of connected components of U. Denote V :=  V, and term the intervals in V basic intervals. This union is defined to be disjoint so that if a set U appears in V1 and V2 for two different lattices 1, 2 then U appears twice in V. For every U  V denote by U the lattice  for which U  V.
Let  > 0 and choose C0 > 0 the corresponding constant provided by Theorem 2.7. We will prove theorem 2.27 for a tuple (, C) where C will be defined later. It will be sufficient to prove the theorem for  small enough. Fix U  V. By Theorem 2.7, there exists a set of disjoint intervals
UU = {(ai,U , bi,U ) : i = 1, . . . , rU },
in U which cover U except a set of volume C0 and a sequence of multisets,
E1,U  E2,U  . . .  ErU ,U ,
such that
a1,U < b1,U < a2,U < b2,U < · · · < arU ,U < brU ,U ,
and gtU  U Gr(l, n)gEi,U for every t  (ai,U , bi,U ).

41

Let U  U be the interval shorter by C from the right, for some C > 0 to be determined later. Define

UU = {I  U  : I  UU , I  U  = } := {(ai,U , bi,U ) : i = 1, . . . , rU },

and denote the corresponding multisets in Il by

E1 ,U



E2 ,U



...



E rU

,U

.

Denote

by

a0,

a rU

+1

the

endpoints

of

U.

Definition 5.32. For every U  V such that U = , the intervals [bi,U , ai+1,U ] for 0  i  rU are called complementary intervals. Let

S :=

rU
[bi,U , ai+1,U ]  R,

U V i=0

be the union of complementary intervals.



Lemma 5.33. If C > (n - 1)C0, then every connected component of S is of length less than C, and hence does not intersect two different U1 , U2 corresponding to basic intervals U1, U2  V satisfying rank U1 = rank U2.
Proof. Let S0 be a connected component of S. We will show that it does not contain complementary intervals of two different intervals U1, U2  V with rank U1 = rank U2.
Assume to the contrary that I1 = [a1, b1], I2 = [a2, b2] with b1 < a2 are complementary intervals contained in S0 from basic intervals U1, U2 and lattices of the same rank U1, U2. Assume that I1, I2 satisfy the following minimality property: there is no such tuple of complementary intervals both intersecting (b1, a2).
All complementary intervals that intersect (b1, a2) are of at most n - 1 basic intervals, corresponding to lattices of different ranks. By Theorem 2.7 every basic interval has complementary intervals of total length at most C0. Hence (b1, a2) is covered by complementary intervals of total length at most (n - 1)C0. Consequently a2 - b1  (n - 1)C0. On the other hand, the distance between U1 , U2 is at least C, and hence a2 - b1 > C. This contradicts the assumption C > (n - 1)C0.
We will define for every U  V an interval U  U. If the left endpoint of U  is not in S, define U  := U . Otherwise, the left endpoint of U is in S; let S0 be the connected component of S that contains that point and define U  := U  \ S0.
We next define for every l a category flow f~E,l : R  Il.

42

OMRI NISAN SOLAN

Claim 5.34. There exists an increasing function  : R  R such that
· For all t  R we have  (t) / S. · For every t  R we have t - C   (t)  t · If t  U  then  (t)  U  for every U  V.

Proof. Write S as S = iZ[ai, bi] for Z = [i0, i1]  Z  Z be a index set of consecutive numbers with ai < bi < ai+1 for every i0  i < i1 >
such that i + 1  Z. Note that i0 may be - and i1 may be . If
i0 =  denote bi0-1 = - and if i1 =  denote ai1+1 =  and Fix i  Z. By Lemma 5.33 we have that bi - ai < C for every i  Z.
For every basic interval U , by the definition of U , if U   [ai, bi] =  then ai  U . Consequently, we can choose bi-1 < ai < ai such that bi - ai < C and ai  U  for every U  which intersect [ai, bi]. If i1 =  define ai1+1 = .
Note that

(bi-1, ai]  (ai, bi] = R.

i[i0 ,i1 +1]

iZ

The function

 (t) =

t ai

if t  (bi-1, ai] for i  [i0, i1 + 1], if t  (ai, bi] for i  Z,

satisfied the desired properties.

Fix a function  as in Claim 5.34. Let the category flow f~E,l : R  Il be defined as follows: For every t  R let U be the unique basic interval with rank U = l and  (t)  (ai,U , bi,U ) and set f~E ,l(t) := Ei,U , where 1  i  rU . Define now
Tl = {t  R : f~E ,l is not locally constant at t},

and f~E,l(t) = f~E ,l(t) at every point t / Tl, and undefined for t  Tl. For every t  Tl define the connecting morphisms: For every U  V with rank U = l, if t  U , denote i± the indices satifies lims0 f~E,l(t ± s) = Ei±,U . By monotonicity of  we get that i- < i+ and hence Ei-,U  Ei+,U . Hence we may choose the connectingmorphism of f~E,l at t to be Ei-,U - Ei+,U For

t  Tl \

U ,

U V rank U =l

we define the connecting morphism to be the null arrow.

43

By Lemma 6.3 below, if  > 0 is small enough, then f~E,·(t) forms a direction filtration.
For every U  V, fix tU  U , and define f~H,l|U as follows: set f~H,l(tU ) := log covol gtU U , and extrapolate f~H,l to U  by Eq. (2.3).
Note that for every interval (ai,U , bi,U ) if ai,U -bi,U > C then f~E |,l (ai,U +C,bi,U )  Ei,U . It follows from Corollary 2.10 that the blade Bl  satisfies

(5.6)

f~H,l(t) - log gt Bl  = O(C),

for every t  U. Let C > 0, to be determined later. For every t  R define fH,·(t)
to be the lower convex hull of the function

(5.7) l  f~H,l(t) + l(n - l)C, for every 0  l  n, for which fH,l(t) is defined.

For every U  V with l0 := rank U and every endpoint t0 of U  which corrsponds to an endpoint t1 of U we have |t0 - t1|  C. Since

2FHN(gt)H,l0(t1) = 0,

the Lipschitz property of t  FHN(gt)H,l(t) implies that

2FHN(gt)H,l0(t0) = O(C).

It follows that

lim
U tt0

 2 f~H,l0 (t)

=

O(C ).

Hence if C = O(C) is large enough, then

lim
U tt0

 2 (f~H,l0 (t)

-

l(n

-

l)C  )

<

0.

Consequently, with this choice of C, near t0 the index l does not correspond to an extreme point of the lower convex hull of the function

in Eq. (5.7), hence removing it does not cause discontinuity of the

lower convex hull. From Eq. (5.6) we have f~H,l(t)+l(n-l)C  FHN(gt)H,l(t) for every
t  Ul(f ) provided that C = O(C) is sufficiently large compared to C. By the definition of fH,· we get that fH,l(t)  FHN(gt)H,l(t).
By Eq. (5.6), for every t  U  we have

(5.8)

fH,l(t)  FHN(gt)H,l(t) + O(C).

By the Lipschitz continuity of both functions we get that Eq. (5.8) holds also for every t  U. Consequently,

(5.9)

fH,l(t)  FHN(gt)H,l(t),

44

OMRI NISAN SOLAN

where  = (l(n - l)C)nl=0 for some C = O(C), and hence Eq. (5.8) holds for every t  R.
Define Ul(f ) := {t  R : 2fH,l(t) > 0},

and

fE,l(t) :=

f~E,l(t) 

if t  Ul(f ), if t / Ul(f ).

The g-template f we defined satisfies the first condition of (, C)matching (Definition 2.22). 2.27 for some constant, since (5.8) holds for every t  R.
We now show that the second condition is also satisfied. Let [a, b] be an interval on which fE,l(t) = E. Then [a, b]  U  for some U  V with rank U = l. The definition of f~E,l implies that  (t)  (ai,U , bi,U ), where Ei,U = E. It follows that ai,U  a and bi,U  b - C, and hence for every t  [a + C, b - C] we have spanR(U )  U(Gr(l, n)gE).

6. Results on the Grassmanian
In this section we will prove Theorem 2.7, which describes the nonrecurrent nature of the gt action on Gr(l, n), and Lemma 6.3, which asserts a functorial behavior of the following correspondence with respect to inclusion: a space V  U(Gr(l, n)gE) corresponds to E  Il. We used both results in Section 5, and we will use them in the following sections as well.

6.1. Proof of Theorem 2.7. It follows from Theorem 2.7 that the
gt-action on Gr(l, n) is non recurrent. A simpler proof for the non recurrence asserts that gt Gr(l, n) is a gradient flow with respect to some function  : Gr(l, n)  R. We will not follow this direction, as it
is harder to analyze how the flow connects the invariant points.
Instead, we will prove a monotonicity result in a more direct way. First, in case l = 1, for every v  Rn we want to quantify the fact
that along the trajectory {gtv : t  R}, the larger index coordinates increase faster.
We will find quadratic forms Qs : Rn  R which separate eigenspaces of smaller eigenvalue and eigenspaces of larger eigenvalue. For every fixed v  Rn the sign of Qs(gtv) will be monotone nondecreasing in t. Then for an l dimensional subspace V  Rn we can compute the
signature of each Qs|gtV and control its location. Recall that the j-s satisfies 1  2  · · ·  n. Denote by k the
number of different values of  in Eall, and denote these values by

45

¯1 < ¯2 < · · · < ¯k. Denote ¯0 = -. For every 0  s  k denote by Q+s , Q-s , Qs the quadratic forms on Rn:

Q+s :=

x2j , Q-s :=

x2j , Qs := Q+s - Q-s .

j >¯s

j ¯s

An immediate use of this definition is the following monotonicity result.

Lemma 6.1. For every s = 0, 1, . . . , k, and v  Rn \ {0}, if Qs(v)  0 then Qs(gtv) > 0 for every t > 0.

Proof. The result is trivial for s = 0, k. Otherwise, Q+s (v) must be positive, otherwise Q+s (v)  Q-s (v)  0 and then v = 0. This yields

Qs(gtv) = Q+s (gtv)

- Q-s (gtv)

 exp(2¯s+1t)Q+s (v) - exp(2¯st)Q-s (v)

> exp(2¯st)Q+s (v) - exp(2¯st)Q-s (v)

= exp(2¯st)Qs(v)  0.

We will extend the phenomenon expressed by Lemma 6.1 to l di-
mensional subspaces. Let V  Gr(l, n). Fix 0  s  k and denote (s0(V ), s+(V ), s-(V )) the signature of Qs|V .
There is a subspace V0  V with dim V0 = s0(V ) + s+(V ) such that for every v  V0 we have Qs(v)  0. Lemma 6.1 implies that Qs(gtv) > 0 for every t > 0 and v  V0 \ {0}, and hence s+(gtV )  s0(V )+s+(V ). It follows that s+(gtV ) is monotone nondecreasing and s-(gtV ) is monotone nonincreasing. Since s+(gtV )  l for every t, it follows that s0(gtV ) = 0 for at most l values of t.
Note that +(V )  r is an open condition on V , and hence {t  R : s+(gtV )  r} is an open set for every fixed V . Similarly {t  R : s-(gtV )  r} is open.
For every E  Il define the open set

UE :=

t  R : s = 1, . . . , k.

s+(gtV )=#{E:>¯s} s-(gtV )=#{E:¯s}

.

This is an open set since we can replace the two equalities within the
parentheses with  and preserve the set. The union EIl UE covers all points t  R exactly once, except maybe lk points in which s0(gtV ) = 0. By the monotonicity condition each UE is an interval. By definition Qs in nondegenerate on gtV for every t  UE.
The following lemma completes the proof of Theorem 2.7.

46

OMRI NISAN SOLAN

Lemma 6.2. For every  > 0 there exists t0 > 0 such that if [t - t0, t + t0]  UE, then gtV is in an -neighborhood U(Gr(l, n)gE).

Proof. Fix  > 0 and let t0 > 0 to be determined later. Assume without loss of generality that t = 0. We will construct inductively a filtration

(6.1)

{0} = V0-  V1-  · · ·  Vk- = V

such that Qs is negative definite on gt0Vs- and dim Vs- = s-(V ). Let s = 0, ..., k - 1 and assume we already defined Vs-. Since Qs is negative definite on gt0Vs- and Qs+1  Qs pointwise, it follows that Qs+1 is negative definite on gt0Vs-. We will extend the negative definiteness of Qs+1 from gt0Vs- to gt0Vs-+1 of dimension s-(V ) = s-(gt0V ). The perpendicular space W to gt0Vs- in gt0V with respect to Qs+1 satisfies that Qs+1|W has signature (0, s-+1 -s-, s++1). Hence, there is W0  W of dimension s-+1 - s- such that Qs+1 is negative definite on W0. It follows that Qs+1 is negative definite on gt0Vs-  W0, and hence we can define Vs-+1 := Vs-  g-t0 W0.
Similarly we can define

0 = Vk+  Vk+-1  · · ·  V0+ = V,

with the property that Qs is positive definite on g-t0Vs-.

s

It follows that Vs+  Vs- = 1, . . . , k. One can show

= 0. Denote Ws by induction that

:=

ns=V1s-Ws

Vs+-1 =V

.

for

every

Fix  > 0. Recall that V denotes the exp(t)-eigenspace of gt.

We will show that we can choose t0 large enough such that for every

v  Ws0 we have d(v, V¯s0 )   v . Indeed, denote by

k

s0-1

v0  V¯s0 , v+ 

V¯s, v- 

V¯s ,

s=s0+1

s=1

the orthogonal projection of v to the relevant spaces. Since the three spaces are orthogonal and generate Rn, we have v = v0 +v+ +v-. Since

Qs-1(g-t0v)  0, it follows that

0  g-t0 v+ 2 + g-t0 v0 2 - g-t0 v- 2

 exp(-2t0¯s0) v+ + v0 2 - exp(-2t0¯s0-1) v- 2

 exp(-2t0¯s0) v 2 - exp(-2t0¯s0-1) v- 2.

Consequently, v-  exp(t0(¯s0-1 - ¯s0)) v . Similarly, v+  exp(t0(¯s0 - ¯s0+1)) v . In particular, if

t0 = -

log

1 2



/ min(¯s - ¯s+1 : s = 1, . . . , k - 1),

then

v+ ,

v-



1 2



v

, and hence d(v, V¯s0 )  

v

.

47

Finally, for every  > 0 there exists  > 0 such that the following

is satisfied. For every E  Il which gives multiplicity  to , if V  

Gr(l, n) that for

has a every

decomposition v  W one has

V = d(v, V

)

Eall W with dim   v , then V  

W =  U(Gr(l,

such n)gE ).

Indeed, the projection of W to V is  close to W. Hence the direct

sum of the projections is close to V .

We deduce that V  U(Gr(l, n)gE), as desired.

6.2. Functoriality of Directions. We end the section by proving that directions are functorial, which was used in the proof of Theorem 2.27, and will be used in the sequel.
Lemma 6.3. There exists  > 0 such that if (a) l1 < l2, (b) Ei  Ili and Vi  U(Gr(li, n)gEi) for i = 1, 2,
and (c) V1  V2, then E1  E2.
Proof. Assume to the contrary that E1  E2. Denote
X := {(V1, V2)  Gr(l1, n) × Gr(l2, n) : V1  V2}.
Note that X is closed. By analyzing the eigenvalues of gt, for every V1  Gr(l1, n)gE1 and V2  Gr(l2, n)gE2 we have V1  V2 . That is,
X  Gr(l1, n)gE1 × Gr(l2, n)gE2 = . Consequently, using the metric
d((V1, V2), (V1, V2)) = max(dGr(l1,n)(V1, V1), dGr(l2,n)(V2, V2)), we obtain the desired result for  = d(X, Gr(l1, n)gE1 × Gr(l2, n)gE2), which is positive since it is the distance between two disjoint compact sets.

7. Flag Perturbation Theorems
In this section we will prove three results on perturbation of flags, namely Lemmas 7.13, 7.16, and 7.28. These results will be used to define Alice's Strategy in Section 8 and the first will be used to analyze Bob's strategy in Section 10.
From a more conceptual viewpoint, Lemma 7.13 is the motivation for the definitions of (·) and 0(·) (see Definition 2.29), and Lemmas 7.16 and 7.28 are the motivation for the combinatorics of category flows.

48

OMRI NISAN SOLAN

7.1. The Counting Lemma.

Definition 7.1. Let 0  l  n, E  Il and V  Gr(l, n)gE. Denote HV := {h  H : hV = V }. Let E· be a direction filtration and V· be a flag such that L(V·) = L(E·) and Vl  Gr(l, n)gEl for every l  L(V·). Denote

HV· :=

HVl .

lL(V·)



Recall that for every direction filtration E· we denoted the quantity

k
(E·) =

( - )+,

i=1

Eli

Eli \Eli-1

and recall the expansion metric d on H as defined in Subsection 4.2 and Definition 4.1. This subsection analyzes the subgroup HV·  H and proves the quantitative claim analogous to the equality

(E·) = dimH(HV·; d),
where L(V·) = L(E·) and Vl  Gr(l, n)gEl for every l  L(V·). Specifically, Lemma 7.2 gives an upper bound on the number of points one can choose in Bd(Id; 1)  HV· that are far from one another.

Lemma 7.2. Let V· be a flag, E· be a direction filtration with L(E·) = L(V·) such that

(7.1)

l  L(V·), Vl  Gr(l, n)gEl.

Let t > 0.
There exists a set A  Bd(Id; 1) of size (exp(t(E·))) that satisfies the following conditions:

(1) d(h1, h2)  exp(-t) for every distinct elements h1, h2  A. (2) hVl  Gr(l, n)gEl for every h  A, l  L(V·), i.e., A  HV·. Moreover, there exists no such A larger than (exp(t(E·))) even if we weaken Condition 2 to
(2') For every h  A there exists h  H with d(h, h) < exp(-t) and hVl  Gr(l, n)gEl for every l  L(V·).

Fix a flag V· and a direction filtration E·. We will express Condition (7.1) coordinatewise. Denote by Og the group of orthogonal matrices

49

that commute with gt. Since the eigenspaces of gt are orthogonal, it follows that

Og =

O(V ),

V eigenspace of gt

and hence Og acts transitively on the set of flags which satisfy (7.1). We
can thus assume that Vl = span{ej : j  Fl}, where Fl  {1, . . . , n}. Denote by (ei)ni=1 the standard basis of Rn and by (ea,b)na,b=1 the
standard basis of Mn×n(R).

Lemma 7.3. Let E  Il and V = span(ej : j  F )  Gr(l, n)gE for some F  {1, 2, . . . , n} of size l for which {j : j  F } = E as multisets, that is, V  Gr(l, n)gE. The group HV satisfies

HV =Id + span({ea,b : a > b, b  F = a  F }) ={h  H : hV  Gr(l, n)gE}.

Proof. The first equality follows from the definition, and similarly

HV  {h  H : hV  Gr(l, n)gE}. Assume to the contrary that hV  Gr(l, n)gE but hV = V . Since V and hV are gt invariant, it follows that g-thgtV = hV . On the other hand g-thgt -t-- Id. The result follows.

By Lemma 7.3,

HV· =

HVl

lL(V· )

=Id + span({ea,b : a > b, l  L(V·), b  Fl = a  Fl})

={h  H : l  L(V·), hVl  Gr(l, n)}.

We want to find a large set A  Bd(Id; 1)  HV· whose elements are exp(-t) far from each other with respect to the semimetric d. Since d is multiplied by exp(t) after applying t, we will find a large set tA  Bd(Id; exp(t)) whose elements are at distance 1 from one another. We will use a volume argument. Let µ be the bi-invariant
Haar measure on HV·, which exists since HV· is nilpotent.

Lemma 7.4. The t action on the measure satisfies

(t)µ = exp(-t(E·))µ.

Proof. By uniqueness of the Haar measure, it follows that (t)µ = tµ for some t > 0. Since HV· is a Lie group, it follows that µ is the integral with respect to an invariant volume form. Hence, to compute the
Radon-Nikodym derivative d(t)µ/dµ  t, it suffices to compute the

50

OMRI NISAN SOLAN

action of (t) locally on NIdHV·, where N = dim HV·. The eigenvalues of (t) on TIdHV· are

exp(t(a - b)) such that a > b and l  L(V·), b  Fl = a  Fl.

The eigenvalues of the dual action are the inverse of these eigenvalues, and hence the eigenvalue of the desired exterior power is the inverse of the product. A direct computation shows that the product is exp(t(E·)), as desired.

Proof of Lemma 7.2. Let tA  Bd(Id; exp(t))  HV· be a maximal set such that the d-distance between every two of its points is at least one. By maximality, every h  Bd(Id; exp(t))  HV· is at d-distance at most 1 from A. Consequently

(#A) · µ(Bd(Id; 1))  µ(Bd(Id; exp(t))) = exp(t(E·))(t)µ(Bd(Id; exp(t))) = exp(t(E·))µ(-tBd(Id; exp(t))) = exp(t(E·))µ(Bd(Id; 1)),
which implies the desired bound on #A. A similar volume argument provides an upper bound on #A if A
satisfies the weaker Condition (2') instead of (2). Recall that d is a metric (see Subsection 4.2). For every point h  tA there is a point h  HV·  Bd(h; 1). It follows that
µ(Bd (h; 2))  µ(Bd (h; 1) = µ(Bd(Id; 1)).
In addition

Bd (h; 2)  HV  Bd (h; 3)  HV  Bd (Id; exp(t) + 3). Consequently the integral

 :=

# A  Bd (h1; 2) dµ(h1)

Bd (Id;exp(t)+3)

counts hence 

with weight  µ(Bd (I

do;f1)a)t#lAea.stOµn(Bthdeo(tIhde;r1)h)anevde, rsyinpceoindtinis

A, a

and dou-

bling metric, it follows that # A  Bd (2; h1) = O(1). Thus we get the desired upper bound.

51
7.2. Adjustment of Lemma 7.2 to Almost Invariant Spaces.

Definition 7.5. Let 0  l  n. For every V  Gr(l, n) denote V  := limt gtV . This is a non continuous mapping Gr(l, n)  Gr(l, n)g. For every E  Il denote

Gr(l, n)E :=

V



Gr(l,

n)

:

lim
t

gtV

 Gr(l, n)gE

,

and
HV E := {h  H : hV  Gr(l, n)E}.
Let E· be a direction filtration and V· a flag with L(V·) = L(E·) and Vl  Gr(l, n)El for every l  L(V·). Denote HV·E· := lL(V·) HVlEl.


Example 2.5, continued. To describe explicitly Gr(2, 4)E for E  I2 we will use a variation of the definition of Schubert cells. We will not use this representation in the rest of the paper, and instead use the more indirect description Gr(2, 4)E = H-Gr(2, 4)gE. For every M  M4×2(R) and a subset F  {1, 2, 3, 4} denote by MF the (#F )×2

52

OMRI NISAN SOLAN

matrix composed of the F rows of M. We get





Gr(2, 4){-1,0}

=

 I m(M )

:

M

=

1 00
0





0  , rank M 0

=

 2

=

{span(e1,

v)

:

0

=v 



span(e2,

e3)},

Gr(2, 4){-1,1}

=

 I m(M )

:

M

=

1 00
0

1

=

{span(e1,

v

+

e4)

:v 



span(e2,

e3)},



Gr(2, 4){0,1}

=

 I m(M )

:

M

=

 
0

  1

,

rank

M{2,3,4}

=

 2







0 = v  span(e2, e3),

=

span(e4 

+

u,

v

+ e1) 

: u


R, and span(e1,

e2,

e3)

,

Gr(2, 4){0,0}

=

 I m(M )

:

M

=

 10
0

010

= {span(e2 + e1, e3 + e1) : ,   R},

where  represents any real number. Let V0 = span(e1 + e2 + e3, e4)  Gr(2, 4){0,1} and V1 = span(e1 + e2, e1 + e3)  Gr(2, 4){0,0}. Then

 HV0{0,1} = a1bc
 HV1{0,0} = a1bc





0 1 0 d

0 0 1 e

0 00 1

:

a,

b,

c,

d,

e



R,

(a,

b)

=

(-1,

 -1)

,





0 1 0 -c

0 0 1 -c

0 00 1

:

a,

b,

c



R,

a

+

b

+

1

=

 0

.



53

Remark 7.6. The set HV·E· is not a group. It does satisfy the property that for every h0  HV·E·,
HV·E· = Hh0V·E· h0.
Our next goal is to prove Lemma 7.10, which shows a local bijection between HV E and HV .

Lemma 7.7. Let E· be a direction filtration and V· a flag with L(V·) = L(E·) and Vl  Gr(l, n)El for every l  L(V·). There exists a matrix q0  H- such that q0 · Vl = Vl for all l  L(V·). Moreover, for E· fixed we can choose the mapping V·  q0 so that it is differentiable as a map from a manifold of flags to H-.

Proof. We will first show the claim for a single space V  Gr(l, n)E. Let W = (V ) be the orthogonal complement of V . Since V 

decomposes as a direct sum of its intersections with eigenspaces V of
gt, it follows that W is the direct sum of the orthogonal complement of V   V in V, and hence W is gt-invariant.
Since gtV -t--  V  and V   W = {0}, it follows that (gtV )  W = {0}. Since W is gt invariant we conclude that V  W = {0}. It follows that for every v  V  there exists a unique q0(v)  V such that q(v) - v  W . Extend q0 to a linear map q0 : Rn  Rn by q0(w) = w for every w  W . As a linear map q0 : Rn  Rn we think on q0 as a matrix.
We claim that qt := gtq0g-t -t--  Id. Indeed, this map is the identify map on W . We will show that qt converges to the identify map on V . For every v  V  the element qtv = gtqg-tv lies in gtV and is the unique element such that qtv - v  W . Since gtV -t--  V  it follows that gtq0g-tv -t-- v. Therefore gtq0g-t -t--  Id, and hence q0  H-. Note that fixing E, the mapping V  q is differentiable as a map from Gr(l, n)E to H-.
To prove the general case, denote L(V·) = {0 = l0 < l1 < · · · < lk = n}. Let q0 be the matrix in H- such that q0 Vl k-1 = Vlk-1. By induction on n, applying the lemma in dimension lk-1 < n to the flow

gt

=

(det

g |t Vl k-1 g | ) t Vl k-1 1/lk-1

,

the flag {0} = (q0 )-1V0  Vl1 · · ·  (q0 )-1Vlk-1, and the direction

filtration



=

E0



El1



···



Ek-1,

there

exists

q0

:

V lk-1



V lk-1

such that q0Vli We can extend

= q0

q0-1Vli for to a map

every 0 q0 : Rn

i 

k- Rn by

1 and gtq0g- t q | = 
0 (Vl k-1 )

-t--  Id. Id. This

54

OMRI NISAN SOLAN

map satisfies gtq0g-t -t-- Id, hence q0 = q0 q0 is the desired matrix. The result follows.

Remark 7.8. For every  > 0, if dGr(l,n)(Vl, Vl) <  for every l  L(V·), then by the differentiability of the construction of q0 we get that dH-(q0, Id) = O(). Lemma 7.9. For every 0  l  n, E  Il, and V  Gr(l, n)gE, we have
HV E = HV .

Proof. By the definitions of the sets HV  HV E. Let h  HV E. By the definition of HV E we get that
gthV -t--  V   Gr(l, n)gE.
It follows from the definition of H that g-thg-t -t--  Id, and by the gt invariance of V , we get

(7.2)

g-thV = g-thgtV -t-- V  Gr(l, n)gE.

Consequently, dGr(l,n)(gthV, Gr(l, 2.7 we get that gthV  Gr(l, n)gE

n)gE) -t--±-  0, for every t and

and hence by in particular

Theorem constant.

Eq. (7.2) implies that hV = V , hence h  HV .

Recall that H-0 = H-H0 is the group of matrices A  SLn(R) such that Aij = 0 only if i  j.

Lemma 7.10. Let E· be a direction filtration and V· a flag with L(V·) =

L(E·) and Vl that satisfies

 q0

VGlr(l=, n)Vl Eflorforeveevreyryl

l  L(V·).  L(V·).

Let q0  H- be a Then there exist

map open

sets U1  HV·E· and U2  HV· containing Id, a diffeomorphism

h : U1  U2, and a map q : U1  H-0 such that

hq0 = q(h)h(h),

for every h  U1. Moreover, for every compact set K  H, and every 0 > 0 there exists K > 0 such that if dH-(q0, Id) < K then U1, U2 contains HV·E·  K and HV·  K, respectively. Furthermore, for every h  U1  K we have dH(h(h), h) < 0.

Proof. The multiplication map

mUL : H × H-0  SLn(R)

mUL : (h, q-0)  q-0h

is one to one and has an open image. Set

U1 := {h  H : hq0  Im(mUL)}, U2 := {h  H : hq0-1  Im(mUL)}.

55

For every h  U1 denote

(7.3)

(h(h), q(h)) := m-U1L(hq0)

and note that the equality hq0 = q(h)h(h) implies that h induces an isomorphism between h : U~1  U~2 . Note that Id  U1 , U2 .
Te sets U1 := U1  HV·E· and U2 := U2  HV· satisfy that for every h  U1 we have

(7.4) (7.5) (7.6) (7.7) (7.8)

h  U1  l  L(V·), hVl  Gr(l, n)El  l  L(V·), hq0Vl  Gr(l, n)El  l  L(V·), q(h)h(h)Vl  Gr(l, n)El  l  L(V·), h(h)Vl  Gr(l, n)El  l  L(V·), h(h)  HVl,

where (7.4) follows from the definition of U1, (7.5) follows from the
definition of q0, (7.6) follows from Eq. (7.3), (7.7) follows from the fact that H- preserves Gr(l, n)E, and (7.8) follows from Lemma 7.9.
As a result U1, U2 satisfy the desired condition. Note that the smaller q0 is, the closer hq0, hq0-1 are to H  Im(mUL) and hence the second condition follows.

Fix a direction filtration E· and a flag V· with L(V·) = L(E·) and

Vl  Gr(l, n)El for every Lemma 7.7 which satisfies

l  L(V·). Let q0  H- be the q0V· = V·. Lemma 7.10 gives

element from us a measure

µ = h- 1µ on HVlEl, where µ is the invariant measure on HV·.

To extend Lemma 7.2 to HV·E· we need to compute the volume

µ(Bd(h; exp(-t))) for h  HV·E·.

Lemma 7.11. There exists  > 0 such that if d(q0, Id) <  then every h0  HV·E· with d(h0, Id)  1 satisfies

µ(Bd(h0; exp(-t))) = (exp(-t(E·))) as t  .

Proof. Let h, q be as in Lemma 7.10. If d(q0, Id) is small enough, then Bd (Id; 21/)  HV·E· is in the domain of h, q and similarly Bd(Id; 21/)  HV· in the image of h.
We first show the result when h0 = Id. We want to calculate

(7.9)

µ({h  HV· : h-1(h)  Bd(Id; exp(-t))}) = µ h(Bd(Id; exp(-t))  HV·E·)

56

OMRI NISAN SOLAN

Let h, q be the function generated by Lemma 7.10 applied to E·, q1V·, and q1, where q1 = gtq0g-t and q1V·. These functions satisfy

(7.10)

q(h)h(h) = hq1 = hgtq0g-t.

Substituting h = gthg-t in Eq. (7.10) we get that q(gthg-t)h(gthg-t) = gth0g-t = (gtq(h)g-t)(gth(h)g-t).

Since the multiplication map mUL : H-0 × H  SLn(R) is one to one it follows that

q(gthg-t) = gtq(h)g-t and h(gthg-t) = gth(h)g-t.

Conjugating by gt we get that the quantity in Eq. (7.9) equals
exp(-t(E·)µ h(Bd (Id; 1)  HV·E·) .
Since q1 is close to the matrix Id, Lemma 7.10 implies that h(h)|Bd(Id;21/ ) is close to the identity map, and hence

µ(h(Bd(Id; 1)  HgtV·E·)) = (1),
and hence our prediction of the µ-measure of a small ball around Id is correct.
For h0 = Id, write q(h0) = q2q20, where q2  H- and q20  H0. Since
l  L(V·), h0q0Vl = q(h0)h(h0)Vl = q2q20Vl,
it follows that for Vl := h0Vl we have (Vl) = q20Vl. We can now construct µ on HV·E· as we constructed µ. Similarly, since dH-(q0, Id) is arbitrarily small and h0 lies in a compact set, we deduce from Lemma 7.10 that dH-(q(h0), Id) = dH-(q1, Id) is arbitrarily small, and hence
µ(Bd(Id; exp(-t))  HV·E·) = (exp(-t(E·)).

By Lemma 7.10 if dH-(q0, Id) is small enough, then both HV·E· and HV·E· are manifolds in a bounded set. Since µ, µ are smooth measures with positive density, and since HV·E·h-0 1 = HV·E·, we obtain that the radon-nikodym derivative (Rh-0 1)µ/µ is bounded on Bd(Id; exp(-t))  HV·E·, where Rh-0 1 is the map of multiplication from the right by h-0 1, and (Rh-0 1) is the measure pushforward. Hence
µ(Bd (h; exp(-t))  HV·E·) =(Rh-0 1)µ(Bd (Id; exp(-t))  HV·E·) = µ(Bd(Id; exp(-t))  HV·E·) = exp(-t(E·)),

as desired.

57

Definition 7.12. For every l = 0, . . . , n and E  Il denote by Gr(l, n),gE

the set of vector spaces V  Gr(l, n)E such that dGr(l,n)(V, V ) <

.



Lemma 7.4 shows that

(7.11)

µ(Bd(h; exp(-t)) = (exp(-t(E·))),

for every h  HV· and t > 0. Combined with standard covering arguments Eq. (7.11) prove Lemma 7.2. Replacing Eq. (7.11) with Lemma

7.11 in the proof of Lemma 7.2 we can now prove the following.

Lemma 7.13. There is 0 > 0 such that the following occurs. Let V· be a flag, E· a direction filtration with L(V·) = L(E·), t > 0, and Vl  Gr(l, n)0,Egl for every l  L(V·). There is a set A  Bd(Id; 1) of size (exp(t(E·))) that satisfies the following conditions.
(1) We have d(h1, h2)  exp(-t) for all pairs of distinct elements h1, h2  A.
(2) We have h  HV·E· for every h  A.
Moreover, there is no such set A larger than (exp(t(E·))), even if we weaken Condition 2 to
(2') For every h  A there exists h  HV·E· such that d(h, h) < exp(-t).

7.3. The Changing Step Lemma. In view of Observation 4.14, the following lemma will construct Alice's step whenever fEh ,· changes from time Tm to time Tm+1 via a non null vertex. In these steps
#Am+1 = 1, that is, Alice's choice determines hm+1. Consequently, Lemma 7.16 below will prove the existence of an element h  Bd(Id; 1) with a certain behavior.

Definition 7.14. Let E·, E· be direction filtrations with L(E·) =

L(E· ). We say that E· E· if El El for every l  L(E·).



Remark 7.15. In Definition 7.14, the conditions El El is required independently for each l. That is, for every l  L(E·) we can increase some of the elements in El to obtain El. The increments are not required to be compatible for different values l. We will see (Definition 7.21) a precise formulation of increasing all sets in a compatible way and show (Theorem 7.22) that the definitions are equivalent.

Lemma 7.16. Let E· E· be direction filtrations and V· be a flag such that L(V·) = L(E·) and Vl  Gr(l, n)El for every l  L(E·). There exists h  Bd(Id; 1) such that hVl  Gr(l, n)El for every l  L(V·).

58

OMRI NISAN SOLAN

Moreover, the convergence rate of limt gthVl  Gr(l, n)gEl is uniform on compact sets of possible V·-s.
The proof of Lemma 7.16 occupies the rest of this subsection. We will break it up into several claims.

Claim 7.17 (Transitivity of Lemma 7.16). The lemma is transitive with respect to E· E· . That is, let E· E· E·, and assume the statement of the lemma holds for the tuples E· E· and E· E·. Then the statement also holds for E· E·.

Proof. Let V· be a flag such that L(V·) = L(E·), and Vl  Gr(l, n)El for every l  L(V·). Fix t0, t1 > 0 to be determined later. By the

statement of the lemma applied to E· E· and the flag gt0V·, there

exists h0  Bd(Id; 1) such that h0gt0Vl  By the statement of the lemma for E·

Gr(l, E·

n)El for all and the flag

l  L(E·). gt1 h0gt0 V·

there exists h1  Bd(Id; 1) such that h1gt1h0gt0Vl  Gr(l, n)El for all l  L(E·).

And hence also g-t1-t0 h1gt1+t0 g-t0 h0gt0VlGr(l, n)El. If t0, t1 are large enough both g-t0h0gt0 and g-t1-t0h1gt1+t0 are close to Id, and

their product lies in Bd(Id; 1).

Claim 7.18 (The meaning of uniform convergence). Let 0  l  n,

E  Il and K  for V  K if and

oGnrl(yl,inf )theE(.coTmhpeaccot)nvcelorgseunreceK¯gtV

V Gr(l,


n)

is is

uniform a subset

of Gr(l, n)E.

Proof. By Lemma 7.7, for every V  K there exists q0(V ) such that

V = q0(V )V  and moreover, the function V  q0(V ) is continuous.

It follows that if K  Gr(l, n)E is compact then so is q0(K), and

gtq0(K)g-t contracts uniformly.

To prove the other direction, by Lemma 7.7 once again, if Q0 

H- is a compact neighborhood of neighborhood of Gr(l, n)gE in Gr(l,

Id, then Q0Gr(l, n)gE is a compact n)E. Therefore if the convergence

rate gtV  V  is uniform for V  K, there exists t0 > 0 such that

gt0K  Q0Gr(l, n)gE, and hence K  g-t0Q0Gr(l, n)gE as desired.

From Claim 7.18 it easily follows that the uniform convergence satisfies transitivity as well.

Claim 7.19 (Reduction to the case V· is g-invariant). It is enough to prove Lemma 7.16 for flags V· satisfying Vl  Gr(l, n)gEl for every l  L(E·). Proof. Assume that Lemma 7.16 holds whenever Vl  Gr(l, n)gEl for every l  L(E·). By Claim 7.18 there are compact sets Kl  Gr(l, n)El

59
such that for every flag V· with L(V·) = L(E·) and Vl  Gr(l, n)gEl for every l  L(E·) there is h  Bd(Id; 1) such that hVl  Kl for every l  L(E·). We will show that for every compact set Klsrc  Gr(l, n)El there exists Kltar  Gr(l, n)El, such that for every flag V· with Vl  Klsrc for every l  L(E·) there exists h  Bd(Id; 1) with hVl  Kltar. This, together with Claim 7.18, shows that Lemma 7.16 holds. HeinvegeFnricygxelolgfo>rLtso0(oVmKa·n)el.dqwAa0eftflemarBgaadyVpH·p-al(swyIsiiudntm;hgOegL(t,(tVh)w)·ae)twm=eifahLyVa(alv Eses·u)Vmlsu=eGcKrhq(0llstV,rhcnl a)tgE. lVU,Altf(thGeeKrrn(alslpr,tchnpef)loyrgEer-l). exists h0  Bd(Id; ) such that h0Vl = h0q0-1Vl  Kl. Since h0, q0 are arbitrarily small, there exist q1  BdH- (Id; 1), h1  Bd(Id; 1) such that q1h1 = h0q0-1. It follows that h1Vl  BH-(Id; 1)Kl =: Kltar, as desired.
To employ Claim 7.17 we will investigate the poset I· of direction filtrations with dimension sequence L = {0 = l0 < l1 < · · · < lk = n}, where the partial order is given by E· E· , as defined in Definition 7.14.

Definition 7.20 (Multiplicity of element in multisets). Let E be a

multiset. For every element x we denote by mult(x; E) the multiplicity

of x in E.



Definition 7.21 (Elementary flip). We say that E·  E· is an elementary flip if there exist  <   Eall and 1  a < b  k such that

(7.12)

Eli =

Eli - {} + {}, Eli ,

a  i < b, otherwise.

We use + and - instead of  and \, as these are multiset operations, which add or subtract the multiplicities. In this case E·  E· is called an (, , a, b)-elementary flip. We think of an elementary flip as an operation transforming E· to E· . Note that a direction filtration E·  I· has an (, , a, b)-elementary flip E·  E· if and only if the following condition of multiplicities is satisfied:

mult(; Ela-1) < mult(; Ela) and mult(; Elb-1) < mult(; Elb).

Indeed, otherwise the unique E· defined by Eq. (7.12) will fail to satisfy

E la-1



Ela

or

E lb-1



Elb ,

respectively.



60

OMRI NISAN SOLAN

Theorem 7.22 (The poset I· is spanned by elementary flips). If E· E· , then there exists a sequence of direction filtration E· = E·0  E·1  . . .  E·r = E· , where each consecutive E·j  E·j+1 is an elementary flip.

Proof. The plan: Since I· is a finite poset, it is enough to show that for every E·  E· there is an elementary flip E·  E· such that E· E· .
To use the fact E·  E· , define

(7.13)

 :{0, ..., k} × (set(Eall)  {-})  N0,

(i, ) : = # (Eli  (-, ]) =

mult(~, Eli).

~set(Eall ) ~

Here we use set(Eall) to refer to the set of distinct elements in Eall and N0 = {0, 1, 2, ...} is the set of natural numbers. Define  in a similar fashion with respect to E· instead of E·. Note that E· E· if and only if (i, )  (i, ) for all i, .
If E·  E· is an (, , a, b)-elementary flip then the functions , 
satisfy that  =  - ½R where R is the rectangle {(i, ~) : a  i <
b,   ~ < }. We need the function  to remain greater or equal to  to ensure E· E·. To help us find a suitable rectangle we will identify 0 < i0 < i2 such that (i, ) - (i, ) is zero for 0  i < i0 and all   Eall  {-} and nonzero for all i0  i < i2 and some   Eall. Moreover i  (i, ) - (i, ) will be weakly increasing in i for 0  i < i2 and every   Eall  {}.
Additional notations: Since we are interested in monotonicity properties of  - , define the function  : {1, ..., k} × (set(Eall)  {-})  Z by
 (i, ) := (i, ) - (i, ) - (i - 1, ) + (i - 1, ).

By definition, for every   Eall  {-} and 0  i  k we have

(7.14)

i

k

(i, ) - (i, ) =  (i, ) = -

 (i, ).

i =0

i=i+1

The last equality holds since (k, ) = (k, ) as Elk =

Denoting

Di

:=

Eli

- Eli-1

and

Di

:=

Eli

-

E li-1

,

we

have

Elk

=

Eall.

 (i, ) = #{~  Di - Di : ~  }.

Note that here we regard Di and Di as multisets with possibly negative multiplicities.

Index choosing: The minimal index i0 for which the function  

 (i0, )

is

nonzero

is

the

minimal

i0

for

which

Eli0

=

E li0

(which

exists

61

since E· = E· ), and satisfies

i0
 (i0, ) =  (i, ) = (i0, ) - (i0, )  0 for all   Eall.

i=0

Since Ei0  Ei0, it follows that  (i0, ) = (i0, ) - (i0, ) is positive for some   Eall.
Similarly, by the right hand side of Eq. (7.14),  attains a negative
value for some i, and we let i2 be the minimal index such that    (i2, ) attains a negative value. It follows from the equality

 (i2, n)

=

#Eli2

-

#Eli2

-

#Eli2-1

+

#E li2 -1

=

0,

that there exists an index 1 < s2  n such that  (i2, s2-1) < 0 but  (i2, s)  0 for all s  s2.
Since i2  (i, s2-1) = (i, s2-1) - (i, s2-1)  0,
i=1

it follows that for some i1 < i2 we have  (i1, s2-1) > 0. Let s1  1 be the minimal index such that  (i, s) > 0 for every s1  s  s2-1.
Obtaining the desired flip: We claim that we can perform an
(s1, s2, i1, i2)-elementary flip to E·, and obtain a sequence E· that satisfies E· E· .
To change one occurrence of s1 to s2 between the indices li1 and li2-1, while preserving the requirement that the resulting sequence E· is a direction filtration (i.e, the multisets E· are nested, see Eq. (2.2)), it is sufficient and necessary to show that

(7.15) mult(s1; E ) li1-1 < mult(s1 ; Eli1 ), mult(s2; E ) li2-1 < mult(s2; Eli2 )
Since

 (i1, s1) -  (i1, s1-1) = mult(s1 ; Eli1 ) - mult(s1 ; E ) li1-1 and

 (i2, s2 ) -  (i2, s2-1) = mult(s2; Eli2 ) - mult(s2; Eli2-1 ), Eq. (7.15) is equivalent to

(7.16)

 (i1, s1) >  (i1, s1-1),  (i2, s2-1) <  (i2, s2),

which follows from the choices of s1, s2. Define

Eli :=

Eli - {s1} + {s2 } Eli

i1  i < i2, otherwise.

62

OMRI NISAN SOLAN

To show that E· E· , define  as in Eq. (7.13) with respect to E·. By the definition of E· we obtain

(i, ) = (i, ) - 1 if i1  i < i2 and s1   < s2,

(i, )

otherwise.

We need to show that    pointwise, which is equivalent to

(i, ) > (i, ) for every i1  i < i2, s1   < s2.
These inequalities follow from the fact that (i, )-(i, ) = ii  (i, ), which is the sum of nonnegative numbers by the definition of i2 and the summand  (i1, ) is positive by the definition of s1.
Altogether we have shown that there is E· such that E·  E· E· , and the tuple E·  E· is an elementary flip. Iterating this procedure for E· E· yields the desired result.

Example 7.23. Let n = 4, Eall = {-2, -1, 1, 2}, and li = i for i = 0, . . . , 4. Denote
E· = {  {-2}  {-2, 1}, {-2, -1, 1}, Eall},
and
E· = {  {2}  {-1, 2}, {-1, 1, 2}, Eall}.
We will describe in detail the process developed in the proof of Theorem 7.22. First, compute , ,  .

63

(i, ) :

 





i

 

-

-2

-1

1

2

0

0 0 000

1

0 1 111

2

0 1 122

3

0 1 233

4

0 1 234

(i, ):

 





i

 

-

-2

-1

1

2

0

0 0 0 00

1

0 0 0 01

2

0 0 1 12

3

0 0 1 23

4

0 1 2 34

 (i, ):

 





i

 

-

-2

-1

1

2

1

0 1 1 10

2

0 0 -1 0 0

3

0 0 1 00

4

0 -1 -1 -1 0

Hence, i0 = 1, i2 = 2, s2 = 3, s2 = 1, i1 = 1, s1 = 1, s1 = -2. Consequently, we obtain the elementary flip E·  E·(1), where

E·(1) = {  {1}  {-2, 1}, {-2, -1, 1}, Eall}.

The blue rectangle in the (i, ) table denotes the rectangle R for which
(1) =  - ½R. Continuing the process for E·(1) E· , we have

64

OMRI NISAN SOLAN

(1)(i, ) :

 





i

 

-

-2

-1

1

2

0

0 0 000

1

0 0 011

2

0 1 122

3

0 1 233

4

0 1 234

 (i, ) :

 





i

 

-

-2

-1

1

2

1

0 0 0 10

2

0 1 0 00

3

0, 0 1 0 0

4

0 -1 -1 -1 0

Hence, i0 = 1, i2 = 4, s2 = 4, s2 = 2, i1 = 1, s1 = 3, s1 = 1. Consequently, we obtain the elementary flip E·(1)  E·(2), where

E·(2) = {  {2}  {-2, 2}, {-2, -1, 2}, Eall}.

(2)(i, ) :

 





i

 

-

-2

-1

1

2

0

0 0 000

1

0 0 001

2

0 1 112

3

0 1 223

4

0 1 234

 (i, ) :

 





i

 

-

-2

-1

1

2

1

0 0 0 00

2

0 1 0 00

3

0 0 1 00

4

0 -1 -1 0 0

Hence, i0 = 2, i2 = 4, s2 = 3, s2 = 1, i1 = 3, s1 = 2, s1 = -1. Consequently, we obtain the elementary flip E·(2)  E·(3), where

E·(3) = {  {2}  {-2, 2}, {-2, 1, 2}, Eall}.

65

We can continue the algorithm for one last step, or alternatively note

that E·(3)  E· is an elementary flip.



Proof of Lemma 7.16. We conclude from Claim 7.17 and Theorem 7.22

that flip.

it is By

Cenlaoiumgh7.t1o9pwroeveasLsuemmme aV·7.i1s6awflhaegnewvietrhEV·lE·Girs(al,nne)lgEelm. eHnetnarcye

V· = uV·(0), where u  Og, Vl(0) = span{ej : j  Fl}, Fl  {1, . . . , n},

and El = {j : j  Fl}. Since E·  E· is an (, ~, a, b)-elementary flip,

there exist j0 with j0 = , and j0  Fa \ Fa-1 and j1 with j1 = ~ and

j1  Fb \ Fb-1. The matrix h = Id + ej1,j0 lies in Bd(Id; 1) provided

 = (1) > 0 is small enough. It preserves the spaces Vli(0) for i < a or i  b. If a  i < b, then the blade corresponding to hVli(0) is

(7.17)

(ej0 + ej1) 

ej = ± ej ± 

ej .

jFli \{j0}

j Fli

jFli {j1}\{j0}

The expression in Eq. (7.17) is the sum of two gt-eigenvectors, with
eigenvalues exp t Ei  and exp t  Ei . The second eigenvalue is exponentially larger than the first, and hence

gthVli(0) -t-- span{ej : j  Fli  {j1} \ {j0}}. It follows that (hVl(0))  Gr(l, n)El for every l  L, and the first claim of Lemma 7.16 holds for V·(0). As for V·, we have that h := uhu-1  Bd(Id; 1) satisfies hV· = uhV·(0) and hVli  Gr(l, n)El for every l  L. Moreover, hVl lies in the compact set OghVl(0)  Vl  Gr(l, n)El for every l  L. Claim 7.18 implies the desired for V·.

7.4. Adding Spaces to the Flag. In view of Observation 4.14, the following lemma will construct Alice's step whenever fEh ,· changes from time Tm to time Tm+1 via a null vertex   E at l. In these steps #Am+1 = 1, that is, Alice's choice determines hm+1. As in Subsection 11.1, Lemma 7.28 below will prove the existence of an element h  Bd(Id; 1) with a certain behavior.
Recall that a sublattice    is called primitive if there is no larger sublattice      with span() = span().
Claim 7.24. Let  be a lattice, and denote by 1() the size of the shortest nonzero vector in . For every l = 0, . . . , n, V  Gr(l, n),  > 0 there exists a primitive sublattice    with rank l, covolume covol 

66

OMRI NISAN SOLAN

that satisfies

(7.18)

log covol 

=

l n

log covol 

+ O(log 1()

-

log ),

and span   U(V ).

Remark 7.25. As always, the implicit constant of the O-notation in Eq. (7.18) depends on n, see Subsection 2.8.

Proof. It is sufficient to construct a non primitive sublattice   .

Indeed, given a non-primitive sublattice    that satisfies the other

condition of the lemma, the lattice  = span  is primitive with the

same span and smaller covolume. Since 1()  1(), Minkowski's Theorem ([3, Chapter III, Theorem II]) implies that covol() = (1()rank ), hence  satisfies the desired condition.

Up to multiplication by a scalar, assume that covol  = 1. It is

enough to prove the claim for l = 1. Indeed, fixing an orthogonal basis

(vi)li=1 and applying the theorem to each of the linear spaces viR for i = 1, ..., l yields l rank-1 sublattices of  whose sum is the desired

sublattice. After rotating  and V we may assume V = {x  Rn :

x1 = · · · = xn-1 = 0}. By Minkowski's Theorem, there exists a vector

v = (vi)ni=1 every 1 >

 0.

 \ {0} satisfying Note that if 1 

|v1|, . . . ,|vn-1|  1()/2 n then

1

and

|vn|



11-n

for

v 2  v12 + · · · + vn2-1 + vn2  (n - 1)21 + vn2  1()2/2 + vn2.

It follows that |vn| = (1()), and hence

dGr(1,n)(Rv, V )O(dRn(v, V )/ v ) = O(/vn) = O(1/1()).

Therefore there is a choice of 1 = (1()) for which dGr(1,n)(Rv, V )  . Consequently, for  = Zv we have covol  = O((1())1-n), as de-
sired.

Remark 7.26. The bound in Claim 7.24 is not optimal. Though deriving the optimal bound may be of interest, it will not improve qualitatively the results of this paper.

Definition 7.27 (Relative Covolume). Let 0  1  2 be lattices in Rn of ranks l0  l1  l2, respectively. Define the relative covolume of 0, 1, 2 by

log

covol(2/1/0)

:=

log

covol

1-

l2 l2

- -

l1 l0

log

covol

0-

l1 l2

- -

l0 l0

log

covol

2.

The relative covolume is the signed height of p1 = (rank 1, log covol 1) above the interval [p0, p2]. It is also the normalized covolume of

67

(1) in (2) where  : Rn  span(0), and we normalize so that

covol((2)) = 1.



Lemma 7.28 (Adding a lattice to a flag). Let 1 >  > 0, let  be a lattice, let E· be a direction filtration and let · be a filtration such that L(E·) = L(·) and
span l  Gr(l, n),gEl.
Let l0 < l1  L(·) be consecutive elements with l0 + 2  l1, let El0  E  El1, and assume that 2FHN(l1/l0)H,l  C for every l = 1, . . . , l1 - l0. There exists h  Hspan ·E· with d(h, Id)  1 and hl0    hl1 such that
span   Gr(l, n) O(E),g
and

(7.19)

log covol(hl1//hl0) = O(C - log ).

Proof. Denote Vl = span l for every l  L(·). We will first find Vl0 

V  Vl1 such that V  Gr(l, n)E. By Lemma 7.7 there exists q0  H-

such that Vl = q0Vl for all l  L(·). In addition, dH-(q0, Id) = O().

By V

deGcorm(l,pno)sgEinsguVchl0t,hVal 1t

V  = V .

to gt-eigenspaces, we Vl 0  V   Vl1. Set

deduce that there exists V = q0V  and note that

We will apply Claim 7.24 to l1/l0 and V /Vl0 in place  and V . Note that log 1(l1/l0) = O(C) since the height FHN(l1/l0)H,1 depends linearly on 2FHN(l1/l0)H,l for l = 1, ..., l1 -l0 -1, which are bounded by C. Then there exists   l1/l0 with d(span , V /Vl0)  1 and

log

covol



=

O(C

-

log

1)

+

ll1 - l ll1 - ll0

(log

covol

l1

-

log

covol

l0) ,

where 1 will be chosen later. Let  denote the inverse image of  in , note that l0    l1. Then the covolume of  satisfies Eq. (7.19), provided that 1 = (). Since  is 1 close to V and 1 can be chosen sufficiently small, there exists m  SLn(R) with m span  = V and
mVl = Vl with dSLn(R)(m, Id) = O(1). If 1 > 0 is sufficiently small, by Lemma 2.3 we can write m = q1h for q1  H-0 and h  H with dSLn(R)(q1, Id), dSLn(R)(h, Id) = O(1). It follows that h  Bd(Id; 1), hVl = q1-1Vl  Gr(l, n)El, and h = q1-1V  Gr(l, n)El. Since

68

OMRI NISAN SOLAN

dSLn(R)(q0, Id) = O(), it follows that dGr(l,n)(span , Gr(l, n)gE)  dGr(l,n)(q1-1V, V ) + dGr(l,n)(V, Gr(l, n)gE)
 dGr(l,n)(q1-1V, V ) + dGr(l,n)(q0V , V )  O(dSLn(R)(q1, Id) + dSLn(R)(q0, Id)) = O( + 1).
Note that we can choose 1 = (). The result follows.
Remark 7.29. In Lemma 7.28 we can require h to be in any neighborhood of Id. Such a choice will only change the implicit constant.

8. Alice's Strategy
Fix a g-template f and a lattice   Xn of covolume 1 for the rest of the section. Let T > 0 be a real number. Its choice will be formalized in Subsection 8.1. Recall that
Y,f := Y,[f] = {h  H : f h  f }  H,
where [f ] is the set of g-template which are equivalent to f . In this section we will construct Alice's strategy in the (T, g) game of
Y,f , see Subsection 4.4, and study some of its properties as explained in Subsection 4.5.

Definition 8.1. For every vertex t0 of f at l, we say that t0 is a vertex of type E-  E+ if fE,l(t) changes from E- to E+ near t0, i.e.,
E± = lim f (t0 ± ). 0


Informally, and somewhat imprecisely, Alice's strategy goes as follows: The initialization step is h0 = Id, T0 = 0. This defines Tm = mT . In the m-th step Alice chooses a set Am+1 of possible choices of hm+1 to ensure the following three conditions:
(1) Lf (Tm+1) = L(FHN(gTm+1 hm+1)). (2) l  Lf (Tm+1), FHN(gTm+1 hm+1)V,l  Gr(l, n) . fE,l(Tm+1) (3) l  Lf (Tm+1), FHN(gTm+1 hm+1)H,l = fH,l(Tm+1) + O(1).
There will be three different types of steps. In every step in which fE,·(Tm) = fE,·(Tm+1), we use Lemma 7.13 to construct a set Am+1 of size (exp(T (fE(T m)))). These steps are called Standard Steps. If f has a null vertex of type E   in [Tm, Tm+1], we will use a Standard Step as well. If f has a null vertex of type   E in [Tm, Tm+1], we will use Lemma 7.28 to construct a singleton Am+1 = {hm+1}. These steps are called Adding Steps. If f has a non null vertex in [Tm, Tm+1], we

69
will use Lemma 7.16 to construct a singleton Am+1 = {hm+1}. These steps are called Changing Steps.
There are several problems with this approach:
(1) We are not able to make a lattice enter the filtration FHN(gTmhm) at the exact step we need.
(2) There may be undesired elements in FHN(gthm)V,l. (3) The implicit constant in Condition 3 might increase with m.
8.0.1. Analogy to Error Correction. To illustrate the idea behind the solution of Problems (1) and (3), we consider an analogy. Suppose Alice has to drive an infinite route in a gridlike city. A navigation app provides Alice a list of directions, of the form "After 3 junctions turn left". Unfortunately, Alice always makes mistakes and never turns at the right junction. If the app does not update its instructions, Alice will eventually drift far from her original route. Therefore after every turn, the app moderately updates the instructions.
The original route of Alice is analogous to the g-template f . The route she finally takes is the g-template f h. The turns Alice makes are analogous to the vertices of the g-template. The updates of the app are analogous to perturbing the g-template below, see Subsubsections 8.1.1 and 8.2.3.
The analogous concept to C-separated g-template is an instruction list with bounded amount of turns every C kilometers. To add Bob to the analogy, we can think of Bob as a random noise, which is weaker the more Alice focuses, and Alice wants to focus the least, while still reaching her target.
8.0.2. Overview of the Strategy. Formally, a strategy is a choice of a move (h0, T0) in the initialization step and a map
 : (h0, T0; A1, h1, . . . , Am, hm)  Am+1,
which assigns for every m  0 and history of moves up to Alice's m-th step (excluded), the move of Alice in the current step m. To compute the value of the game it is enough to define Alice of histories that are consistent with Alice up to step m.
We will use auxiliary information, that is, Alice will maintain a filtration m· of  and a locally constant error function m = (lm)nl=0 with lm : Ul(f )  R. The strategy we will define will be a map
Alice : (h0, T0; A1, h1, . . . , Am, hm, m· , m)  (Am+1, m· +1, m+1).
For each history, the computation of Am+1, m· +1, and m+1 will have one of several forms. For each step we will decide whether it is a Standard Step, an Adding Step, or a Changing Step. In addition

70

OMRI NISAN SOLAN

we have three ways to update m· to m· +1. We can preserve it, and then m· +1 = m· ; we can add a lattice to it, and then m· +1  m· ; or we can remove a lattice from it, and then m· +1  m· . Further, there are two ways to update m. We can either anchor it (See Subsubsection 8.2.3) or not anchor it, and then m+1 = m.

8.1. Preliminaries. Fix C2  C1  T (see Subsection 2.8 for the
definition of ). The strategy will depend on T, C1, C2. Recall that f is a g-template fixed for the entire section. Let f  be the g-template f shifted so that fH ,l(0) = 0 for every l with 0  l  n. To shift f to f  we use the independent shift sequence with parameters C and (0)JGf , for a large enough C. By Lemma 5.15 the g-templates f, f  are equivalent. By Lemma 5.9 there is a C2-significant and C2-separated g-template f  that is equivalent to f . By the proof of Lemma 5.9 we get that f  is a shift of f , hence fH ,l(0) = 0 for every l with 0  l  n. Since we care about f only up to equivalence, we may assume that f is
C2-significant, C2-separated, and fH,l(0) = 0 for every l with 0  l  n.

8.1.1. Adjusting f . Define the shift sequence

(8.1)

 := (2l(n - l)C1 + C1)ln=-11.

For every sequence of locally constant functions  = (l)ln=-11, l : Ul(f )  [-C1, C1], we get that  +  is an independent shift sequence with parameters 2C1, C1 + .
By Lemma 5.30, since C2 is large enough with respect to C1, for every nontriviality interval J of f at l there exists a nontriviality interval J of f  at l with J  J. In addition f  is also C2/2-separated and C2/2-significant.

8.1.2. Preliminaries on Directions.

Definition 8.2 (Final direction). Let E-1  E0  E1 be submultisets

of Eall. We say that E0 is final in E-1  E1 if it is the maximum

with respect to the partial order of all E of size #E0 which satisfy

E-1  E  E1.



Observation 8.3. Let E· be a direction filtration and El  El be a

two consecutive elements in E·. Let E be a multiset between them,

i.e., El  E  El. Then (E·)  (E·  {E}), with equality if and

only if E is final in El  El.



Definition 8.4 (Scalar pairs). We say that a pair of multisets E  E

is a scalar pair if E - E has no two distinct elements, (i.e., has one

element, possibly with multiplicity).



71

Observation 8.5. If E  E is a scalar pair then for every l with

#E < l < #E there is a unique E  E  E of size l, and it is final

in E  E.



We will treat scalar pairs differently because of their following property (which is the reason for their name):

Observation 8.6 (Scalar action). Let E  E be a scalar pair, with

l := #E, l := #E. Let V  Gr(l, n)gE and V   Gr(l, n)gE be two linear spaces with V  V . Then the induced action gt V /V is a

multiplication with a scalar.



Lemma 8.7. Let E-1  E0  E1 be a multisets of sizes l-1 < l0 < l1 respectively, such that E0 is final in E  E1. Then

E0



l0 l1

- -

l-1 l-1

E1

+

l1 - l0 l1 - l-1

E-1

,

and equality occurs if and only if E-1  E1 is a scalar pair.

Proof. Denote the values with multiplicity of E1 - E-1 by

1  2  · · ·  l1-l-1 .

This sequence is constant if and only if E-1  E1 is a scalar pair. It

follows that the sequence l0 

 l0 -l-1 
i=1 i

for

l-1



l0



l1

is

convex,

and is linear if and only if E-1  E1 is a scalar pair. The result follows

since E0 = E-1 + {i : i = l0 - l-1 + 1, . . . , l1 - l-1}.

Lemma 8.8. Let f be a g-template, J be a nontriviality interval of f

at

l0

and

t0

one

of

its

endpoints.

Let

E·

=

lim
J tt0

fE,·(t),

and

let

l-1, l1

be the adjacent elements in L(E·) to l0 satisfying l-1 < l0 < l1. Then

El-1  El1 is not a scalar pair.

Proof. Let J0  J be an open interval in which f has no vertices and

t0 is an endpoint of J0. By the definition of E· for every t  J0 we

have fE,·(t) = E·. Consequently, t  fH,l(t) is linear in J0 for every l

with 0  l  n, and so is t  2fH,l0(t). Since t0 / Ul0(f ) it follows that 2fH,l0(t0) = 0 while for every t  J0 we have 2fH,l0(t0) = 0.

Consequently

d dt

2fH,l0

(t)

is

nonzero

for

t



J0.

From Observation 5.4 we get that

(8.2)

2fH,l0 (t)

=

l0

1 -

l-1

fH,l-1

+

l1

1 -

l0 fH,l1

-

(l1

l1 - l-1 - l0)(l0 -

l-1) fH,l0 .

72

OMRI NISAN SOLAN

Differentiating Eq. (8.2) yields

0

=

d dt

2fH,l0

(t)

=

l0

1 -

l-1

El-1

+

l1

1 -

l0

El1

-

(l1

l1 - l-1 - l0)(l0 -

l-1

)

El0

,

which implies with Lemma 8.7 that El-1  El1 is not a scalar pair.

8.1.3. Constants Order of Magnitude. Our computations will use sev-
eral universal constants, which depend on Eall but not on T , f , and , and should obey certain relations. Specifically, we require that

(8.3) 10  9  8  7  6  5  4  3, 3  2  1, 1  0.
Note that Eq. (8.3) states that both 4  3  2 and 4  3  2 holds, and a similar interpretation applies to 1, 1 . We will choose  > 0 small enough to satisfy several conditions that will be detailed throughout the proof. In particular,  is small enough so that the conclusions of Lemma 7.13, Theorem 2.7, and Lemma 6.3 are satisfied.

8.1.4. Convenient Assumption. Throughout the section we evaluate
the category flow of various g-templates at {Tm : m  N0}. The category flows might be undefined at Tm. To avoid this difficulty we will assume all g-templates have no vertices at N0T , i.e., their category flows are defined at N0T . To justify this assumption we translate f by a random small number and obtain a g-template f  with no non
null vertices at N0T . In addition, when shifting f we perturb the shift sequence to make sure no non null vertex of f lies in N0T . The perturbations affect Subsubsection 8.1.1 below and the anchoring operation
that we will define at Subsubsection 8.2.3, in which we are given one shift sequence  for which f + has no vertices in N0T . The anchoring operation changes  at a single nontriviality interval, to obtain another shift sequence . To make sure f + has no null vertices in N0T , we will perturb the updated value. Since the construction is indifferent to
perturbations, this procedure will not affect the arguments.

8.2. Setup for the Strategy Alice.
8.2.1. The State. In each step we keep a state that consists of (S.1) hm  H and Tm = T m. (S.2) An error function m = (lm)ln=-11, where lm : Ul(f )  [-C1, C1] is locally constant. (S.3) A filtration m· of .
Denote m := gTmhm and ml := gTmhmml for every l  L(m· ). We require the data in the state to satisfy the following conditions:

73

(S.4) L(m· )  Lf (Tm). We will see in Remark 8.13 that a stronger condition on L(m· ) actually holds.
(S.5) For every l  L(m· ) we have

(8.4)

span

ml



Gr(l,

n),g fE ,l (Tm )

and

(8.5)

log covol(ml ) = fH+,l m(Tm) + O(1),

where  is defined as in Eq. (8.1).
(S.6) For every two consecutive l < l  L(m· ), consider lattices m with ml  m  ml that project to elements in FHN(ml /ml ). We call such m a noise lattice. We require that the noise

lattices are insignificant, in the sense that

(8.6)

log covol(ml /m/ml ) = O(T ).

The choice of m is equivalent to the choice of  such that ml    ml , where m = gTmhm. The strategy selects a finite set Am+1 of possible hm+1  Bd(hm; (1- exp(-T ))1/ exp(-Tm)), where  is a constant for which d is a metric, see Subsection 4.2. The set Am+1 satisfies that d(hm+1, hm+1)  31/ exp(-Tm+1) for every pair of distinct hm+1, hm+1  Am+1. Instead of Am+1, we can consider the set Am+1 := gTmAm+1h-m1g-Tm, which satisfies
· Am  BT := Bd(Id; (1 - exp(-T ))1/). · d(hm+1, hm+1)  31/ exp(-T ) for every pair of distinct hm+1, hm+1 
Am+1.
This translation is possible due to the right invariance of the semimetric d. Sometimes the set Am+1 will consist of a single element. In that case, choosing Am+1 is equivalent to choosing the unique element hm+1 in it.

Definition 8.9 (Alignment of noise lattices). Let l0 < l1 be two consecutive elements in L(m· ). We say that a noise lattice  with ml0    ml1 is E-aligned at step m if m = gTmhm satisfies span m  U(Gr(l, n)E), for some fE,l0(Tm)  E  fE,l1(Tm), where rank  = l. We say that  is final at step m if it is E aligned and E is final in

fE,l0(Tm)  fE,l1(Tm).



8.2.2. Initialization. Sets h0 = Id, T0 = 0, and 0 = 0 everywhere. Since for every l with 0  l  n we have fH,l(0) = 0, it follows that Lf+0 (t) = {0, n}, hence we choose 0· := ({0}  ).

74

OMRI NISAN SOLAN

8.2.3. Updating m and m· . In this subsubsection we describe how m, m· are updated at each step.
There are three different ways to update m· to m· +1: Preserve, Add, and Remove, which respectively sets m· +1 = m· , adds a single element to m· to get m· +1, and removes a single element element form m· to get m· +1. We will use preserve and remove at Standard Steps, preserve at Changing Steps, and add at Adding Steps.

Definition 8.10 (Anchoring). By default, m+1 = m. After every
adding or changing step, we will use the Anchor operation. For each 1  l  n - 1, to anchor lm+1 is to fix lm+1(Tm+1) so that equality is attained in the formula

log covol(ml +1) = fE,l(Tm+1) + l(Tm+1) + lm+1(Tm+1),

i.e.

lm+1(Tm+1) := log covol(ml +1) - fE,l(Tm+1) - l(Tm+1).

Note that this operation changes lm on the entire connected component

of Tm on Ul(f ). This is the only operation that changes m. If we do

not anchor lm+1, then lm+1 = lm.



8.3. Geometric Picture. We will describe here geometric phenomena of the behavior of the (T, g) game.
Assume the game has been played, and has generated a sequence h0, A1, h1, . . .. For every 0  m0  m1 <  such that m0 < , denote
hm0m1 := gTm0 hm1 h-m10 g-Tm0 .

Since Am  BT for every m, it follows that Bd(hm+1; exp(-Tm+1))  Bd(hm; exp(-Tm)). Consequently d(hm0, hm1)  exp(-Tm0 ) and for every m0  m1  m2 we have d(hm0m1, hm0m2)  exp(-(Tm1 - Tm0)). Hence the limit limm hm exits. Denote h := limm hm, and for every 0  m0 <  denote
hm0 := gTm0 hh-m10 g-Tm0 .
For every m  0 denote hm+1 = hmm+1. Note that

(8.7)

hm = g-Tm hmgT hm-1gT · · · gT h1gT0.

Remark 8.11 (Relative notation). Some objects are defined from the absolute perspective of time 0, like , m· , hm, and Am. Sometimes it is more convenient to consider these objects from the perspective
of time Tm. Whenever we do so, we denote the relative objects with (tilde). For example, m· = gTmhmm· , hm+1 = gTmhm+1h-m1g-Tm,

75
and Am+1 = gTmAm+1h-m1g-Tm are the relative versions of m· , hm, and Am, respectively. The advantage of the relative perspective (with tilde) is that the formulas do not involve Tm, and are time invariant. The advantage of absolute perspective is the locally constant nature of various definitions, such as m· .
The following is a corollary of Lemma 7.7.
Corollary 8.12. There is 0 > 0 small enough such that the following holds. For every  with 0 <  < 0, l with 0  l  n, two integers 0  m0  m1, and V  Gr(l, n) that satisfies V m := gTmhmV  Gr(l, n)E for all m with m0  m  m1 and V m0  Gr(l, n),gE, we have
log dH(V m1, Gr(l, n)gE) = -(- log  + (Tm1 - Tm0)), i.e., dH(V m1, Gr(l, n)gE) decays exponentially in m1 - m0. In addition, for all l-blades w  l V we have

(8.8) log gTm1 hm1w = log gTm0 hm0w + (m1 - m0)T E + O(1).
Proof. Since V m0  Gr(l, n),gE, by Lemma 7.7 there exists q0  H- such that dH-(q0, Id) = O() and V m0 = q0(V m0). Apply Lemma 7.10 to V m0, q0, and E. We obtain two open sets U1  HV m0E, U2  H (V m0) and two maps

h : U1 - U2, q : U2  H-0,

where h is an diffeomorphism such that for every h  U1 we have

(8.9)

hq0 = q(h)h(h).

Moreover, since dH-(q0, Id) is arbitrarily small, we get that U1, U2 are arbitrarily large. Specifically, for some 0 > 0 small enough which depends only on n, we get that Bd(Id; 1)  U1. We will apply these
functions to hm0m1.

V m1 = g(m1-m0)T hm0m1 V m1 = g(m1-m0)T hm0m1 q0 · (V m1 )

= g(m1-m0)T q hm0m1 h hm0m1 · (V m1 )

= g(m1-m0)T q hm0m1 · (V m1 )

= g(m1-m0)T q hm0m1 g-(m1-m0)T · (V m1 ).
Since · q depends differentiably on q0,

76

OMRI NISAN SOLAN

· if q0 = Id then q  Id, · dH-(q0, Id) = O(),
it follows that for every h  Bd(Id; 1) we have dH-0(q(h), Id) = O() for every h  Bd(Id; 1). In particular, dH-0(q(hm0m1), Id) = O(). Write q hm0m1 = q1-q10 where q1-  H-, q10  H0. We deduce that dH-1(q1-, Id) = O(). Altogether, we get
dGr(l,n)(V m1 , Gr(l, n)gE )
 dGr(l,n)(g(m1-m0)T q hm0m1 g-(m1-m0)T · (V m1 ), Gr(l, n)gE )
= dGr(l,n)(g(m1-m0)T q1-q10g-(m1-m0)T · (V m1 ), Gr(l, n)gE ) = dGr(l,n)(g(m1-m0)T q1-g-(m1-m0)T q10 · (V m1 ), Gr(l, n)gE )  dGr(l,n)(g(m1-m0)T q1-g-(m1-m0)T q10 · (V m1 ), q10 · (V m1 )) = O dH- (g(m1-m0)T q1-g-(m1-m0)T , I d) .
The distance result follows from the uniform contraction rate of conjugation of gt on H-.
To show Eq. (8.8), note that

gTm1 hm1 w = g(m1-m0)T hm0m1 gTm0 hm0 w. By Eq. (8.9) we can factor hm0m1 as

hm0m1 = q(hm0m1 )h(hm0m1 )q0-1.

By definition of q0,

q0-1V m0 = q0-1gTm0 hm0 V  Gr(l, n)gE , and hence q0-1gTm0 hm0w  l(q0-1gTm0 hm0V ) is a gt eigenvalue of with eigenvalue exp(Et). Consequently,

l Rn,

log gTm1 hm1 w = log g(m1-m0)T hm0m1 gTm0 hm0 w = log g(m1-m0)T q(hm0m1)h(hm0m1 )q0-1gTm0 hm0 w = log g(m1-m0)T h(hm0m1)q0-1gTm0 hm0 w + O(1).
The last equality holds since

dH-0(g(m1-m0)T q(hm0m1)g-(m1-m0)T , I d) = O(1).

77

Since h(hm0m1 ) preserves (V m0 ) = q0-1gTm0 hm0 V it stabilizes q0-1gTm0 hm0 w and hence

log gTm1 hm1 w as desired.

= log g(m1-m0)T q0-1gTm0 hm0 w + O(1) = (m1 - m0)T E + log q0-1gTm0 hm0w + O(1) = (m1 - m0)T E + log gTm0 hm0 w + O(1),

8.4. The Different Steps. We here describe the three types of steps
of Alice: adding, changing and standard. For each type we provide the condition that should be satisfied so that step m has this type, the way Am+1 is chosen, and the way m and m· are chosen.

8.4.1. Adding Step. To determine whether step m is an Adding Step

we do the following. Consider a null vertex t0 of f at l of the form

  E. By Lemma 5.30, for every independent shift sequence  with

parameters

2C1, (J )JGf



[0, 2C1]Gf

there

is

a

unique

vertex

of

f






that corresponds to t0, denoted t0 . Let

[at0 , bt0 ] :=


t0

:

 is with

an independent shift sequence parameters 2C1, (J )JGf  [0,

2C1]Gf

.

Since f is C1-separated it follows that bt0 - at0 = (C1). Denote

mat0 := at0 /T  and mbt0 := bt0 /T . By Lemma 5.30, for every such



the

g-template

f




has

exactly

one

vertex

in

[at0 , bt0 ],

namely


t0 .

Denote

by

mt0

the

first

m



[mat0 , mbt0 ]

for

which

L+m f

(Tm

)



{l}

=

L+m f

(Tm

).

As

we

will

see

below,

there

will

be

only

Standard

Steps

at

m  [mat0 , mbt0] \ {mt0 }, and Standard Steps do not change m. Hence mt0 is the unique m  [mat0 , mbt0] for which

L+mat0 f

(Tm )

=

L+mat0 f

(Tmat0 ),

and

L+mat0 f

(Tm+1)

=

L+mat0 f

(Tmat0 )



{l}

=

L+mat0 f

(Tmbt0 +1).

Condition-Adding: Step m is an Adding Step if m  [mat0 , mbt0] and

m = mt0 for some null vertex t0 of f of type   E. Note that there

may exist a unique such null vertex t0 with if m  mat0 then mt0 can be computed.

m



[mat0 , mbt0 ].

Moreover,

The following condition is equivalent to Condition-Adding:

Condition-Adding': Step m is an Adding Step if

L(m· ) = Lf+m (Tm) Lf+m (Tm+1).

78

OMRI NISAN SOLAN

Construction of Am+1: When m is an Adding Step, Am+1 consists
of a single element hm+1. We here explain how hm+1 is calculated. Denote by l- < l < l+ the consecutive elements of l in LTm+1(f +m). We will use Lemma 7.28 to obtain a lattice  with ml-    ml+ and an element hm+1  BT  Hspan m · fE+,m that satisfy

(8.10)

hm+1

span





Gr(l,

n) . O(),g fE+,lm (Tm+1)

To use Lemma 7.28 we have to obtain some bound on the noise lattices in between ml and ml . In Corollary 8.21 below we will find 4 > 0 depending only on Eall such that every noise lattice at an Adding Step  with ml    ml has log covol(ml //ml )  4T .
By the bound on the noise lattices and Lemma 7.28 we have log covol(ml //ml ) 
5T , for some 5 > 0 depending only on Eall. Updating the auxiliary parameters: We add g-Tmh-m1 to the filtration m· , anchor lm+1, and get |lm+1(Tm+1)|  5T

Remark 8.13. We will compare the two sets L(m· ) and Lf+m (Tm) for every step m. By the condition of Adding Step, an index is added to L(m· ) exactly at Adding Steps, at m = mt0 for some null vertex t0 of f of type   E.
Although the behavior of Lf+m (Tm) is more complicated than the behavior of L(m· ), we know that when going from m = mat0 to m = mbt0, a single index is added to Lf+m (Tm).
We will see in the Standard Step that near a null vertex of the form E   we do have L(m· ) = Lf+m (Tm), and hence for every m  t0[mat0 , mbt0] we have L(m· ) = Lf+m (Tm), where the union is taken over null vertices of f of type   E. Note that t0[Tmat0 , Tmbt0 ] is contained in a union of (C1) neighborhoods of the null vertices of
f.

8.4.2. Changing Step. Condition-Changing: Step m is a Changing Step if f has a non null vertex t0 in [Tm, Tm+1).
In that case f +m also has a non null vetex in [Tm, Tm+1). Since f +m is C2-separated, it follows that Lf+m (Tm) = Lf+m (Tm+1), and this condition cannot hold simultaneously with Condition-Adding.
Construction of Am+1: When m is a Changing Step, Am+1 consists
of a single element hm+1. We here explain how hm+1 is calculated. By the C2-separatedness of f we get that m is of distance C2/(2T ) from an Adding Step, and hence, by Remark 8.13, we get that L(·) = LTm (f +m ). Denote E· = fE+,·m (Tm) and E· = fE+,·m (Tm+1).

79

By Lemma 7.16, there is hm+1  BT Gr(l, n)El for every l  LTm+1 (f +m ).

such that hm+1 span ml  The uniformity in Lemma

7.16 shows that for T large enough (depending only on Eall) we have

(8.11) In addition,

gT hm+1 span ml  U Gr(l, n)gEl .

(8.12)

covol(gT hm+1ml ) = (covol(hm+1ml )) · exp(O(T )) = (covol(ml )) · exp(O(T ))

Updating the auxiliary parameters: We anchor lm+1 for every l at which f has a non null vertex in [Tm, Tm+1). By Eq. (8.12) we have lm+1(Tm+1) - lm(Tm+1) = O(T ). In this step we preserve m· .

8.4.3. Standard Step. Condition-Standard: Step m is a Standard Step if it is neither an Adding Step nor a Changing Step.
Construction of Am+1: Denote L = L(m· ) and E· the filtration fE,·(Tm) restricted to L. Let Am+1 be the set of h  HgTm hm span m · E· that is given by Lemma 7.13 and satisfies:
· For every two distinct elements hm+1, hm+1  Am+1 we have d(hm+1, hm+1) > 3 exp(-T ).
· #Am+1 = (exp(T (E·))).
For each noise lattice m with ml  m  ml , let E with El  E  El be a non final multiset of size rank m.
We will mark hm+1  Am+1 as E-forbidden if
hm+1m  U(Gr(rank , n)gE)
and there is
hm+1  Bd (hm+1; 3 exp(-T ))  HgTm hm span m · fE+m (Tm)
such that hm+1m  Gr(rank , n),gE. Let Am+1  Am+1 be the set of non-forbidden elements. By Lemma
7.13 the number of E forbidden elements is

O(exp(T (E·  {E}))).
By Observation 8.3 we have (E·  {E}) < (E·). Consequently, the number of forbidden elements is negligible relative to #Am+1, and #Am+1 = (exp(T (E·))) for every T large enough. Therefore Am+1 = g-TmAm+1gTm hm.

80

OMRI NISAN SOLAN

Updating the auxiliary parameters: In a Standard Step we do not anchor . If there is a vertex of type fE+,l m(Tm)   in [Tm, Tm+1), then we remove ml from the sequence m· . Otherwise we preserve m· .
8.5. Proof that the Assertions Hold. We have to prove four properties: First, we need to show that with all the anchoring we did, we preserved the property that lm(t)  [-C1, C1] for every t  0 and m  0. We also need to prove the three Assertions (S.4), (S.5) and (S.6). Only the proof of Assertion (S.6) does not follow from the above discussion.
To define the behavior of Alice in step m, we need to show that these assertions hold up to step m. For the proof that the assertions hold at step m, it will be convenient to assume that the whole game has been played while Alice followed the strategy Alice. The proof that the assertions hold at step m will not depend on the moves after step m, hence this assumption is innocuous.
8.5.1. Bound on . The bound on lm follows from the discussion. The first time we encounter a nontriviality interval J we anchored lm to a value of size O(5T ), and afterwards changed by at most O(T ) every time there was a non null vertex E  E at l. Since there are at most l(n - l) such vertices in J, the result follows provided C1 is large enough.
8.5.2. Existence of Lattices - Assertion (S.4). By the conditions of the Adding Step and the removing of a lattice from m, we get that if l  L(m· ) then l  Lf+m (Tm) for some m, and hence l  Lf (Tm) as desired.
8.5.3. Bounds on the Flag Elements - Assertion (S.5). Eq. (8.4) holds at Standard Steps by Corollary 8.12, at Adding Steps by Eq. (8.10) and Corollary 8.12, and at Change Steps by Eq. (8.11).
As for Eq. (8.5), for every m in which we anchored lm+1, step m was either a Changing Step which changed l or an Adding Step which added ml +1 to the filtration m· +1. In these step we constructed ml +1 and hm+1 to satisfy this very assertion. For any step m > m in which ml  = ml for every m with m  m  m, the assertion follows from Corollary 8.12.
8.5.4. Bounds on Noise - Assertion (S.6). The rest of the subsection is devoted for the proof of Assertion (S.6). We will bound the noise at step m using the bound on the noise at previous steps. To make sure the noise does not amplify, we will identify regions where the noise decays.

81

We need to prove that the noise is bounded by O(T ). To this end

we will show that for every lattice  with ml    ml with l, l consecutive elements in L(m· ) we have

(8.13)

log covol(ml //ml )  10T.

The constant 10 is larger than the bound on the noise we used at the Adding Step 8.4.1. When E = fE,l(Tm)  E = fE,l(Tm) is a non scalar pair for m = m0, . . . , m1 and if m - m0 is large enough, we will have a better bound of 4T at Eq. (8.13) for m = m1, see Eq. (8.3).

Definition 8.14 (Rectangle). Let [m0, m1] with 0  m0 < m1 be a maximal interval for which l0 < l1 are consecutive elements in L(m· ) for all m with m0  m  m1. Note that we may have m1 = . We call such a configurations of (m0 < m1, l0 < l1) a rectangle. Every rectangle satisfies exactly one of the following conditions:

(R.1) m0 = 0. In this case we say that (m0 < m1, l0 < l1) is initial rectangle.
(R.2) It was preceded by two rectangles (m-1 < m0 - 1, l0 < l1/2) and (m-1 < m0 - 1, l1/2 < l1). In this case we say that these two rectangles merge into (m0 < m1, l0 < l1).
(R.3) It is split from another rectangle, see Case (R.6) below.

In addition every rectangle satisfies exactly one of the following conditions:

(R.4) m1 = . In this case we say that (m0 < m1, l0 < l1) is final rectangle.

(R.5) It is merged with another rectangle, see Case (R.2) above.

(R.6) It is succeeded by two rectangles (m1 + 1 < m2, l0 < l1/2) and (m1 +1 < m2, l1/2 < l1). In this case we say that (m0 < m1, l0 < l1) splits to these two rectangles.

If (m0 < m1, l0 < l1) splits, then there is an Adding Step at m1. If

the rectangle is the merge of two other rectangles then there was a

Standard Step at m0 - 1 and hence f +m0-1 has a null vertex at some

l0 < l < l1 in [Tm0-1, Tm0 ].



Fix a rectangle (m0 < m1, l0 < l1). We will consider the following invariant, which depends on the rectangle.

Definition 8.15 (The potential invariant). For every m  [m0, m1] denote

(8.14)

Pm

:=

-

min
m l1 m l0

(rank )

log

covol(ml1 //ml0 ),

82

OMRI NISAN SOLAN

where



:

[l, l]



R

is

define

by

(x)

=

1 (x-l-1)(l

+1-x)

.



Note

that

1 

is

positive

and

strictly

concave.

Lemma 8.16. The minimum in Eq. (8.14) can be taken over lattices which corresponds to the Harder-Narasimhan filtration FHN(ml1 /ml0 ). Moreover, if  with ml0    ml1 is a primitive lattice not in the filtration, then

(rank ) log covol(ml1 //ml0 )  (1 - 1-1)Pm, for some 1 > 0 which depends only on n.

Before the proof we will quote a quantitative version of the claim of
uniqueness of lattices representing vertices of FHN(). It is equivalent to [9, Corollary 1.31].

Lemma 8.17. Let    be a primitive lattice, and assume it is not in
the Harder-Narasimhan filtration. There exist primitive lattices 0, 2 with 0    2   such that log covol(2//0)  0.

Proof of Lemma 8.16. Let  with ml0    ml1 be a primitive lattice

which is not in the filtration. that for some ,  with

By

Lemma

8.17

applied

to

 = ml1 /ml0 ,

ml0        ml1

we have log covol(//)  0. Denote l1/2 := rank , l1/4 := rank , l3/4 := rank . Then

-(l1/2) log covol(ml1 //ml0 )

 -(l1/2)

l3/4 l3/4

- -

l1/2 l1/4

log

covol(ml1 //ml0 )

+

l1/2 l3/4

- -

l1/4 l1/4

log

covol(ml1 //ml0 )

 (l1/2)

l3/4 l3/4

- -

l1/2 l1/4

Pm (l1/4)

+

l1/2 l3/4

- -

l1/4 l1/4

Pm (l3/4)

= Pm(l1/2)

l3/4 l3/4

- -

l1/2 l1/4

1 (l1/4)

+

l1/2 l3/4

- -

l1/4 l1/4

1 (l3/4)

.

Since 1/ is a strictly concave function, we can choose 1 > 0 to satisfy

1-1-1

>

max
1l1/2 n-1



(l1/2

)

0l1/4

max
<l1/2 <l3/4

n

l3/4 l3/4

- -

l1/2 l1/4



1 (l1/4

)

+

l1/2 l3/4

- -

l1/4 l1/4

1 (l3/4)

<

1,

as desired. Note that 1 depends only on Eall.

83

Observation 8.18 (Pm is Lipschitz). For every m  [m0, m1] and ml0    ml1 we have

log covol(ml1 +1/gT hm+1/ml0 +1) - log covol(ml1 /gT hm/ml0 )  1 T,

for some 1 , which depends only on Eall. This implies that |Pm+1 -

Pm|  1 T .



We next prove the following lemma, which relates Pm for m in certain intervals.

Lemma 8.19. Let [m0, m1] with m0  m0 < m1  m1 be an interval in which fE,l0(Tm) = E, fE,l1(Tm) = E for every m  [m0, m1]. Then

(1) (2)

If If

E E

 

E E

is is

a scalar pair, then Pm1 not a scalar pair, then

=

Pm0

+ O(1).

Pm1  max(3T, Pm0 - (m1 - m0)/3 ),
where 3, 3  1 depend only in Eall, provided that m1 -m0  d0 which depends only on Eall as well.

Proof. We start by proving the first claim. Let l1/2 with l0 < l1/2 < l1

and



with

m0 l0







m0 l1

be a rank l1/2

lattice.

Since

span

m0 l0



Gr(l0, n)E,g

and

span

m0 l1



Gr(l1, n)E,g ,

Lemma

7.7

provides

an

ele-

ment q0 span(ml1 0

for ),

which and in

q0-1

span

m0 l0

addition dH-

= (q0

span(ml0 0 ) , Id) = O().

and

q0-1

Decomposition to eigenvalues shows that q0-1 span m0 

where E with E  E  E is the unique such multiset

span

m0 l1

=

Gr(l1/2, n)gE with l1/2 el-

,

ements, we get that span m0  Gr(l1/2, n)E  Gr(l1/2, n)E. Since

dH-(q0, Id) = O(), it follows that span m0  Gr(l1/2, n)E  Gr(l1/2, n) O(E),g.

Assume that  is chosen to be small enough so that we are able to ap-

ply Corollary 8.12 to span m0. The result follows now from Corollary

8.12.

We turn to prove the second claim. Assume E  E is not a scalar

pair. We will find 2 > 0 such that if Pm0  (m1 - m0)2T , then only

lattices in FHN(ml1 0 /ml0 0)should be taken into account when computing

Pm1 .

That

is,

if

m0 l0

= 0

 1  · · ·  k

=

m0 l1

is the filtration

corresponding to FHN(ml1 0/ml0 0), then to compute Pm1 it is enough to

use

the

lattices

m1 j

for

j

=

0, . . . , k,

where

mj

:=

gTm

hm

h-1 m0

g-Tm0

j

.

84

OMRI NISAN SOLAN

Let

m1

=

gTm1

hm1

h-1 m0

g-Tm0

;

m1 l0

 m1



m1 l1

,

m0 l0







m0 l1

,

witThhPe mla1 t=tic-e (rma1nkispmr1i)mloitgivceovionl(mlml11 11

/m1 /ml0 1 ). as it can b

e

replaced

by

the

primitive closure and decrease its covolume. If  is not one of the

j-s, then by Lemma 8.16

-(rank ) log covol(ml1 //ml0 )  (1 - 1-1)Pm0.

It follows from Observation 8.18 that

Pm1 = -(rank m1 ) log covol(ml1 1 /m1 /ml0 1 )  (1 - 1-1)Pm0 + 1 dT.

On the other hand, again by Observation 1 dT . Consequently we get a contradiction Therefore we may choose 2 = 21 1.

8.18 we as soon

have Pm1 as Pm0 >

 Pm - 21 1dT .

Assume for which

thma1t=Pm0mj 1ist2h(me 0la-ttimce1

)T . that

Let  attains

= j be the the minimum

lattice in the

definition of Pm1. Denote l := rank . By the discussion above, for

every m0  m  m1 the lattice m := gTmh-m1h-m1g-Tm0  corresponds

to elements in the Harder-Narasimhan filtration of FHN(ml1 /ml0 ), and hence is a noise lattices. Denote ¯ m = g-(m1-m)T m1, and note that ¯ m = hmm1 d for hmm1  Bd(Id; 1); that is, ¯ m and m are

somewhat close.

Note that if C2 > (m1 - m0)T , then by Lemma 5.28 only O(1) steps between m0, m1 may be non Standard Steps. Note also that every Stan-

dard Step m, is designed to push d away from Gr(l, n)E, for any non

final note

E with by Em 

E Il

 E  E the unique

. Specifically, for multiset for which

every ¯ m 

m U/2

([Gmr0(,l,mn1)]gEdme)-,

if such a multiset exists and otherwise it is remained undefined. By

Theorem 2.7, m is not defined for at most l(n - l) values of m.

We claim that if m is a Standard Step and Em is defined and not final then Em+1 does not equal to Em. Indeed, since

¯ m = hmm1 m  U/2(Gr(l, n)gEm)

and d(hmm1, hm+1)  exp(-T ), it follows that

m  U(Gr(l, n)gEm).

Hence, since Alice did not forbid hm+1, there is no

h  Bd (hm+1; 3 exp(-T ))  Hspan m · fE,·(Tm)

85

such that h span m  Gr(l, n),gEm. It follows that there is no

(8.15)

h  Bd (I d; 2 exp(-T ))  Hhmm1 span m · fE,·(Tm)

such that h span ¯ m  Gr(l, n),gEm. Since span ¯ m  U/2(Gr(l, n)gEm), the , g part is redundant, and there is no h that satisfies Eq. (8.15) and h span ¯ m  Gr(l, n)Em.
Conjugating Eq. (8.15) by gT we deduce that there is no matrix

h  Bd (I d; 2 )  Hhm+1m1 span m · +1fE,·(Tm+1)

such that h¯ m+1  Gr(l, n)Em. If ¯ m+1  U/2(Gr(l, n)gEm), that is, Em+1 = Em, then there exists s  UO()(Id; dSLn(R)) such that s-1¯ m+1  Gr(l, n)gEm and s-1hm+1m1 span m· +1 = hm+1m1 span m· +1. By Lemma 2.3, provided  is small enough, there are q  H-0 and
h  H such that dH-0(q, Id), dH(h, Id) = O() and s = hq. This
h satisfies the above condition for h and contradicts the assumption that Em+1 = Em.
It follows that for m  m1/2 = m0 + O(1) we have

span m, span ¯ m  U

Gr(l,

n)g Efinal

,

where Efinal is the unique final multiset of size l in E  E. From Observation 8.18,

(rank

m1/2 )

log

covol(lm1 1/2

/m1/2

/m1/2 l0

)



Pm

+

O(1 ).

From Corollary 2.10, for every m  m0 we have

log

covol(ml1 /m/ml1 )

-

covol(lm1 1/2

/m1/2

/m1/2 l1

)

= (m - m1/2)

rank  - l - l

l E

+

l

- rank  l - l E

-

Ef inal

+ O(1)

=: (m - m1/2) + O(1)

By Lemma 8.7,  < 0. Consequently, if Pm0  (m1 - m0)2T then

Pm1 = (l) log covol(ml1 1 /m1 /ml0 1 )



(l)

log

covol(lm1 1/2

/m1/2

/m1/2 l0

)

+

(m1

-

m1/2)

+

O(1)

= Pm0 + (m1/2 - m0)1 + (m1 - m1/2) + O(1).

Hence, if m1 - m0  -1/ then

Pm1

-

Pm0

<

(m1

-

m0)

 2

.

86

OMRI NISAN SOLAN

The result follows with d0 being the implicit lower bound on m1 - m0
We next show that Pm is bounded by 7T . We will do so by induction on all rectangles (m0 < m1, l0 < l1). We sort the rectangles by the value of m0, and perform our induction from smallest to largest. The tricky part is to show that the implicit constant does not increase at every step of the induction. The reason is the decaying behavior of Pm in case 2 of Lemma 8.19, and the fact that this case occurs near every null point.

Lemma 8.20. There is 9 > 0 and bounds 8 > 7 > 3 that depend only on Eall, such that for every rectangle (m0 < m1, l0 < l1) we have

Pm 

8T 7T

if m0  m < m0 + 9, if m0 + 9  m  m1.

Moreover, if the rectangle splits (see Definition R.6) then Pm1 < 3T .

Corollary 8.21. At every Adding Step the noise is bounded by 4.

Formally, if l- < l < l+

Alice attempts to add a lattice are the consecutive elements of

lmlin+1LTamt+s1 t(efp+mm,

and if ), then

for every ml-    ml+ we have

log covol(ml+//ml-)  -4T ).

Proof. The claim follows from the fact that in this case there is a rectangle (m0 < m, l- < l+) that splits, and hence Pm < 3T .

Recall that Corollary 8.21 was used in the definition of the Adding Step. We turn to the proof of Lemma 8.20.

Proof of Lemma 8.20. We will distinguish between three cases, depend-

ing on whether the rectangle is a merge of two rectangles, is split from

another rectangle or is an initial rectangle.

Rectangle is merged: Assume the rectangle is merged from, say,

(m-1 < m0 - 1, l0 < l1/2) and (m-1 < m0 - 1, l1/2 < l1). Induction hypothesis on the two rectangles bounds the corresponding potential

invariants:

Pm 0-1, Pm 0-1  7T .

Since

m0-1 l1/2

was

removed

at

step

m0 - 1, and By Eq. (8.5) we get that covol(ml1 0-1/ml1/02-1/ml0 0-1) =

O(T ). Pm =

It O(T

follows that the bound on + Pm 0-1 + Pm 0-1) = O(7T

Pm 0 ).

-1

,

Pm 0

-1

gives

a

bound

on

Since f +m0-1 has a null vertex at [Tm0-1, Tm0) if follows and f +m0-1

is C2/2-separated it follows that for all m0  m  m0 + C2/(2T ) the

87

multisets fE,l0(Tm)  fE,l1(Tm) are constant. By Lemma 8.8 it follows that these fE,l0(Tm)  fE,l1(Tm) are not a scalar pair.
Partition the numbers m = m0, . . . , m1 to intervals [a0, a1-1], [a1, a2-
1], . . . , [ak-1, ak - 1] via the value of fE,l0(Tm)  fE,l1(Tm). Since there are at most O(n2) vertices in every nontriviality interval it follows that

k = O(n2). Lemma 8.19 implies that Pm decays on [a0, a1 -1], and Observation 8.18 and Lemma 8.19 imply that Pm does not expand more

than O(1d0T ) over the succeeding intervals. Rectangle is split: Suppose that the rectangle was split from an-

other rectangle, without loss of generality, (m-1 < m0 - 1, l0 < l2) was

split to (m0 < m1, l0 < l1) and (m0 < m1, l1 < l2). By the construction

of the Pm is

Adding Step, covol(ml2 0/ml1 0 the potential invariant of the

/ml0 0 ) = rectangle

O(5T ). In addition, if (m-1 < m0 - 1, l0 < l2),

then by induction Pm 0-1  3T . As a result we get the bound Pm0 =

O(5T ). As in the previous case we obtain a bound on Pm, for all

m0  m  m1.

Rectangle is initial: At step 0, the only noise lattices are the

lattices in FHN(). It follows that P0 = O(T ) provided T is large

enough. As in the previous cases we obtain a bound on Pm for all

m0  m  m1.

f

T+omb1 oiusnsdepPamra1 tiend

the we

case that the rectangle splits note that since get that fE,l1(Tm), fE,l2(Tm) are constant for

m1 - C2/(2T )  m  m1, and hence the claim follows from Lemmas

8.19 and 8.8.

8.6. Existence of Lattice Given Template - Proof of Corollary 2.34. In this subsection we will prove Corollary 2.34 which states that every template describe at most one lattice. Let Alice be the strategy constructed above for the T - g game. Let h0, h1, ... be the output of a T - g game where Alice plays via Alice and Bob plays arbitrarily. It is sufficient to prove that the lattice h satisfies f h  f .
Lemma 8.22. Let h0, h1, ... be the output of a T - g game where Alice plays via Alice and Bob plays arbitrarily. Then f h  f .
Before the proof we will prove the following corollary of Lemma 8.17.

Corollary 8.23. Let  be a lattice and · a filtration of  composed of primitive sublattices. Let · be the filtration · when adding between each consequt l  l the inverse image of FHN(l/l). Consider piecewise linear function f : [0, n]  R defined by its values on L(·) by f (l) = log covol l. The following are equivalent:
(1) The function f is convex and strictly convex at L(·) \ {0, n}.

88

OMRI NISAN SOLAN

(2) · is contained in FHN(). (3) · = FHN().

Proof of Lemma 8.22. The verification that (3)  (2) = (1)
follows from the definition of the Harder-Narasimhan filtration and the definition of f . To show (1) = (2) we use induction on n. For
n = 1 there is nothing to prove. Assume (1) holds for , but not (2), i.e., for some l  L(·) with l = 0, n we have l / FHN(). By induction hypothesis applied to l, /l we conclude that · is composed of FHN(l) and the inverse image of FHN(/l) in . Applying Lemma 8.17 contradicts the strict convexity of f at l, as desired.

Proof. By

Observation

4.14

the

restriction

f

| h [0,Tm

]



f hm|[0,Tm]

where the implicit constants are independent of m, T . Hence |fHhm,i(t)-

fHh ,i (t)| = O(1) for every 0  i  n and t  [0, Tm]. By Remark 8.13,

for every m for which Tm is outside (C1) neighborhood of the ver-

tices of f we have L(m· ) = Lf (Tm). Since f is C2-significant, if Tm

is outside a (maybe larger) O(C1) neighborhoodof the vertices of f

we have 2f (Tm)  {0}  [(C1), ). By Assertion (S.5) Eq. (8.5)

and Assertion (S.6) Eq. (8.6) we are able to apply Corollary 8.23 to

the filtration m· of m and deduce that FHN(m) contains ~m· and

that FHN(m)H,l = fH,l(Tm) + O(C1) for every 0  l  n. Since

hmm = gTmh and dH(hm, Id) = O(1) (See Subsection 8.3)

it follows that for every m such that Tm is outside a O(C1) neighbor-

hood of the vertices of f we have FHN(gTmh)H,l = fH,l(Tm) + O(C1). Since for every t  0 there is such m with t - Tm = O(C1) we get that

for every t  0

(8.16)

FHN(gth)H,l = fH,l(t) + O(C1).

This proves Condition 1 of Definition 2.22 of matching template. As

for condition 2, let [a, b] be an interval such that fE,l(t) = E  Il and 2fH,l(t)  C for every t  [a, b], for some C > 0 to be determined later.

By the Eq. (8.16) if C = (C1) then we have FHN(gth)H,l = (C) for every t  [a, b]. It follows from Assertion (S.6) that h-1g-TmFHN(gTmh),l is not a noise lattice at step m, and hence ml = h-1g-TmFHN(gTmh),l. Assertion (S.5) Eq. (8.4) now implies that span(~ml )  U(Gr(l, n)gE). Using argument similar to those used to prove Corollary 8.12 we get

that for every t U(Gr(l, n)gE).

 [a+O(| log |), b-O(| log |)] we have FHN(gTmh),l This shows that h (, C)-matches f .



89

9. Bob's Strategy
Bob's strategy is a function BT ob : (T0, h0, A1, h1, . . . , Am+1)  hm+1, where hm+1  Am+1. As it turns out, the construction of Bob's strategy is simpler than the construction of Alice's strategy. While Alice tries to create a good template, Bob's goal is to interfere with her attempts.
Let  be a lattice. At each step m the set Am+1 satisfies
· Am+1  g-TmBT gTm hm. · d(hm+1, hm+1)  exp(-3 Tm+1) for every hm+1, hm+1  Am+1.
Equivalently, denoting Am+1 := gTmAm+1h-m1g-Tm we have
· Am+1  BT . · d(hm+1, hm+1)  exp(-3T )) for every hm+1, hm+1  Am+1.
Bob needs to choose hm+1  Am+1, or, alternatively, hm+1 = gTmhm+1h-m1g-Tm  Am+1.
In the end Alice and Bob generate h := limm hm  H. Bob's goal is to minimize (f h).

9.1. Point Sorting in a Height Sequences. To construct Bob's strategy, we need to introduce an order on the indices of a height sequence. Define () = (l(n - l))ll=0 for every  > 0. For every height sequence a·, define the vanishing number l(a·) of every index 1  l  n - 1 by
l(a·) = min{ > 0 : l / L(a·())}.
The number l(a·) behaves similarly to 2al. Both vanish in height sequences and one can show that l(a·) = (2al).

9.2. The Strategy. For every m consider the lattice m := gTmhm and its Harder-Narasimhan filtration FHN(m). Let  > 0 be sufficiently small to satisfy Theorem 2.7 and Lemma 6.3. Consider the
subset of indices

Lm0 := {l  L(FHN(m))\{0, n} : E(m, l)  Il, span ml  U(Gr(l, n)gE(m,l)}.

By Lemma 6.3, the sequence (E(m, l))lLm 0 without the extremal multisets , Eall. Sort

forms a the set

direction filtration Lm0 by the value of

l(FHN(m)H,·) for l  Lm0 , that is, Lm0 = {l1m, l2m, . . . , lkmm}, where

l1m(FHN(m)H,·)  l2m(FHN(m)H,·)  · · ·  lkmm (FHN(m)H,·).
Let im denote the first index of l·m with the following property: there is hm+1  Am+1 such that for every h  Bd(hm+1; 3 exp(-T )) one

90

OMRI NISAN SOLAN

has  1  i  im, hik / H . span m lm i E(m,lim)
If such im exits, the strategy selects this hm+1. In this case we call the step an Interruption Step, and say that Bob interrupted im indices. If no such im exists, let hm+1  Am+1 be arbitrary, and call step m an Idle Step.

10. Computation of the Dimension - Proof of Theorem 2.30

10.1. Computation of the Payoff. We fix a family F of g-templates that is invariant to equivalence of g-templates. For every lattice , we wish to prove that

dimH(Y,F ; d) = sup 0(f ).
f F

We will use the Dimension Game introduced in Subsection 4.4.

To prove the lower bound, it is enough to fix f0  F with 0(f0)  supfF 0(f ) - , and to prove that Alice has a strategy ATlice that guarantees that the payoff is at least DATlice, where limT  DATlice  0(f ). Any h attained with Alice's strategy will have f h  f0.
To prove the upper bound, we have to prove that Bob has a strategy BT ob that guarantees that the payoff is at most DBT ob where

lim
T 

DBT ob



sup
f F

0(f ).

10.2. The Payoff Guaranteed by Alice's Strategy. Fix  > 0 as
in Section 8 and let f  F with 0(f )  supfF 0(f ) - . To apply Alice's strategy we have to choose C2  C1  T and approximate
f by a C2-separated and C2-significant g-template. By Lemma 5.9 there is an equivalent g-template f   f that is C2-separated and C2significant. The construction of f  was by constructing a proper shift sequence  and getting f  = f . The following claim will allow us to replace f by f .

Claim 10.1. For every g-template f and a shift sequence  we have 0(f )  0(f ).
Proof. To prove the result it is enough to show that (fE,·(t))  (fE,·(t)) (See Definition 2.29 of shifting a height sequence). This inequality holds since  is monotone nonincreasing with respect to adding multisets and the fact that each multiset in fE,·(t) appears also in fE,·(t).

91

We can thus assume without loss of generality that f is C2-significant and use Alice's strategy as defined in Section 8. Let A0, h0, A1, h1, . . . be the choices made by Alice and Bob along the game. Note that Bob may

play arbitrarily, not necessarily according to the strategy BT ob described

in Section 9. By Lemma 8.22 the resulting matrix h = limm

satisfies f h  f . It is left to compute the first option of Eq. (4.10),

namely

1 T

lim infm

1 m

m k=1

log

#Ak

.

The number of elements in Am+1 is larger than 1 only if m is a Stan-

dard Step. and hence

In every Standard Step we have #Am+1 = (exp(T log #Am+1 = T (fE+m(Tm)) + O(1). Thus

 (fE+m (Tm ))),

1m

1

lim inf
m

Tm

log #Am

=

lim inf
m

m

m

(fE+m (Tm ))+O(T -1).

m =0

m =0

m is a Standard Step

We will restrict the set of m we sum over even further to obtain

f +m E

(Tm )

=

fE(Tm ).

For every t > 0 for which 2fH,l(t) / (0, 4C1] for every 1  l  n - 1

we

have

f +m E

(t)

=

f +m E

(t).

Since f is C2-significant, we have

2fH,l(t)  (0, 4C1] only if t is in an O(C1) neighborhood of a null

vertex of f .

In addition, if Tm is not in an O(C1) neighborhood of any vertex, m

is a Standard Step.

Hence

(10.1)

m

(fE+m (Tm ))



1 T

m =0

m is a Standard Step

 (fE (t))dt
Jm



1 T

Tm
(fE(t))dt - O(C1 · #{vertices of f until Tm + O(C1)})
0



1 T

Tm
(fE(t))dt - O(C1 · (2n3 + O(Tm/C2))) = O(C1 · (1 + Tm/C2)),
0

where Jm is the set of point 0  t  Tm such that t is not in an O(C1) neighborhood of a vertex of J. Note that Inequality (10.1) follows from
Lemma 5.28. Consequently,

lim inf
m

1 Tm

m

log #Am  0(f ) - O(T C1/C2).

m =0

If we choose a sequence of C2(T )  C1(T )  T   such that T C1(T )/C2(T ) -T--  0, we obtain the upper bound.

92

OMRI NISAN SOLAN

10.3. The Payoff Guaranteed by Bob's Strategy. In this subsec-
tion we prove the lower bound. To this end we fix  > 0 and consider Bob's strategy BT ob, both described in Section 9. We then show that when Bob follows this strategy, no matter how Alice plays (not neces-
sarily according to the strategy described in Section 8), the payoff is at most DBT ob where limT  DBT ob = supfF 0(f ).
As before, denote by (T0, h0, A1, h1, · · · ) the choices of Alice and Bob along the game. Denote ¯ m := gTmh, where h := lim hm, and consider f := f h. We will bound (f ) using #Am+1. Let C be the constant given by Theorem 2.27 for . Assume that h (, C)matches f . Fix 1 > C and 2 > 4C to be determined later. Let C1 > 0 to be defined later as well.

Lemma 10.2. Let   T and let m  0 be a step for which fE(,·)(t) = fE(,·+2)(t) is constant for every t  [Tm - C - C1, Tm+1 + C + C1]. Then #Am+1 = O(exp(T (fE(,·)(Tm)))).

Proof. Denote the distinct elements of L(fE(,·)(Tm)) by {0, l1, . . . , lr, n} and fix t  [Tm - C - C1, Tm+1 + C + C1]. The elements (li(fH,·(t)))ri=1

are the r largest elements in {l(fH,·(t)) : l = 1, . . . , n - 1}, and are

larger than their successors by at least 2. Since h (, C)-matches f , it follows that (li(FHN(gTmh)H,·(t)))ri=1 are the r largest elements in

{lFHN(gth)H,· : l = 1, . . . , n - 1}and are larger than their successors

by 1.

at least 2-4C. Hence 2-4C is

Recall from Subsection 8.3 large enough it follows that

t(hlai t(FdHHN((ggTTmmhhmmh-)1Hg-,·T)m )ri)=1

are the largest among all {l(FHN(gTmhm)) : 1  l  n - 1}.

Denote by li   the lattices that satisfy gthli = FHN(gth),li for

t = Tm, Tm+1. Then gthm+1li = FHN(gthm),li.

Fix 1 > 0, and choose C1 such that if for some 1  l  n - 1 and

V gtV

Gr(l, n) we  U1(Gr(l,

have n)gE ).

gtV  Such

U a

(Gr(l, n)gE) for every t  [-C1, C1 constant exists by Theorem 2.7.

] then Since

h (, C)-matches f , it follows that

1  i  r, span gthli  U Gr(li, n)gfE,li Consequently

for Tm-C1  t  Tm+1+C1.

span gthli  U1

Gr(li

,

n)g fE,li

for t = Tm, Tm+1.

Let M  SLn(R) be a matrix with dSLn(R)(M, I) = O(1) such that

1  i  r,

M span gTm+1 hli



Gr(li,

n) . g fE,li (Tm+1)

93

Using Lemma 2.3 we get h  BdH (Id; O(1))  BdH (Id; 1) such that

1  i  r,

h span gTm+1 hli



Gr(li,

n)O(1),g fE,li

.

Then,

h

:=

g-T hgT



Bd(Id; exp(-T )) satisfies

hgTm h



Gr(li

,

n)g fE,li

.

Since d(h, hm+1)  exp(-Tm+1), we have gTmhh-m1+1g-Tm  Bd(Id; exp(-T )).

Observe that

d(h · gTm hh-m1+1g-Tm, Id)  2 .

Since span gTmhli  U1 Gr(li, n)gfE,li we have

span gTmhm+1li

=

(gTm hh-m1+1g-Tm )-1gTm hli



U

(Gr(li

,

n)g fE,li

),

provided that 1 is small enough as a function of , and T is large enough.
As a result, the m-th step is either an Idle Step or an Interruption Step, in which Bob interrupted more than r indices. Otherwise, Bob's choice for hm+1 contradicts the existence of h. By Lemma 7.13 it follows that #Am+1 = O(exp(T (fE(,·)(t)))).

Corollary 10.3. For some 1  T the following is true. Let 3 > 0 and let m  0 be a step for which f (3) has no non null vertices t  [Tm-C-C1, Tm+1+C+C1]. Then #Am+1 = O(exp(T (fE(,·1+3)(Tm))).

Proof. For every  > 0 consider the map

 : [0, 2] × [Tm - C - C1, Tm+1 + C + C1]  {height sequences},

which assigns
(0, t)  fE(,·+0)(t).
Note that if f has no non null vertex in [Tm - C - C1, Tm+1 + C + C1] then the total length of { > 0 :  is non-constant} is O(T ). We get that  is constant for some 3    1 + 3 provided that 3 is large enough. Hence the conditions of Lemma 10.2 are true for f (1) and . The result follows since (fE(,·)(Tm)) is nondecreasing as we increase  to 1 + 3.

By Lemma 7.13 for the empty direction filtration 0  Eall satisfies #Am+1 = O(exp(DT )).
By Corollary 10.3, for every 3 > 0 we have

m

Tm+1

#Am 

log (fE(,·1+3)(t))dt + O(m)

m=1

0

+ D(2C + T + 1)#{non null vertices of f (3) until Tm+1}.

94

OMRI NISAN SOLAN

Since t  l(fH,·(t)) is a Lipschitz function, maxtJ l(fH,·(t)) = O(vol(J)) for every nontriviality interval J of f at l. Consequently,
only connected components J of Ul(f ) with vol(J) = (3) satisfy that the function l(fH(,·3)(t))|J does not vanish. There are at most O(T m/3 + 1) connected components of Ul(f ) that are larger than 3 and intersect [0, Tm+1]. Each of them contains at most n2 non null vertices. It follows that the number of non null vertices of f (3) until
Tm+1 is O(T m/3 + 1). Consequently,

m
#Am 

Tm+1 log (fE(,·1+3)(t))dt + O(m + T 2m/3),

m =1

0

and hence for every 3 > 0 the payoff is

DBT ob

:=

lim inf
m

1 Tm

m

#Am

m =1

Tm+1

 lim inf m 0

log (fE(,·1+3)(t))dt + O(T -1 + T /3)

= 0(f (1+3)) + O(T -1 + T /3).

Therefore DBT ob  (f ) + O(T -1), as desired.

11. The dimension of the set of Divergent Trajectories

In this section we will prove Corollary 2.31. In view of Theorem
2.30 we will be interested in computing supfF (f ) for the set F of g-templates that corresponds to divergent trajectories. Recall that

D := dimH(H; d) = (  Eall) =

( - )+.

, Eall

Denote

=

+.

Eall
The following two lemmas together with Theorem 2.30 imply Corollary 2.31. The first implies the upper bound and the second implies the lower bound. Let Fsing := {g-template f : fH,1  }. It follows that Sing(H, ; gt) = Y . ,Fsing

Lemma 11.1. We have 0(f )  D -  for every f  Fsing.

Lemma 11.2. There is a g-template f  Fsing with (f ) = D - , provided that n  3.

95
11.1. Single Dimension Analysis. We will be interested in studying the behavior of the g-template f only on a single l. Fix n+, n-  1 such that there are at most n+ positive i-s, at most n- negative i-s, and n+ + n- = n. (We use this ambiguous notation to preserve symmetry). Fix 1  l  n - 1. Denote

l :=

n+ l n-
n-l

if l  n+, if l > n+.

For every E  Il denote (E) := (  E  Eall).

Lemma 11.3. For every E  Il we have

(E) - lE  D - 

Lemma 11.3 is analogous to [7, Lemma 8.1] and contains the combinatorial essence of [12, Proposition 3.1].

Remark 11.4. The inequality is important because we need to integrate

numbers of the form (fE,l(t)) in order to compute 0(f ) for a gtemplate f . Lemma 11.3 will enable us to transform the problem into

bounding

an

integral

of

d dt

fH,l(t),

which

is

more

accessible.

Remark 11.5. In general equality occurs in Lemma 11.3 only if l = 1, n - 1. In the case l = 1, if Eall  {0} =  then equality occurs at E = {}, whenever  being the maximal negative or the minimal positive element in Eall. If Eall  {0} = , then equality occurs for E = {0}, and perhaps at the maximal negative or the minimal positive
elements in Eall, depending on the choice of n+, n-.

Proof. We will reduce the proof to a polynomial inequality on integers, which will be proved in the appendix.
Note that

D - (E) =

( - )+.

Eall -E  E

Consequently, we need to show that

(11.1)

( - )+ + lE  .
Eall-E  E

96

OMRI NISAN SOLAN

Let E  {1, . . . , n} be a set for which E = {j : j  E}. Inequality (11.1) turns to

(11.2)

n

V (1, . . . , n) :=

(j - j)+ + l j -

j  0.

j{1,...,n}\E j  E

j E 

j=n-+1

In this form the inequality is symmetric with respect to

j  -n-j+1, E  {1  j  n : n - j + 1 / E}, n+  n-,
and hence we may assume l  n+. Inequality (11.2) is a linear homogeneous inequality in (i)ni=1 given
the linear inequalities

(11.3) (11.4)

1  · · ·  n-  0  n-+1  · · ·  n,
n
i = 0.
i=1

The set of i satisfying (11.3) and (11.4) is a cone defined by the rays

Pa,b,c := (-c, . . . , -c, 0, . . . , 0, a, . . . , a); 1  a  n-, 1  c  n+, a+b+c = n.

a times

b times c times

It is left to prove that V (Pa,b,c)  0 for every such a, b, c. Denote

a0 = #E{1, . . . , a}, b0 = #E{a+1, . . . , a+b}, c0 = #E{a+b+1, . . . , n}.

Since

l

=

n+ l

=

n+ a0 +b0 +c0

it

is

left

to

show

that

(11.5)

V (Pa,b,c) =(c - c0)a0(a + c) + (b - b0)a0c + (c - c0)b0a

+

a0

n+ + b0

+

c0

(-a0c

+

c0a)

-

ac



0.

This inequality is proved in the Appendix 12.1.

11.2. Upper Bound on Divergent Trajectories - Lemma 11.1.

Let f be a g-template on I. For every t 

n-1 l=1

Ul(f )

denote

by

f (t) := min lfH,l(t). l=1,...,n-1

This is a nonpositive continuous piecewise linear function, as it is

the minimum of such functions. Note that f (t) < 0 for every t 

n-1 l=1

Ul

(f

).

Since

l

is

convex

in

l

the

minimum

must

be

attained at

a point lf (t)  Lf (t) \ {0, n}.

Consequently, for every differentiable point t 

n-1 l=1

Ul

(f

)

of

f

we

have

97

d

d

dt f (t) = dt lf (t)fH,lf (t)(t) =   . lf (t) fE,lf (t)(t)

The following lemma follows, and implies Lemma 11.1.

Lemma 11.6. For every interval (t0, t1) 

n-1 l=1

Ul

(f

),

t1
(fE,(t))dt  (t0 - t1)(D - ) + f (t)|tt1=t0.
t0

Proof. By Lemma 11.3,

(11.6)

(fE,(t))



(fE,lf (t)(t))



D

-



+

  lf (t) fE,lf (t)

=

D

-



+

d dt

f

(t).

Integrating Eq. (11.6) from t0 to t1 yields the result.

11.3. Construction of a Special g-Template - Proof of Lemma 11.2. For the rest of the section assume n  3.

Definition 11.7. We say that Eall is standard if its elements are proportional to -(n - 1), 1, . . . , 1. This is the flow corresponding to stan-

dard vector approximation.



The standard case was dealt with in [7, Section 9]. The arguments that we present below can be adapted to handle the standard case as well. For the rest of the section assume Eall is not standard.

Lemma 11.8 (The connecting template). Let - be the maximal negative weight, and + be the minimal positive weight. There exists a g-template f  and C > 0 such that

· fH ,1(t) =

+t - 1 -t - 1

if t  0, if t  0.

· For every t  R \ [-C, C],  {+}
fE ,l(t) = {-}

if l = 1, t < -C, if l = 1, t > C, otherwise.

Proof. Define

 {+} fE ,1(t) := {-}

if l = 1, t < -C, if l = 1, t > C, otherwise.

98

OMRI NISAN SOLAN

By definition t = 0 is a null point of f  at l = 1, hence must have

fE ,l(0) =  for some 1 < l < n. We will use l = 2. Define f~+ (t) :=

(-

+ n)t - 2

and

let

t+

:=

n (n-1)n +-

>

0.

Then

t+

is

solution

of

f~+ ,2(t+)

=

n n

- -

2 1

fE ,1(t+

)

=

n n

- -

2 1

(-t+

-

1).

Since Eall is not standard, (n - 1)n + - > 0, since instead of consid-

ering the sum of all i, we take n - 1 times the largest weight together

with another weight. Similarly, set f~- (t) := (+ + 1)t - 2 and let

t-

:=

n (n-1)1 ++

<

0.

Then

t-

is

the

solution

of

f~+ ,2(t-)

=

n n

- -

2 1

fE ,1(t-

)

=

n n

- -

2 1

(+t-

-

1).

Define





fE ,2

:=

{{+-,,

1} n}

if t < t- or t+ < t, if t- < t < 0, if 0 < t < t+,

with the nontrivial connecting morphism {+, 1}  {-, n} at 0.

Define

 f~- ,2

if t-  t  0,

fH ,2(t) = fnn~+-- ,212fH ,1(t)

if 0  t  t+, if t  (-, t-]  [t+, ).

Extrapolate (fH ,l)l=1,2 to fH ,· by convexity and the fact that no other fE ,l is nontrivial.

We will use Lemma 11.8 to glue simple g-templates and thereby generate more complex ones.

Proof of Lemma 11.2. We will distinguish between two cases:
(1) If 0 / Eall. (2) If 0  Eall.
Case (1): Let - be the largest negative weight and + be the smallest positive weight. Let

E-,1 := {-}, E+,1 := {+}, E±,2 := {+, -}.

For every t0 < t1 denote by f t0,t1 the g-template on R defined as follows: 

E-,1 if t0 < t < t1/2, l = 1,

f t0,t1 E,l

(t)

:=

E +,1

if t1/2 < t < t1, l = 1, otherwise,

99
Figure 8. The connecting g-template with Eall = {-1.2, 0.3, 0.9}. t

 {-1.2}

{0.3}

{-1.2}



{-1.2, 0.9} 

{-1.2, 0.3}

with

the non

null

connecting

morphism

E-,1



E+,1

and

t1/2

=

+ t1 -- t0 + --

be

the

only

value

for

which

the

differential

equation

will

define

a

f t0,t1 H,1

(t)

to vanish at t = t1.



-(t - t0)

f t0,t1 H,1

(t)

:=

0+(t

-

t1)

if t0  t  t1/2, if t1/2  t  t1, otherwise,

and

extrapolate

it

by

convexity

to

get

f t0,t1 H·

(t)

for

every

t



R.

Figure 9. The g-template f t0,t1 with Eall = {-1.2, 0.3, 0.9}.

t0 t1/2

t1

t

 {-1.2} {0.3}





100

OMRI NISAN SOLAN

The definition was selected because it satisfies the following equality:

t1



f t0,t1 E,

dt = (t1/2 - t0)({-}) + (t1 - t1/2)({+})

t0

= (t1 - t0)D - (t1/2 - t0) ( - +)+ - (t1 - t1/2) ( - +)+

=-

=+

= (t1 - t0)D - (t1/2 - t0)( - n+-) - (t1 - t1/2)( - n++)

= (t1 - t0)(D - ).

For every pair of intervals t0 < t1, t0 < t1 that satisfy t1/2 < t0 < t1 < t1/2, we would like to define the merge f  = f t0,t1  f t0,t1 of f t0,t1 and f . t0,t1 Unfortunately, the connecting template protrudes beyonds
[t0, t1], and hence we will need additional constrains on t0, t1, t0, t1 to define the merge.

Figure 10. The merge of f t0,t1 and f , t0,t1 where t0 = -5, t1 = 0.5, t0 = -0.5, t1 = 12, and Eall = {-1.2, 0.3, 0.9}.

t0 t1/2

t- 1 t0 t0 t1 t1 t1/2

t

 {-1.2}

{0.3}

{-1.2}



{-1.2, 0.9}

{-1.2, 0.3}

{0.3} 

101

Our

goal

is

that

the

merge

will

satisfy

fH ,1(t)

=

max(fHt0,,1t1 (t),

f t0,t1 H,1

(t)).

Let

t0

:=

+ t1 -- t0 + --

denote

the

unique

point

t0

 [t1/2, t1/2]

for which

f t0,t1 H,1

(t0

)

=

f t0,t1 H,1

(t0

)

=

t1 +-1

- -

t0 --1

.

Denote

 :=

, 1
+-1 ---1

and C := C,

were C is the constant from Lemma 11.8. We define the merge f t0,t1  f t0,t1 only if the following inequality holds:

t- 1 := t0 - (t1 - t0)C > t1/2 and t1 := t1 + (t1 - t0)C < t1/2.

Define t  R, f~ by

f~E ,l(t) := fE ,l

t - t0 (t1 - t0)

, f~H ,l(t) := (t1 - t0)fH ,l

t - t0 (t1 - t0)

.

In other words, we translate f  and apply homothety so that the in-

creasing and decreasing branches of f~H ,1 will coincide with the corre-

sponding

branches

of

f , f t0,t1 t0,t1 H,1 H,1

at t- 1, t1, respectively.

We can then

glue the three g-templates f | , t0,t1 (-,t- 1] f~|[t- 1,t1], f | . t0,t1 [t1,) Using this method we can merge arbitrarily many g-templates f t0,t1.

Let t0(m) < t1(m), m  0, be an infinite sequence of pairs with dm := t1(m) - t0(m+1) > 0 and

t1(m/2)  t0(m+1) - Cdm < t1(m) + Cdm < tm1/+2 1.

We can merge the g-templates (f ) t(0m),t(1m) m0 into a single g-template

f=

f . 
m=0

t0(m) ,t1(m)

Note

that

Assume that

f | = f . [t1(m)+Cdm,t0(m+2)-Cdm+1]

t(0m+1) ,t(1m+1)

(11.7) (11.8)
(11.9)

dm -m--  ,

dm t1(m) - t0(m)

-m-- 

0,

t1(m) - t0(m)

m m =0

t(1m)

-

t0(m )

-m-- 

0.

102

OMRI NISAN SOLAN

For instance, the sequence t0(m) = m3 - m, t1(m) = (m + 1)3 + m works for m large enough as a function of C. We now wish to compute

0(f

)

=

lim
T 

1 T

T
(fE,(t))dt.
0

By Eq. (11.9), it is enough to compute the limit for T = t1(m). By Eq. (11.8), the regions in which f is not one of the (f ) t(0m),t(1m) m0 are negligible. We have

0(f

)

=

lim
m

1 t1(m)

t(1m)
(fE,(t))dt
0

1m

=

lim
m

t1(m)

m =0

(f (t))dt t(1m)
t(0m )

t(0m ) ,t(1m ) E,

=

lim
m

1 t1(m)

m
(t1(m )
m =0

-

t(0m))(D

-

)

=

lim
m

1 t1(m)

m
(t1(m )
m =1

-

t(1m-1))(D

-

)

=D-

Similarly, the local minima of fE,1(t) are (dm)m0 that tend to infinity, and hence fE,1(t) -t--  -, as desired.
Case (2): The construction is similar. We define f t0,t1, to be

f t0,t1 H,1

,(t)

:=

f t0,t1 E,l

,(t)

:=

max ((t - t0)-, t - t1+, -(t1 - t0)) if t  [t0, t1],

0

if t / [t0, t1],

d dt

f t0,t1 H,1

,

(t)



if t  (t0, t1) and l = 1, otherwise,

and

extrapolate

f t0,t1, H,l

to

f t0,t1, H,·

by

convexity.

Let t1/3 < t2/3 denote

the two non null vertices of f t0,t1, at 1. Then

t2/3



f t0,t1 E,

,

(t)

dt = (t2/3 - t1/3)(D - ).

t1/3

Hence the merge of a sequence of such functions with   0 constructs the desired function as in Case (1).

103

Figure 11.

The

g-template

f t0,t1, H,l

with

Eall

=

{-1.2, 0, 0.3, 0.9}.

t0 t1/3

t2/3

fH,· :

t1 t



fE,1{-1.2} {0}

{0.5}



fE,2



fE,3



12. Appendix

12.1. Dimension Inequality. In this subsection we will prove the following inequality that was used in the proof of Lemma 11.3.

Lemma 12.1. Let a  a0  0, b  b0  0, c  c0  0 be integers with a0 + b0 + c0  1 and let n+  [c, c + b]. Then

V (a, b, c, a0, b0, c0, n+) :=(c - c0)a0(a + c) + (b - b0)a0c + (c - c0)b0a

+

a0

n+ + b0 +

c0 (-a0c

+

c0a)

-

ac



0

provided that a0 + b0 + c0  n+.

Proof. Since V is linear in n+ we may assume n+ is one of its boundary values:

(1) n+ = c + b, (2) n+ = c, or (3) n+ = a0 + b0 + c0.

First we will show that we may decrease b until b = b0 or b = b0 and b + c = n- = a0 + b0 + c0. We will show that

dV := V (a, b, c, a0, b0, c0, n+) - V (a, b - 1, c, a0, b0, c0, n+)  0,

where n+ = n+ in cases 2, 3 or n+ = n+ - 1 in case 1. In cases 2, 3 we

see

that

dV

= a0c  0.

In

case

1

we

have

dV

=

-a0 c+c0 a a0 +b0 +c0

+ a0c  0

as

a0 + b0 + c0  1.

The above three cases become four:

(1) n+ = c + b, b = b0. (2) n+ = c, b = b0. (3) n+ = a0 + b0 + c0, b = b0.

104

OMRI NISAN SOLAN

(4) n+ = a0 + b0 + c0 = c + b.
Denote a1 = a - a0, b1 = b - b0, c1 = c - c0. Case (1): Note that since c + b = n+  a0 + b0 + c0 = a0 + b + c0
we get that c1  a0. Since a20 - a0, b20 - b0  0. By simple algebraic manipulations,

V (a, b,c, a0, b0, c0, n+) · (a0 + b0 + c0)
=(a20 - a0)(a0c1 + a1c1 + 2c0c1 + a1c0 + c20 + c21 + a0c0 + b0c0 + 2b0c1) + (c1 - a0)(a0a1c0 + a0c20 + a0c0c1 + a20c0 + a0b0c0) + (b20 - b0)a1c1 + 2a0a1b0c1 + a0b20c1 + a1b0c0c1 + a0b0c21 + a0b0c0c1
0.

Case (2): Note that if b0 = 0 then we were in the previous case, hence assume b0  1. Since c = n+  a0+b0+c0 we get that c1  a0+b0. In particular, c1  b0  1. By simple algebraic manipulations,
V (a, b,c, a0, b0, c0, n+) · (a0 + b0 + c0) =(a20 - a0)(a0c1 + b0c1 + c21) + (b0 - 1)(a0a1c1 + a1b0c1 + 2a0c0c1) + (c1 - 1)(a20c0 + a0a1c0 + a1b0c0 + a0c20 + a0c0c1) + (c1 - b0)a0c0 + a20a1c1 + a20b0c1 + a0a1b0c1 + a0b20c1 + a20c0c1 + a0b0c21 0.

Case (3): Note that a0 + b0 + c0 = n  [c, c + b0]. If n was one of the edges we would be in the previous cases. Hence c < a0 +b0 +c0 < c+b0. Equivalently a0 < c1 < a0 + b0. In particular b0  2, c1  1.
By simple algebraic manipulations,

V (a, b,c, a0, b0, c0, n+) =(b0 - 2)(a0c1 + a1c1) + (c1 - 1)a0c0 + a1c1 + a20c1 + a0a1c1 + a0c21 0.

Case (4): Since we get that a0 = c1 + b1. If we had b1 = 0 then we were in Case (1). Consequently a0  b1  1. By simple algebraic

105
manipulations,
V (a, b,c, a0, b0, c0, n+)
=(b1 - 1)(a0c0 + a0c1)
+ (a0 - 1)(a0c1 + a1c1) + a0b0c1 + a1b0c1 + a0c0c1 + a0c21 0
References
[1] J. An, L. Guan, A. Marnat, and R. Shi Divergent trajectories on products of homogeneous spaces, arXiv e-prints (2020).
[2] A. Borel and J. P. Serre, Corners and arithmetic groups, Commentarii Mathematici Helvetici 48.1 (1973): 436-491.
[3] J. W. S. Cassels, An Introduction to the Geometry of Numbers, Springer Science & Business Media (2012).
[4] Y. Cheung, Hausdorff dimension of the set of singular pairs, Ann. of Math. (2) 173 (2011), no. 1, 127­167.
[5] Yitwah Cheung and Nicolas Chevallier, Hausdorff dimension of singular vectors, Duke Math. J. 165 (2016), no. 12, 2273­2329. MR 3544282
[6] S. G. Dani, Divergent trajectories of flows on homogeneous spaces and Diophantine approximation, Journal fu¨r die reine und angewandte Mathematik 1985.359 (1985): 55-89.
[7] T. Das, L. Fishman, D. Simmons and M. Urban´ski, A variational principle in the parametric geometry of numbers, with applications to metric Diophantine approximation, Comptes Rendus Mathematique, Volume 355, Issue 8, (2017), pages 835-846.
[8] M. Einsiedler and S. Kadyrov, Entropy and escape of mass for SL3(R)/ SL3(Z), Israel J. Math. 190 (2012), 253-288.
[9] D. R. Grayson, Reduction theory using semistability, Comment. Math. Helv. 59 (1984), 600-634.
[10] L. Guan and R. Shi. Hausdorff dimension of divergent trajectories on homogeneous spaces, Compositio Mathematica 156.2 (2020): 340-359.
[11] G. Harder, M. S. Narasimhan, On the cohomology groups of moduli spaces of vector bundles on curves, Math. Ann. 212 (1974), 215-248.
[12] S. Kadyrov, D. Kleinbock, E. Lindenstrauss, A. G. Margulis, Singular systems of linear forms and non-escape of mass in the space of lattices, Journal d'Analyse Math´ematique 133.1 (2017): 253-277.
[13] D. Y. Kleinbock, An extension of quantitative nondivergence and applications to Diophantine exponents, Transactions of the American Mathematical Society 360.12 (2008): pages 6497-6523.
[14] D. Y. Kleinbock, Badly Approximable Systems of Affine Forms, Journal of Number Theory 79.1 (1999): 83-102.
[15] D. Y. Kleinbock and G. A. Margulis. Flows on homogeneous spaces and Diophantine approximation on manifolds, Annals of mathematics (1998): 339-360.

106

OMRI NISAN SOLAN

[16] P. Mattila, Geometry of Sets and Measures in euclidean Spaces: Fractals and Rectifiability, No. 44. Cambridge university press (1999).
[17] L. Liao, R. Shi, O. N. Solan, and N. Tamam, Hausdorff dimension of weighted singular vectors in R2, Journal of the European Mathematical Society 22.3 (2019): 833-875.
[18] D. Roy, On Schmidt and Summerer parametric geometry of numbers, Annals of Mathematics (2015): 739-786.
[19] W. M. Schmidt, On badly approximable numbers and certain games, Trans. Amer. Math. Soc. 123 (1966): 27­50.
[20] W. M. Schmidt, On parametric geometry of numbers, Acta Arith. 195 (2020), no. 4, 383­414.
[21] W. M. Schmidt and L. Summerer, Diophantine approximation and parametric geometry of numbers Monatshefte fu¨r Mathematik 169.1 (2013): 51-104.
[22] G. Tomanov and B. Weiss, Closed orbits for actions of maximal tori on homogeneous spaces, Duke Math. J. 199 no. 2 (2003) 367-392.

, 9 #, 7
,7 E· E· , 57 · ,7 , 16
a·, 6 Aligned noise lattice, 73 , 20 Am, 24 Am+1, 73 Anchor, 74
Basic intervals, 40 Bd(x; r), 16 Blades, 7 Bln, 7 Bl , 7 boundedly expanding action, 18 BT , 73
Category flow, 9 Complementary interval, 41 Constructible graph, 32 covol , 5 covol(2/1/0), 66
D, 15 (E·), 14 0(f ), 14 (f ), 14 dGr(l,n), 6 dH , 4 dimH, 19 Direction filtration, 6 Direction filtration with heights, 6 Doubling metric, 25 d, 20 dSLn , 3 dXn , 3
ea,b, 49 Eall, 3 E·, 6 ei, 49 Elementary flip, 59 Enticement, 32

Index
Compatible with a graph, 32 Finitary collection, 32 Satisfaction, 32 Solution, 32 Support, 32 Equivalent trajectories, 3 E , 8 i, 3 expansion semimetric, 18

f , 10 fE,·, 10 fH,·, 10
F , 21 FHN, 5 Final multiset, 70 Final noise lattice, 73 Flag, 6 Flag with heights, 6 f , 12 F , 21

Game - (T, g), 24

m · , 72

m · , 72 , 72

Gf , 11

Gr(l, n), 6

Gr(l, n)gE, 6

Gr(l, Gr(l,

nn)) ,gEE

, ,

51 57

gt, 3

g-template, 10

Separated, 27

Significant, 27

H, 4
HV , 48 HV E , 51 H-, 4 H0, 4 H-0, 4 h, 55
Harder-Narasimhan Filtration, 5
Hausdorff dimension, 19
with respect to a semimetric, 20
Height sequence, 6
107

108

OMRI NISAN SOLAN

h, 24 hm, 24 hm0m1 , 74
Il, 9 Il, 6 Independent shift sequence, 30 irregular point, 10 I·, 9
L(-), 6 m, 72 Lf (t), 26 Lower convex hull, 28
mUL, 4 mult(x; E), 59
n, 3 N0, 60 Noise lattice, 73 Nontrivial place, 6 Nontrivial point, 10 Nontriviality interval, 11 Null arrow, 9 Null point, 10
O(-), 16 Og, 48 (-), 16
p, 5 2a·, 6 t, 20 m, 72 (-)+, 14 Pm, 81
q, 55
Rectangle, 81 Relative covolume, 66 R×, 7
Scalar pair, 70 Shift
of g-template f , 29 of height sequence a· , 28 Sequence, 29 SLn(R), 3 SLn(Z), 3

Standard weights, 97 Steps of Alice
Adding, 77 Changing, 78 Standard, 79 Steps of Bob Idle, 90 Interruption, 90
Template, 10 (-), 16 Transition arrow, 9
U, 7 Ul(f ), 11
V:V, 8 Vanishing number, 89 V·, 6 Vertex, 26
Impact, 27 non null, 26 null, 26 V , 51
l Rn, 7
, 15 Xn, 3
Y,F , 14 Y,f , 16

