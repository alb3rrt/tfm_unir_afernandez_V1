arXiv:2106.01746v1 [q-bio.QM] 3 Jun 2021

Limits of accuracy for parameter estimation and localisation in Single-Molecule Microscopy via sequential Monte Carlo methods
Alix Marie d'Avigneau1, 2, Sumeetpal S. Singh2, and Raimund J. Ober1
1Center for Cancer Immunology, Faculty of Medicine, University of Southampton, Southampton, UK 2Signal Processing and Communications Group, Department of Engineering, University of Cambridge,
Cambridge, UK
Abstract
Assessing the quality of parameter estimates for models describing the motion of single molecules in cellular environments is an important problem in single-molecule fluorescence microscopy. In this work, we consider the fundamental data model, where molecules emit photons at random time instances and these photons arrive at random locations on the detector according to complex point spread functions. The randomness and non-Gaussian spread function of the detection process, and the random trajectory of the molecule, makes inference challenging. Moreover, the presence of other closely spaced molecules causes further uncertainty in the origin of the measurements, which impacts the statistical precision of the estimates. We quantify the limits of accuracy of model parameter estimates and separation distance between closely spaced molecules (known as the resolution problem) by computing the Cram´er-Rao lower bound (CRLB), or equivalently the inverse of the Fisher information matrix (FIM), for the variance of estimates. Results on the CRLB obtained from the fundamental model are crucial, in that they provide a lower bound for more practical scenarios. While analytic expressions for the FIM can be derived for static molecules, the analytical tools to evaluate the FIM for molecules whose trajectories follow stochastic differential equations (SDEs) are still for the most part missing. We address this by presenting a general sequential Monte Carlo (SMC) based methodology for both parameter inference and computing the desired accuracy limits for non-static molecules and a non-Gaussian fundamental detection model. For the first time, we are able to estimate the FIM for stochastically moving molecules observed through the Airy and Born and Wolf detection models. This is achieved by estimating the score and observed information matrix (OIM) via SMC. We sum up the outcome of our numerical work by summarising the qualitative behaviours for the accuracy limits as functions of e.g. collected photon count, molecule diffusion, etc. We also verify that we can recover known results from the static molecule case.
Keywords : Single-molecule microscopy, Fluorescence microscopy, Particle filtering, Particle smoothing, Sequential Monte Carlo (SMC), Fisher information matrix (FIM), Stochastic differential equations (SDEs)
1 Introduction
In recent years, single-molecule microscopy has become a powerful tool in cell biology [62, 61]. It has allowed significant insight to be gained into the behaviour of single molecules in cellular environments using fluorescence microscopy. Single-molecule fluorescence microscopy (see [63, 45] for reviews) consists of using a suitable fluorophore to label the molecule(s) of interest, exciting said fluorophore with a specific light source and capturing the fluorescence or photons emitted by the molecule(s) through an optical microscope system onto a detector during a fixed acquisition time. Many biological applications rely on being able to accurately track and estimate parameters such as the location and/or movement of a single molecule, or the
1

separation distance between two closely spaced molecules, observed via an optical microscope [62, 44]. Indeed, when inferring the parameters relating to the state of single molecules, it is vital to be able to assess the accuracy of estimates. For instance, the interactions between multiple closely spaced molecules can often lead to a resolution problem, and the resolution limit of an optical microscope is crucial when trying to accurately estimate the separation distance between two molecules. In the past, Rayleigh's criterion [4] has been used to define the minimum distance between two point sources such that they can be distinguished in the image. However, Rayleigh's criterion ignores the statistical aspect of the separation distance estimation problem. For example, it doesn't account for the fact that each new observation (taking the form of a captured emitted photon) brings new information on the separation distance. In contrast, in estimation theory, the Cram´er-Rao lower bound (CRLB) [14, 59, 30, 15] establishes a lower bound on the variance of unbiased estimates, and is therefore often used as a benchmark for the quality of a given estimator. As a result, the CRLB plays an important part in experimental design for single-molecule microscopy [47, 57]. For example, in [56, 58], the authors present an improved microscope resolution measure in the form of the square root of the CRLB for the separation distance between two molecules, which is referred to as the limit of accuracy with which the separation distance between the two objects can be estimated based on the observed data. A particular advantage of this new resolution measure is that it predicts that increasing the photon count makes it possible to estimate a separation distance between two molecules that is shorter than Rayleigh's criterion.
In this paper, we consider the fundamental data model [47, 57], which is crucial in that is provides accessible lower bounds for the limits of accuracy of more realistic practical models, where factors such as pixelisation and readout noise come into play and make inference more challenging. Indeed, the limits of accuracy derived for the fundamental model are often known as the fundamental limits of accuracy. In this model, the detection process of the emitted fluorescence presents its own challenges, as it is intrinsically random both in time and location. While many methods [7, 6, 8] have assumed that the arrival times of the photons on the detector were uniformly distributed, [47, 57] suggest that the arrival times of photons follow a Poisson process. As for the arrival location of these photons on the detector, a wide range of measurement models exist - corresponding to the various types of detector. The typical measurement model used for an in-focus source is the Airy profile [66, 11]. If the molecule is out of focus, 3D models are generally used instead, such as the Born and Wolf model [4]. Often, these models make parameter inference difficult, and researchers have often opted for a Gaussian approximation to these models, such as in [2, 60, 43]. However, [66] argue that in practice, assuming Gaussian distributed photon locations on the detector is not an accurate approximation of the underlying model.
While it is important to be able to accurately study the behaviours and interactions of single molecules within a cell, it is no easy task when those molecules have stochastic trajectories. The motion of an object in a cellular environment is affected by a multitude of deterministic, as well as random factors [5], and in many applications [66, 6], the trajectories of single molecules are modelled by stochastic differential equations (SDEs) [51]. The CRLB is obtained by taking the inverse of the Fisher information matrix (FIM), and analytical expressions for the FIM, and thus the limit of accuracy (given by the square root of the CRLB) for the location of an in-focus static (or unmoving) molecule have been derived in [47, 11]. Similar results for an outof-focus static molecule are available in [50], and analytical expressions have also been derived in the context of molecules with deterministic linear or circular trajectories in [67]. As for the resolution problem, it is addressed in [56, 57] in a static molecule context and in [42] for two dynamic molecules with deterministic trajectories. However, when molecules have stochastic trajectories, the analytical tools to obtain the CRLB and tackle many of these problems are still for the most part missing. In this paper, we propose a numerical approach to address these problems.
2

In the context of stochastically moving molecules, [66] developed a method to obtain the FIM for a molecule whose trajectory is described by a linear SDE. For a 2D Gaussian approximation of the photon detection process, the authors take advantage of the Kalman filter formulae to obtain an analytical form for the FIM for a specific set of photon detection times. However, if the Airy profile is used instead, the computational cost of performing numerical integration becomes prohibitive for more than a single photon. Among other things, we build on [66] and provide effective methodological advances which enable the estimation of the FIM for the hyperparameters of models with Airy and Born and Wolf distributed photon locations.
In this paper, we develop an effective and general numerical framework to obtain sequential Monte Carlo (SMC) approximations of expectations of interest, including for stochastically moving molecules. The ability to approximate these expectations is important for estimating the score and observed information matrix (OIM) for the hyperparameters of interest, and can also be employed to obtain maximum likelihood (ML) estimates of said hyperparameters. Access to the score and/or OIM is vital in order to be able to estimate the FIM. To achieve this, the observation interval is first discretised and the problem reformulated as a discrete-time state space model, which takes into account the random arrival times of photons on the detector in the form of missing observations. Then, a particle filter is employed in conjunction with forward smoothing methods [17, 54] to obtain particle approximations of the expectations of interest. Our work complements [1], in which the authors similarly employed time discretisation of the observation interval, but they did not attempt to estimate the CRLB for hyperparameters.
The numerical experiments in this paper consist first of applying the methodology to estimate the limit of accuracy for a single stochastically moving molecule with 2D Gaussian, Airy, and Born and Wolf photon detection models by using estimates of the score and OIM obtained by forward smoothing. This is repeated for various expected mean photon counts to verify that for molecules with stochastic trajectories, the limit of accuracy exhibits an inverse square root decay with respect to mean photon count, i.e. the uncertainty of the hyperparameter estimates decreases as the expected number of photons increases. This has already been proven for static molecules [49, 50, 56]. The methodology is also applied in the context of the optical microscope resolution problem to obtain estimates of the limit of accuracy for the mean separation distance between two closely spaced diffusing molecules. Thanks to our numerical approach, insights can be obtained into the generalisation to diffusing molecules of results proven in [58] on this resolution problem for two static molecules. For instance, in [47], it was shown that the limit of accuracy for the location of a static molecule has a linear relationship with the standard deviation of the photon detection profile. From our numerical results, we show that when molecules are diffusing, the appropriate relationship behaves qualitatively with the diffusion coefficient standard deviation in a similar way, i.e. it can be translated into additional observation uncertainty. The qualitative relationships observed through our numerical experiments for stochastically moving molecules are summarised in Table 1.
This paper is structured as follows. In Section 2, the model is presented, including the molecule trajectory, described by a stochastic differential equation (SDE), and the photon detection time and location processes. In Section 3, the model is formulated as a discrete-time state space model with a discretised observation interval. Then, Section 4 establishes the main parameter inference aims and methods, which consist of particle filtering and smoothing of additive functionals in order to estimate the score and OIM for hyperparameters, and methods to estimate the FIM from the score and OIM. Numerical experiments are run in Section 5 to first estimate the limit of accuracy for the drift and diffusion coefficients of the SDE for all photon detection profiles and then estimate the limit of accuracy for the separation distance between two dynamic molecules. Finally, Section 6 provides concluding remarks.
3

2 Model specification

For the purpose of this paper, a basic optical system is considered, also known in [66, 11] as the fundamental data model. See Figure 1 for an overview of the optical system. Under the fundamental model, we assume that the photons are observed under ideal conditions, in which the detector Y = R2 is non-pixelated. This model does not describe image data obtained from actual microscopy experiments the way more realistic, or practical models do. However, the fundamental model is crucial, in that it offers an obtainable lower bound to the CRLB of parameters of the more realistic practical model, which is much more difficult to obtain. In this section, the various aspects of the model are described. These include the true molecule trajectory, occurring in the object space, the photon detection locations in the image space, and the times at which photons arrive on the detector.

object space
eo,2 object

image space ei,2
lens system

detector

eo,1
object
plane

X (t)
object location at
time t

ei,1
image
Y (t) plane
location of detected photon
at time t

optical axis

Figure 1: Illustration of an optical microscope. At time t  t0, the molecule is located at X(t) in the object space and might be moving along the object plane. If the molecule is out of focus, it will instead move along a plane parallel to the object plane but displaced along the optical axis. The molecule emits photons through the lens system into the image space and its image is acquired on the planar detector Y located on the image plane. The location of the detected photons at time t is denoted by Y (t).

2.1 Molecule trajectory
For notational simplicity, let Xt := X(t)  Rd denote the true, d-dimensional location of the molecule at time t. Given hyperparameters , let fs,t(xt|xs) denote the probability density function of Xt given the previous location Xs. Assume that the molecule trajectory (Xt)t0tT follows a linear stochastic differential equation (SDE)

dXt = b(t, Xt)dt + (t, Xt)dBt,

(2.1)

where b(t, Xt) := b0 + b(t)Xt and (t, Xt) := (t) represent the drift and diffusion coefficients,
respectively, b0 is the zero order drift coefficient, and (dBt)t0tT is a Wiener process with E [dBtdBt] = Id×d. According to [36, 29] the solution to the SDE in (2.1) at discrete time points t0 < t1 < . . . is given by

Xti+1 = (ti, ti+1)Xti + a(ti, ti+1) + Wg(ti, ti+1),

(2.2)

where the fundamental matrix function   Rd×d satisfies the following for all s, t, u  t0

d(s, dt

t)

=

b(t)(s, t),

(t, t) = Id×d, (s, t)(t, u) = (s, u),

(2.3)

4

the vector a(ti, ti+1)  Rd is given by

ti+1

a(ti, ti+1) =

b0(ti, t)dt,

ti

and finally the process

Wg(ti, ti+1) =

ti+1 ti

(ti,

t)(t)dBt


is a white noise sequence with
i=1

mean zero and covariance

ti+1

R(ti, ti+1) =

(ti, t)(t)(t)(ti, t)dt.

ti

(2.4)

Therefore, the transition density fti+1,ti (x|x) can be expressed as a Gaussian with mean µ(x, ti, ti+1) = (ti, ti+1)x + a(ti, ti+1) and covariance R(ti, ti+1):

Xti+1 |(Xti = x)  N (µ(x, ti, ti+1), R(ti, ti+1)) .

(2.5)

Example 2.1. Let the trajectory of a molecule be given by the following SDE 
dXt = bId×dXtdt + 2dBt,

(2.6)

where in the drift term b  R, in the diffusion term  > 0, and (dBt)t0tT is a Wiener process and let  = (2, b). Assuming the time points t0, t1, . . . are equidistant, i.e. ti+1 - ti =  for all i = 0, 1, . . ., let the fundamental matrix  := Id×d where   R and the covariance matrix R := r Id×d where r > 0. Then, by solving (2.3) and plugging the result into (2.4), we obtain

 =

eb, 1,

if b = 0, if b = 0,

and

r =

2 b

e2b - 1 ,

22,

if b = 0, if b = 0.

The initial distribution Xt0  N (x0, P0) has covariance matrix P0 = p20Id×d where p0  R. In a 2D setting (i.e. d = 2), let the drift b = -10 s-1, the diffusion 2 = 1 µm2/s and the
initial covariance p20 = 10-2 µm2 and mean x0 = (4.4, 4.4) µm. By simulating the molecule trajectory for the time interval [0, 0.1] seconds, we obtain the trajectory in Figure 2.

True molecule trajectory

4.0

x2-location of molecule (m)

3.5

3.0

2.5

2.0

2.5

3.0

3.5

4.0

4.5

x1-location of molecule (m)

Figure 2: Trajectory of a molecule in the object space with stochastic trajectory described in (2.6) and with diffusion and drift coefficients 2 = 1 µm2/s and b = -10 s-1, respectively. The molecule
moves during an interval of [0, 0.1] seconds and its initial location is Gaussian distributed with mean x0 = (4.4, 4.4) µm and covariance P0 = 10-2I2×2 µm2.

5

2.2 Photon detection locations

The true molecule trajectory cannot be observed directly. Instead, a fluorescence microscope
is used: the molecule of interest is labelled using a suitable fluorophore, magnified through a lens system and the photons it emits arrive on a detector Y := R2 for a fixed time period (see
Figure 1). The arrival location of a photon on the detector is random, and using the typical
approximation of the optical microscope from [32], it can be described as follows. Let Y  Y denote the observed location of a detected photon. For an object located at (x0,1, x0,2, z0)  R3 in the object space, its photon distribution profile [57] is given by the density

g (y |x)

:=

1 |M | qz0

M -1y - (x0,1, x0,2)

,

y  R2,

(2.7)

where M  R2×2 is an invertible lateral magnification matrix and the image function qz0 : R2  R describes the image of an object in the detector space when that object is located at (0, 0, z0) in the object space. Note that the subscript  is used in the left-hand side of (2.7) to include dependence on hyperparameters. Depending on the model considered and inference aims, the hyperparameter(s) of interest can be (x0,1, x0,2) if the object is static and/or z0 if an out-of-focus molecule is considered.
Three types of image functions are considered. First of all, according to optical diffraction theory from [4], an in-focus point source (i.e. when z0 = 0) will typically generate an image that follows the Airy profile, given by

J12 q(x1, x2) =

2n e

x21 + x22

(x21 + x22)

,

(x1, x2)  R2,

(2.8)

where n is the numerical aperture of the objective lens, e is the emission wavelength of the molecule and J1(·) represents the first order Bessel function of the first kind.
Often, to simplify the problem, the 2D Gaussian approximation to the Airy profile has been
used instead (see [12, 65, 69, 64]):

q(x1,

x2)

=

1 2a2

exp

-

x21 + x22 2a2

,

(x1, x2)  R2.

(2.9)

If the point source of interest is out of focus, then a 3D Born and Wolf model [4] is used instead:

qz0(x1, x2)

=

4n2 2e

1
J0
0

2n e

x21 + x22

exp

jn2z0 noe

2

2
d ,

(x1, x2)  R2, (2.10)

where z0  R is the location of the object on the optical axis, no is the refractive index of the objective lens immersion medium and J0(·) is the zero-th order Bessel function of the first kind. Note that the Airy profile is a special case of the Born and Wolf model. Indeed, if the object is
in focus, then z0 = 0 on the optical axis and (2.8) and (2.10) coincide.

2.3 Photon detection times
Just like the photon detection locations, the times at which the photons arrive on the detector Y are random. More specifically, in [66, 11], the arrival of the photons on the detector, or photon detection process, can be modelled as a Poisson process. Let N (t) be the number of photons detected at time t  t0 for initial time t0  R and let (t) be the photon detection rate, representing the rate at which the photons emitted by the object hit the detector at any given time t. For example, the detection rate of an object that has high photostability will simply be constant, while an exponentially decaying (t) can indicate that the object image is photobleaching, or fading over time. The arrival times of the photons on the detector Y are denoted t1, t2, . . . where ti denotes the arrival time of the i-th photon.

6

2.4 The observed data

Let np = N (T ) - N (t0) be the number of photons detected in the interval [t0, T ]. We have now
established the two aspects of the data that can be observed in a basic optical system during
this interval, namely the detection times t1, t2, . . . , tnp of photons and the location of those detected photons Yt1, Yt2, . . . , Ytnp on the detector Y. Assume that, conditionally on the current object location Xti, the location of the i-th detected photon Yti at time ti is independent of the previous locations and time points of the detected photons, i.e. for xti  X ,

p(yti |xti , yti-1 , . . . , yt0 ) = p(yti |xti ) =: g(yti |xti ), yti  Y,

(2.11)

where the density g is the photon distribution profile from (2.7). This is a reasonable assumption, as at any given time, processes such as photon emission and image formation only depend on the state of the emitting fluorescent molecule at that time, and not on any prior event.

Example 2.2. Let the trajectory of a molecule be given by the SDE in Example 2.1 and simulated using the same parameters and for the same time interval. Let Y be a non-pixelated
detector. Then, let the photon detection rate be constant such that the mean number of
photons is 500, and the photon distribution profile be given by (2.7), where the magnification
matrix M = mI2×2 with m = 100. The image functions for the Airy, 2D Gaussian and Born and Wolf profiles are given by (2.8), (2.9) and (2.10) respectively, where n = 1.4, e = 0.52 µm, no = 1.515, a2 = 49 × 10-4 µm2 and z0 = 1 µm. By simulating the detected photon locations based on the same molecule trajectory and according to these three models, we obtain
the observed photon trajectories in Figure 3. Note that the parameters of the Airy and 2D
Gaussian profiles have been chosen so that the Gaussian profile approximates the Airy profile.

x2-location of detected photon (m) x2-location of detected photon (m) x2-location of detected photon (m)

Detected photon locations, Gaussian model
450

Detected photon locations, Airy model

450

400 400

350 350

300 300

250

250

200

200

Detected photon locations, Born and Wolf model
500 400 300 200 100

250 300 350 400 450 x1-location of detected photons (m)

250 300 350 400 450 x1-location of detected photons (m)

100 200 300 400 500 x1-location of detected photons (m)

Figure 3: Detected photon locations of a moving molecule with stochastic trajectory for the 2D Gaussian (left), Airy (middle) profiles and Born and Wolf model (right).

3 The model as a state space model
It is possible to reformulate this model as a state space model that takes into account the random arrival times of photons. This is achieved by discretising the time interval during which photons are recorded.
3.1 Reformulation
For simplicity, we assume for the rest of this paper (unless stated otherwise) that the photon detection rate is constant, i.e. (t) =   [0, 1] for all t  t0. First of all, let Xt = (xt,1, xt,2)  X where X := R2 denotes the state of the molecule at time t  t0, which includes its location xt,1:2
7

on the object plane. The location of the object on the optical axis is assumed to be constant and equal to the initial location parameter, i.e. z0 for all t  t0. The probability of recording an observation, i.e. detecting a photon in the small interval (t, t + h] is
P [N (t + h) - N (t) > 0] = h + o(t),   [0, 1], t  t0.
Let ti denote the arrival time of the i-th photon on a detector Y for i = 1, 2, . . . and Yti  Y be the location of the captured photon on the detector. Assume the location of a detected photon is distributed according to the probability density function
Yti | (Xti = x)  g(·|x), i = 1, 2, . . . ,
where g is the photon distribution profile given in (2.7). The recorded data in the time interval [t0, T ], 0  t0 < T comprises of np observations with arrival times t0 < t1 < . . . < tnp  T and photon locations yt1, . . . , ytnp . The inference objective is to estimate the trajectory of the molecule (Xt)t0tT given data (ti, yti ), i = 1, . . . , np. As seen in Subsection 2.1, the molecule evolves according to the probability density function
Xti+1 | (Xti = x)  fti,ti+1( · |x), i = 1, 2, . . . , np,
where  denotes the model parameters and fs,t for t > s  t0 is the homogeneous continuoustime Markov transition density given by the the Gaussian distribution in (2.5) for d = 2.

3.1.1 Non-constant photon detection rate
If the photon detection rate (t) is not assumed to be constant, then we redefine the state of an object at time t  t0 as Xt = (xt,1, xt,2, t)  X where X := R2 × [0, 1]. The state at time t now includes the location of the molecule (xt,1, xt,2) as well as the probability t of detecting a photon it emits. The Markov transition density p(x|x) can be defined as follows
p(xti+1 |xti ) = fti,ti+1 (xti+1,1:2|xti,1:2)l(ti+1 |ti ), xti+1 , xti  X ,
where ti and ti+1 denote the arrival times of the i-th and (i + 1)-th photons, respectively, fti,ti+1 is the Markov transition density for the object location defined above and l is the Markov transition density for the photon detection rate.

3.2 Time discretisation
Let (t1, yt1 ), . . . , (tnp, ytnp ) be a realisation of the photon arrival times and locations observed in the time interval [t0, T ]. Setting t0 := 0 for convenience, we adopt a discrete time formulation where [0, T ] is divided into segments of length . Let xk  X denote the state of the molecule at time t = (k - 1)  where k = 1, . . . , n for n := T /. We assume the discretisation is fine enough so that an interval (k, k + ] contains at most one arrival time ti. Then, for k = 1, . . . , n, let

yk =

, yti ,

if if

ti / (k - , k], ti  (k - , k],

i = 0, 1, . . . , np,

where yti  Y denotes the location of the i-th detected photon on the detector Y. The vector yk is assigned  to indicate the absence of an observation in the corresponding interval. See Appendix A for details on why the time discretisation is a valid approximation of the Poisson
process. If x = (x1, x2, )  X , let

Gk(x) =

1 - , g(yti |x1:2),

if yk = , if yk = yti ,

8

then Gk(x) is the so called potential function.
For k = 1, . . . , n, the probability density function of Xk+1 given the previous state Xk is f (xk+1|xk) := fk,k+(xk+1|xk) from (2.5), thus transforming (2.2) into

Xk+1 = Xk + a + Wx, Wx  N (0, R) ,

where  = (k, k + ) is now constant and similarly for a and R.

To summarise, (Xk) k=1 and (Yk) k=1 molecule trajectory in the object space

are X - and Y  -valued (Xk) k=1 corresponds to

stochastic processes where the the unobserved latent Markov

process tection

with Markov transition locations (or lack of) (Yk

)d ke=n1sirteypfres(exnt|xt)heanodbsienrivteiadl

density process

(x), and the photon dewith conditional density or

potential function Gk(x), i.e.

X1  (·), Xk| (Xk = x)  f (·|x), Yk| (Xk = x)  Gk(x), k = 1, 2, . . . .

(3.1) (3.2)

Note that if the object is static, so that the drift and diffusion coefficient in (2.1) are zero, the model simplifies from a state space model to a basic inference problem with independent observations. The observed process is still described by (3.2) but the location of the object x0 becomes part of the hyperparameters.

4 Parameter inference

4.1 Inference aim

Now that we have formulated the problem in (3.1) and (3.2) as a state space model, the first aim

is going to be to estimate the posterior probability density function of X1:n := {X1, . . . , Xn},

n  N, given the observations Y1:n, also known as the joint smoothing distribution, which is

given by

p(x1:n|y1:n)

=

p(x1:n, y1:n) , p (y1:n )

(4.1)

where the numerator represents the joint density

n

n

p(x1:n, y1:n) = (x1) f (xk|xk-1) Gk(xk),

k=2

k=1

(4.2)

where (x1) is the initial distribution of X1, and the denominator represents the marginal likelihood of the observed data

p(y1:n) =

p(x1:n, y1:n)dx1:n.

Xn

(4.3)

Estimating p(x1:n|y1:n) is what allows the molecule to be tracked and is done using a particle filter. The second aim is to obtain particle approximations of smoothed additive functionals, which in turn will allow for estimation of the score and OIM for of the hyperparameters , as well as other applications such as ML estimation of said hyperparameters via gradient ascent and Expectation-Maximization (EM). Finally, the third aim is to use the estimates of the score and OIM of the hyperparameters to obtain an approximation of their FIM.

4.2 Tracking the molecule using a particle filter
The particle approximation of the marginal posterior of X1, . . . , Xn defined in (4.1) is given by
N
p^(x1:n|y1:n) = i=1 n(i)X1(i:n) (x1:n),
9

where X1(1:n:N) are the particles, n(1:N) their corresponding normalised importance weights, i.e.

N i=1

n(i)

=

1

and

v0 (v)

denotes

the

dirac

delta

mass

located

at

v0.

To obtain this particle

approximation, we employ sequential Monte Carlo (SMC) methods in the form of a particle

filter (see [9, 23, 26, 13] for comprehensive reviews of SMC methods). There is flexibility in the

specific choice of particle filter, but the general form they take follows three key steps, namely

resamplepropagateweight. A generic particle filter is summarised in Algorithm 3. The resampling step avoids weight degeneracy [24, 39] and consists of drawing indices (k1:N)
with probabilities corresponding to the normalised weights k(1:N). The propagation and weighting steps consist of advancing the particle population (Xk(1-:N1 ), k(1-:N1 )) forward in time via the proposal density k(xk|xk-1) and updating the importance weights as follows:

k(i) =

k(i-) 1w~ Xk(i-) 1, Xk(i)

,

N j=1

k(j-)1w~

Xk(j-)1, Xk(j)

where w~(xk-1, xk) is known as the incremental weight and is given by

w~(xk-1, xk)

=

Gk

(xk)f (xk|xk-1) k (xk |xk-1 )

.

The proposal density is user-defined. For example, if t(xk|xk-1) = f (xk|xk-1), the particle filter becomes the well-known bootstrap filter, introduced in [33] and the computation of the
incremental weights simplifies to w~(xk) = Gt (xk). Given weighted particle sample (Xk(1-:N1 ), k(1-:N1 )) at step k, we denote an iteration of running
the particle filter (steps 4-6 of Algorithm 3) as

Xk(1:N), k(1:N) := PF Xk(1-:N1 ), k(1-:N1 ) .

For this particular problem, we must also take into account the missing observations introduced by the time discretisation. Since a lack of observation does not bring any new information, it suffices to only run the particle filter at segments which contain an observation. A typical iteration of this approach is summarised in Algorithm 1. The interval counter is initialised at c0 := 1 and counts the number of discrete intervals since (and including) the last observation. An example of particle filtering for stochastically moving molecules observed through the 2D Gaussian, Airy and Born and Wolf models is available in Example B.1.

4.3 Particle approximations of expectations of additive functionals

The second inference aim is to obtain estimates of the score and observed information matrix

(OIM) for the hyperparameters . To achieve these aims, we make use of smoothed additive

functionals. Assume that there exists a real-valued function Sk, k  0 such that it is an additive functional given by

k

Sk(x1:k) = sj (xj-1, xj ),

(4.4)

j=1

where s1(x0, x1) := s1(x1) and sk k0 is a sequence of sufficient statistics which may depend on the value of the observations y0:k. The main aim is to compute the posterior or smoothing expectation, given by

Sk() := E Sk (X1:k) |y1:k = Sk (x1:k) p(x1:k|y1:k)dx1:k.
X

(4.5)

If the model in question is linear and Gaussian or the state space X is finite, then the expectation Sk() can be computed exactly by recursion. However, this is not the case if the Airy or Born

10

Algorithm 1 Particle filter for SDE with missing observations

Input: weighted particle sample
1: if yk =  then 2: ck := ck-1 + 1 3: Do not run the particle filter

Xk(1-:N1 ), k(1-:N1 )

and interval counter ck-1 at step k - 1.

Xk(1:N), k(1:N) := Xk(1-:N1 ), k(1-:N1 ) .

4: else 5: Run the particle filter with updated interval length, i.e.

Xk(1:N), k(1:N) := PFck Xk(1-:N1 ), k(1-:N1 ) .

6: ck := 1 7: end if
Output: updated particle sample Xk(1:N), k(1:N) .

and Wolf profiles are used to describe photon distribution. In this case, SMC methods can again be employed to approximate the expectation as follows

N

S^k() :=

k(i)Sk X1(i:k) ,

i=1

where the weighted sample (X1(1:k:N), k(1:N)) is a particle approximation of the joint smoothing distribution p(x1:k|y1:k) obtained using a particle filter.
A simple way of estimating the smoothing expectation Sn() for a set of n observations y1:n is to run the desired particle filter in a `forward pass' through the whole data to obtain the particle approximation (Xn(1:N), n(1:N)) at the final step n, followed then by a `backward smoothing' pass through the data, starting from the latest sample yn. This is the case of algorithms such as the fixed-lag smoother by [38, 52, 53], forward-filtering backward smoothing (FFBSm) by [25, 35, 37] and forward-filtering backward simulation (FFBSi) by [31]. However, if one wishes to avoid multiple passes through the data, it is also possible to take advantage of the form of the additive functional in (4.4) to estimate Sk() in an online or `forward-only' fashion, as proposed in [17] and further developed in [54]. Introducing the auxiliary function

Tk(xk) :=

Sk(x1:k)p(x1:k-1|y1:k-1, xk)dx1:k-1,

X k-1

the following recursion is then created:

Tk(xk) =

Tk-1(xk-1) + sk(xk-1, xk) p(xk-1|y1:k-1, xk)dxk-1,

X

(4.6)

where T0 := 0 and its particle approximation given the weighted sample (X1(1:k:N), k(1:N)) and previous state particle approximation T^k-1(Xk(1-:N1 )) is given by

N

T^k Xk(i) =

k(i, j) T^k-1 Xk(j-)1 + sk Xk(j-)1, Xk(i)

j=1

(4.7)

for all i  {1, . . . , N }, and where

k(i, j) :=

k(j-)1f Xk(i)|Xk(j-)1

N j=1

k(j-)1f

Xk(i)|Xk(j-)1

.

(4.8)

11

Finally, using the recursion on the auxiliary function Tk, the smoothing expectation in (4.5) can be rewritten as

Sk() = Tk(xk)p(xk, y1:k)dxk,
X

(4.9)

and its particle approximation is

N

S^k() =

k(i)T^k Xk(i) .

i=1

This algorithm is known as Forward smoothing SMC (SMC-FS) and is summarised in the context of our experiments in Algorithm 2.

Algorithm 2 Forward smoothing SMC (SMC-FS)

Where (i) or (j) appears, the operation is performed for all i, j  {1, . . . , N }.

At k = 1,

1: Initialise the particle filter to obtain the weighted particle sample X1(1:N), 1(1:N) .

2: Initialise the interval counter c0 := 1. 3: Set T^1 X1(i) := 0.

4: for k = 2, . . . , n do

5: if yk =  then

6:

ck := ck-1 + 1

7: else

8:

Use the particle filter to update the weighted particle sample, i.e.

Xk(1:N), k(1:N) := PFck Xk(1-:N1 ), k(1-:N1 ) .

9:

Evaluate

k(i, j) :=

k(j-)1fck Xk(i)|Xk(j-)1

.

N j=1

k(j-)1fck

Xk(i) |Xk(j-)1

10:

Update the auxiliary function estimate

N

T^k Xk(i) =

k(i, j) T^k-1 Xk(j-)1 + sk Xk(j-)1, Xk(i) .

j=1

11:

Update the smoothing expectation estimate

N

S^k() =

k(i)T^k Xk(i) .

i=1

12:

Reset the interval counter ck := 1.

13: end if

14: end for Output: smoothing expectation estimate S^n.

4.4 Estimation of the score and observed information matrix (OIM)
The score and OIM have important applications to ML estimation, e.g. see [40, 55]. They can also be instrumental in assessing the performance of such an estimator, either directly, as argued by [28], or as tools to estimate the FIM when the latter cannot be computed exactly, as
12

we will see in this section. We aim to compute, recursively in time, the score vector Gk() :=  log p(y1:k) and OIM Hk() := -2 log p(y1:k) where p(y1:k) denotes the marginal likelihood at step 1  k  n defined in (4.3),  denotes the gradient and 2 the Hessian.

4.4.1 Establishing the sufficient statistics
First of all, assume that the regularity conditions allowing for differentiation and integration to be switched around in expressions are satisfied. Let us establish the Fisher and Louis identities for the score and OIM, respectively, from [9, 23]:

Gk() =  log p(xk, y1:k)p(xk|y1:k)dxk,

X

Hk()

=



log

p(y1:k) log

p (y1:k )

-

2 p (y1:k p (y1:k )

)

,

where

2 p (y1:k ) p (y1:k )

=

 log p(xk, y1:k) log p(xk, y1:k)p(xk|y1:k)dxk
X

+ 2 log p(xk, y1:k)p(xk|y1:k)dxk,
X

and note that (4.10) and (4.11) can be rewritten as

(4.10) (4.11)

 log p(y1:k) = E k(Xk)|y1:k ,

2 p (y1:k ) p (y1:k )

=

E

k (Xk )k (Xk ) |y1:k

+E

k (Xk )|y1:k

,

where the expectations are with respect to the density p(xk|y1:k), and the functions k(xk) :=  log p(xk, y1:k) and k := 2 log p(xk, y1:k) are the additive functionals of interest. A recursion for k and k is straightforward to obtain, more details in [55]. For k and k, (4.6) becomes

k(xk) =

k-1(xk-1) + sk (xk-1, xk) p(xk-1|y1:k-1, xk)dxk-1,

X

k(xk) =

k-1(xk-1) + sk (xk-1, xk) p(xk-1|y1:k-1, xk)dxk-1 - k(xk)k(xk),

X

where the sufficient statistics are given by

sk (xk-1, xk) :=  log Gk(xk) +  log f (xk|xk-1), sk (xk-1, xk) := k-1(xk-1) + sk (xk-1, xk) k-1(xk-1) + sk (xk-1, xk) 
+ 2 log Gk(xk) + 2 log f (xk|xk-1).

(4.12) (4.13)

Finally, to approximate the score and OIM, adapt the particle approximation in (4.7) to the recursions in (4.12) and (4.13) to obtain the score estimate

N

G^k() =

k(i)^k Xk(i)

i=1

and OIM estimate

N

H^k() = G^k()G^k() -

k(i) ^k Xk(i) ^k Xk(i)  + ^k Xk(i) .

i=1

13

In Example 4.1, we apply this framework to a possible application of the single-molecule tracking model. We focus for now on the case where the photon distribution is described by the Airy or 2D Gaussian profile.

Example 4.1. Let the trajectory of a molecule be given by the following SDE 
dXt = bI2×2Xtdt + 2dBt,

where in the drift term, b = 0, in the diffusion term,  > 0, and (dBt)t0tT is a Wiener process. Let the photon detection process be described by the Airy or 2D Gaussian profile. Then, the parameters of interest are  = (2, b). Recall from Subsection 3.2 and Example 2.1 that the
solution to the SDE can be written as

Xk = ebXk-1 + Wx,

Wx  N

0,

2 b

e2b - 1 I2×2

,

(4.14)

and since the potential function Gk does not depend on  in this case, it can be dropped from (4.12) and (4.13) and the components of the sufficient statistic sk (xk-1, xk) for the additive functional k are

 2

log

f (xk|xk-1)

=

-

1 2

+

b

xk - ebxk-1 24 (e2b - 1)

2
,

 b

log f (xk|xk-1)

=

1 b

-

2e2b (e2b - 1)

-

xk - ebxk-1 2 22(e2b - 1)

+

beb(xk - ebxk-1)xk-1 2(e2b - 1)

+

xk

- ebxk-1 2(e2b -

2 be2b 1)2

.

The components of the sufficient statistic sk (xk-1, xk) for k are given in Appendix C. Note that these derivatives can be evaluated for any value of , and it is therefore possible to adapt them
in order to only compute sufficient statistics when an observation is recorded as in Algorithm 1.
This is reflected in Algorithm 2.

4.5 Estimating the Fisher information matrix (FIM)

The Fisher information matrix (FIM) is widely used in estimation problems as an indicator of the performance of a given estimator. Indeed, it is a key element of the Cram´er-Rao inequality, or Cram´er-Rao Lower Bound (CRLB) derived by [14, 59, 30, 15], which states that for an unbiased estimate ^ of the parameter , its covariance has lower bound

Cov(^) In()-1,

where given matrices A and B, the inequality A B indicates that A - B is a positive semidefinite matrix, and In() denotes the FIM in a random sample Y1, . . . , Yn of size n [16], defined as

In() = E  log p(Y1:n) log p(Y1:n)T = E -2 log p(Y1:n) ,

(4.15) (4.16)

where the second equality is proven in [27]. When the expectations in (4.15) and (4.16) are intractable - which is the case when the Airy profile is used to describe the photon detection locations in the single-molecule tracking model - there are several ways one can go about estimating the FIM.

14

4.5.1 Estimating the FIM for a single large sample using the OIM Firstly, note that from (4.16), the relationship between the FIM and OIM is simply

In() = E [Hn()] ,

(4.17)

where Hn() = -2 log p(y1:n) denotes the OIM. Then, for a general state space model, in [3], it was proven that under mild assumptions,

1 n

Hn()



I ()

as n  ,

where I() is the asymptotic FIM. See [34] for the corresponding result for multiple targets. So for a large enough sample size n, i.e. if the interval during which the molecule(s) of interest are observed is long enough, the OIM and FIM can be used interchangeably, i.e. for n  1,

Hn()  In().

(4.18)

See Figure 4 for an illustration. Therefore, the first way of estimating the asymptotic FIM in the single-molecule tracking model is simply to obtain the OIM for a large sample size. For more details on the OIM as an estimate of the FIM, see [22].

4.5.2 Estimating the FIM using the mean outer product of the score

If the molecule(s) of interest are only observed for a short interval, then the size n of the sample

of interest is not large enough to estimate the FIM using the OIM. It is then also possible to

instead obtain a particle approximation of the expectation in (4.15) using the score as follows:

generate D datasets y1(1:n:D) of (smaller) size n where y1(d:n) := {y1(d), . . . , yn(d)}, and according to the same parameters . The outer product of the score can then be used in the estimate of the

FIM as follows:

I^n()

=

1 D

D

Gn(d) ( )Gn(d) ( ) ,

j=1

(4.19)

where for d = 1, . . . , D, the vector Gn(d)() :=  log p(y1(d:n)) is the score for the d-th dataset of size n.

4.5.3 Estimating the FIM using the mean OIM

When multiple datasets are available, the OIM can also similarly be averaged over D datasets

to estimate the FIM as follows:

I^n()

=

1 D

D

Hn(d)().

j=1

(4.20)

This third approach is the Monte Carlo estimator of the expectation in (4.17), and can be seen as averaging the first estimation method in (4.18).
Now that the various methods for estimating the FIM have been established, it can be used in an experimental design setting to plan experiments with the aim of returning the most accurate parameter estimates. See Appendix D for details on how ML estimates can similarly be obtained via EM and gradient ascent methods with the use of smoothed additive functionals and SMC-FS.

Example 4.2. To verify these approaches to estimate the FIM, consider the straightforward special case of estimating the FIM for the location x0 = (x0,1, x0,2) parameters of a static

15

molecule emitting photons at a constant rate. In [47, 11], the analytical expression for the FIM is derived for the Airy profile, and its diagonal components given observations y1:n are given by

InAiry(x0,1) = InAiry(x0,2) = Nphot2,

where



=

2na e

,

Nphot

denotes

the

expected

photon

count,

and

I Airy(x0,i)

denotes

the

(i, i)-

th element of the FIM, corresponding to parameter component xi, for the Airy profile. As

mentioned in Subsection 3.2, having a static molecule simplifies the model. Since we have

independent data, the true values of score G and OIM H can be derived as follows. Given a set

of observations y1:n distributed according to the Airy profile,

n

GnAiry(x0) =

k(M -1yk - x0)½yk=,

k=1

n

HnAiry(x0) =

k(M -1yk - x0)(M -1yk - x0) + kI2×2 ½yk=,

k=1

where

k

=

2 r

J2(rk J1(rk

) )

,

k

=

-

22 rk2

J3 (rk ) J1 (rk )

-

J22 (rk ) J12 (rk )

,

and rk = (M -1yk - x0)(M -1yk - x0). See Appendix E for the full derivation. Using the same settings as in Example 2.2, we simulate Dl = 40 `large' datasets according
to the Airy profile consisting of observations obtained during the interval [0, 0.2] seconds. We

also simulate Ds = 400 `short' datasets consisting of observations obtained during the shorter interval [0, 0.02] seconds. The score and OIM are obtained for all datasets and the FIM for the

large and short datasets is estimated in three ways: (i) using the OIM returned from a single

dataset selected at random (4.18), (ii) using the mean outer product of the score (4.19) over

all datasets and (iii) using the mean OIM across all datasets (4.20). Finally, the square root of

the CRLB, also known as the (fundamental) limit of accuracy and defined as

 = CRLB
for parameter  is obtained. This is repeated for various expected photon counts in order to compare the evolution of the estimated limit of accuracy as the expected number of photons increases to the true limit of accuracy obtained using the true FIM. In Figure 4, it is apparent that, apart from very low photon counts, all approaches are able to return accurate estimates of the limit of accuracy. Comparing Figure 4a and Figure 4b, it also becomes apparent that for long datasets, approach (i) is slightly more accurate than (ii), and the opposite is true for short datasets. In both cases, approach (iii) is the most accurate. Similar results can be obtained for the 2D Gaussian profile and Born and Wolf model, as analytical expressions for the FIM are also available for a static object [49, 50].

5 Numerical experiments
In this section, we apply the particle smoother known as SMC-FS to estimate the FIM, and thus the limit of accuracy, for various parameters in the context of one or multiple moving molecules with stochastic trajectories. Experiments are first run with photon detection locations described by the Gaussian and Airy profiles, and then the Born and Wolf model, where an additional hyperparameter, namely the optical axis location, must be considered as well. The methodology is then applied to the optical microscope resolution problem, where the limit of accuracy for the mean separation distance between two closely spaced diffusing molecules is assessed.
Unless stated otherwise, the FIM for any given settings is estimated according to (4.20), i.e. by generating several datasets according to the same settings, estimating the OIM for each

16

x1-l cati n limit f accuracy x1 ( )

0.06 0.05 0.04 0.03 0.02 0.01 0.00
0 0.06 0.05 0.04 0.03 0.02 0.01

True  and estimated ( limit f accuracy f r a [0 0.02] sec nds interval
true x1 f r Airy pr file (i) fr m OIM f r a single dataset (ii) fr m mean uter pr duct f sc re ver 400 datasets ( )iii fr m mean OIM ver 400 datasets

20

40

60

80 100 120 140

mean ph t n c unt

x2-l cati n limit f accuracy x2 ( )

0
0.0035 0.0030 0.0025 0.0020 0.0015 0.0010 0.0005 0.0000
0
0.005

20

40

60

80 100 120 140

mean ph t n c unt

Absolute difference between true and estimated limit of accuracy for a [0, 0.02] seconds interval

(i) from OIM for a single dataset (ii) from mean outer roduct of score over 400 datasets (iii) from mean OIM over 400 datasets

20

40

60

80 100 120 140

mean hoton count

0.004

0.003

0.002

0.001

0.000 0

20

40

60

80

100

mean hoton count

120

140

(a) Many short datasets, Airy profile

()x2 - x2(

x1 |  -

x1|

x2-location limit of accuracy x2 ( )

x1-location limit of accuracy x1 ( )

0.020 0.015 0.010 0.005

True  and estimated  limit of accuracy for a [0 0.20] seconds interval
true x1 for Airy rofile (i) from OIM for a single dataset (ii) from mean outer roduct of score over 40 datasets ( )iii from mean OIM over 40 datasets

0
0.020 0.015 0.010 0.005

200 400 600 800 1000 1200 1400 mean hoton count

0
0.0014 0.0012 0.0010 0.0008 0.0006 0.0004 0.0002 0.0000
0
0.0005

200 400 600 800 1000 1200 1400 mean hoton count
Absolute difference between true and estimated limit of accuracy for a [0, 0.20] seconds interval
(i) from OIM for a single dataset (ii) from mean outer roduct of score over 40 datasets (iii) from mean OIM over 40 datasets
200 400 600 800 1000 1200 1400 mean hoton count

0.0004

0.0003

0.0002

0.0001

0.0000 0

200

400

600

800

1000

mean hoton count

1200

1400

(b) Few long datasets, Airy profile

x1|

x1 |  -

()x2 - x2(

Figure 4: True and estimated limit of accuracy for mean photon counts ranging from (a) 1 to 150 (b) 10 to 1500. The limit of accuracy is estimated for the location parameters (x1, x2) of a static in-focus molecule. The estimates are obtained by taking the square root of the inverse of the FIM, obtained for (a) 400 `short' (b) 40 `long' simulated datasets using approaches (i) , (ii) × and (iii) + for comparison purposes. To generate each dataset, the photon detection times are simulated according to a Poisson process with constant rate corresponding to the expected mean photon count for (a) [0, 0.02] (b) [0, 0.2] seconds and the intervals are discretised. The photon detection locations are generated according to the Airy profile, with parameters as in Example 2.2. The true limit of accuracy (blue solid line) is also computed as it is available analytically [49]. Estimates of the limit of accuracy based on a single dataset (approach (i)) are more accurate when the dataset is long, while taking the mean outer product of the score over all datasets (approach (ii)) yields more accurate estimates for a large number of short datasets. Approach (iii) provides a good balance between the two. In general, estimates of the limit of accuracy are relatively poor for very low mean photon counts but quickly improve as it increases.

17

dataset using the SMC-FS algorithm (Algorithm 2) and averaging the estimated OIM over all generated datasets. The particle filter employed in the SMC-FS algorithm is the bootstrap filter. A large number of datasets is needed to minimise Monte Carlo error in FIM estimates, so to speed up computations we adopt a distributed computing approach: the datasets and repeat runs of the SMC-FS algorithm to estimate the OIMs are divided evenly among 60 to 64 CPUs and run in parallel. We note that for our methodology, access to a large number of CPUs is beneficial to both the accuracy of estimates and the speed at which they can be obtained. The wall clock speed of the SMC-FS algorithm is also affected by the mean photon count Nphot considered. Indeed, as described in Algorithm 2, the filtering and smoothing steps only occur in segments where a photon is observed, so the expected complexity of a full run of the SMC-FS algorithm is O(NphotN 2) where N is the size of the SMC particle population (generally N = 500).
5.1 Limit of accuracy of drift and diffusion coefficients for the Gaussian and Airy profiles
Consider a molecule with trajectory described by the SDE in Example 2.1. In [66], the authors took advantage of the Kalman filter formulae to evaluate the FIM for the diffusion (2) and drift (b) coefficients. However, it was only possible to obtain an analytic solution for a particular set of detection times t1, t2, . . . and for the 2D Gaussian photon distribution profile. Otherwise, the computational cost of performing numerical integration was too high for more than one photon.
In our particle filtering framework, it is also possible to take advantage of the Kalman filter formulae when considering the 2D Gaussian model in order to obtain an accurate approximation of the true score and OIM by numerical differentiation, and for any detection times schedule. An estimate of the FIM is therefore obtained by evaluating the true OIM for 3000 datasets and taking their mean, as described in Subsection 4.5. The molecule trajectories are simulated for [0, 0.2] seconds, with diffusion coefficient 2 = 1 µm2/s, drift coefficient b = -10 s-1, and initial location Gaussian distributed with mean x0 = (5.5, 5.5) µm and covariance P0 = 10-2I2×2 µm2. The observations for the first experiment are generated according to the 2D Gaussian profile (2.9) with parameters as in Example 2.2. It is not possible to employ the Kalman filter formulae for the Airy and Born and Wolf profiles, and we must resort to using the SMC-FS algorithm instead. First of all, to evaluate the performance of the SMC-FS algorithm, the algorithm is employed using N = 500 particles to estimate the score and OIM for the same 3000 2D Gaussian profile datasets, and we similarly take the mean OIM over all datasets to estimate the FIM. Next, we move on to the Airy profile, for which it was too computationally costly in [66] to obtain the FIM for more than a single photon. We estimate the OIM for the diffusion and drift coefficients using the SMC-FS algorithm with N = 500 particles for 2040 datasets, where the molecule trajectories are simulated using the same parameters as for the 2D Gaussian profile, and the observations are generated according to the Airy profile (2.8) with parameters as in Example 2.2. This is repeated for various mean photon counts ranging from 10 to 1250. Then, the limit of accuracy estimate, denoted ^ for hyperparameter , is computed, and the results are displayed in Figure 5.
Both Figure 5a and Figure 5b display an inverse square root decay of the limit of accuracy with respect to the mean photon count. This is consistent with the results for a static molecule from Example 4.2, and means that the quality of diffusion and drift estimates improves as the mean photon count increases. In addition to that, comparing the limit of accuracy obtained from the estimated and true OIM for the 2D Gaussian profile in Figure 5a indicates that the SMC-FS algorithm is able to return accurate estimates of the score and FIM for a stochastically moving molecule. Indeed, apart from a very slight discrepancy for very low photon counts for the drift coefficient, the estimates of the limit of accuracy are almost indistinguishable.
18

e timated limit of accuracy (2 for diffu ion coeff.
e timated limit of accuracy (b for drift coeff.
e timated limit of accuracy (2 for diffu ion coeff.
e timated limit of accuracy (b for drift coeff.

0.5 0.4 0.3 0.2 0.1
0

E timated limit of accuracy (Gau ian profile

inver e quare root fit (true OIM inver e quare root fit (e timated OIM  from true OIM  from e timated OIM

500

1000

mean photon count

0.88 0.87 0.86 0.85 0.84 0.83 0.82
0

500

1000

mean photon count

(a) 2D Gaussian profile

0.6 0.5 0.4 0.3 0.2 0.1
0

E timated limit of accuracy (Airy profile

inver e quare root fit (e timated OIM  from e timated OIM

0.90 0.88

0.86

0.84

500

1000

mean photon count

0.82 0

500

1000

mean photon count

(b) Airy profile

Figure 5: Evolution of the estimated limit accuracy for mean photon counts ranging from 10 to 1250. The limit of accuracy is estimated for the diffusion (2) and drift (b) coefficients for an in-focus molecule
with stochastic trajectory. The estimates are obtained by taking the square root of the inverse of the FIM,
obtained by estimating the OIM using the SMC-FS algorithm with 500 particles for (a) 3000 and (b)
2040 simulated datasets. To generate each dataset, the molecule's trajectory was simulated according to the SDE in Example 2.1 for the interval [0, 0.2] seconds, with 2 = 1 µm2/s, b = -10 s-1, and initial location Gaussian distributed with mean x0 = (5.5, 5.5) µm and covariance P0 = 10-2I2×2 µm2. The observations are generated according to the (a) 2D Gaussian and (b) Airy profiles, with parameters as
in Example 2.2. For the (a) 2D Gaussian profile, the limit of accuracy is also estimated by using the
true OIM obtained using numerical differentiation applied to the Kalman filter. An inverse square root
curve (orange and green dashed) is fitted to the resulting estimated limits of accuracy for comparison.

5.2 Limit of accuracy of drift, diffusion and optical axis location for the Born and Wolf model

When the molecule is out of focus, which means the photon detection locations are distributed

according to the Born and Wolf model (2.10), the FIM components for the diffusion and drift

coefficients can be obtained as for the Airy and Gaussian profiles. However, a new hyperpa-

rameter must be considered, namely the optical axis location, denoted z0. While previously,

differentiating the log potential function was not needed, the vector of hyperparameters is now

 = (2, b, z0), and Gk(xk) depends on z0 for k = 1, . . . , n.

While it requires numerical integration, differentiating log qz0(x1, x2) for a given x =

(x1, x2)  R2 with respect to z0 is not impossible.

For notational simplicity, let  :=

2n e

,

r :=

x21 + x22

and

W

:=

n2 noe

and

rewrite

(2.10)

as

2 qz0(x1, x2) = 

Uz20 + Vz20

,

where
1
Uz0 := J0 (r) cos W z02 d,
0

1
Vz0 := J0 (r) sin W z02 d.
0

The first derivative was derived in [50] and is given by

where



log qz0(x1, x2) z0

=

2

Uz0

U z0 Uz20

+ +

Vz0 Vz20

Vz0

,

U z0

:=

Uz0 z0

=

1
J0 (r) cos W z02 W 3d,
0

Vz0

:=

Vz0 z0

=-

1
J0 (r) sin
0

W z02 W 3d.

19

The second derivative with respect to z0 is given by

2 log qz0(x1, x2) z02

=

2 Uz0 U¨z0

+ U z20 + Vz0 V¨z0 Uz20 + Vz20

+ Vz20

-

 log qz0(x1, x2) z0

2
,

where

U¨z0

:=

2Uz0 z02

=-

1
J0 (r) cos
0

W z02 W 25d,

V¨z0

:=

2Vz0 z02

=-

1
J0 (r) sin
0

W z02 W 25d.

The potential function only depends on z0, so any cross terms in the FIM and OIM between z0 and either 2 or b will be zero.
The OIM is estimated for the diffusion (2), drift (b) coefficients and optical axis location (z0) using the SMC-FS algorithm with 500 particles for 2040 datasets, where the molecule trajectories are simulated using the same parameters as for the 2D Gaussian and Airy profiles, and the observations are generated according to the Born and Wolf model with parameters as in Example 2.2 (i.e. z0 = 1 µm). Then, the limit of accuracy for mean photon counts ranging from 10 to 1250 is computed, and the results are displayed in Figure 6. Once again, there is an inverse square root decay of the limit of accuracy with respect to the mean photon count for all hyperparameters considered.

e timated limit of accuracy (2 for diffu ion coeff.
e timated limit of accuracy (b for drift coeff.
e timated limit of accuracy (z0 for optical axi loc.

1.2 1.0 0.8 0.6 0.4 0.2
0

E timated limit of accuracy (Born and Wolf model

inver e quare root fit  from e timated OIM

1.15 1.10

0.20

1.05

0.15

1.00 0.10
0.95

0.90

0.05

0.85

500

1000

0

500

1000

0

mean photon count

mean photon count

500

1000

mean photon count

Figure 6: Evolution of the estimated limit accuracy for mean photon counts ranging from 10 to 1250. The limit of accuracy is estimated for the diffusion (2), drift (b) coefficients and optical axis location (z0) for an out-of-focus molecule with stochastic trajectory. The estimates are obtained by taking the square
root of the inverse of the FIM, obtained by estimating the OIM using the SMC-FS algorithm with 500
particles for 2040 simulated datasets. To generate each dataset, the molecule trajectories are simulated according to the SDE in Example 2.1 for the interval [0, 0.2] seconds, with 2 = 1 µm2/s, b = -10 s-1, and initial location Gaussian distributed with mean x0 = (5.5, 5.5) µm and covariance P0 = 10-2I2×2 µm2. The observations are generated according to the Born and Wolf model with parameters as in
Example 2.2, where z0 = 1 µm. An inverse square root curve (orange) is fitted to the resulting estimated limits of accuracy for comparison.

5.3 Limit of accuracy of the separation distance between two molecules for the Airy profile
Being able to estimate the distance of separation between two closely spaced molecules is an important aspect of single-molecule microscopy. In the past, Rayleigh's criterion [4] has been used to define the minimum distance between two point sources such that they can be distinguished in the image. However, [56] treated the separation distance problem as a statistical
20

estimation task and derived the CRLB (or inverse of the FIM) for the mean square error of the separation distance estimate. It was shown that Rayleigh's minimum distance can be surpassed by capturing more photons, e.g. by observing the molecules for a longer period. So far, the limit of accuracy has only been derived for static molecules. In this experiment, we apply our methodology to estimate the limit of accuracy for the locations and separation distance between two molecules that are not static, but diffusing independently at their respective stationary distributions, as illustrated in Figure 7.

x2-location of molecule (m) x2-location of molecule (m)

0.006 0.004 0.002 0.000 -0.002 -0.004 -0.006 -0.008

object 1 object 2 mean states

True molecule trajectories

()  0.010 m

0.06 0.04 0.02 0.00 -0.02 -0.04 -0.06 -0.08

True molecule trajectories

object 1 object 2 mean states

()  0.100 m

-0.006 -0.004 -0.002 0.000 0.002 0.004 0.006 0.008
x1-location of molecule (m)
(a)

-0.08 -0.06 -0.04 -0.02 0.00 0.02 0.04 0.06 0.08
x1-location of molecule (m)
(b)

Figure 7: Examples of two molecules diffusing independently at a mean separation distance of (a) 0.01 µm with diffusion coefficient 2 = 10-4 µm2/s (b) 0.1 µm with 2 = 10-3 µm2/s. For an Airy distributed photon detection profile with n = 1.4 and e = 0.52 µm, Rayleigh's resolution limit is  0.227 µm. Increasing the value of the diffusion coefficient 2 will often lead to the molecule trajectories
overlapping.

Let Xt = (Xt,1, Xt,2) be the cartesian coordinates of a moving molecule with stationary

distribution N (x0, 2I2×2) for all t, where x0 is referred to as the mean state. The continuous

time dynamics are given by

 dXt = (x0 - Xt)dt + 2dBt.

(5.1)

From Subsection 2.1, it is straightforward to establish the solution to this SDE, which yields the conditional pdf fx0 of Xk+1 at the (k + 1)-th discrete segment, given Xk = x at the k-th segment, as
Xk+1|(Xk = x) = x + a + Wx, Wx  N (0, R),

where  = e-, a = x0(1 - e-) and R = 2(1 - e-2)I2×2. In this experiment, consider two independently diffusing molecules whose states are (Xt, Vt),
where Xt is the state of the first molecule and Vt is the state of the second. Assume that the initial state of each molecule is the same as its corresponding mean state, i.e. (x0, v0) =:  = (1, 2, 3, 4), and is non-random but unknown and to be estimated. The conditional probability density function of (Xk+1, Vk+1) given (Xk, Vk) = (xk, vk) is fx0(xk+1|xk)fv0 (vk+1|vk) owing to their independent motions.
Let ^ = ^1(Y1:n), ^2(Y1:n), ^3(Y1:n), ^4(Y1:n)  denote an estimate of  given observations
Y1:n. Recall that the FIM, denoted In(), is given by

In() = E  log p(Y1:n)  log p(Y1:n)T .

For any scalar-valued function D()  R, we can estimate D() using D(^) where ^ is the

estimate of . Assuming the estimate is unbiased, we have the following CRLB for the function

D,

E D(^) - D() 2  D()In()-1D(),

(5.2)

21

where D() := (D/1, . . . , D/4). For example, to estimate the separation between the two molecules we have D() = (1 - 3)2 + (2 - 4)2, and as a result

 1 - 3 

D()

=

1

D()

 

2 - 4 -(1 - 3)

 

.



-(2 - 4)

This experiment is essentially the dynamic version of the experiments on estimating the separation of two static molecules by [58]. The key difference here is that the molecules are diffusing. The observations Y1:n are generated as in [58], i.e. according to the following mixture

Gk(xk, vk) =

1 - ,  [xg(yk|xk) + vg(yk|vk)] ,

if yk = , otherwise,

(5.3)

where g is the photon distribution profile given in (2.7) and  = x + v. The measurement model considered in this experiment is the Airy profile (2.8), but it is straightforward to also
apply the methodology to the 2D Gaussian profile and Born and Wolf model.
In the first part of the experiment, we analytically replicate results similar to those in [56, 58]
for two static molecules, then observe how introducing diffusion affects the progression of the
limit of accuracy D() for the separation distance (obtained using (5.2)), as this separation distance between the two molecules increases. We set x = v =  for simplicity. Evaluating D() analytically for the static case is performed as in [56], with a mean photon count, denoted Nphot, of 3000. For the dynamic case, the molecules are observed during an interval of [0, 1] seconds with the same mean photon count, and for diffusion coefficients 2 varying from 5×10-3 to 10-4 µm2/s. The parameters of the Airy profile are unchanged (i.e. n = 1.4, e = 0.52 µm), as is the lateral magnification matrix (M = 100I2×2). The estimate of the limit of accuracy is obtained by estimating the OIM for the mean locations x0 and v0 via the SMC-FS algorithm for 640 to 1024 datasets then applying (5.2). The resulting estimated limits of accuracy ^D() are given in Figure 8a. The second part of the experiment involves similarly estimating the
limits of accuracy D() for various separation distances, but this time the diffusion coefficient remains fixed, i.e. 2 = 10-4 µm2/s, and the mean photon count Nphot is set to vary between 100 and 4500. The resulting estimated limits of accuracy are given in Figure 8b.
As the separation distance D() gets closer to zero, the limit of accuracy increases, indicating
that estimates would become less accurate. Additionally, an inverse square root curve was fit
to each set of estimated limits of accuracy in Figure 8a and Figure 8b. This is consistent with
results in [56] that showed an inverse square root relationship between separation distance and Dst(at)ic for two static molecules, and indicates that these results can be generalised to dynamic molecules. Additionally, in [47], it is suggested that the limit of accuracy for the location of a static molecule, known as localisation accuracy and denoted loc, is of the form  a where
Nphot
Nphot is the mean photon count and a the standard deviation of the photon detection profile. The interpretation for this is that the quality of location estimates of a single static molecule
deteriorates as the measurement uncertainty a increases. Now in [58], it is proven that the limit of accuracy for the separation distance between two molecules Dst(at)ic and the localisation accuracy for each of these molecules are related as follows:

HNstpahot

:=

lim
D()

Dst(at)ic

=

xst0a,loc

2
+

vs0ta,loc

2
,

(5.4)

where xst0a,loc and vs0ta,loc denote the localisation accuracy for the first and second (static) molecule observed independently with cumulative mean photon count Nphot, respectively. Even though the separation distance goes to infinity, its limit of accuracy D() remains finite. This

22

means that as D()  , evaluating the limit of accuracy for the separation distance between

two (static) molecules becomes equivalent to two independent localisation accuracy problems. It also means that Dst(at)ic is similarly affected by measurement uncertainty a as are the localisation accuracies for the two molecules.

In this experiment, the introduction of diffusion negatively affects the improvement in esti-

mation accuracy as the mean distance of separation between the two molecules increases. This

is evidenced in Figure 8a by the more and more slowly decaying limits of accuracy as the value of 2 increases, and in Figure 9a by the linearly increasing trend in ^D() for all values of D() as  increases. As a result, the diffusion coefficient in the dynamic model can be translated into

additional observation uncertainty which affects D() in a way reminiscent of how a affects Dst(at)ic. More generally, from our numerical results, we observe the relationship for our dynamic application behaves qualitatively as

a2 + 2 Nphot

,

where, as above, a is the standard deviation of the photon detection process, also known as

measurement uncertainty.

We now investigate the relationship between D() and the dynamic equivalent to the lo-

calisation accuracy, namely the limit of accuracy for the mean locations x0 and v0 of each

individual, xst0o,loc and

stochastically moving molecule, denoted vs0to,loc can be estimated independently

xst0o,loc and vs0to,loc, respectively. by repeatedly taking the mean

The limits estimated

OIM for x0 and v0 based on two separate sets of 640 simulated datasets (one for each molecule)

for mean photon counts ranging from 50 to 2250 (half of Nphot each, given we have x = v = 

under current settings). The distance

HNstpohot :=

xst0o,loc

2
+

vs0to,loc 2

between the limits of accuracy xst0o,loc and vs0to,loc of each individual object with various (cumulative) mean photon counts Nphot is illustrated as horizontal lines in Figure 8b, which appear to act as asymptotes, thus indicating that the relationship in (5.4) can be generalised to stochastically moving molecules. While the introduction of diffusion leads to less accurate estimates, Figure 8b displays a stronger decay in the limit of accuracy as the mean photon count Nphot increases, thus indicating that increasing the mean photon count Nphot improves those estimates, as was the case for static molecules in [56]. This is reinforced in Figure 9b, which also suggests that the relationship between D() and Nphot is an inverse square root. This is also a generalisation to the dynamic case of results in [56] which showed an inverse square root relationship between Dst(at)ic and Nphot for two static molecules.
In summary, this experiment employs the numerical framework developed in this paper for estimating the FIM of parameters of dynamic molecules using SMC in order to gain insights into generalising results from [57, 58] about the effects of separation distance, measurement uncertainty and mean photon count to a context in which the two molecules considered follow a SDE rather than being static. These effects, as well at that of the measurement uncertainty, can all be observed by applying our methodology and are summarised in Table 1. We also summarise in Table 1 the results on the limits of accuracy for the drift and diffusion coefficients of a single stochastically moving molecule observed via the 2D Gaussian, Airy profiles and the Born and Wolf model from Subsection 5.1 and Subsection 5.2. Note that the limits of accuracy for the mean locations of each molecule, denoted  := (1 , 2, 3 , 4), can also be estimated as part of our methodology (as their FIM is required for (5.2)) and return similar relationships with separation distance, mean photon count, diffusion coefficient and measurement uncertainty as D() (not reported here).

23

Limit of accuracy 
D(),  D(),  D(),  D(),  2 , b, z0

Name
separation distance diffusion coefficient measurement uncertainty mean photon count mean photon count

Parameter
D() 2 a2
Nphot
Nphot

Relationship
O D()-1/2 O () O (a)
O Np-h1o/t2 O Np-h1o/t2

Reference
Figure 8 Figure 9a
[56, 47] Figure 9b Figure 5, Figure 6

Table 1: Summary of the qualitative relationships between various parameters and the limits of ac-
curacy  := (1 , 2 , 3 , 4 ) and D() for the mean locations  = (x0, v0) = (1, 2, 3, 4) and separation distance D(), respectively, of two stochastically diffusing molecules observed simultaneously.
Also included in the table is the relationship between mean photon count and the limits of accuracy for the hyperparameters of the SDE trajectory (drift b and diffusion 2 coefficients) and photon detection
process (optical axis location z0) of a single molecule. Note that when we increase the mean photon count Nphot, the observation interval length remains fixed.

estimated limit of acc racy (D())
for separation distance
estimated limit of accuracy (D())
for separation distance

0.14

0.09

0.12

0.08

0.10

0.07

0.08

0.06

0.06

0.05

0.04

0.04

0.02

0.00

0.00 0.05 0.10 0.15 0.20 0.25 0.30
separation distance (m)

static Rayleighs resol tion limit H3st0a00 2 = 5e - 03 m2/s
2 = 4e - 03 m2/s

2 = 3e - 03 m2/s 2 = 2e - 03 m2/s 2 = 1e - 03 m2/s 2 = 1e - 03 m2/s

2 = 8e - 04 m2/s 2 = 5e - 04 m2/s 2 = 3e - 04 m2/s 2 = 1e - 04 m2/s

0.03

0.02 0.0
H1st0o0 H2st5o0 H5st0o0

0.5

1.0

1.5

2.0

separation distance (m)

Hsto 1500
Hsto 3000
Hsto 4500

Nphot  100 Nphot  250 Nphot  500

Nphot  1500 Nphot  3000 Nphot  4500

(a)

(b)

Figure 8: Comparison of the evolution of the estimated limit accuracy for separation distances ranging

from 20 × 10-3 to 2 µm for various (a) diffusion coefficient (2) values (b) mean photon counts (Nphot). The limit of accuracy for the separation distance D(), where  = (x0, v0) = (1, 2, 3, 4), is estimated using the square root of the CRLB obtained using (5.2) (in the dynamic case) and evaluated using

analytical results from [56] (in the static case). The estimates of In() in (5.2) are obtained by running the SMC-FS algorithm with 500 particles for 640 to 1024 simulated datasets. For the dynamic case, the

molecule trajectories are initialised at their respective mean locations x0 and v0 and each is propagated according to its corresponding SDE (5.1) during an interval of [0, 1] seconds with (a) fixed and mean

photon count Nphot = 3000 (b) fixed diffusion coefficient 2 = 10-4 µm2/s. The observations are generated according to a mixture of Airy profiles (5.3) with parameters as in Example 2.2. This is

repeated for (a) 2 varying from 10-3 to 10-4 µm2/s (b) Nphot varying from 100 to 4500. Finally, an inverse square root curve is fitted to each of the resulting sets of estimated limits of accuracy for

comparison purposes. Note that the pink set of estimates and their corresponding solid fitted curve in

(a) coincide with those in (b). In (b), the horizontal lines correspond to the equivalent mean photon

counts

and

represent

the

distances

H sto
Nphot

between

the

limits

of

accuracy

^xst0o,loc

and

^vs0to,loc

for

the

mean

locations x0 and v0 of each individual object, estimated independently for each molecule using the SMC-

FS algorithm. Note that any variation in estimates for low separation distances is due to Monte Carlo

error, and can be reduced by increasing the number of simulated datasets.

24

estimated limit of accuracy (())
for separation distance
estimated limit of accuracy (D(
for separation distance

0.14 0.12 0.10 0.08 0.06 0.04

()  0.02 ()  0.03 ()  0.04 ()  0.05 ()  0.1

()  0.15 ()  0.2 ()  0.25 ()  0.3

0.09 0.08 0.07 0.06 0.05 0.04 0.03

D( = 0.02 D( = 0.03 D( = 0.04 D( = 0.05 D( = 0.1 D( = 0.15

D( = 0.2 D( = 0.25 D( = 0.3 D( = 0.5 D( = 1.0 D( = 2.0

0.02 0.01 0.02 0.03 0.04 0.05 0.06 0.07
 (ms 1/2)
(a)

0.02 0

1000 2000 3000 mean photon count
(b)

4000

Figure 9: Evolution of the estimated limit of accuracy for the separation distance D() (obtainedusing (5.2)) between two stochastically moving molecules observed simultaneously for (a)  ranging from 10-4 to 5 × 10-3 µm s-1/2 (b) Nphot ranging from 100 to 4500. Estimates are obtained through the same
algorithm and parameters as in (a) Figure 8a (b) Figure 8b, with separation distances ranging from 20 × 10-3 to 2 µm. In (b), inverse square root curves are fitted to the resulting estimates ^D() for comparison.

6 Conclusion
In this paper, we introduced an SMC approach to performing parameter inference when tracking a molecule with stochastic trajectory for a fixed time interval. The three main aspects of this fundamental model in single-molecule microscopy were the true location of the molecule in the object space, which follows a linear SDE, the Poisson distributed arrival process of the photons it emits on the detector in the image space, and the arrival location of those photons on the detector, which follows either a 2D Gaussian, Airy profile, or Born and Wolf model.
First of all, we discretised the time interval in order to formulate the problem as a discretetime state space model, in which all states are equally spaced in time, but a number of observations are marked as missing. From this, SMC methods were applied for parameter inference. A general forward smoothing algorithm was employed to estimate the score and OIM of the data regardless of the distribution of the photon locations. For the first time, this allowed for the estimation of the FIM and hence the limit of accuracy (square root of the CRLB), which could not be done before for the Airy profile and Born and Wolf model, and could only be achieved analytically for a specific set of photon detection times for the 2D Gaussian profile. The methodology was subsequently applied to characterise the precision limits for estimating the separation distance between two moving molecules, thus providing new insights into results for the static case from [58]. The outcome of our numerical work was summarised in Table 1, which sums up the qualitative behaviours of the limits of accuracy as functions of the mean photon count, separation distance, diffusion coefficient and measurement uncertainty.
Although for the first time a method has been described to estimate the limit of accuracy for the hyperparameters of dynamic single molecules with non-uniform observation times and complex measurement models, such as the Airy profile or Born and Wolf model, there is scope to use the techniques developed here to provide a wider range of more computationally efficient approaches. Indeed, an advantage of the straightforward state space model formulation of the problem is access to the vast range of filtering and smoothing algorithms available. While we employed forward smoothing, any kind of particle smoothing algorithm would be suitable, and indeed, the SMC-FS algorithm of [17] employed for forward smoothing, even though it mitigates issues related to path degeneracy, is of O(N 2) complexity. For example, the PaRIS algorithm of [54] can reduce the complexity of the algorithm to linear.

25

References
[1] T. T. Ashley and S. B. Andersson. Method for simultaneous localization and parameter estimation in particle tracking experiments. Physical Review E, 92(5):052707, 2015. 1
[2] A. J. Berglund. Statistics of camera-based single-particle tracking. Physical Review E, 82 (1):011917, 2010. 1
[3] P. J. Bickel, Y. Ritov, T. Ryden, et al. Asymptotic normality of the maximum-likelihood estimator for general hidden Markov models. The Annals of Statistics, 26(4):1614­1635, 1998. 4.5.1
[4] M. Born and E. Wolf. Principles of optics: electromagnetic theory of propagation, interference and diffraction of light. Elsevier, 2013. 1, 2.2, 2.2, 5.3
[5] V. Briane, C. Kervrann, and M. Vimond. Statistical analysis of particle trajectories in living cells. Physical Review E, 97(6):062121, 2018. 1
[6] C. P. Calderon. Motion blur filtering: a statistical approach for extracting confinement forces and diffusivity from a single blurred trajectory. Physical Review E, 93(5):053303, 2016. 1
[7] C. P. Calderon and K. Bloom. Inferring latent states and refining force estimates via hierarchical dirichlet process modeling in single particle tracking experiments. PloS one, 10(9), 2015. 1
[8] C. P. Calderon, M. A. Thompson, J. M. Casolari, R. C. Paffenroth, and W. Moerner. Quantifying transient 3d dynamical phenomena of single mrna particles in live yeast cell measurements. The Journal of Physical Chemistry B, 117(49):15701­15713, 2013. 1
[9] O. Capp´e, E. Moulines, and T. Ryd´en. Inference in hidden Markov models. Springer Science & Business Media, 2006. 4.2, 4.4.1
[10] A. Cauchy. M´ethode g´en´erale pour la r´esolution des systemes d'´equations simultan´ees. Comp. Rend. Sci. Paris, 25(1847):536­538, 1847. D.1
[11] J. Chao, E. S. Ward, and R. J. Ober. Fisher information theory for parameter estimation in single molecule microscopy: tutorial. JOSA A, 33(7):B36­B57, 2016. 1, 2, 2.3, 4.2
[12] M. K. Cheezum, W. F. Walker, and W. H. Guilford. Quantitative comparison of algorithms for tracking single fluorescent particles. Biophysical journal, 81(4):2378­2388, 2001. 2.2
[13] N. Chopin and O. Papaspiliopoulos. An introduction to sequential Monte Carlo. Springer, 2020. 4.2
[14] H. Cram´er. Mathematical methods of statistics, volume 43. Princeton university press, 1999. 1, 4.5
[15] G. Darmois. Sur les limites de la dispersion de certaines estimations. Revue de l'Institut International de Statistique, pages 9­15, 1945. 1, 4.5
[16] M. H. DeGroot and M. J. Schervish. Probability and statistics. Pearson Education, 2012. 4.5
26

[17] P. Del Moral, A. Doucet, and S. Singh. Forward smoothing using sequential Monte Carlo. arXiv preprint arXiv:1012.5390, 2010. 1, 4.3, 6
[18] P. Del Moral, A. Doucet, and A. Jasra. An adaptive sequential Monte Carlo method for approximate Bayesian computation. Statistics and Computing, 22(5):1009­1020, 2012. B
[19] P. Del Moral, A. Doucet, A. Jasra, et al. On adaptive resampling strategies for sequential Monte Carlo methods. Bernoulli, 18(1):252­278, 2012. B
[20] A. P. Dempster, N. M. Laird, and D. B. Rubin. Maximum likelihood from incomplete data via the EM algorithm. Journal of the Royal Statistical Society: Series B (Methodological), 39(1):1­22, 1977. D.2
[21] R. Douc and O. Capp´e. Comparison of resampling schemes for particle filtering. In ISPA 2005. Proceedings of the 4th International Symposium on Image and Signal Processing and Analysis, 2005., pages 64­69. IEEE, 2005. B
[22] R. Douc, E. Moulines, T. Ryd´en, et al. Asymptotic properties of the maximum likelihood estimator in autoregressive models with Markov regime. The Annals of statistics, 32(5): 2254­2304, 2004. 4.5.1
[23] R. Douc, E. Moulines, and D. Stoffer. Nonlinear time series: Theory, methods and applications with R examples. CRC press, 2014. 4.2, 4.4.1
[24] A. Doucet and A. M. Johansen. A tutorial on particle filtering and smoothing: Fifteen years later. Handbook of nonlinear filtering, 12(656-704):3, 2009. 4.2
[25] A. Doucet, S. Godsill, and C. Andrieu. On sequential Monte Carlo sampling methods for Bayesian filtering. Statistics and computing, 10(3):197­208, 2000. 4.3
[26] A. Doucet, N. de Freitas, and N. Gordon. Sequential Monte Carlo Methods in Practice. Springer Science & Business Media, 2001. ISBN 978-1-4757-3437-9. 4.2
[27] J. Duchi. Lecture notes for statistics 311/electrical engineering 377. URL: https://stanford. edu/class/stats311/Lectures/full notes. pdf, 2:23, 2016. 4.5
[28] B. Efron and D. V. Hinkley. Assessing the accuracy of the maximum likelihood estimator: Observed versus expected Fisher information. Biometrika, 65(3):457­483, 1978. 4.4
[29] L. C. Evans. An introduction to stochastic differential equations, volume 82. American Mathematical Soc., 2012. 2.1
[30] M. Fr´echet. Sur l'extension de certaines ´evaluations statistiques au cas de petits ´echantillons. Revue de l'Institut International de Statistique, pages 182­205, 1943. 1, 4.5
[31] S. J. Godsill, A. Doucet, and M. West. Monte Carlo smoothing for nonlinear time series. Journal of the american statistical association, 99(465):156­168, 2004. 4.3
[32] J. W. Goodman. Introduction to Fourier optics. Roberts and Company Publishers, 2005. 2.2
[33] N. J. Gordon, D. J. Salmond, and A. F. Smith. Novel approach to nonlinear/non-Gaussian Bayesian state estimation. In IEE proceedings F (radar and signal processing), volume 140, pages 107­113. IET, 1993. doi: 10.1049/ip-f-2.1993.0015. 4.2
27

[34] J. Houssineau, S. S. Singh, and A. Jasra. Identification of multiobject dynamical systems: Consistency and fisher information. SIAM Journal on Control and Optimization, 57(4): 2603­2627, 2019. 4.5.1
[35] M. Hu¨rzeler and H. R. Ku¨nsch. Monte Carlo approximations for general state-space models. Journal of Computational and graphical Statistics, 7(2):175­193, 1998. 4.3
[36] A. H. Jazwinski. Stochastic processes and filtering theory. Courier Corporation, 2007. 2.1
[37] G. Kitagawa. Monte Carlo filter and smoother for non-Gaussian nonlinear state space models. Journal of computational and graphical statistics, 5(1):1­25, 1996. 4.3
[38] G. Kitagawa and S. Sato. Monte Carlo smoothing and self-organising state-space model. In Sequential Monte Carlo methods in practice, pages 177­195. Springer, 2001. 4.3
[39] A. Kong, J. S. Liu, and W. H. Wong. Sequential imputations and Bayesian missing data problems. Journal of the American statistical association, 89(425):278­288, 1994. 4.2
[40] F. Le Gland and L. Mevel. Recursive identification in hidden Markov models. In Proceedings of the 36th Conference on Decision and Control, San Diego 1997, volume 4, pages 3468­ 3473, 1997. 4.4
[41] C. Lemar´echal. Cauchy and the gradient method. Doc Math Extra, 251:254, 2012. D.1
[42] Z. Lin, Y. Wong, and R. J. Ober. Limit of the accuracy of parameter estimation for two molecules moving in close proximity. In 2015 IEEE International Symposium on Circuits and Systems (ISCAS), pages 441­444. IEEE, 2015. 1
[43] X. Michalet and A. J. Berglund. Optimal diffusion coefficient estimation in single-particle tracking. Physical Review E, 85(6):061916, 2012. 1
[44] X. Michalet, A. N. Kapanidis, T. Laurence, F. Pinaud, S. Doose, M. Pflughoefft, and S. Weiss. The power and prospects of fluorescence microscopies and spectroscopies. Annual review of biophysics and biomolecular structure, 32(1):161­182, 2003. 1
[45] W. Moerner and D. P. Fromm. Methods of single-molecule fluorescence spectroscopy and microscopy. Review of Scientific instruments, 74(8):3597­3619, 2003. 1
[46] J. Nocedal and S. Wright. Numerical optimization. Springer Science & Business Media, 2006. D.1
[47] R. J. Ober, S. Ram, and E. S. Ward. Localization accuracy in single-molecule microscopy. Biophysical journal, 86(2):1185­1200, 2004. 1, 4.2, 5.3, ??, A
[48] R. J. Ober, E. S. Ward, and J. Chao. Quantitative Bioimaging: An Introduction to Biology, Instrumentation, Experimentss and Data Analysis for Scientists and Engineers. CRC Publishing, 2020. A
[49] R. J. Ober, E. S. Ward, and J. Chao. Quantitative Bioimaging: An Introduction to Biology, Instrumentation, Experimentss and Data Analysis for Scientists and Engineers, chapter Localizing Objects and Single Molecules in Two Dimensions, pages 337­375. CRC Publishing, 2020. 1, 4.2, 4
[50] R. J. Ober, E. S. Ward, and J. Chao. Quantitative Bioimaging: An Introduction to Biology, Instrumentation, Experimentss and Data Analysis for Scientists and Engineers, chapter Localizing Objects and Single Molecules in Three Dimensions, pages 377­401. CRC Publishing, 2020. 1, 4.2, 5.2
28

[51] B. Oksendal. Stochastic differential equations: an introduction with applications. Springer Science & Business Media, 2013. 1
[52] J. Olsson, O. Capp´e, R. Douc, E. Moulines, et al. Sequential Monte Carlo smoothing with application to parameter estimation in nonlinear state space models. Bernoulli, 14 (1):155­179, 2008. 4.3
[53] J. Olsson, J. Stro¨jby, et al. Particle-based likelihood inference in partially observed diffusion processes using generalised poisson estimators. Electronic Journal of Statistics, 5:1090­ 1122, 2011. 4.3
[54] J. Olsson, J. Westerborn, et al. Efficient particle-based online smoothing in general hidden Markov models: the PaRIS algorithm. Bernoulli, 23(3):1951­1996, 2017. 1, 4.3, 6, 11
[55] G. Poyiadjis, A. Doucet, and S. S. Singh. Particle approximations of the score and observed information matrix in state space models with application to parameter estimation. Biometrika, 98(1):65­80, 2011. 4.4, 4.4.1
[56] S. Ram, E. S. Ward, and R. J. Ober. Beyond Rayleigh's criterion: a resolution measure with application to single-molecule microscopy. Proceedings of the National Academy of Sciences, 103(12):4457­4462, 2006. 1, 5.3, 5.3, 5.3, ??, 8
[57] S. Ram, E. S. Ward, and R. J. Ober. A stochastic analysis of performance limits for optical microscopes. Multidimensional Systems and Signal Processing, 17(1):27­57, 2006. 1, 2.2, 5.3
[58] S. Ram, E. S. Ward, and R. J. Ober. A stochastic analysis of distance estimation approaches in single molecule microscopy: quantifying the resolution limits of photon-limited imaging systems. Multidimensional systems and signal processing, 24(3):503­542, 2013. 1, 5.3, 5.3, 5.3, 6
[59] C. R. Rao. Information and the accuracy attainable in the estimation of statistical parameters. In Breakthroughs in statistics, pages 235­247. Springer, 1992. 1, 4.5
[60] P. K. Relich, M. J. Olah, P. J. Cutler, and K. A. Lidke. Estimation of the diffusion constant from intermittent trajectories with variable position uncertainties. Physical Review E, 93 (4):042401, 2016. 1
[61] M. J. Saxton. Single-particle tracking: the distribution of diffusion coefficients. Biophysical journal, 72(4):1744, 1997. 1
[62] M. J. Saxton and K. Jacobson. Single-particle tracking: applications to membrane dynamics. Annual review of biophysics and biomolecular structure, 26(1):373­399, 1997. 1
[63] S. Shashkova and M. C. Leake. Single-molecule fluorescence microscopy review: shedding new light on old problems. Bioscience reports, 37(4):BSR20170031, 2017. 1
[64] S. Stallinga and B. Rieger. Accuracy of the Gaussian point spread function model in 2D localization microscopy. Optics express, 18(24):24461­24476, 2010. 2.2
[65] R. E. Thompson, D. R. Larson, and W. W. Webb. Precise nanometer localization analysis for individual fluorescent probes. Biophysical journal, 82(5):2775­2783, 2002. 2.2
[66] M. R. Vahid, B. Hanzon, and R. J. Ober. Fisher information matrix for single molecules with stochastic trajectories. SIAM Journal on Imaging Sciences, 13(1):234­264, 2020. doi: 10.1137/19M1242562. 1, 2, 2.3, 5.1
29

[67] Y. Wong, Z. Lin, and R. J. Ober. Limit of the accuracy of parameter estimation for moving single molecules imaged by fluorescence microscopy. IEEE Transactions on Signal Processing, 59(3):895­911, 2010. 1
[68] C. J. Wu. On the convergence properties of the EM algorithm. The Annals of statistics, pages 95­103, 1983. D.2
[69] B. Zhang, J. Zerubia, and J.-C. Olivo-Marin. Gaussian approximations of fluorescence microscope point-spread function models. Applied optics, 46(10):1819­1829, 2007. 2.2

A Validity of the time discretisation

Given a realisation of the observations (t1, yt1), . . . , (tn, ytn) observed in the time interval [t0, T ], we adopt a discrete time formulation in our methodology where [t0, T ] is divided into segments of length . We assume the discretisation is fine enough so that an interval (k, k + ]
contains at most one arrival time ti. We now prove in Proposition A.1 that this discretisation is a valid approximation of the homogeneous Poisson process which is used in [47, 48] to describe
photon detection.

Proposition A.1. Let the photon detection process {N (t)}tt0 be a homogeneous Poisson process with photon detection rate  > 0. The probability of observing k photons during the time interval [t, t + h] for t  t0 and h > 0 is

P (N (t

+

h)

-

N (t)

=

k)

=

exp

[-h] k!

(h)k

.

(A.1)

Discretise the interval [t, t + h] into segments of length , so that a single segment contains at most one arrival time. Then as   0, the probability of observing k is also given by (A.1).

Proof. Discretising the interval into segments of length  as such, we now have for this interval

a Binomial random variable M  Binomial(

h 

, ) with

h 

trials, with probability of

success (i.e. a photon is observed)  and probability of failure (i.e. no photon is observed)

1 - . The probability observing k photons in the interval [t, t + h] is

P (M = k) =

h 
k

()k

(1

-

)

h 

-k

.

Taking the limit as   0, we have

lim
0

P

(M

=

k)

=

lim
0

h 

h 

!

-k

()k

(1

-

)

h 

-k

!k!

= lim
0

h 

k +O

k!

h k-1 

()k (1

-

)

h 

-k

=

lim
0

k

h 
k!

k

k

(1

-

)

h 

-k

.

Employing the following property of the ceiling function

h 



h 

<

h 

+

1,

30

we have

lim
0

k

h 
k!

k

k

(1

-

)

h 

-k

=

lim
0

hk k!

k (1

-

)

h 

-k

=

lim

(h)k

(1

-

)

h 

-k

0 k!

k



lim P
0

(M

=

k)

<

lim
0

h 

+

1

k!

k

k

(1

-

)

h 

+1-k



lim
0

P

(M

=

k)

<

lim
0

(h

+ )k k!

k (1

-

)

h 

+1-k



lim
0

P

(M

=

k)

<

lim
0

(h)k k!

(1

-

)

h 

-(k-1)

.

Finally, employing the following results

lim

(1

-

)

h 

=

lim

0

h 



1

-

h
h



h 
= exp(-h),

lim (1 - )-k = lim (1 - )-(k-1) = 1,

0

0

yields the desired probability

lim P
0

(M

=

k)

=

(h)k k!

exp(-h).

This paper mainly considers the situation in which  is a scalar, but this proof can be generalised to the situation where the Poisson process is inhomogeneous. As suggested in Proposition A.1, the approximation of the Poisson process becomes increasingly more accurate as the discrete segment length  becomes smaller.

B Particle filtering in single-molecule microscopy
Given our reformulation of the fundamental model as a discrete state space model, a particle filter, summarised in Algorithm 3, can be applied to track the state of stochastically moving particles. There are several approaches to resampling, studied in [21, 19, 18]. In this paper, we refer to the resampling step of algorithms as
(k1:N), k(1:N) := resample k(1:N) .
An example of particle filtering for for stochastically moving molecules observed through the 2D Gaussian, Airy and Born and Wolf models is available in Example B.1.
Example B.1. Let the trajectory of a molecule be given by the SDE in Example 2.1 and simulated three times (one for each measurement model) using the same parameters and for the same time interval. Observations are generated as per in Example 2.2 for the 2D Gaussian, Airy profiles and Born and Wolf model and the molecules are tracked using the bootstrap filter. The resulting estimated trajectories for each measurement model are given in Figure 10.

C Sufficient statistic for estimating the OIM by forward smoothing

In Example 4.1, recall that the molecule trajectory is described by the following SDE in d-

dimensional space

 dXt = bId×dXtdt + 2dBt,

31

Algorithm 3 Generic particle filter

Where (i) appears, the operation is performed for all i  {1, . . . , N }.

Initialise at k = 1:

1: Sample X1(i)  1 where 1 is the initial user-defined proposal density.

2: Initialise importance weights w1

X1(i)

= G1 X1(i)  X1(i)
1 X1(i)

and normalise to obtain 1(i).

Given weighted particle sample Xk(1-:N1 ), k(1-:N1 ) ,

3: for k = 2, . . . , n do

4:

(Resample) (k1:N), k(1:N) := resample k(1:N) .

5:

(Propagate) Sample Xk(i)  k ·|Xk(-(ki1)) , where k is the proposal density.

6: (Weight) Compute the incremental weights

w~

Xk(-(ki1)), Xk(i)

Gk Xk(i) f Xk(i)|Xk(-(ki1))

=

k Xk(i)|Xk(-(ki1))

,

then update and normalise the importance weights to obtain k(i). 7: end for

x1-location of molecule (m) x1-location of molecule (m) x1-location of molecule (m)

Estimated molecule trajectory, Gaussian model

4.5

observed (scaled)

true

4.0

estimated

3.5

3.0

2.5

2.0

1.5

2.0 2.5 3.0 3.5 4.0 4.5 x2-location of molecule (m)

Estimated molecule trajectory, Airy model
5.0 observed (scaled)

4.5

true

estimated

4.0

3.5

3.0

2.5

2.0

1.5

1.0

0.5

1

2

3

4

5

x2-location of molecule (m)

E5.s0timated molecule trajectory, Born and Wolf model

observed (scaled)

4.5

true estimated

4.0

3.5

3.0

2.5

2.0

1.5

1.0 1.0 1.5 2.0 2.5 3.0 3.5 4.0 4.5 5.0 x2-location of molecule (m)

Figure 10: Estimated molecule trajectories for the 2D Gaussian (left), Airy (middle) profiles and Born and Wolf model (right). The scaled observations (i.e. divided by m) for each measurement model are displayed for information.

32

where in the drift term, b = 0, in the diffusion term,  > 0, and (dBt)t0tT is a Wiener process. The log transition density can be written as

log

f (xk|xk-1)

=

-

d 2

log

22

+

d 2

log(b)

-

d 2

log

e2b - 1

b -

xk - ebxk-1 22(e2b - 1)

2
,

(C.1)

where x 2 = xx =

d i=1

x2i

for

d-dimensional

vector

x.

To obtain the sufficient statistics

in (4.12) and (4.13), if the photon location process is distributed according to the Airy or 2D

Gaussian profiles, it suffices to take the gradient and Hessian of the log transition density in

(C.1) with respect to the diffusion 2 and drift b coefficients, i.e.

 log f (xk|xk-1) =

g1 g2

,

2 log f (xk|xk-1) =

H11 H21

H12 H22

,

where

· Gradient w.r.t 2

g1

:=

-

d 22

b +

xk - ebxk-1 24 (e2b - 1)

2
.

· Gradient w.r.t b

g2

:=

d 2b

-

de2b (e2b - 1)

-

xk - ebxk-1 2 22(e2b - 1)

+

beb(xk - ebxk-1)xk-1 2(e2b - 1)

+

xk

- ebxk-1 2(e2b -

2 be2b 1)2

.

· Hessian w.r.t 2 then 2

H11

:=

d 24

-

b

xk - ebxk-1 6 (e2b - 1)

2
.

· Hessian w.r.t b then 2 and vice versa

H12 = H21 :=

xk - ebxk-1 2 24(e2b - 1)

-

beb(xk - ebxk-1)xk-1 4(e2b - 1)

-

xk

- ebxk-1 4(e2b -

2 be2b 1)2

.

· Hessian w.r.t b then b

H22

:=

-

d 2b2

-

2d2e2b e2b - 1

+

2d2e4b (e2b - 1)2

+

xk xk 2

2e2b + 22be2b (e2b - 1)2

-

42be4b (e2b - 1)3

+

xk xk-1 2

2eb + 2beb e2b - 1

-

4e3b + 82be3b (e2b - 1)2

+

82be5b (e2b - 1)3

-

xk-1xk-1 2

2e2b + 22be2b e2b - 1

-

2e4b + 62be4b (e2b - 1)2

+

42be6b (e2b - 1)3

.

33

D Parameter estimation
Being able to estimate the biophysical parameters of the molecular interactions is very important in single-molecule tracking. In this section, we present two maximum likelihood (ML) estimation methods that make use of smoothed additive functionals.

D.1 By gradient ascent
Given observations y1:n of size n  N, the marginal log-likelihood of the observations p(y1:n) may be maximised via the steepest ascent algorithm [41, 10]:

i+1 = i + i+1Gn(i),

(D.1)

where Gn(i) the step-size

s=equelnogcep{(yi1}: in=)1|=coinsisisttsheofscsomrealvl epcotosirtievvealnuuamtebderast

the and

current estimate satisfies i i =

i, 

and and

i i2 < ; for example, take i = i-a where 0.5 < a < 1. One can also include the observed

information matrix in order to follow the Newton-Raphson algorithm described in [46]. In this

case, (D.1) becomes

i+1 = i - i+1Hn(i)-1Gn(i),

where Hn(i) = 2 log p(y1:n)|=i is the observed information matrix evaluated at the current estimate i.

D.2 By expectation-maximization (EM)
Another approach to obtaining maximum likelihood estimates of the hyperparameters  is to use the expectation-maximization (EM) algorithm by [20, 68] defined as follows:

· Expectation step: given the current parameter estimate i and observations y1:n,

Q(, i) = Ei [log p(X1:n, y1:n)|y1:n] ,

where the joint density p(x1:n, y1:n) is defined in (4.2) and the expectation is with respect to the posterior pi(x1:n|y1:n).

· Maximisation step:

i+1 = argmax Q(, i).


Recall that the Expectation step cannot be done exactly when using the Airy or Born and Wolf

profile. In this case, the posterior expectation can be estimated using particle approximations of

smoothed additive functionals. First of all, let Sk(x1:k) := log p(x1:k, y1:k) denote the additive

functionals of interest at step k.

n k=1

sk(xk-1,

xk )

are

given

by

Their

corresponding

sufficient

statistics

such

that

Sk (x1:k )

=

sk(xk-1, xk) := log f (xk|xk-1) + log Gk(xk),

where for notational simplicity, f (x1|x0) := (x1). In the Maximisation step, define the function  to obtain the maximising argument of Q(, i),

i+1 =  n-1E Sni (X1:n)|y1:n ,

An example of parameter estimation of the drift and diffusion coefficients based on Example 4.1 using EM is available in Example D.1.

34

Example D.1. Building on Example 4.1, note that given the model specification in (4.14), it is impossible to compute the maximum of Q(, i) for the parameter b = 0 directly. However, as seen previously, the equation can also be written such that we simply have

Xk = Xk-1 + Wx, Wx  N (0, rI2×2) ,

where the auxiliary parameters are given by

 := eb

and

r

:=

2 b

e2b - 1

.

It is straightforward to maximise Q(, i) for the auxiliary parameters  and r as follows: let {Sl,k(x1:k)}3l=1 denote the additive functionals of interest at time k and {sl,k(xk-1, xk)}3l=1 their corresponding sufficient statistics. Luckily, the sufficient statistics are easily obtained, since for the Gaussian and Airy profiles, the likelihood Gk does not depend on :

s1,k(xk-1, xk) = xkxk-1, s2,k(xk-1, xk) = xk-1xk-1, s3,k(xk-1, xk) = xkxk.

The maximisation function is given by

(c1, c2, c3) =

c3 2

-

c21 2c2

,

c1 c2

.

Finally, to obtain maximum likelihood estimates for b and 2, simply use the following trans-

formation:

b = -1 log  and

2

=

r log  (2 - 1)

.

Note that when dealing with measurements distributed according to the Born and Wolf model,

we must also estimate the optical axis location parameter z0, which is done via gradient ascent.

drift coefficient (b) estimate diffusion coefficient () estimate

2.00 1.75 1.50 1.25 1.00 0.75
0
10 0
-10 -20 -30

20

40

60

80

100

120

140

iteration

0

20

40

60

80

100

120

140

iteration

Figure 11: Estimates of the diffusion (2) and drift (b) coefficient over 150 EM iterations or passes through the data. The blue and red dashed lines represent the true parameter values 2 = 1 µm2/s and b = -10 s-1, respectively. The red and blue solid lines and bands correspond to the mean estimates and
their corresponding 95% confidence intervals over 50 datasets generated during the time interval [0, 0.2]
seconds, with initial location x0 = (5.5, 5.5) µm and a mean photon count of 1000. The observations were generated according to the Airy profile with parameters as in Example 2.2 and the sufficient statistics
were estimated using the PaRIS algorithm [54].

35

E Score and OIM for a static molecule observed via the Airy profile

In Example 4.2, we consider the problem of estimating the FIM for the location parameters

(x1, x2) of an in-focus static molecule. This is achieved by computing the score and OIM for

the observed data. If the photon detection locations are described by the 2D Gaussian profile,

the differentiation is straightforward, but in the case of the Airy profile (2.8), the computations

are more involved.

Given observation y  R2 and invertible lateral magnification matrix M  R2×2, for nota-

tional simplicity let v := M -1y, r :=

(v1 - x1)2 + (v2 - x2)2

and



:=

2n e

.

The

log

photon

distribution profile (2.7) is given by

log g(y) = - log (|M |) + log q(y),

where the image function is

q(y)

=

J12(r) r2

.

First

of

all,

use

the

relation

 x

x-nJn

(x)

=

-x-nJn+1(x)

for

n



N

in

order

to

obtain

the

gradient and hessian of q(y). Where the subscript i appears, the result is valid for i = 1, 2

q(y) xi

=

2 

(vi

-

xi)

J1(r) r

J2

(r) r2

,

2q(y) x2i

=

22 r4

(vi

-

xi)2

J1(r)J3(r) + J22(r)

-

2 

J1(r) r

J2(r) r2

,

2q(y) x1x2

=

22 r4

(v1

-

x1) (v2

-

x2)

J1(r)J3(r) + J22(r)

.

To derive the components of the gradient and hessian of log q(y), we make use of the following identities:



log

q(y)

=

q(y) q(y)

,

2

log q(y)

=

2q(y) q(y)

-

[ log q(y)]2

.

Therefore, for i = 1, 2, the components of the log gradient are given by



log q(y) xi

=

2 r

J2(r) J1(r)

(vi

-

xi) ,

and the diagonal components of the log hessian are

[log q(y)]2 x2i

=

22 r2

(vi

-

xi)2

J3(r) J1(r)

-

J22(r) J12(r)

-

2 r

J2(r) J1(r)

.

And finally, the cross terms are given by

[log q(y)]2 x1x2

=

22 r2

(v1

- x1) (v2

- x2)

J3(r) J1(r)

-

J22(r) J12(r)

.

To summarise, the log gradient and negative log hessian for the Airy profile are

 log g(y) = (M -1y - x), -2 log g(y) = (M -1y - x)(M -1y - x) + I2×2,



=

2 r

J2(r) J1(r)

,



=

-

22 r2

J3(r) J1(r)

-

J22(r) J12(r)

.

36

