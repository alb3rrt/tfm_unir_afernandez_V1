arXiv:2106.01511v1 [astro-ph.GA] 3 Jun 2021

MNRAS 000, 1­21 (0000)

Preprint 4 June 2021

Compiled using MNRAS LATEX style file v3.0

A New Model For Including Galactic Winds in Simulations of Galaxy Formation II: Implementation of PhEW in Cosmological Simulations
Shuiyao Huang1, Neal Katz1, J'Neil Cottle2, Evan Scannapieco2, Romeel Dav´e3,4,5, & David H. Weinberg6,7
1 Astronomy Department, University of Massachusetts, Amherst, MA 01003, USA 2 School of Earth and Space Exploration, Arizona State University, P.O. Box 871404, AZ 85287-1404, USA 3 Institute for Astronomy, Royal Observatory, University of Edinburgh, Edinburgh EH9, 3HJ, UK 4 University of the Western Cape, Bellville, Cape Town 7535, South Africa 5 South African Astronomical Observatories, Observatory, Cape Town 7925, South Africa 6 Astronomy Department and CCAPP, Ohio State University, Columbus, OH 43210, USA 7 Institute for Advanced Study, Princeton, NJ 08540, USA
Accepted 0000 October 00. Received 0000 October 00; in original form 0000 October 00
ABSTRACT
Although galactic winds play a critical role in regulating galaxy formation, hydrodynamic cosmological simulations do not resolve the scales that govern the interaction between winds and the ambient circumgalactic medium (CGM). We implement the Physically Evolved Wind (PhEW) model of Huang et al. (2020) in the GIZMO hydrodynamics code and perform test cosmological simulations with different choices of model parameters and numerical resolution. PhEW adopts an explicit subgrid model that treats each wind particle as a collection of clouds that exchange mass, metals, and momentum with their surroundings and evaporate by conduction and hydrodynamic instabilities as calibrated on much higher resolution cloud scale simulations. In contrast to a conventional wind algorithm, we find that PhEW results are robust to numerical resolution and implementation details because the small scale interactions are defined by the model itself. Compared to conventional wind simulations with the same resolution, our PhEW simulations produce similar galaxy stellar mass functions at z  1 but are in better agreement with low-redshift observations at M < 1011M because PhEW particles shed mass to the CGM before escaping low mass halos. PhEW radically alters the CGM metal distribution because PhEW particles disperse metals to the ambient medium as their clouds dissipate, producing a CGM metallicity distribution that is skewed but unimodal and is similar between cold and hot gas. While the temperature distributions and radial profiles of gaseous halos are similar in simulations with PhEW and conventional winds, these changes in metal distribution will affect their predicted UV/X-ray properties in absorption and emission.
Key words: hydrodynamics - methods: analytical - galaxies: outflow

1 INTRODUCTION
Galactic winds have been ubiquitously observed in galaxies at both low and high redshifts, and they are critical to galaxy formation and evolution. Simulations calibrated to match these observations predict that most galactic material is ejected as a wind before reaccreting to either form stars or be ejected once again (Oppenheimer et al. 2010; Angl´es-Alc´azar et al. 2017). Current cosmological hydrodynamic simulations of galaxy formation employ a variety of sub-grid models (e.g. Springel & Hernquist 2003; Oppenheimer & Dav´e 2006; Stinson et al. 2006; Dalla Vecchia & Schaye 2008; Agertz et al. 2013; Schaye et al. 2015; Dav´e et al. 2016;
 E-mail:shuiyao@astro.umass.edu
© 0000 The Authors

Tremmel et al. 2017; Pillepich et al. 2018; Dav´e et al. 2019; Huang et al. 2020a) that artificially launch galactic winds, but the results are sensitive to numerical resolution and the exact sub-grid model employed (Huang et al. 2019, 2020a). Simulations without these sub-grid wind models (e.g. Hopkins et al. 2018; Kim & Ostriker 2015; Martizzi et al. 2016) allow winds to occur "naturally", but these simulations may not resolve the scales necessary to resolve the important known physical processes (Scannapieco & Bru¨ggen 2015; Bru¨ggen & Scannapieco 2016; Schneider & Robertson 2017; McCourt et al. 2018; Huang et al. 2020b). Hence, modelling galactic winds accurately remains a theoretical challenge for even the most refined high-resolution simulations of galaxies (see Naab & Ostriker (2017), for a review). Even if one were able to accurately model the formation of galactic winds, the subsequent propagation in galactic haloes de-

2 S. Huang et al.
pends on a complicated interplay of many physical processes that occur on a wide range of physical scales that cannot be simultaneously resolved in a single simulation. For example, to robustly model the propagation and disintegration of moving clouds in various situations requires cloudcrushing simulations with at least sub-parsec scale resolution (Schneider & Robertson 2017; McCourt et al. 2018), which is orders of magnitudes below the resolution limits of cosmological simulations. Furthermore, most cosmological hydrodynamic simulations concentrate their resolution in the dense, star-forming regions of galaxies and thus have lower resolution in the circumgalactic medium (CGM, but see Hummels et al. 2019; Mandelker et al. 2019; Peeples et al. 2019; van de Voort et al. 2019).
Owing to the complicated nature of galactic winds, the sub-grid wind models used to launch the winds vary widely among different cosmological simulations. The results from these simulations are sensitive to the details of the wind implementation and the wind model parameters (Huang et al. 2020a). They are resolution-dependent due to the poorly understood interaction between the numerical resolution and the numerical method used to solve the hydrodynamics. For example, Huang et al. (2020a) found that a small change in the initial wind velocities may result in large differences in the amounts of wind re-accretion. Furthermore, the results are not only sensitive to how the winds are launched from galaxies but also to their subsequent evolution and interaction with the surrounding medium.
Inadequate resolution and over-simplified wind models may also affect wind material in the CGM and the intergalactic medium (IGM). Observational evidence shows that the CGM is composed of multi-phase gas on a range of physical scales (Tumlinson et al. 2017), many of which are not resolvable in cosmological simulations (McCourt et al. 2018). Current wind models do not self-consistently account for the multiphase sub-structure of the wind particles in simulations.
In Huang et al. (2020b), we developed an analytic model, Physically Evolved Winds (PhEW), which predicts the evolution of a cold cloud that travels at supersonic speeds through an ambient medium. The PhEW model explicitly calculates various properties of the evolving cloud, such as the cloud mass, Mc, the cloud velocity relative to the ambient medium, vrel, the cloud density, c, and the cloud temperature Tc as the cloud travels. The model includes physical processes such as shocks, hydrodynamic instabilities and thermal conduction simultaneously in the calculation, and we tuned the cloud evolution model to match the numerical results from high resolution cloud-crushing simulations of Bru¨ggen & Scannapieco (2016) (hereafter, BS16) with thermal conduction and radiative cooling under many conditions.
In this paper, we describe a method to implement our analytic PhEW model into cosmological simulations. Though in this paper we detail implementation in the gizmo (Hopkins 2015) hydrodynamics code, the method could be generalised to any cosmological hydrodynamic simulation including galactic winds. Even if the hydrodynamic method does not explicitly involve the use of gas particles, wind particles could be temporarily created, propagated using the PhEW model, and then destroyed in a way that conserved all the important quantities (e.g. Genel et al. 2013). In our approach, we eject wind particles as in our previous particlebased or mass-conserving simulations (Oppenheimer & Dav´e
MNRAS 000, 1­21 (0000)

2006; Huang et al. 2020a) but follow their evolution in the ambient CGM differently. We model each wind particle as an ensemble of identical cloudlets that travel at the same speed, with each of the individual cloudlets evolved using the PhEW model. As a result, unlike in previous simulations, the wind particles in a simulation with the PhEW model can lose mass and metals to their neighbouring particles.
Relative to previous simulations of the CGM (Oppenheimer & Dav´e 2009; Dav´e et al. 2010; Oppenheimer et al. 2012; Ford et al. 2013, 2014, 2016), PhEW incorporates an approximate but explicit description of the physics on scales that cannot be resolved by hydrodynamic simulations, yields predictions that are less sensitive to the hydrodynamic resolution (as we show below), and allows a physically realistic treatment of metal mixing between winds and the ambient CGM.
The paper is organised as follows. In Section 2, we provide details of the numerical implementation of the PhEW model in cosmological simulations and discuss the assumptions and choices we make. In Section 3, we describe several test simulations that we perform to study the effects of the PhEW model. In Section 4, we study the properties and behaviours of individual PhEW particles in our test simulations and how they depend on the wind parameters and numerical resolution. In Section 5, we analyse the stellar and gas properties of galaxies in these simulations. We demonstrate how galaxies acquire their mass and metals differently with and without the PhEW model. In Section 6, we summarise our main results.
2 IMPLEMENTATION
In this section, we describe the implementation of the PhEW model into hydrodynamic simulations of galaxy formation as a sub-grid recipe for evolving galactic winds. We will describe the method based on our own simulations that use a particle-based hydro solver, e.g., smoothed particle hydrodynamics (SPH, Oppenheimer & Dav´e 2006; Dav´e et al. 2019; Huang et al. 2020a) or GIZMO with meshless finitemass (MFM, Hopkins 2015).
Here, we focus on the propagation of wind particles in galactic haloes after they have escaped the galaxies from which they were ejected. Huang et al. (2020a) describe the ejection of wind particles in our cosmological simulations in detail.
To summarise, at each time-step we find gas particles that are above a density threshold, SF, equivalent to a hydrogen number density of nH = 0.13 cm-3, and treat them as starforming particles. In addition, we use an on the fly friends-offriends algorithm to identify the dark matter haloes to which these star-forming particles belong and calculate the velocity dispersion, gal, of those haloes. Then we select star-forming particles randomly to eject as wind particles at a rate proportional to the mass loading factor w, giving each of them

an initial wind velocity vw. Both w and vw are functions of gal (Huang et al. 2020a):


  w = 

150 km s-1 gal
150 km s-1 gal

ezw  gal

(gal < ezw)

(gal ezw)

(1)

where we choose the free parameters,  = 0.1,  = 4.0 and ezw = 106 km s-1, for all simulations in this paper. We also allow w to change with redshift as w  (1 + z)1.3 at z < 4 and use a constant factor of 51.3 at z > 4.
The formula for the initial wind velocity, vw, is

vw = vgal

fL

gal 50 km s-1

v
,

(2)

where fL is a metallicity dependent ratio between the galaxy luminosity and the Eddington luminosity. We adopt the Oppenheimer & Dav´e (2006) formula for fL:

fL = fL; × 10-0.0029(log , Zgal+9)2.5+0.417694

(3)

where we choose fL; = 2 as in Oppenheimer & Dav´e (2006) so that fL typically ranges from 1.05 to 2. We also use the mass weighted average metallicity Zgal of the host galaxy to compute fL. In this paper, we use v = 3.5, v = 0.6 for all simulations.
After ejecting the wind particles, we temporarily let each of them move out freely, experiencing only gravitational accelerations, until the ambient density decreases below th = 0.1SF. At this time we start modelling the wind particle as a PhEW particle using the analytic method from Huang et al. (2020b).
We assume that each PhEW particle of mass Mi and velocity vi represents Nc identical cloudlets, each with the same initial mass Mc and velocity vi, which is the same as the wind particle velocity. The number of cloudlets in a PhEW particle, Nc = Mi/Mc, depends on the mass resolution (Mi) and the choice of the model parameter Mc. These cloudlets evolve identically and independently according to the analytic model. Therefore, the PhEW particle that represents these cloudlets has the same phase properties as each individual cloudlet.
At each time-step, we evaluate the properties of the ambient medium using the same kernel as that used for the hydrodynamics solver. In a SPH or a MFM simulation, one defines the kernel as a normalised, spherically symmetric function W (r/hi), (r < hi) for each gas particle, where r is the distance from the particle and the hi is the softening length of the particle. We determine the softening length hi of each particle by specifying a fixed number of neighbouring gas particles, i.e., Nngb = 128, within the kernel. We determine the ambient density a, the ambient temperature Ta, and the ambient metallicity Za using the kernel smoothed values from the neighbouring particles:

Nngb

a =

mj Wij ,

(4)

j

Ta =

µmH kB

Nngb j

mj uj Wij

Nngb j

mj Wij

,

(5)

Implementation of PhEW 3

and

Za =

Nngb j

mj Zj Wij

Nngb j

mj Wij

,

(6)

where Wij  W (|r i - r j |/hi), mj, uj and Zj are the mass, specific internal energy, and metallicity of a neighbouring particle j, and µ, mH and kB are the atomic weight, hydrogen mass, and the Boltzmann constant, respectively. One can derive the thermal pressure of the ambient medium from these properties as

Pa

=

akBTa µmH

.

(7)

We determine the relative velocity between the cloudlets and the ambient medium similarly, but only include the neighbouring particles that move against the PhEW particle as we are only concerned with converging flows where shocks can develop:

vrel =

Nngb j

mj Vij |v

i

-

v j |Wij

Nngb j

mj Vij Wij

,

(8)

where

Vij =

1, 0,

v i · (v j - v i)  0; v i · (v j - v i) < 0.

(9)

At the first time-step when a wind particle becomes a PhEW particle, we initialise the cloudlet properties as if they have just been swept by the cloud-crushing shock. We set the initial temperature of the cloudlet to be 104 K assuming the shock is isothermal, and set the initial pressure Pc, density c, radius Rc and length Lc of each cloudlet as follows (Huang et al. 2020b).

Pc = Pa



2 +

1

M2

-

 

- +

1 1

s s ,

(10)

where M is the Mach number of the ambient flow relative to the cloudlet, s and s are the corrections to the jump conditions for density and temperature owing to thermal conduction with

s

=

5(1

+

s) + 9 + 16q^s + 5s(5s 8(1 - q^s + 5s)

-

6)

(11)

and

s

=

1 2

-

4q^s 3

+

1 6

(1+s

)

9

+

16q^s

+

5s (5s

+

6)+

5 6

s(s-6),

(12)

where q^s is a parameter chosen as 0.9 and s is defined as s  1/(M2).
The density, radius, and length of the cloudlet are

c

=

µmH 104 K · kB

Pc

,

(13)

1

Rc =

Mc 2c

3
,

and

(14)

Lc = 2Rc.

(15)

At each succeeding time-step, we first obtain the properties of the ambient medium using Equation 4 to Equation 8, and

MNRAS 000, 1­21 (0000)

4 S. Huang et al.

then calculate how each cloudlet will evolve according to the analytic model. Namely, we find the mass loss rate M c, the deceleration v i, and the changes in the geometric parameters of the cloudlet, i. e., Rc and Lc, as described in Huang et al. (2020b).
We assume that the cloudlets lose their mass to the ambient medium owing to hydrodynamic instabilities and also thermal evaporation. We calculate the total mass loss rate of a cloudlet combining these two effects as (Equation 43 from Huang et al. (2020b))

M c = M c,KH exp(-Rc/KH) + M c,ev,

(16)

where M c,KH and M c,ev are mass loss rate from hydrodynamic instabilities and evaporation alone, respectively.

M c;KH

=

Mcvrel

,

fKH1/2Rc 1 + M

(17)

where fKH is a free parameter that controls the growth rate of the KHI,   c/a is the density contrast between the cloudlets and their ambient medium.

M c;ev = 1.8RcLcm^ A,

(18)

where m^ A is the average mass loss rate per unit area from evaporation (Huang et al. 2020b).
In a cool ambient medium, thermal evaporation is negligible, while in a hot ambient medium, where thermal conduction is efficient, we suppress the mass loss rate from hydrodynamic instabilities by a factor of exp(-Rc/KH). The cloudlet size relative to a characteristic scale KH determines whether or not thermal conduction is strong enough to suppress the Kelvin-Helmholtz instability:

KH

=

1+ 1/2

1 M(M2

+ 3)

fs  na Ta1/2

4µmH  3 kB3

1/2
,

(19)

where na is the number density of atoms in the ambient medium.
The cloudlets decelerate owing to ram pressure Pram (and gravitational) forces. The ram pressure in front of a cloudlet is (McKee & Cowie 1975; Huang et al. 2020b)

 Pa Pram = Pa

2 +1

M2

-

-1 +1

5

1

+

M2 3

2,

s s ,

M > 1; M 1.

(20)

We decelerate the PhEW particle that represents the cloudlets at the same rate as the cloudlets:

vi

=

Pram Rc2 (vrel /|vrel |) Mc

+ g,

(21)

where g is the gravitational field at the particle location. In the cosmological simulations, as the cloudlets in a PhEW
particle lose their mass to the ambient medium, the mass of the PhEW particle decreases accordingly

M i Mi

=

M c Mc

.

(22)

At the same time, we distribute the lost material to the neighbouring particles within the smoothing kernel of the PhEW particle in a way that conserves mass, energy, and metallicity. Here, we define M , p, v and E as the change of mass, momentum, velocity, and energy during a

MNRAS 000, 1­21 (0000)

time-step t for the PhEW particle as a whole. For each of the neighbouring particles:

Mj =

Mi Wij

Nngb j

mj Wij

,

(23)

pj =

piWij

Nngb j

mj Wij

,

(24)

vj

=

Mj vj + pj Mj + Mj

.

(25)

The metallicity of the neighbouring particle becomes

Zj(t + t) =

MjZj (t) +

Mi Zi (t)Wij

Nngb j

mj Wij

/(Mj + Mj ). (26)

The total amount of heat generated from the ram pressure approximately equals the net loss of kinetic energy from the PhEW particle and all its neighbouring particles, i.e.,

Nngb

E = Ekin,i +

Ekin,j .

j

(27)

In the limit of strong shocks, a fraction /(1 + ) of the heat is advected with the ambient flow while the remaining fraction 1/(1 + ) of the heat enters the cold cloudlet. Therefore, the specific energy of a neighbouring particle changes by

u j =

Mjuj + Mj ui +

E 1+

Wij

Nngb j

mj Wij

(Mj + Mj)t

.

(28)

As we evolve the PhEW particles over time, we need to choose the proper time-step for each particle. To ensure that all the critical time scales, i.e., the Courant time scale, the deceleration time scale, the cloudlet disruption time scale, and the heating time scale, are resolved, we choose the time step as the minimum of these time scales multiplied by a parameter ft:

ti

=

ft

min(

hi |vrel |

,

|vrel | |v rel|

,

Mc M c

,

ui u i

).

(29)

In our simulations, we choose ft = 0.2. Since the cloudlets usually have small cross sections and cool very efficiently, the deceleration and heating time-scales are often very long. Therefore, the Courant condition and the disruption time typically determine the time step of PhEW particles.
When a PhEW particle has lost a significant fraction, flim, of its original mass, we remove it from the simulation and distribute its remaining mass, momentum, and metals among its neighbouring particles in a single time-step using Equations 23 to 28. In this paper, we choose flim = 0.1. There is a very small likelihood that a PhEW particle moves into a galaxy. When this happens, the physics that governs the cloudlets is no longer valid, but the properties of the PhEW particle might be similar to the surrounding medium. Therefore, if this occurs we transition the PhEW particle back into a normal gas particle. In Section 4.2, we will explore the option of converting PhEW particles back into normal gas particles at late stages in their evolution, i.e., recoupling, instead of

removing them. However, in the end we decided not to allow recoupling because it led to potential numerical artefacts, e.g. artificial rapid heating of the new gas particle.
As the PhEW particles lose their mass to their neighbouring gas particles, normal gas particles in the simulations can gain much more wind material than their original mass over time. We found in our test simulations that over half of the gas particles have doubled their mass by the end of the simulation (z = 0) and 5% of them have accumulated 10 times or more wind material than their initial mass. The situation tends to be worse in higher resolution simulations. This results in a wide range of particle masses at lower redshifts, which lowers the effective resolution and may cause numerical errors in GIZMO. Therefore, we split any over-massive particle into two smaller particles once its mass has tripled to prevent a loss of resolution and other numerical issues, a feature already present in GIZMO.
3 SIMULATIONS
Table 1 lists the simulations that we use for this paper. In our naming convention "l" means CDM, the first number is the length of one side of the cubic periodic volume in h-1Mpc, and the number n after the "n" indicates that the simulation starts with n3 particles of each dark matter and gas. The table indicates the mass resolution of each simulation as the mass of one gas particle. Typically we have found that it requires 128 particles to accurately reproduce galaxy masses when comparing simulations of different resolutions (Finlator et al. 2006), but that could be different for the PhEW model. We also indicate the spatial resolution as the comoving Plummer equivalent gravitational softening length , though the actual form of the softening we use is a cubic spline (Hernquist & Katz 1989). All simulations use the same initial condition with the following cosmological parameters: m = 0.3,  = 0.7, b = 0.045, h = 0.7, and 8 = 0.8.
To evolve the simulations we use a version of gizmo (Hopkins 2015) that derives from the one used by Dav´e et al. (2019), except that we launch the galactic winds using the Huang et al. (2020a) model and do not include any AGN feedback or any artificial quenching for massive galaxies. Here we solve the hydrodynamic equations using the MFM method using the quintic spline kernel with 128 neighbours. We also calculate cooling using the grackle-3.1 package (Smith et al. 2017) with a Haardt & Madau (2012) UV background and model the H2-based star formation rate using the Krumholz & Gnedin (2011) recipe to calculate the H2 fraction. We model Type-Ia supernova feedback and AGB feedback, and explicitly track the evolution of 11 species of metals as in Dav´e et al. (2019).
Among the gizmo simulations, the l50n288-phewoff simulation and the l25n288-phewoff simulation do not use the PhEW model for evolving galactic winds. We use them as baseline models to compare with the simulations that do use the PhEW model. These two simulations only differ in their volume size and numerical resolution.
The fiducial simulation for this paper, l50n576-phew-m5, was performed in a cubic volume with periodic boundary conditions and a comoving size of 50 h-1 Mpc on each side, starting with 2 × 5763 particles, an equal amount of gas and dark matter particles, with a mass resolution of 1.2 × 107M

Implementation of PhEW 5
for the gas particles. The PhEW model is parameterized with a initial cloudlet mass of Mc = 105M, a Kelvin-Helmholtz coefficient of fKH = 30. The parameter fKH reflects a combination of potential effects that could increase the longevity of cold clumps, such as very small-scale radiative cooling, magnetic field effects (e.g. McCourt et al. (2015); Li et al. (2019), though see Cottle et al. (2020)), and the effects of a bulk outflow by which an entrained clump may experience a lower velocity relative to its surroundings than versus the ambient medium.
In addition, we set the conductivity coefficient fs, to 0.1 for all PhEW simulations, limiting the strength of thermal conduction to 10% of the Spitzer conductivity. Full Spitzer rate conduction seems unlikely to be realised in nature, as even a weak magnetic field could significantly suppress conduction perpendicular to the field lines. Furthermore, by performing further cloud-crushing simulations similar to those in Bru¨ggen & Scannapieco (2016) we find that amount of conduction is still sufficient to suppress the Kelvin-Helmholtz instability.
The rest of the PhEW simulations start with 2 × 2883 particles and vary either in the numerics, e.g., volume size and numerical resolution, or in the PhEW parameters. Namely, the l50n288-phew-m4 and the l25n288-phew-m4 simulations have smaller cloudlets with Mc = 104M, which lose mass more quickly, but also use a higher fKH = 100 to further suppress mass loss in the non-conductive regime.
Finally, we performed the l50n288-phew-m5-rec simulation to examine an alternative method for recoupling the PhEW particles. This simulation is identical to the l50n288-phew-m5 except that it allows a PhEW particle to recouple as a normal gas particles once its velocity becomes sub-sonic, while other PhEW simulations forbid recoupling unless a PhEW particle hits a galaxy.
For each output from the simulations, first we identify galaxies by grouping their star particles and gas particles whose density satisfy the star forming criteria using skid (Keres et al. 2005; Oppenheimer et al. 2010). Then we identify the host halo for each galaxy based on a spherical overdensity (SO) criteria (Keres et al. 2009). We start with the centre of each galaxy and search for the virial radius Rvir with an enclosed mean density equal to the virial density (Kitayama & Suto 1996). We define the virial mass Mvir as the total mass within Rvir and the circular velocity as vcir = (GMvir/Rvir)1/2.
4 PHEW PARTICLES IN SIMULATIONS
In this section, we study the properties of PhEW particles and how they evolve in cosmological simulations.
When a normal gas particle becomes a PhEW particle, we give it a unique ID and track its properties at every time-step until it either is removed or recouples according to the criteria from Section 4.2. As the PhEW particles travel in the CGM, we also keep track of the ambient gas properties as well as the virial mass Mvir and the virial radius Rvir of its host halo from which they were launched.
MNRAS 000, 1­21 (0000)

6 S. Huang et al.

Table 1. Simulations

Model
l50n576-phew-m5f l50n288-gadget3g l50n288-phewoff l25n288-phewoff l50n288-phew-m4 l50n288-phew-m5 l25n288-phew-m4 l25n288-phew-m5 l50n288-phew-m5-rech

Lbox[h-1 Mpc]a
50 50 50 25 50 50 25 25 50

Mres[M]b
1.2 × 107 9.3 × 107 9.3 × 107 1.2 × 107 9.3 × 107 9.3 × 107 1.2 × 107 1.2 × 107 9.3 × 107

[h-1 kpc]c
0.75 1.50 1.50 0.75 1.50 1.50 0.75 0.75 1.50

Mc[M]d
105 -
104 105 104 105 105

fKH e
30 100 30 100 30 30

a Comoving size of the simulation domain. b The mass resolution of the simulation, defined as the initial mass of each gas particle. c The spatial resolution of the simulation, defined as the comoving Plummer equivalent gravitational softening length d Initial cloudlet mass. e The parameter that controls mass loss rate from the Kelvin-Helmholtz instability. f Fiducial simulation. g The only simulation performed with the gadget-3 code h Identical to the l50n288-phew-m5 simulation except that we allow PhEW particles to recouple once their mach number
drops below 1.0.

4.1 Tracking PhEW Particles
Figure 1 shows how the properties of PhEW particles and their surrounding ambient medium change over time, with the stars showing the disintegration time. We select those particles that are launched shortly after redshift z = 1.0 from the l50n288-phew-m5 simulation. In general, there are much more winds launched from the low-mass haloes at any given time, but here we choose to show a sample of particles whose host haloes are evenly distributed across Mvir to demonstrate different wind behaviours in haloes of different masses.
The top panels show how far the cloudlets can travel (left panel) in their host haloes and how quickly they slow down relative to the ambient medium. The middle left panel shows how quickly the cloudlets lose their mass. Most cloudlets lose mass gradually over time and survive long enough to travel far from their host galaxies and even beyond their haloes before they disintegrate. The ram pressure and the gravity slow down the cloudlets rapidly at the beginning but become less efficient later on. Most cloudlets remain supersonic with M 1 until disintegration.
Thermal conduction has little effect except in the most massive haloes, where the hot CGM gas (Ta > 106.5 K) causes the cloudlets to evaporate within hundreds of Megayears. The linear factor fs controls the strength of thermal conduction, but changing this parameter slightly does not help the cloudlets survive in the massive haloes, because of the strong non-linear dependence between the conductive flux and the ambient temperature.
The bottom panels show the density of the cloudlets, c (left panel), and the ambient density, a (right panel). Both the cloudlet density and the ambient density decrease with time as a PhEW particle travels towards the outer regions of its host galaxy. The ambient density decreases as the radius increases and at the same time the cloudlets expand in the radial direction to adjust to the change in ambient pressure. Even so, at later times the cloudlets are still much denser than the ambient medium because, firstly, the cloudlets are much
MNRAS 000, 1­21 (0000)

cooler than the surrounding CGM gas, especially in the hot haloes, and secondly, the cloudlets are mostly still travelling at supersonic speeds and experience a large confining ram pressure.
Figure 2 shows statistically how far the PhEW particles travel in haloes of different virial masses. The upper panel and the middle panel show the average time and the average distances that the PhEW particles have travelled, respectively. The different colour lines indicate when and where they have lost 25%, 50%, and 75% of their mass and when they are removed (the disintegration time), as indicated. In general, the PhEW particles from massive haloes travel a further distance owing to their higher initial velocities. However, the PhEW particles can travel hundreds of kiloparsecs regardless of their host haloes.
The lower panel of Figure 2 shows the distances normalised to the virial radius, i.e., r/Rvir. In low-mass and intermediatemass haloes with log(Mvir/M) < 12.5, the normalised distances are largely independent of the halo mass. On average, the PhEW particles are capable of getting close to the virial radius before they disintegrate, though they have lost half of their mass when they reach approximately 0.25 Rvir, depositing half of the wind material within this radius. In massive haloes, conductive evaporation quickly starts to dominate the mass loss and leads to a rapid disintegration of the cloudlets. The time and radius at which the cloudlet disintegrates strongly correlates with the halo virial mass in these massive haloes as a consequence of the strong dependence between the evaporation rate and the gas temperature.
To understand the scalings between the PhEW particle mass loss rate and the halo virial mass, note that in lowmass haloes, hydrodynamic instabilities such as the KelvinHelmholtz instability (KHI) dominate the mass loss from the cloudlets as the halo gas is primarily cold (Keres et al. 2005, 2009). In haloes above about 1011.7M a halo of hot gas develops from accretion shocks and hence conductive evaporation becomes increasingly important. In the KHI dominated

Implementation of PhEW 7

Figure 1. The evolution of wind particle properties with time since they became PhEW particles. We show a random sample of particles that are launched at z = 1 from the l50n288-phew-m5 simulation. The colour of each line corresponds to the mass of its host halo when the particle was launched, with red tracks coming from massive haloes and blue tracks from low mass haloes. From top to bottom, left to right, the properties being plotted are distance from the halo centre normalised to the virial radius of the halo, the mach number of the particle relative to the ambient medium, the remaining fraction of cloudlet mass, the ambient temperature, the cloudlet density, and the ambient density. The star indicates when the wind particle is removed, i.e. when it has 0.1 times its initial mass.

haloes, both the wind velocities and the sound speed of the ambient medium scale as Mv1i/r3, approximately. Compression from ram pressure determines the cloudlet density so that
c  vr2el, while the cloudlet radius scales with the cloudlet density as Rc  c-1/3. Therefore, Equation 17 suggests that M c,KH  Mv2i/r9a1/2, i.e., the mass loss rate from the KHI depends only weakly on the halo mass at the same ambi-

ent density. In practise, the PhEW particles last longest in the intermediate-mass haloes for two reasons. First, when the ambient temperature becomes hot (Tvir > 106 K) in these relatively massive haloes, thermal conduction becomes strong enough to suppress the KHI but is not strong enough to cause significant conductive evaporation. Second, wind particles move faster in these haloes and reach the low-density

MNRAS 000, 1­21 (0000)

8 S. Huang et al.

Figure 3. The median and the 20th to 80th percentiles of the physical distances that the PhEW particles travel at the time when they only have 25% of their original mass. We compare five simulations to show the effects of changing the numerical resolution and the initial cloudlet mass Mc. The mass evolution of cloudlets is resolution independent. The smaller mass cloudlets lose mass more rapidly in haloes where thermal conduction is important.

Figure 2. How far PhEW particles travel in galactic haloes of different masses. From top to bottom, the panels show the time, physical distances and normalised distances that PhEW particles travel on average at the times when they have 75% (t75; purple), 50% (t50; red), 25% (t25; orange) of their original mass remaining, and at the time when they are removed (tlast; yellow). The PhEW particles in this figure are launched at z = 1 in the l50n576-phew-m5 simulation. The shaded regions indicate the 20th to 80th percentiles.
regions sooner, where the KHI is less efficient than at smaller radii.
Figure 3 compares the physical distances at which the cloudlets retain only 25% of their original mass between simulations to demonstrate how the wind parameters and numerical resolution affect the distances that the PhEW particles travel. More massive cloudlets, i.e., Mc = 105M, travel about the same distances in haloes with log(Mvir/M) < 12, but survive significantly longer in more massive haloes than the PhEW particles that have Mc = 104M. In the less massive haloes where the KHI dominates the mass loss, we compensate for the smaller mass of the cloudlets in the Mc = 104M simulations by using a fKH factor that is approximately 3 times larger. In the more massive haloes, thermal evaporation becomes increasingly important but the total evaporation time is longer for the more massive cloudlets, which scale as Mc-2/3(Huang et al. 2020b).
Importantly, Figure 3 also demonstrates that increasing the mass resolution by a factor of eight, i.e., going from the l50n288-phew-m5 simulation to the l50n576-phew-m5 simulation, or changing the box size by a factor of two, i.e., going from the l25n288-phew-m5 simulations to the l50n576phew-m5 simulations, has little effect on the dynamics of the cloudlets in haloes of any mass. This resolution insensitivity gives the PhEW model a clear advantage over any other
MNRAS 000, 1­21 (0000)

sub-grid wind algorithm that under-resolves the wind - halo interactions. For example, Dav´e et al. (2016) find that much of the lack of resolution convergence likely occurs because of poor convergence in wind recycling, owing to wind-ambient interactions being highly resolution dependent.
Since the mass and metals that a PhEW particle loses are mixed into the ambient medium, Figure 3 also suggests how wind material is distributed within the haloes. In simulations without the PhEW model, the metal rich wind material is locked to the wind particles and could only fuel future star formation through wind recycling (Oppenheimer et al. 2010; Angl´es-Alc´azar et al. 2017). With the PhEW model, the halo gas is constantly enriched by the PhEW particles that pass through. We, therefore, expect that the structures of cold gas, cooling and accretion within the gaseous haloes will be very different between simulations with and without PhEW, as we will show in Section 5.2 and Section 5.4.
Figure 4 shows the scalings between the wind velocities and the circular velocities, vcir, of their host haloes. In each panel, the colour scale indicates the velocities at 0.25 Rvir and the blue lines show the medians for each halo mass bin. We compare this scaling relation from our simulations to the results from high resolution zoom-in simulations (Muratov et al. 2015). The solid and dashed lines in this figure indicate their 50th and 95th percentiles wind velocities, respectively. The bottom panels show the fraction of wind particles in each halo mass bin that are fast enough to reach 0.25 Rvir.
In Huang et al. (2020a), we adjusted the wind launch velocities in our SPH simulations using gadget-3 to recover the superlinear scaling relation from Muratov et al. (2015) (see the appendix). Most of the winds in the SPH simulations were then fast enough to reach 0.25 Rvir regardless of the halo mass. However, in the gizmo simulation without the PhEW, even though we use the same wind launch velocities, the winds slow down more quickly in massive haloes and

Implementation of PhEW 9

Figure 4. Upper panels: The relation between the wind velocities at 0.25 Rvir, i.e., v25, and the halo circular velocities vcir. In each panel, the cyan line indicates the medians of v25 and the colour scales indicate the scatter from the relation. The red (vinit) lines indicate the wind velocity at launch. The black solid and black dashed lines are the 50th and the 95th percentiles from (Muratov et al. 2015),
respectively. Lower panels: The grey histograms show the distribution of vcir for all selected wind particles. The black lines show the fraction of wind particles in each vcir bin that were able to reach 0.25 Rvir in their host haloes. From left to right, the first row shows results for the gizmo simulation without the PhEW model, and the second and third rows show results both with the PhEW model but
at lower and higher resolutions, respectively, as labelled.

many of them stop and turn back before reaching 0.25 Rvir (left panel of Figure 4).
In the gizmo simulations with the PhEW model, however, the scaling relation is not only consistent with Muratov et al. (2015) but also much less dependent on the numerical resolution. In both the SPH and the gizmo simulations without the PhEW, increasing the numerical resolution tends to slow down winds even more quickly. In practise, we need to boost the initial wind velocities by a factor of 1.14 in the SPH simulations when increasing the spatial resolution by a factor of two (a factor of eight increase in mass resolution) to obtain the same v25 - vcir scaling relation (Huang et al. 2020a). In PhEW simulations, one no longer needs to re-tune the wind velocities to match the Muratov et al. (2015) relations at different resolutions as in the non-PhEW simulations.
Hence, the PhEW model has the advantage that the dynamics of the wind particles is no longer dominated by unresolved hydrodynamics, which interacts in unknown ways with the hydrodynamic algorithm, but instead is governed by analytic equations based on physics.
In the PhEW simulations, fewer wind particles reach 0.25

Rvir in massive halos as they have lost most of their mass before they reach that radius in these halos. Typically the fraction of wind particles that reach 0.25 Rvir starts dropping significantly above vcir  300 km s-1, corresponding to haloes with virial temperatures over 10 million degrees. Clouds in these haloes evaporate on very short time- scales.
Figure 5 shows how the baryonic mass distributes according to its density and temperature. We only show the result from the fiducial l50n576-phew-m5 simulation here, but the phase space distributions are similar between different simulations in this paper, indicating that the PhEW model does not significantly affect the average gas properties.
At z = 0.5, PhEW particles have a wide range of properties, such as Mc, c and the age, tout, i.e., the age of the winds since they were launched. The PhEW particles exist in various halo environments with different ambient properties. A typical PhEW particle in this diagram travels from the cold, dense interstellar medium (ISM) and moves across the phase diagram towards lower densities, with its cloudlet masses decreasing with time. However, most PhEW particles are at an equilibrium temperature of around Tc  104 K
MNRAS 000, 1­21 (0000)

10 S. Huang et al.

range where mass loss is minimal because there is still enough conduction to suppress the Kelvin-Helmholtz instabilities but not enough to promote rapid conductive evaporation. However, they only represent a small fraction of the total amount of winds launched from these haloes over time. For example, of all the winds launched from these haloes at z = 1, less than 10% have ages over 5 gigayears, and the fraction is much less in other haloes.

Figure 5. The density­temperature gas phase diagram at z = 0.25 with PhEW particles over plotted. The background scale indicates the mass distribution in this phase space. The two dotted lines separate the phase space into warm-hot gas, hot gas, diffuse intergalactic gas, and condensed gas phases. For each PhEW particle, we show its cloudlet properties, i.e., c and Tc, as a cross and its ambient properties, i.e., a and Ta as a circle. The size and colour of the symbol indicates the remaining cloudlet mass fraction and the time since it became a PhEW particle, i.e., tout, respectively. The cloudlets (crosses) are clustered at Tc  104 K. Older winds tend to have a smaller cloudlet mass and have travelled further into the lower density regions. In particular, there are PhEW particles that have survived for more than 5 gigayears. Most of them are in the most diffuse regions of the Universe.
over their lifetimes regardless of the ambient temperature of the surrounding gas, as a result of strong metal line cooling inside the cloudlet. This picture is consistent with highresolution cloud-crushing simulations. The cloudlet densities, on the other hand, decrease with time as the cloudlets expand as they enter more diffuse regions. The cloudlet density is often a few orders of magnitude larger than the ambient density owing to compression from ram pressure and the contrast between the cloudlet temperature and the ambient temperature.
The PhEW particles often travel at high speed and decelerate slowly owing to their small cross-sections, so they leave the central regions of their host haloes very soon after launch and are, therefore, more likely to be found in the diffuse and the WHIM gas at any given time.
Some PhEW particles survive for a very long time and can be found in very diffuse regions of the simulation. Cloudlets in these PhEW particles will have expanded greatly and become kpc-scale metal rich structures in the IGM. Most of these long lived wind particles were launched from galactic haloes with 12.0 < log(Mvir/M) < 13.0, corresponding to a temperature
MNRAS 000, 1­21 (0000)

4.2 Wind Recoupling
In our fiducial model, we eliminate PhEW particles from a simulation when the cloudlet mass drops below a certain fraction flim. In most circumstances, if a gas particle has been launched as a wind, it will either remain as a PhEW particle or disintegrate. In this section, we consider recoupling the PhEW particles that become sub- sonic, i.e., turning them back into normal gas particles when they still have more than flim of their original mass, and we explain why we decided not to let them recouple in our final PhEW model.
In a test simulation, l50n288-phew-m5-rec, we allow PhEW particles to recouple when they have slowed down to a subsonic speed relative to the surrounding medium, i.e., M < Mre, where Mre is a parameter that we set to 1.0 in our test simulation. When a PhEW particle recouples, it becomes a normal gas particle that starts interacting with its neighbouring particles hydrodynamically while retaining its current mass and velocity.
Figure 6 tracks the evolution of the PhEW particles before they either recouple or disintegrate in cloud mass­mach number space. Asymptotically, most PhEW particles end up in a narrow region of this space where both the cloudlet mass and the mach number are small. Winds from low-mass haloes (log(Mvir/M) < 12.5) often start with a high mach number but gradually slow down and still retain a considerable amount of cloudlet mass at the time of recoupling. On the other hand, winds from massive haloes evaporate much more quickly while staying at a nearly constant speed. Figure 6 also shows a few particles from massive galaxies with increasing M at later times as a result of their surrounding medium becoming cooler as they travel outwards.
Our test simulations also show that there are a small fraction of PhEW particles that neither recouple nor disappear. Nearly all of them are launched from intermediate-mass haloes (log(Mvir/M)  12.0) and have travelled beyond the virial radius of their host haloes, where both the mass loss rate and the deceleration rate are very small, enabling them to stay as PhEW particles for a long time.
In our fiducial model, we remove a PhEW particle once its mass drops below flim = 0.1, indicated as the horizontal dotted line. Alternatively, one might think of letting it recouple as a normal gas particle once its mach number becomes low enough, but, we found that the recoupled particles will often numerically overheat even if one uses a low mach number for the recoupling criteria (e.g. Mre = 1 as the vertical dotted line in the figure). We experimented by making even stricter recoupling criteria. This led to wind particles remaining as PhEW particles for longer periods of time before recoupling, during which time they typically retained a low temperature. But, whatever the recoupling criteria, once the PhEW particles became ordinary gas particles again, they quickly heated from about 104 K up to 105  107 K.

Implementation of PhEW 11
further evolution is beyond the scope of the PhEW model. Therefore, we let any PhEW particle whose ambient density is larger than SF become a normal gas particle. However, this affects very few PhEW particles (typically  0.1%).

Figure 6. The evolution of cloud mass (Mc/Mc(0)) as a function of Mach number (M) for the PhEW particles launched at z = 1 in the l50n288-phew-m5-rec simulation. The star symbols indicate the last appearance of these PhEW particles in the simulation. In all the PhEW simulations, we remove PhEW particles when their mass drops below 10%, indicated as the horizontal dotted line. In the l50n288-phew-m5-rec simulation shown here we also allow PhEW particles to recouple at M < 1.0, which is indicated as the vertical dotted line. There is also a small fraction of PhEW particles that have neither recoupled nor disintegrated at the end of the simulation. In practise, most particles have lost enough mass before slowing down to meet the recoupling criterion.
This over-heating occurs because recoupling a cold PhEW particle to a hot ambient medium leads to a sudden change in the estimated density of that particle. Before recoupling, one uses the cloudlet density to compute the cooling rate, while after recoupling, one uses the kernel smoothed density, which is lower than the cloudlet density by a factor of   Ta/Tc. As a result, the cooling rate drops immediately at the time of recoupling, enabling the particle to heat up very quickly.
Therefore, we do not allow PhEW particles to recouple in our simulations owing to this numerical artefact. Our test simulations show that whether or not we allow recoupling has little effect on galaxy properties because a particle usually has lost most of its mass before meeting the recoupling criteria and this choice, therefore, plays a limited role in determining galaxy properties. However, this experiment should serve as a warning to any cosmological simulation that attempts to include the effects of galactic supernova winds or AGN winds by adding velocities to individual particles. Such methods might lead to a spurious heating of those particles compared to a simulation that had orders of magnitude more resolution, since the evolution of the particle temperature only depends on numerical vagaries of the hydrodynamical solver and the potentially grossly underestimated cloud densities.
Finally, a PhEW particle may travel into a galaxy, whose

5 GALAXY AND HALO PROPERTIES
5.1 The Stellar Masses of Galaxies
Figure 7 shows the galactic stellar mass functions (GSMFs) at different redshifts. In the simulations without the PhEW, we adjust wind parameters that control the mass loading factor and the initial wind velocities so that the GSMFs match observations (Huang et al. 2020a). In the simulations with the PhEW, we use the same set of wind parameters but also adjust the fKH parameter for each choice of Mc. Since a smaller cloudlet loses mass more quickly, we adopt a larger value of fKH in the simulations with Mc = 104M.
The GSMFs from the different PhEW simulations with volume sizes and mass resolutions that vary by a factor of eight are nearly indistinguishable but the low resolution simulation without the PhEW, i.e., l50n288-phewoff, underproduces stars at z = 0 relative to other simulations. The results from the PhEW simulations are much more resolution independent, regardless of the choice of the cloudlet size. Surprisingly, in the simulations including the PhEW model, the galactic stellar mass functions remain viable below the nominal resolution limit that we established previously of 128 gas particle masses (Finlator et al. 2006), down to a mass of 16 gas particle masses as one can see by comparing the lower resolution l50n288-phew-m5 simulation with the higher resolution l50n576-phew-m5 simulation.
Figure 8 shows a similar result. The z = 0 stellar mass­halo mass (SMHM) relations between the two simulations without PhEW are significantly different at almost every Mh, while the simulations with PhEW are much more consistent with each other. In particular, the galaxies in low-mass haloes are more massive in the PhEW simulations, in better agreement with observational results (Behroozi et al. 2013).
5.2 Baryonic Mass Distributions
Figure 9 compares the amount of baryons in different phases normalised by the cosmic mean baryon fraction. For each central halo, we separate cold and hot gas with a temperature threshold of Tcut = 105.0 K, close to the range of temperatures where the fractions of many observed ions are very sensitive. In previous papers, we used a slightly higher threshold of 105.5 K (Keres et al. 2005; Huang et al. 2020a), but the difference between these values has little effect on the cold gas fraction. In addition to cold and hot halo gas, we also show the mass of star-forming gas in the galaxies and the total baryonic mass including stars.
The fraction of hot gas in galactic haloes depends strongly on the halo mass but is less sensitive to the different numerical models. The halo gas switches from mostly cold to mostly hot at around log(Mvir/M) = 12.0. This threshold is somewhat higher than in Keres et al. (2005), owing to the inclusion of metal line cooling (Gabor & Dav´e 2012). In general, the different wind models do not significantly affect the amount of hot gas in galactic haloes of any given mass. This
MNRAS 000, 1­21 (0000)

12 S. Huang et al.

Figure 7. Galactic stellar mass functions at z = 0, z = 1, z = 2 and z = 4. We compare the results from different simulations that are coloured in accordance with inset key. The two dashed lines correspond to the two non-PhEW simulations. The bold lines correspond to the simulations with a higher resolution. See Table 1 for details. The vertical dotted and dashed lines indicate the mass resolution limit corresponding to a total mass of 128 gas particles in the low-resolution and high-resolution simulations, respectively.

is also true when we change the PhEW parameters and the numerical resolution.
The baryon fraction within haloes is less than 75% of the cosmic mean baryon fraction in most haloes, regardless of which code or which wind model we use. This depletion of halo baryons is the result of winds that escape from haloes over time. The PhEW simulations have a similar fraction of wind material escaping from haloes as the non-PhEW simulations. The escape fractions are also similar at z = 0 and z = 2, indicating that most of the winds escape at higher redshifts.
Figure 10 shows how wind particles affect the radial distribution of baryons and wind material in galactic haloes with different Mvir. In the left panels, we calculate the mass fraction of the cold, hot and star-forming gas and wind particles as a function of the normalised radius r/Rvir for each halo and average over all central haloes within the same Mvir range. We define star forming gas as dense gas particles residing in galaxies that satisfy the star-forming criteria that we use during the simulations, and we separate cold halo gas from hot halo gas based on the temperature criterion T < 105.0 K. Consistent with Figure 9, the fraction of cold and hot gas
MNRAS 000, 1­21 (0000)

as a function of halo radius is similar between non-PhEW and PhEW simulations, especially in the intermediate and massive haloes.
In the right panels of Figure 10, we show the fraction of wind material in each radial bin. For the non-PhEW simulation, we define wind material as gas particles that were once launched as winds, and we further separate them into cold winds or hot winds based on their current gas temperature. These particles often have distinct properties from their neighbouring normal gas particles, e.g., a higher metallicity as they were enriched in the galaxies before becoming winds. In the PhEW simulations, wind particles mostly disintegrate after losing most of their mass to the neighbouring particles, so that the wind material is well mixed with the halo gas. For each gas particle, a fraction of its mass has come from a PhEW particle. Therefore, we define the wind fraction in a gas particle as the fraction of the material that used to be in a PhEW particle. In addition, the currently surviving PhEW particles make up a small fraction of the total baryonic mass in the low-mass haloes in the PhEW simulation. This PhEW fraction becomes negligible in more massive haloes be-

Figure 8. Stellar mass - halo mass relations at z = 0 from the same set of simulations in Figure 7. We show the observational results from Behroozi et al. (2013) for comparison. The vertical dotted line indicate the mass resolution limit corresponding to a total mass of 128 dark matter particles in the low-resolution simulations. The mass resolution limit of the high-resolution simulations is below the plotting limit of this figure.
cause PhEW particles launch less frequently and travel faster through these haloes.
Even though the definition of wind material differs between the non-PhEW and the PhEW simulations, its radial distribution between these simulations is very similar in the intermediate and massive haloes, with a total wind fraction of approximately 30% and 20% at most radii, respectively. However, in the low-mass haloes, the wind fraction in the PhEW simulations is considerably higher. The wind fraction in the PhEW simulation also increases towards smaller radii until the innermost region where star-forming gas dominates, while the wind fraction in the non-PhEW simulation declines within 0.5 Rvir because typical wind particles travel quickly and hence spend little time near the galaxy.
The fraction of hot wind material is also very similar between the two simulations, but the origin of the hot wind differs. In the non-PhEW simulation, the hot wind material is simply high velocity wind particles that heat up to the ambient temperature. In the PhEW simulation, on the other hand, it mostly made up of cloudlets that evaporate and mix into the hot ambient medium.
Although not shown here, the profiles from the l50n288phew-m4 simulation are nearly identical to the l50n288-phewm5 simulation, except that it has a slightly higher fraction of PhEW particles in the low-mass haloes.
5.3 Gas Metallicities
The PhEW particles lose not only mass but also metals to the surrounding medium so the radial distribution of metals also changes significantly with the PhEW model. In the left panels of Figure 11, we study the fraction of metals in each of the gas phases as a function of halo radius. For the nonPhEW simulation, most of the metals are locked in former wind particles and there is no exchange of metals between the

Implementation of PhEW 13
former wind particles and normal gas particles. Therefore, one can interpret the cold and hot fraction in the non-PhEW simulation as the fraction of former wind particles that are currently cold or hot.
In the PhEW simulation, 20% to 40% of the metals are in the PhEW particles at most radii in low-mass and intermediate-mass haloes as they survive longer in haloes of these masses. In addition, the fraction of metals in the hot gas tends to increase with radius and halo mass. In the nonPhEW simulation, the majority of metals are in the former wind particles that remain mostly cold. Even in the most massive haloes (log(Mvir/M)  13.0), a considerable amount of metals are in the cold wind particles that scatter over all radii. In contrast, almost all metals are hot in the PhEW simulation owing to the absence of cold gas in these massive haloes and the ability to share metals.
In the right panels of Figure 11, we calculate the metallicity as the ratio of the total mass of metals and the total gas mass for each phase separately. Even though the averaged metallicity profiles are similar between the non-PhEW and the PhEW simulations, the metallicities of the cold and hot gas alone are drastically different. In the PhEW simulations, the metallicities of the cold and hot gas are comparable. However, in the non-PhEW simulations the metallicity of the cold gas is significantly higher, since the metal-rich former wind particles are on average colder than the ambient gas particles owing to more efficient metal cooling, resulting in disproportionally more metals in the cold gas.
In the most massive haloes, the metallicity of the hot gas in the PhEW simulation is much closer to the observed universal value of 1/3 Z for hot cluster gas at low redshifts (e.g. De Grandi & Molendi 2001; Leccardi & Molendi 2008; Molendi et al. 2016), while the metallicity in the non-PhEW simulation is much lower than this observed value.
Figure 12 compares the metallicity distributions in the halo gas between the non-PhEW and the PhEW simulations. The two PhEW simulations, l50n288-phew-m5 and l50n576-phewm5, have very similar distributions regardless of the different numerical resolutions, which is another example of the robustness of the PhEW model. Gas metallicities in the PhEW simulations strongly peak at between -1 < log(Z/Z) < 0 for all of the three halo mass bins. The metallicities in the cold and hot gas have similar shapes except for a slight shift in the peaks. The non-PhEW simulation, on the other hand, has much broader overall metallicity distributions. Over 40% of particles in the non-PhEW simulation even have metallicities below the plotting limit, log(Z/Z) = -4, of Figure 12, while the fractions in the two PhEW simulations are negligible. The non-PhEW simulation also shows a clear bimodality in the metallicity distributions in both the low-mass and intermediate-mass haloes. In the intermediate-mass haloes, the metal-rich peak at log(Z/Z)  -0.5 is dominated by cold gas while the metal-poor peak at log(Z/Z)  -3.0 is dominated by hot gas.
In the non-PhEW simulations, the bimodal distribution of metals in galactic haloes results from different metallicities in the inflowing and outflowing material (Ford et al. 2014; Hafen et al. 2017) and the inability of these different materials to mix. This inability to mix metals would be present in any Lagrangian simulation that launches wind particles explicitly (e.g. Pillepich et al. 2018; Dav´e et al. 2019) and even in simulations that attempt to evolve the winds numerically
MNRAS 000, 1­21 (0000)

14 S. Huang et al.

Figure 9. The composition of baryons in galactic haloes at z = 0 (left panel) and z = 2 (right panel). Each panel shows the mass of the different components, cold gas (blue), hot gas (red), star-forming gas (orange) and the total baryons (gas + star, grey), as fractions of the cosmic mean value with halo mass. The solid lines and the shaded regions indicate the medians and the 68 percentiles from the l50n576phew-m5 simulation. The dashed and the dotted lines are from the l50n288-phew-m5 and the l50n288-phewoff simulations, respectively. On the top axis of the panels, we label the average stellar masses of the central galaxies in corresponding haloes from the l50n576-phew-m5 simulation.

(e.g. Schaye et al. 2015; Hopkins et al. 2018) since the mixing occurs on scales that cannot be resolved in those simulations.
Many recent simulations (Shen et al. 2010; Brook et al. 2012, 2014; Su et al. 2017; Rennehan 2021) have implemented sub-grid models to allow metal diffusion following the Smagorinsky (1963) turbulence model. Results from these simulations suggest metal diffusion plays important roles in the chemical evolution of dwarf galaxies (Pilkington et al. 2012; Revaz et al. 2016; Hirai & Saitoh 2017; Escala et al. 2018). However, these simulations are either non-cosmological or zoom-in simulations that are very different from our simulations in context.
In the PhEW simulations, metal mixing can occur naturally between the outflowing wind particles and the ambient medium, which effectively erases the bimodality. Observationally, whether or not a bimodality exists at low redshifts is still uncertain (Lehner et al. 2013; Prochaska et al. 2017). Future quasar absorption line observations could potentially distinguish different models of how metals mix in the CGM. Furthermore, although these results hint at major differences in the predicted metallicity distributions in the different wind models, our cold-hot temperature split is only a crude attempt to make contact with the observations. To make more robust comparisons with the observations of gas metallicities requires simulated quasar absorption lines, which we will pursue in future work.
MNRAS 000, 1­21 (0000)

Despite the fact that the PhEW model drastically changes the distribution of metals in the CGM, it hardly affects the metallicities of the star-forming gas in the simulated galaxies. We find that the mass-metallicity relation in the simulations without PhEW are nearly identical to that in the simulations with PhEW.
5.4 Gas Accretion
The gas that ultimately forms stars in galaxies had different thermal histories before accretion. Galaxies may acquire gas through cold accretion, hot accretion and wind re-accretion and their relative importance strongly depends on the galaxy or dark halo mass (Keres et al. 2005, 2009; Oppenheimer et al. 2010). In simulations without PhEW, one often defines wind re-accretion as the accretion of former wind particles. The definition is clear since the wind particles do not mix with other particles.
In simulations with the PhEW, the mass of a normal gas particle can grow by a considerable amount owing to material lost from neighbouring PhEW particles before the gas particle accretes onto a galaxy. We define the wind mass, i.e, Mw, of a gas particle as the mass that came from PhEW particles. At the time when a gas particle accretes, we count its wind mass as wind re-accretion and the rest of its mass as pristine accretion. In non-PhEW simulations, since there

Implementation of PhEW 15

Figure 10. The average radial profiles in galactic haloes selected by halo mass at z = 0.25. The left panels show total baryon mass profiles including winds. In each radial bin, we separate the baryons into cold gas (blue), hot gas (red) and star-forming gas (brown) as described in the text. The right panels show the total fraction of wind material (orange) as a function of radius. We also separate the wind material into cold wind (cyan), hot wind (magenta) and PhEW particles (green, only existing for the PhEW simulations). From top to bottom shows averaged profiles for low- mass, intermediate-mass and massive haloes, with their corresponding mass ranges indicated in the right panels. The dashed and solid lines compare results from the l50n288-phewoff and the l50n288-phew-m5 simulations, respectively.

is no mass exchange between normal gas particles and wind particles, we define pristine accretion as the accretion of a gas particle that has never accreted onto any galaxy before, and wind re-accretion as the accretion of particles that used to be winds. This definition for the non-PhEW simulations is identical to our previous papers (Oppenheimer & Dav´e 2008; Huang et al. 2020a).
For each PhEW particle we note the time it was launched, tw, and the velocity dispersion, w, of the galaxy that launches it in a wind. Therefore, whenever a gas particle acquires some mass from a PhEW particle, we can calculate the mass-weighted average wind launch time, t¯w, and the massweighted velocity dispersion of the wind launching galaxy ¯w for the wind component of the gas particle. We find that the variances for tw are usually large while the variances for gal are usually small, indicating that a gas particle typically ac-

cumulates its wind material over a long period of time but mostly from winds launched from the same halo.
In Figure 13, we look at the thermal histories of gas particles before they accreted onto galaxies and formed stars. For each galaxy at z = 0, we track all of the star particles to their most recent accretion event and determine whether they were cold accretion, hot accretion or wind re-accretion. In a nonPhEW simulation, each accretion event can only be one of the three types, while in a PhEW simulation, each accretion event can be a mix of wind re-accretion and either of the two other types. In this analysis, we separate cold accretion from hot accretion using a temperature cut of T = 105.5 K.
In the non-PhEW simulation, l50n288-phewoff, cold accretion dominates galaxies in small haloes with log(Mvir/M) < 12.0 while hot accretion dominates in massive haloes. Hot accretion might become less important if one were to include
MNRAS 000, 1­21 (0000)

16 S. Huang et al.

Figure 11. Similar to Figure 10, this figure shows how metals are distributed in the different gas phases. The left panels show the fraction of metals in cold gas (blue), hot gas (red) and the PhEW particles (only applying to the PhEW simulation) as a function of radius. The right panels shows the metallicity of cold gas (blue), hot gas (hot) and the average of the two in solar units as a function of radius. Here we use Z = 0.0122 from Asplund et al. (2009).

AGN feedback to efficiently suppress cooling flows in the most massive haloes. The fraction of wind-re-accretion is negligible in very low-mass haloes and grows with halo mass. The importance of wind re-accretion is sensitive to wind model implementations (Huang et al. 2020a). For example, the initial wind speed determines whether or not wind particles can escape haloes of different masses and controls the amount and the time-scale of wind recycling.
Compared to the non-PhEW simulation, the main difference in the PhEW simulation is a significant increase of wind re-accretion in low-mass haloes, making it the dominant mode of accretion in these haloes. Adding this recycled wind material leads to as much as 0.5 dex increase in the low-mass end of the stellar mass - halo mass relation, which now matches the empirical results from Behroozi et al. (2013) as shown in Figure 8. Although not shown here, the results from the
MNRAS 000, 1­21 (0000)

low resolution l50n288-phew-m5 simulation are very similar to the l50n576-phew-m5 simulation.
Most winds can easily escape the low-mass haloes in both the PhEW and the non-PhEW simulations. However, a PhEW particle loses its mass as it travels outwards to the cold gas that it passes through and that gas can later accrete unto the galaxy. A star-forming galaxy in a low-mass halo usually has strong winds resulting in a large amount of wind material being mixed with the accreting gas and, therefore, increases the amount of wind re-accretion in a PhEW simulation.
The total amount of cold accretion is similar between the non-PhEW and the PhEW simulations, but the total amount of hot accretion also significantly increases in the PhEW simulations, possibly because the hot gas is more metal rich owing to the mixing with outflowing wind material.
The two PhEW simulations with different resolutions are

Implementation of PhEW 17

Figure 13. The relative importance of different accretion types for galaxies of different mass. In the upper panel, we calculate for galaxies at z = 0 how much of their total stellar masses (black) came from cold accretion (blue), hot accretion (red) or wind reaccretion (green). The lower panel shows their relative fractions. In each panel, the dotted lines are from the l50n288-phewoff simulation, which defines cold accretion, hot accretion and wind reaccretion similar to Oppenheimer et al. (2010). The solid lines are from the l50n576-phew-m5 simulation, using the definitions described in the text.

Figure 12. Mass weighted histograms of metallicities in low-mass (upper panel ), intermediate-mass (middle panel ) and massive (bottom panel ) haloes at z = 0.25. We compute the histograms using gas particles within the virial radius and exclude particles that are star forming or that are from the innermost radii (r/Rvir < 0.1). We normalise the histograms by the total mass of the selected particles. We also show the histograms for the cold (blue) and hot (red) gas separately, using a temperature cut of log(T / K) = 5.0. The dotted, dashed, and solid lines correspond to the l50n288phewoff, l50n288-phew-m5, and the l50n576-phew-m5 simulations, respectively. A considerable fraction (> 40%) of particles in the l50n288-phewoff simulation have metallicities below the plotting limit of the figure.
much more similar. The l50n576-phew-m5 simulations have slightly more hot accretion and wind re-accretion but less cold accretion, but the total amounts of gas accretion in these two simulations are comparable, again demonstrating the robustness of the PhEW model to numerical resolution.
Why do galaxies in the high resolution simulations accrete more wind material? The reason is that at higher resolution, one can resolve haloes with lower mass in the simulation or haloes at earlier stages of their assembly when they were still too small to be resolved in the lower resolution simulations. These low mass haloes launch a considerable amount of wind material because of their very high mass loading factors be-

fore they grow to sizes that would be resolvable in the lower resolution simulations. In their subsequent evolution, galaxies in the high resolution simulations start accreting material from this earlier generation of winds while the galaxies in the low resolution simulation are still accreting mostly pristine gas.
The top panel of Figure 14 compares the distribution of all winds that are launched from a simulation as a function of gal, which is the velocity dispersion of the haloes from which the winds are launched. It demonstrates that the high resolution simulation launches more than twice as much mass in winds as the low resolution simulation over time and that most of the extra winds are launched from the lowest mass haloes, i.e., smaller gal. Furthermore, above the resolution limit, both simulations launch nearly identical amount of winds from galaxies that are resolved in both simulations.
The lower panels of Figure 14 indicate where the accreted wind material originates in these two simulations. We select all wind material that recently accreted on galaxies within the last gigayear and show the distribution of gal for where this wind material originates. It also demonstrates that the high resolution simulation not only launches more winds, but also that a considerable amount of this wind material is recycled.
MNRAS 000, 1­21 (0000)

18 S. Huang et al.
Figure 14. In the upper panel, we show from which haloes (binned by their velocity dispersions) the winds are launched at z = 2 (blue) and at z = 0 (red). The l50n576-phew-m5 simulation (solid lines) launches much more wind in low-mass haloes, which are unresolved in the l50n288-phew-m5 simulation (dashed lines), at both redshifts. In the lower panel, we show the mean gal of all wind material that accreted within the last gigayear in these simulations.
6 SUMMARY AND DISCUSSION Modelling the interactions between galactic winds and their surrounding halo gas has been a challenge for cosmological simulations owing to the complicated interplay of physical processes that are unresolved in these simulations. In our previous paper (Huang et al. 2020b), we developed the Physically Evolved Winds (PhEW) model for analytically evolving cold galactic winds through an ambient medium. Our analytic framework consistently models shocks, hydrodynamic instabilities, thermal conduction and evaporation, and makes predictions for the mass loss rate and the deceleration rate of the cloudlets that match the numerical results of high resolution cloud-crushing simulations from BS16 under various conditions.
In this paper, we provide a detailed numerical prescription for implementing the PhEW model in cosmological hydrodynamic simulations. The PhEW model governs the evolution of the wind particles after they were launched from their host galaxies in a simulation. We performed several simulations with the PhEW model using various numerical and physical parameters to study the behaviours of the PhEW particles and their impact on the stellar and gas properties of the galaxies in the simulations. MNRAS 000, 1­21 (0000)

The evolution of PhEW particles in our simulations strongly depends on halo mass. In low-mass haloes with log(Mvir/M) < 11.5, hydrodynamic instabilities dominate mass loss, even though most PhEW particles are still able to survive for hundreds of Megayears and escape their host haloes before they disintegrate. PhEW particles survive longest in intermediate-mass haloes with log(Mvir/M)  12.0, because weak thermal conduction can suppress hydrodynamic instabilities but still does not lead to efficient conductive evaporation. Some PhEW particles remain in the CGM/IGM even after a few gigayears. In the massive haloes with log(Mvir/M) > 13.0, the ambient halo gas becomes hot enough that strong thermal conduction leads to quick evaporation of the cloudlets, usually within 200 Megayears. Nevertheless, owing to the high initial speed of these winds, many particles can still travel a considerable distance, up to 0.5 Rvir, before being fully evaporated.
The behaviour of PhEW particles is robust to numerical resolution and hydrodynamic technique (see appendix). This is in stark contrast to previous galaxy supernova wind models (Katz et al. 1996; Springel & Hernquist 2003; Oppenheimer & Dav´e 2006; Stinson et al. 2006; Dalla Vecchia & Schaye 2012; Agertz et al. 2013; Pillepich et al. 2018; Dav´e et al. 2019; Huang et al. 2020a), which are sensitive to resolution and to the complex interactions between resolution and the hydrodynamic technique. The PhEW wind behaviour does depend on the PhEW parameters, as it must, being based on an explicit model of the sub-grid physics. For example, a smaller cloudlet mass leads to cloudlets that disintegrate on shorter time-scales in both low-mass and massive haloes, although choosing a larger value for fKH helps them to survive longer in low-mass haloes.
The evolution of wind particles and the galaxy properties in the PhEW simulations are much more robust to numerics than simulations without the PhEW model. Between the gadget-3 and the gizmo simulations, which rely on different algorithms for solving hydrodynamics, the behaviours of wind particles are very different even with the same initial wind speeds and at the same resolution, with the winds in the gizmo simulation slowing down faster (see appendix). Furthermore, in both the SPH and the MFM method used by these simulations, the wind-halo interactions are unresolved and sensitive to numerical resolution. This leads to very different predictions on how far the winds can travel, the amount of wind recycling and the star formation histories of the galaxies. Because of this sensitivity of the wind model, one often needs to re-adjust the wind parameters for simulations with different resolutions to obtain similar results (Huang et al. 2020a). However, most results from the PhEW simulations converge very well at different resolutions without the need for wind retuning. We are hopeful that the PhEW model can be easily adapted to other cosmological hydrodynamic simulation codes whether they are Lagrangian, grid based, or moving mesh and still retain the numerical robustness that we demonstrated here.
Our results provide an initial view of how the sub-grid physics modelled by PhEW affects the evolution of galaxies, winds, and the CGM in simulations that are matched in numerical resolution, cooling and feedback physics, and the treatment of wind launch from galaxies. Our key findings are as follows.

1. At redshifts z  1, the galaxy stellar mass function is little affected. However, at z = 0 the mass function is boosted significantly below M = 1011M, achieving a better agreement with observations. This change arises because there is much more wind recycling in these lower mass halos. This increase in recycling is caused by the ability of PhEW particles to shed some of their mass to the ambient CGM before escaping the halo, unlike traditional wind particles. This recycling leads to significantly better agreement with the empirically inferred stellar-to-halo mass relation at low redshift and thus with the observed galaxy stellar mass function. See Figures 7 and 8.
2. The high-mass end of the galaxy stellar mass function is minimally affected. In the absence of AGN feedback (or some other physics we have not included), simulations with or without PhEW produce excessively massive galaxies in large halos at low redshift, by about a factor of three at the highest masses. See Figure 7.
3. The CGM baryon fraction and the division of CGM baryons between cold and hot phases is only mildly affected. Across the halo mass range 1011 - 1013M the fraction of baryons in halos is depressed to 60-80% of the cosmic baryon fraction in our simulations, at z = 0 and z = 2, with or without PhEW. Cold CGM gas exceeds hot CGM gas in halos below Mh  1011.7M, and hot CGM gas exceeds cold CGM gas in halos above 1012M. Radial profiles of cold and hot CGM gas are also similar with or without PhEW. See Figure 9.
4. The distribution of metals in the CGM is radically affected because PhEW particles share metals with the ambient CGM as their clouds dissipate, while conventional wind particles retain their metals throughout. The distribution of CGM gas metallicities with PhEW is skewed but unimodal, while the conventional wind model gives a very broad and bimodal distribution (actually trimodal if one includes the large amount of nearly zero metallicity gas). In our PhEW simulations the metallicity of hot CGM gas and cold CGM gas is similar, while our conventional wind simulations have a CGM comprised of metal-rich cold gas and metal-poor hot gas. See Figures 11 and 12.
Based on these exploratory results, we expect the change from a conventional wind implementation to PhEW to have an important impact on predictions for metal-line absorption and emission by the CGM, and perhaps on X-ray properties of galaxy halos, groups, and clusters. These changes arise from adopting a physically explicit model for dispersion of metals from winds to the ambient CGM, rather than a numerical prescription that is sensitive to resolution and to implementation details. We will examine predictions for these informative CGM and galaxy observables in future work.
REFERENCES
Agertz O., et al., 2007, MNRAS, 380, 963 Agertz O., Kravtsov A. V., Leitner S. N., Gnedin N. Y., 2013, ApJ,
770, 25 Angl´es-Alca´zar D., Faucher-Gigu`ere C.-A., Keres D., Hopkins
P. F., Quataert E., Murray N., 2017, MNRAS, 470, 4698 Asplund M., Grevesse N., Sauval A. J., Scott P., 2009, ARA&A,
47, 481 Behroozi P. S., Wechsler R. H., Conroy C., 2013, ApJ, 770, 57 Brook C. B., et al., 2012, MNRAS, 426, 690

Implementation of PhEW 19
Brook C. B., Stinson G., Gibson B. K., Shen S., Maccio` A. V., Obreja A., Wadsley J., Quinn T., 2014, MNRAS, 443, 3809
Bru¨ggen M., Scannapieco E., 2016, ApJ, 822, 31 Cottle J., Scannapieco E., Bru¨ggen M., Banda-Barrag´an W., Fed-
errath C., 2020, ApJ, 892, 59 Cullen L., Dehnen W., 2010, MNRAS, 408, 669 Dalla Vecchia C., Schaye J., 2008, MNRAS, 387, 1431 Dalla Vecchia C., Schaye J., 2012, MNRAS, 426, 140 Dav´e R., Oppenheimer B. D., Katz N., Kollmeier J. A., Weinberg
D. H., 2010, MNRAS, 408, 2051 Dav´e R., Thompson R., Hopkins P. F., 2016, MNRAS, 462, 3265 Dav´e R., Angl´es-Alca´zar D., Narayanan D., Li Q., Rafieferantsoa
M. H., Appleby S., 2019, MNRAS, 486, 2827 De Grandi S., Molendi S., 2001, ApJ, 551, 153 Durier F., Dalla Vecchia C., 2012, MNRAS, 419, 465 Escala I., et al., 2018, MNRAS, 474, 2194 Finlator K., Dav´e R., Papovich C., Hernquist L., 2006, ApJ,
639, 672 Ford A. B., Oppenheimer B. D., Dav´e R., Katz N., Kollmeier J. A.,
Weinberg D. H., 2013, MNRAS, 432, 89 Ford A. B., Dav´e R., Oppenheimer B. D., Katz N., Kollmeier J. A.,
Thompson R., Weinberg D. H., 2014, MNRAS, 444, 1260 Ford A. B., et al., 2016, MNRAS, 459, 1745 Frenk C. S., et al., 1999, ApJ, 525, 554 Gabor J. M., Dav´e R., 2012, MNRAS, 427, 1816 Genel S., Vogelsberger M., Nelson D., Sijacki D., Springel V., Hern-
quist L., 2013, MNRAS, 435, 1426 Haardt F., Madau P., 2012, ApJ, 746, 125 Hafen Z., et al., 2017, MNRAS, 469, 2292 Hernquist L., Katz N., 1989, ApJS, 70, 419 Hirai Y., Saitoh T. R., 2017, ApJ, 838, L23 Hopkins P. F., 2013, MNRAS, 428, 2840 Hopkins P. F., 2015, MNRAS, 450, 53 Hopkins P. F., et al., 2018, MNRAS, 480, 800 Hu C.-Y., Naab T., Walch S., Moster B. P., Oser L., 2014, MNRAS,
443, 1173 Huang S., et al., 2019, MNRAS, 484, 2021 Huang S., Katz N., Dav´e R., Oppenheimer B. D., Weinberg D. H.,
Fardal M., Kollmeier J. A., Peeples M. S., 2020a, MNRAS, 493, 1 Huang S., Katz N., Scannapieco E., Cottle J., Dav´e R., Weinberg D. H., Peeples M. S., Bru¨ggen M., 2020b, MNRAS, 497, 2586 Hummels C. B., et al., 2019, ApJ, 882, 156 Katz N., Weinberg D. H., Hernquist L., 1996, ApJS, 105, 19 Kennicutt Jr. R. C., 1998, ApJ, 498, 541 Keres D., Katz N., Weinberg D. H., Dav´e R., 2005, MNRAS, 363, 2 Keres D., Katz N., Fardal M., Dav´e R., Weinberg D. H., 2009, MNRAS, 395, 160 Kim C.-G., Ostriker E. C., 2015, ApJ, 815, 67 Kitayama T., Suto Y., 1996, ApJ, 469, 480 Krumholz M. R., Gnedin N. Y., 2011, ApJ, 729, 36 Leccardi A., Molendi S., 2008, A&A, 487, 461 Lehner N., et al., 2013, ApJ, 770, 138 Li Z., Hopkins P. F., Squire J., Hummels C., 2019, arXiv e-prints, p. arXiv:1909.02632 Mandelker N., van den Bosch F. C., Springel V., van de Voort F., 2019, ApJ, 881, L20 Martizzi D., Fielding D., Faucher-Gigu`ere C.-A., Quataert E., 2016, MNRAS, 459, 2311 McCourt M., O'Leary R. M., Madigan A.-M., Quataert E., 2015, MNRAS, 449, 2 McCourt M., Oh S. P., O'Leary R., Madigan A.-M., 2018, MNRAS, 473, 5407 McKee C. F., Cowie L. L., 1975, ApJ, 195, 715 Molendi S., Eckert D., De Grandi S., Ettori S., Gastaldello F., Ghizzardi S., Pratt G. W., Rossetti M., 2016, A&A, 586, A32 Muratov A. L., Keres D., Faucher-Gigu`ere C.-A., Hopkins P. F., Quataert E., Murray N., 2015, MNRAS, 454, 2691
MNRAS 000, 1­21 (0000)

20 S. Huang et al.

Naab

T.,

Ostriker

J.

P.,

2017,

Annual Review of Astronomy and Astrophysics, 55, 59

Oppenheimer B. D., Dav´e R., 2006, MNRAS, 373, 1265

Oppenheimer B. D., Dav´e R., 2008, MNRAS, 387, 577

Oppenheimer B. D., Dav´e R., 2009, MNRAS, 395, 1875

Oppenheimer B. D., Dav´e R., Keres D., Fardal M., Katz N.,

Kollmeier J. A., Weinberg D. H., 2010, MNRAS, 406, 2325

Oppenheimer B. D., Dav´e R., Katz N., Kollmeier J. A., Weinberg

D. H., 2012, MNRAS, 420, 829

Peeples M. S., et al., 2019, ApJ, 873, 129

Pilkington K., et al., 2012, MNRAS, 425, 969

Pillepich A., et al., 2018, MNRAS, 473, 4077

Price D. J., 2008, Journal of Computational Physics, 227, 10040

Prochaska J. X., et al., 2017, ApJ, 837, 169

Rennehan D., 2021, arXiv e-prints, p. arXiv:2104.07673

Revaz Y., Arnaudon A., Nichols M., Bonvin V., Jablonka P., 2016,

A&A, 588, A21

Scannapieco E., Bru¨ggen M., 2015, ApJ, 805, 158

Scannapieco C., et al., 2012, MNRAS, 423, 1726

Schaye J., et al., 2015, MNRAS, 446, 521

Schneider E. E., Robertson B. E., 2017, ApJ, 834, 144

Sembolini F., et al., 2016, MNRAS, 459, 2973

Shen S., Wadsley J., Stinson G., 2010, MNRAS, 407, 1581

Smagorinsky J., 1963, Monthly Weather Review, 91, 99

Smith B. D., et al., 2017, MNRAS, 466, 2217

Springel V., 2005, MNRAS, 364, 1105

Springel V., Hernquist L., 2003, MNRAS, 339, 312

Stinson G., Seth A., Katz N., Wadsley J., Governato F., Quinn T.,

2006, MNRAS, 373, 1074

Su K.-Y., Hopkins P. F., Hayward C. C., Faucher-Gigu`ere C.-A.,

Keres D., Ma X., Robles V. H., 2017, MNRAS, 471, 144

Tremmel M., Karcher M., Governato F., Volonteri M., Quinn

T. R., Pontzen A., Anderson L., Bellovary J., 2017, MNRAS,

470, 1121

Tumlinson J., Peeples M. S., Werk J. K., 2017, ARA&A, 55, 389

Wiersma R. P. C., Schaye J., Smith B. D., 2009, MNRAS, 393, 99

van de Voort F., Springel V., Mandelker N., van den Bosch F. C.,

Pakmor R., 2019, MNRAS, 482, L85

APPENDIX A: A COMPARISON BETWEEN GADGET AND GIZMO WITHOUT PHEW
Simulations that use different numerical algorithms for solving hydrodynamic equations are known to produce different results in both high resolution simulations on small-scale hydrodynamic processes (Agertz et al. 2007; Hu et al. 2014; Hopkins 2015) and in large-scale cosmological simulations (Frenk et al. 1999; Scannapieco et al. 2012; Sembolini et al. 2016; Huang et al. 2019).
In this work we implement the PhEW model into gizmo and show how it affects the properties of galaxies and haloes in gizmo simulations. The gizmo MFM method solves hydrodynamics very differently from the gadget-3 (Springel 2005) SPH method. Hopkins (2015) shows that the two algorithms produce different results in various standard hydrodynamic test problems. In addition, our version of gizmo also includes different cooling and star formation algorithms than we used in our gadget-3 simulations, as outlined in the main text. Hence, to isolate changes from our previous published simulations that owe to switching from our gadget-3 to our gizmo code, we evolved a non-PhEW simulation using our fiducial gadget-3 model (Huang et al. 2020a) to study how gizmo simulations compare to gadget-3 simulations using the same sub-grid wind model.
MNRAS 000, 1­21 (0000)

Figure A1. The galactic stellar mass functions at z = 0. Here we compare the gadget-3 simulation (green) with several gizmo simulations, including the l50n288-phewoff (blue, MFM method without the PhEW model), the l50n288-phew-m5 (red, MFM method with the PhEW model), the l50n288-phewoff-sph (pink, PE-SPH method without the PhEW model) and the l50n288-phew-m5-sph simulation (red, PE-SPH method with the PhEW model). The results from the two simulations with the PhEW are close to each other, even though they use different hydrodynamic solvers, while the results from the three simulations without the PhEW are very different.
This simulation, l50n288-gadget3, represents our previous simulations that model galactic winds with the subgrid model of Huang et al. (2020a), and using our previous cooling and star formation algorithms. Here we use a version of the gadget-3 code (Huang et al. 2019) that employs the pressure-entropy SPH formulation (PESPH) (Hopkins 2013), the Cullen & Dehnen (2010) artificial viscosity, artificial conduction (Price 2008), and a timestep limiter (Durier & Dalla Vecchia 2012). It models nonequilibrium cooling using the Wiersma et al. (2009) model and a Haardt & Madau (2012) UV background and models the interstellar medium and star formation using the effective equation of state model of Springel & Hernquist (2003) based on the observed Kennicutt (1998) relation.
In addition, we performed two simulations with gizmo using its implementation of the PE-SPH method instead of the MFM method, one without the PhEW (l50n288-phewoffsph) and one with the PhEW (l50n288-phew-m5-sph). The PE-SPH method in the gizmo simulations also uses the Cullen & Dehnen (2010) artificial viscosity and artificial conduction as in the gadget-3 simulation. We use the same cooling and the star formation algorithms in these simulation as in the other gizmo simulations.
Figure A1 compares the z = 0 GSMFs from these simulations. Their GSMFs at higher redshifts (z 1) are similar to each other. We run all these simulations with the same initial density field but using different numerical methods for solving hydrodynamics, i.e. SPH methods implemented

Implementation of PhEW 21

Figure A2. The composition of baryons in galactic haloes at z = 0 similar to Figure 9. The dashed and solid lines indicate results from the gadget-3 simulations and the gizmo simulations, respectively. The shaded area corresponds to the 1 scatter from the gizmo simulation.
separately in gadget-3 and gizmo and the MFM method in gizmo. The GSMFs between the non-PhEW simulations (l50n288-gadget3, l50n288-phewoff and l50n288-phewoff-sph) are different over a wide range of masses. On the other hand, the GSMFs of the PhEW simulations are nearly identical with each other. This shows that when one changes the numerical hydrodynamic method or the numerical resolution in simulations using PhEW it only marginally affects the z = 0 GSMF, again demonstrating the numerical robustness of PhEW. However, when using traditional wind propogation techniques, i.e. not using PhEW, there are significant differences in the results.
Figure A2 suggests that the cold and hot gas fractions between the two simulations are similar as well, except that the amount of cold gas is lower in the gizmo (l50n288-phewoff) simulation. These results are consistent with previous findings that the large scale properties of gas and stars from cosmological simulations are robust to changes in numerical algorithms even if they may have a large impact on small scale physics (Hu et al. 2014; Huang et al. 2019).
However, Figure A3 shows that the different hydrodynamics in gadget-3 and gizmo have a strong effect on the dynamics of wind particles, especially in massive haloes. Even though wind particles in both simulations have the same initial velocities at any given halo mass, those from the gizmo (l50n288-phewoff) simulation slow down faster than in the gadget-3 (l50n288-gadget3) simulation. As a result, wind particles become significantly slower in the gizmo (l50n288phewoff) simulation at 0.25Rvir. Therefore, wind recycling is faster and more frequent in the gizmo (l50n288-phewoff) simulation, leading to more star formation in massive galaxies.
It is important to note, however, that neither gadget-3 nor gizmo actually resolves the small scale interactions between the winds and the surrounding gas, making the wind

Figure A3. The same as Figure 4, except that we now compare the results from the gadget-3 (l50n288-gadget3) and the gizmo (l50n288-phewoff) simulations. Both simulations launch winds using the same sub-grid model, but the different hydrodynamics of the two simulations affect wind propagation very differently. dynamics in both methods suspect and sensitive to both numerical resolution and numerical artefacts. In contrast, the PhEW model is very robust to both the numerical hydrodynamic algorithm and is almost independent of the numerical resolution. This paper has been typeset from a TEX/LATEX file prepared by the author.
MNRAS 000, 1­21 (0000)

