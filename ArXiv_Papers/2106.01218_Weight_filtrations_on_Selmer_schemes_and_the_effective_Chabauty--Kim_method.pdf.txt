arXiv:2106.01218v1 [math.NT] 2 Jun 2021

WEIGHT FILTRATIONS ON SELMER SCHEMES AND THE EFFECTIVE CHABAUTY­KIM METHOD
L. ALEXANDER BETTS
Abstract. We develop an effective version of the Chabauty­Kim method which gives explicit upper bounds on the number of S-integral points on a hyperbolic curve in terms of dimensions of certain Bloch­Kato Selmer groups. Using this, we give a new "motivic" proof that the number of solutions to the S-unit equation is bounded uniformly in terms of #S.

Contents

1. Introduction

1

2. Weight filtrations and Hilbert series

8

3. Filtrations on Selmer schemes

18

4. Weights and Coleman analytic functions

31

5. Bounding zeroes of Coleman algebraic functions

44

6. Effective Chabauty­Kim

57

7. S-uniformity in Siegel's Theorem

69

References

72

1. Introduction
One of the crowning achievements of 20th century number theory was the resolution of the Mordell Conjecture, showing that the set X(K) of K-rational points on a smooth projective geometrically connected curve X of genus g  2 over a number field K is finite. Since then, a major open question is whether the Mordell Conjecture can be made effective, by which is meant any of the following.
(1) Giving an algorithm to compute X(K). (2) Giving a computable upper bound on the height of K-rational points of X. (3) Giving a computable upper bound on #X(K).
In this paper, we give a complete resolution of (3) in the case K = Q subject to the Bloch­Kato Conjecture. We do this using a strengthening of Minhyong Kim's method of non-abelian Chabauty which systematically incorporates weight filtrations on Selmer schemes. The weight-filtered Chabauty­Kim method we develop in this paper is always effective in the sense of (3), and also yields some algorithmic consequences in the direction of point (1).
The input in the usual Chabauty­Kim method is a finite-dimensional GQ-equivariant quotient U of the Qp-pro-unipotent ´etale fundamental group U´et of XQ based at a point b  X(Q), where p is a prime of good reduction for X. If we write (Vn)n1 for
Date: June 3, 2021. 1

2

L. ALEXANDER BETTS

the graded pieces of the descending central series, then the Chabauty­Kim method shows that when the inequality

(1.0.1)

dim H1f (GQ, Vn) < dim H1f (Gp, Vn)

n

n

between the dimensions of the global and local Bloch­Kato Selmer groups of the Vn holds, then there is a non-zero Coleman analytic function f on XQp which vanishes on X(Q). In particular, (1.0.1) implies finiteness of the set X(Q).

Much of the interest in the Chabauty­Kim method derives from the fact that it has been made effective for specific quotients U . When the p-Selmer rank of the
Jacobian J of X is strictly less than the genus, then inequality (1.0.1) holds for U = (U´et)ab the abelianisation of the fundamental group, and the Coleman analytic function f produced by the Chabauty­Kim method is the Coleman integral of a
holomorphic 1-form  on XQp . So the Chabauty­Kim method in this case recovers the usual Chabauty method. Given enough independent points in J(Q), the 1form  and hence the function f can be computed to any desired p-adic precision,
and this allows one in some cases to compute X(Q) exactly [PM12, FPS97, Poo98]. In general, even without finding f , Coleman showed that it is possible to bound
#X(Q) in terms of g and the number of Fp-points on X [Col85]. When instead the p-Selmer rank of the Jacobian J is equal to the genus, and
the rational N´eron­Severi rank of J is at least 2, then there is a quotient U of U´et
which is a central extension of the abelianisation by Qp(1), and inequality (1.0.1) holds for this quotient. The Coleman analytic function f produced in this case can be expressed as a double Coleman integral of meromorphic 1-forms on XQp . Again, if X has sufficiently many rational points, then the function f can be determined to any desired precision, and this can be used to compute X(Q) in several cases [BD18, BDM+19]. And even without computing f , knowing its general form can
be used to give an explicit bound on #X(Q) [BD19a].

However, for a general quotient U , the Chabauty­Kim method does not afford any control over the function f , and so tells us nothing about X(Q) beyond its finiteness. This is what we address in this paper. In order to state our main theorem, let us say that two rational points x, y  X(Q) have the same reduction type just when they reduce onto the same component of the mod- special fibre of the minimal regular model of X for all primes . We write X(Q) for the set of all rational points of a given reduction type . These sets form a finite partition of the set X(Q).

Theorem A. Let (cgi lob)i0 and (clioc)i0 be the coefficients of the power series





HSglob(t) :=

(1-tn)- dim H1f (GQ,Vn) and HSloc(t) :=

(1-tn)- dim H1f (Gp,Vn) ,

n1

n1

which are non-negative integers. Suppose that m is a positive integer such that the inequality

(1.0.2)

m

m

cgi lob <

clioc

i=0

i=0

holds. Then for every reduction type , the set X(Q) is contained in the vanishing locus of a non-zero Coleman analytic function f of weight at most m.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

3

The advantage of this theorem over the more usual set-up in the Chabauty­Kim method is that it offers some a priori control on the Coleman analytic function f , in the form of a bound on its weight. We will explain in §4.1.3 what is meant by the weight of a Coleman analytic function, but in the context of effectivity questions, the significance of this notion of weight is twofold.
(1) For all m  0, the space of Coleman analytic functions of weight  m is finite-dimensional. (Corollary 4.2.4.)
(2) For all m  0, there is an explicit uniform bound on the number of zeroes of a non-zero Coleman analytic function of weight  m. (Theorem 5.0.1.)
In particular, Theorem A gives us effective Chabauty­Kim results for a general quotient U . The first of these is an explicit upper bound on the number of rational points on any curve X to which the method applies, generalising the bounds of Coleman and Balakrishnan­Dogra.

Theorem B. Suppose that m is a positive integer such that inequality (1.0.2) holds.

Then

m-1

#X(Q)  p · n · #X(Fp) · (4g - 2)m · (clioc + 1) ,



i=1

where n denotes the number of components of the mod- special fibre of the minimal regular model of X, #X(Fp) denotes the number of Fp-points on the mod-p special fibre of the minimal regular model, and the positive constant p is defined by

p :=

1

+

p-1 (p-2) log(p)

2

+

2 log(2)

if p = 2, if p = 2.

It has been a long-standing expectation in the Chabauty­Kim community that if the inequality (1.0.1) holds for U = Un´et the maximal n-step unipotent quotient of the Qp-pro-unipotent ´etale fundamental group, then it should be possible to bound the number of rational points of X in terms of n. Theorem B realises this
expectation by giving the following coarse upper bound on #X(Q) in terms of n.

Corollary (to Theorem B). Suppose that inequality (1.0.1) holds for U = Un´et the maximal n-step unipotent quotient of the Qp-pro-unipotent ´etale fundamental group
where n  2. Then

#X(Q)  p ·

n

·

#X(Fp) · (4g

- 2)n(2g)n

·

(2g

)(n(2g)n 2

)

,



where n, #X(Fp) and p are as in Theorem B.

For any X/Q, inequality (1.0.1) is known to hold for some computable n  0 if one assumes the Bloch­Kato Conjecture [Kim09, §3]. So the above Corollary gives in particular an effective upper bound on #X(Q) for any X, subject to the Bloch­ Kato Conjecture. Moreover, in several cases, computable upper bounds on n can be computed without assuming Bloch­Kato e.g. [KC10]. Explicit values for these upper bounds on #X(Q) will be given in future work.

The other consequence of Theorem A in the context of effective Chabauty­Kim is that it constrains the Coleman analytic function f to lie in a finite-dimensional space, and so when X has sufficiently many rational points, it is possible to find f using the method of undetermined coefficients, i.e. using the equations f (xi) = 0

4

L. ALEXANDER BETTS

for some points xi  X(Q) to solve for f . To state this formally, we adopt the

shorthand Cmglob :=

m i=0

cgi lob

and

Cmloc

:=

m i=0

clioc.

Theorem C. Suppose that m is a positive integer such that (1.0.2) holds. Let f1, . . . , fCm loc be a basis of the space of Coleman analytic functions of weight  m associated to the quotient U in the sense of §6.2. Then for any Cmglob + 1 points x0, x1, . . . , xCm glob  X(Q) of the same reduction type , all (Cmglob +1)×(Cmglob +1) minors of the matrix M with entries Mij = fi(xj ) vanish.

In particular, fixing the points x1, . . . , x , Cm glob the minors of the matrix M provide Coleman analytic functions in the variable x0 which vanish on X(Q). There is no
guarantee that the functions obtained in this way are non-zero (e.g. if X has fewer than Cmglob rational points overall), but in the cases when it is non-zero, it gives an explicit Coleman analytic function on XQp vanishing on X(Q), computable to any desired p-adic precision.

Remarks. 1) The Chabauty­Kim method applies not just to rational points on smooth projective curves X of genus  2, but more generally to S-integral points on regular models Y/ZS of smooth hyperbolic curves Y /Q, for S any finite set of primes. We will in fact prove all of our main results in this greater level of generality: see Theorem 6.2.1. Theorems A, B and C are recovered from these more general results by taking Y = X, S = , and Y/Z the minimal regular model of X. In dealing with affine curves, an extra technicality arises in that the space of Coleman analytic functions of weight  m is infinite-dimensional, so we cannot hope to bound the number of zeroes of a Coleman analytic function in terms of its weight. To resolve this issue, we introduce in §4.1.2 a subspace, which we call the space of Coleman algebraic functions, which agrees with the space of Coleman analytic functions in the projective case, but is better behaved in the affine case.
2) Although the Chabauty­Kim method is only usually applied to quotients U that are finite-dimensional, our Theorems A, B and C also apply in the case that U is infinite-dimensional. We will see in §7 that this extra flexibility can sometimes be useful in calculations.
3) The factor of (4g - 2) appearing in Theorem B is not optimal. It can always be improved to (4g - 3), and in some special cases yet smaller values suffice. See §5.4.
4) When U dominates the abelianisation of the fundamental group, the first exponent H1f (GQ, V1) appearing in HSglob(t) is the p-Selmer rank of J . The pSelmer rank is greater than or equal to the Mordell­Weil rank of J(Q), with equality if and only if the p-divisible part of the Tate­Shafarevich group of J vanishes, as predicted by the Tate­Shafarevich Conjecture. Using a trick of Balakrishnan­Dogra (see §6.3), one can circumvent the apparent need to assume the Tate­Shafarevich Conjecture in order to compute HSglob(t): Theorems A, B and C still hold verbatim when the power series HSglob(t) is replaced by the power series



HSBglDob(t) := (1 - t)- rk(J(Q)) ·

(1 - tn)- dim H1f (GQ,Vn) .

n=2

5) There are also versions of Theorems A and C which apply to the whole set X(Q), rather than the subsets X(Q) individually: see Theorem 6.0.2. The price one pays is that the weight of the Coleman analytic function vanishing on

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

5

the whole of X(Q) is in general larger than the weights of the Coleman analytic functions vanishing on each X(Q) separately. This weight discrepancy means that bounding the sizes of the sets X(Q) individually usually gives better bounds than bounding the size of X(Q) directly. These versions of Theorems A and C for X(Q) were already obtained in unpublished work of Francis Brown [Bro], using related ideas to those we develop in the first half of this paper.
1.1. Application: S-uniformity in Siegel's Theorem. One feature of the version of Theorem B we prove for S-integral points on affine curves is that the bound depends only weakly on the set S of primes. In particular, it always provides upper bounds which are S-uniform, meaning that they depend only on the number of primes in S, and not on the set S itself. For example, our effective Chabauty­Kim method proves the following S-uniform upper bound on the number of solutions to the S-unit equation.
Theorem D. Let Y := P1 \ {0, 1, }, and let s be a non-negative integer. Then for every set S of primes of size s, we have
#Y(ZS )  8 · 6s · 24s .
S-uniform bounds of this kind are already known via analytic techniques. The best available upper bound is #Y(ZS )  3 · 72s+3, due to Evertse [Eve84, Theorem 1]. Our bound in Theorem D, being doubly exponential in s, is much weaker than Evertse's; what is of interest here is not so much the specific bound than the method used to obtain it, demonstrating the applicability of the Chabauty­ Kim programme to uniformity questions. Tantalisingly, it suggests that it may be possible to use Theorem B to prove uniformity results of a similar type to [KRZB16, DGH].
1.2. Examples. As an illustration of the kinds of explicit results one can obtain from Theorem B, we give a few examples showing that it recovers as special cases both the effective Chabauty results of Coleman and the effective quadratic Chabauty results of Balakrishnan­Dogra, as well as giving a new example from quadratic Chabauty which goes beyond [BD19a].
Throughout these examples, we assume the Tate­Shafarevich Conjecture, which ensures that
dimQp H1f (GQ, H´1et(XQ, Qp)) = rk(J (Q)) for every smooth projective curve X/Q with Jacobian J. But all the bounds in the below examples are still true without this assumption; see §6.3.
Example 1.2.1. Suppose that the rank of the Jacobian J of X is strictly less than the genus g. We take U = U1 := (U´et)ab. Then the representations Vn are zero for n > 1, and V1 is the Qp-linear Tate module of the Jacobian J of X. The power series HSglob(t) and HSloc(t) are given by
HSglob(t) = (1 - t)- rk J(Q) = 1 + rk(J (Q))t + . . .
HSloc(t) = (1 - t)-g = 1 + gt + . . . .
Thus the assumption that rk(J(Q)) < g implies that inequality (1.0.2) holds for m = 1, so Theorem B provides the bound
#X(Q)  p · n · #X(Fp) · (4g - 2)


6

L. ALEXANDER BETTS

whenever p is a prime of good reduction for X. This bound is worse than the upper bound of #X(Fp) + 2g - 2 proved by Coleman in the case p > 2g [Col85, Corollary 4a & §1], and is indicative of the extra complications which arise when dealing with genuinely non-abelian quotients of the fundamental group.

Example 1.2.2. Suppose that the rank of the Jacobian J of X is equal to the
genus g, and suppose that the rational N´eron­Severi rank of J is strictly bigger
than 1. Then according to [BD18, Proof of Lemma 3.2], the Qp-pro-unipotent ´etale fundamental group of X has a quotient U which is a central extension of the abelianisation of U´et by Qp(1). For this quotient U , we have

HSglob(t)

=

(1

-

t)- rk J(Q)

=

1

+

gt

+

g(g + 2

1) t2

+

.

.

.

HSloc(t) = (1 - t)-g(1 - t2)-1 = 1 + gt +

g(g + 2

1)

+

1

t2 + . . . .

Inequality (1.0.2) holds for m = 2, so Theorem B provides the bound

#X(Q)  p · n · #X(Fp) · (16g3 - 12g + 4)

whenever p is a prime of good reduction for X. This is actually slightly better than the upper bound of p ·  n · #X(Fp) · (16g3 + 15g2 - 16g + 10) obtained by Balakrishnan­Dogra in the case that p is odd [BD19a, Theorem 1.1(i)]. We will explain this in Remark 4.1.14.

Remark 1.2.3. Strictly speaking, the constants n in our Theorem B are not the same as the constants denoted n in [BD19a], which are instead defined as the size of the image of X(Q) under the non-abelian Kummer map j,U at  [BD19a, §2]. We always have #j,U (X(Q))  n, and in fact Theorem B still holds if we replace the constants n with the smaller constants #j,U (X(Q)) (see Remarks 6.1.2 and 6.2.2).

We conclude with another example from quadratic Chabauty which illustrates that the bounds from Theorem B can be quite large, even in relatively simple situations.

Example 1.2.4. Suppose that the rank of the Jacobian J of X is equal to g + 1,

and suppose that the rational N´eron­Severi rank of J is strictly bigger than 2. By

[BD18, Proof of Lemma 3.2] again, the Qp-pro-unipotent ´etale fundamental group of X has a quotient U which is a central extension of the abelianisation of U´et by Qp(1)2. To find a value of m for which inequality (1.0.2) holds, we employ a
computational trick which we will use at several points in this paper, considering

instead the more manageable series

(1 + t)2 1-t

HSglob(t)



4(1

-

t)-g-2

=

4

·



i+g+1 g+1

ti ,

i=0

(1 + t)2 1-t

HSloc(t)

=

(1

-

t)-g-3

=



i+g+2 g+2

ti ,

i=0

where  denotes componentwise inequality of power series. One checks straightfor-

wardly

that

the

coefficient

of

t3g+7

in

(1+t)2 1-t

HSglob

(t)

is

strictly

less

than

the

corre-

sponding coefficient in

(1+t)2 1-t

HSloc

(t).

This

implies

that

there must

be some

m

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

7

3g + 7

such

that

the

mth

coefficient

of

1 1-t

HSglob

(t)

is

strictly

less

than

the

corre-

sponding

coefficient

in

1 1-t

HSloc

(t)

(in

fact,

one

of

m

=

3g + 7, 3g + 6, 3g + 5

works).

Since

the

coefficients

of

1 1-t

HS?(t)

are

the

partial

sums

of

the

coefficients

of

HS?(t),

we thus know that (1.0.2) holds for some m  3g + 7.

Combined with the elementary estimate clioc + 1 

i+g+1 g+1

for i  1, Theorem B

gives the bound

#X(Q)  p ·

3g+6
n · #X(Fp) · (4g - 2)3g+7 ·

i+g+1 g+1



i=1

whenever p is a prime of good reduction for X. Note that, despite the superficial similarities with Example 1.2.2, the dependence of this bound on g is much worse, being super-exponential as opposed to cubic. It seems likely that the above bound is very far from sharp.

1.3. Outline of the method. To give an idea of the techniques developed in this paper, let us sketch how the effective Chabauty­Kim method we develop here differs from the original one from [Kim05, Kim09, BDCKW18, BD19b]. The usual Chabauty­Kim method studies the rational points of X/Q inside the p-adic points via a certain commuting square

X (Q)

X (Qp )

jU

jp,U

SelU (Qp) locp H1f (Gp, U )(Qp) .

Both sets on the bottom row are the Qp-points of affine Qp-schemes (SelU being the Selmer scheme as defined in [BDCKW18, p. 371]), and the localisation map locp is a morphism of Qp-schemes. By comparison with crystalline fundamental groups, one shows that the local non-abelian Kummer map jp,U is a Coleman analytic map with Zariski-dense image, whose coordinates are given by iterated Coleman integrals.
When inequality (1.0.1) holds, we have dim SelU < dim H1f (Gp, U ), from which one deduces that the localisation map locp is non-dominant. Thus, there is a nonzero algebraic functional  : H1f (Gp, U )  A1Qp vanishing on the scheme-theoretic image of locp. This implies that the composite f :=   jp,U is a non-zero Coleman analytic function vanishing on the rational points of X.
Of course, this construction affords no control on f at all. The way we obtain some a priori control over f is to exploit an extra structure on the schemes SelU and H1f (Gp, U ) in the form of a weight filtration W· on their affine rings, induced from the weight filtration (=descending central series) on U . Using this weight filtration, we will prove the following additional properties of the Chabauty­Kim square:
· the map locp : O(H1f (Gp, U ))  O(SelU ) is compatible with the weight filtration;
· for every   WmO(H1f (Gp, U )), the composite   jp,U is a Coleman analytic function of weight at most m.

8

L. ALEXANDER BETTS

Assume now for simplicity that X has everywhere potentially good reduction, which implies that all rational points have the same reduction type. When inequality (1.0.2) holds for m, a Hilbert series computation shows that
dim WmO(SelU ) < dim WmO(H1f (Gp, U )) ,
and hence that the map locp : WmO(H1f (Gp, U ))  WmO(SelU ) must fail to be injective. Hence there is some non-zero   WmO(H1f (Gp, U )) vanishing on the image of locp, so f :=   jp,U is a non-zero Coleman analytic function of weight at most m vanishing on X(Q). This proves Theorem A in the case of everywhere potentially good reduction.
Theorem C is a formal consequence. For Theorem B, we need to combine Theorem A with an upper bound on the number of zeroes of a non-zero Coleman analytic function f in terms of its weight. This latter we accomplish by means of the "nice differential operators" machinery of [BD19a], by writing down a suitable differential equation satisfied by f .
Overview of sections. The proofs of our main theorems require two main ingredients: endowing the local and global Selmer schemes with weight filtrations, and bounding the number of zeroes of a Coleman algebraic function in terms of its weight. The first part we accomplish in §2 and §3, with §2 establishing basic results on filtered schemes, and §3 applying these to construct weight filtrations on the affine rings of Selmer schemes. The second part we accomplish in §4 and §5, with §4 giving the definition of Coleman algebraic functions and their weights, and §5 using a version of the "nice differential operators" machinery of [BD19a] to bound the number of zeroes of a Coleman algebraic function in terms of its weight.
These two strands are then combined in §6 to set up our effective Chabauty­Kim theory and prove all of the main results: Theorems A, B and its Corollary, and C. §7 is then devoted to an in-depth analysis of the case of the thrice-punctured line, and proves Theorem D, our S-uniform Siegel's Theorem.
Acknowledgements. I am pleased to thank Netan Dogra and Jennifer Balakrishnan for explaining to me their thoughts on effective Chabauty­Kim, and to thank Pierre Berthelot, Noam Elkies, Majid Hadian, Richard Hain, Minhyong Kim, Martin Olsson, Jonathan Pridham and Umberto Zannier for taking the time to answer my questions during the writing of this paper. I am grateful to Alex Best, Jennifer Balakrishnan and Netan Dogra for their comments and corrections on a preliminary version of this article; in particular, both the use of Lemma 6.0.1 and the content of §5.4 came about as a result of their suggestions. I was a guest of the Max-Planck Institut fu¨r Mathematik while I wrote this paper, and I gratefully acknowledge their support.

2. Weight filtrations and Hilbert series
In this section, we discuss the theory of filtered rings and their Hilbert series. §2.1 is devoted to recalling the basic definitions, and to describing in detail some of the examples which will recur throughout this paper. The second section §2.2 is devoted to a rather less trivial example, showing that the continuous Galois cohomology scheme with coefficients in a filtered Qp-pro-unipotent group U admits a natural filtration induced from that on U . This construction is fundamental in the theory we set up, since the local and global Selmer schemes of the Chabauty­Kim

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

9

method are all closed subschemes of continuous Galois cohomology schemes, and this construction is how we will endow them with filtrations.

2.1. Filtrations on affine schemes. To begin with, we fix notation and terminology which will be in use throughout this section. We fix a field F of characteristic 0, which for us will almost always be equal to Qp. A filtration (or weight filtration when we want to distinguish it from e.g. a Hodge filtration) on an F -algebra A consists of an increasing sequence
W0A  W1A  W2A  · · ·  A
of F -subspaces which is compatible with the multiplication on A, in the sense that 1  W0A and if x  WiA and y  WjA then xy  Wi+j A. In practice, almost all of the filtrations we will consider will be exhaustive (A = i WiA), have each WiA finite-dimensional and satisfy W0A = F , but we will not assume this in general.
A filtered affine F -scheme is an affine F -scheme X endowed with a filtration on its affine ring O(X); a filtered morphism of filtered affine F -schemes is one which is compatible with the filtration. We denote the category of filtered affine F -schemes by W·Aff F , which is dual to the category W·AlgF of filtered F -algebras. When we want to distinguish between a filtered affine F -scheme and its underlying affine F -scheme, we denote the former by X (for example) and the latter by X.
The category W·Aff F admits many of the same constructions as the category of affine F -schemes, such as finite disjoint unions, products, and more generally all small limits1. A common construction we will see throughout this paper is that if X is a filtered affine F -scheme and Z is a closed F -subscheme of its underlying F -scheme X, then there is an induced filtration on O(Z), namely the image of the filtration on O(X) under the map O(X)  O(Z). We refer to this simply as the induced filtration on Z. The equaliser of a pair of maps X  Y of filtered affine F -schemes is always a closed F -subscheme of X with the induced filtration.

2.1.1. Hilbert series. The Hilbert series of a filtered affine F -scheme X is the formal

power series

HSX (t) := dimF grW i O(X) ti  N 0 [[t]]

i0

whose coefficients are non-negative integers or . We let denote the partial

ordering on N 0 [[t]] where i0 aiti

i0 aiti just when

n i=0

ai



n i=0

ai

for

all n. In other words, HS(t)

HS(t)

just

when

1 1-t

HS(t)



1 1-t

HS

(t)

coefficient-

wise. We will frequently use the following easily-verified properties of Hilbert series

and the relation .

Lemma 2.1.1. Let HS1(t) HS1(t) and HS2(t) HS2(t) be elements of N 0 [[t]]. Then HS1(t) + HS2(t) HS1(t) + HS2(t) and HS1(t) · HS2(t) HS1(t) · HS2(t). The same holds for infinite sums and products.

Lemma 2.1.2. (1) If X1 and X2 are filtered affine F -schemes, then HSX1×X2 (t) = HSX1 (t) · HSX2 (t) . The same holds for infinite products.

1In fact, it also has all small colimits, but these are not so well-behaved.

10

L. ALEXANDER BETTS

(2) If X is a filtered affine F -scheme and Z  X is a closed subscheme with the induced filtration, then
HSZ (t) HSX (t) .
(3) If f : X  X is a filtered morphism which is scheme-theoretically dense (e.g. f dominant and X reduced), then we have
HSX (t) HSX (t) .
2.1.2. Functors of points. We will often define filtered affine F -schemes in terms of the functors they represent. If X is a filtered affine F -scheme and  a filtered F -algebra, then we write
X() := HomW·AlgF (O(X), ) for the set of -valued points of X. The assignment   X() is a functor W·AlgF  Set: the functor of points of X. The Yoneda Lemma ensures that any natural transformation between the functors of points of two filtered affine F schemes is induced by a unique morphism of filtered affine F -schemes. Because of this, we do not distinguish notationally between a filtered affine F -scheme and its associated functor of points.
If Z  X is a closed subscheme with the induced filtration, then its functor of points is the subfunctor of the functor of points of X, consisting of all the morphisms Spec()  X of filtered affine F -schemes whose image (on the level of underlying topological spaces) is contained in Z.
The functor (-) : W·Aff F  Aff F given by forgetting the filtration admits a simple characterisation in terms of functors of points.
Lemma 2.1.3. Let X  W·Aff F be a filtered affine F -scheme. Then the underlying (non-filtered) affine F -scheme X of X represents the composite functor
AlgF -(---)t-riv W·AlgF -X-(--) Set , where (-)triv denotes the functor which endows an F -algebra  with the trivial filtration given by Wntriv =  for all n.
Proof. This is just a matter of chasing definitions. We have
X(triv) = HomW·AlgF (O(X), triv) = HomAlgF (O(X), ) = X() for every   AlgF , so X represents the functor   X(triv).
2.1.3. Examples: vector spaces and pro-unipotent groups. The following two examples play a basic role in the theory in this paper. We describe both examples in the most general setting where some objects may be infinite-dimensional, but the reader is free to assume that all objects involved are finite-dimensional on a first reading, which simplifies matters.
Example 2.1.4. A pro-finite-dimensional vector space is a pro-object of the category of finite-dimensional vector spaces. A filtration on a pro-finite-dimensional vector space V is an increasing sequence of subobjects
0  · · ·  W-3V  W-2V  W-1V = V ,
indexed by negative integers. A pro-finite-dimensional vector space V has an associated affine space, which
we also denote by V . If V is finite-dimensional, its associated affine space is

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

11

Spec(Sym·(V )). dimensional vector

In general, spaces, and

we the

write affine

V= space

lim- Vi as associated

an to

inverse limit of finiteV is Spec(Sym·(-lim Vi)).

If V is endowed with a filtration, then there is an induced filtration on the

isnytmo ma efitlrtiecreadlgaebffirnaeSFym-s·ch(l-eimmeV.iW), haenndVthiiss

makes the affine space associated to V finite-dimensional, the functor of points

of V is

  W0( F V ) ,

where  F V is endowed with the tensor product filtration; the general case is an inverse limit of this. The Hilbert series of V is

HSV (t) =

(1 - tn)- dimF (grW -nV ) .

n>0

Example 2.1.5. Let U/F be a pro-unipotent group. A filtration on U is an increasing sequence

1  · · ·  W-3U  W-2U  W-1U = U

of subgroup-schemes, indexed by negative integers, such that the image of the commutator map [·, ·] : W-iU × W-jU  U is contained in W-i-j U for all i, j  1.
The Lie algebra Lie(U ) := ker U (F []/(2))  U (F ) is naturally a pro-finite-
dimensional vector space, being the inverse limit of the Lie algebras of the finitedimensional quotients of U . A filtration on U corresponds under the logarithm isomorphism U = Lie(U ) to a filtration on Lie(U ) by F -subspaces for which the Lie bracket is a filtered map. Thus U becomes a filtered affine F -scheme by pulling back the filtration on O(Lie(U )) from Example 2.1.4 along the logarithm isomorphism U = Lie(U ). It is then easy to check that the multiplication map U × U  U and the identity map Spec(F )  U are morphisms of filtered affine F -schemes, so that the filtration on O(U ) is compatible with the Hopf algebra structure maps.
Most often, we will assume that the filtration on U is separated, by which we mean that nNW-nU = {1}.

Since filtered pro-unipotent groups will appear throughout this paper, we fix some notation for particular subquotients which will appear frequently.

Notation 2.1.6. If U is an F -pro-unipotent group with a filtration in the sense of Example 2.1.5, then we write2

Un := U/W-n-1U and Vn := grW -nU = W-nU/W-n-1U

for all n  1. Then Un is an F -pro-unipotent group and Vn is a vector group, which we often conflate with its underlying pro-finite-dimensional vector space. The quotient maps Un  Un-1 fit into central extensions

(2.1.1)

1  Vn  Un  Un-1  1

for n  2, Moreover, we have U = lim- Un in the category of affine F -schemes provided that the filtration W· is separated ( n W-nU = 1).
Both Un and Vn are naturally endowed with filtrations. In the case of Un we take the image of the filtration on U under the map U  Un, and in the case of Vn we give it the filtration supported in filtration-degree -n. With these conventions, (2.1.1)

2The quotients appearing in this expression are taken in the most naive possible sense: that is, the -points of Un is the quotient of the -points of U by those of W-n-1U for all F -algebras , and similarly for Vn.

12

L. ALEXANDER BETTS

is a central extension of filtered affine F -group schemes, in the strong sense that the maps Un  Un-1 and Vn  Un admit a splitting and retraction, respectively, in the category of filtered affine F -schemes. Moreover, the isomorphism U = lim- Un is an isomorphism in the category of filtered affine F -group schemes.

Remark 2.1.7. It is sometimes convenient to adopt the convention that W0U = U , so that U0 = W0U/W-1U is the trivial group, and we have the central extension (2.1.1) also for n = 1 (reflecting the fact that U1 = V1). This convention allows us, for example, to begin inductive arguments at n = 0, where the result is
usually trivial. See the proof of Lemma 3.1.8 for example.

The pro-unipotent fundamental groups which appear in this paper will all be pro-unipotent surface groups, or quotients thereof. For later use, we calculate here the Hilbert series of these groups.

Lemma 2.1.8. Let g and r be non-negative integers, not both zero, and let Ug,r denote the F -pro-unipotent completion of the surface group

g,r := a1, . . . , ag, b1, . . . , bg, c1, . . . , cr | [a1, b1] · . . . · [ag, bg] · c1 · . . . · cr = 1 .

We endow Ug,r with the filtration whereby W-1Ug,r = Ug,r, W-2Ug,r is the subgroup generated by the commutator subgroup of Ug,r and the elements c1, . . . , cr, and for k  3, W-kUg,r is the subgroup generated by the commutators of elements in W-iUg,r and W-j Ug,r for i + j = k.
With respect to this filtration, the Hilbert series of Ug,r is

()

HSUg,r (t)

=

1

-

1 2gt - (r

-

1)t2

.

Proof. When r > 0, () follows from the observation that Ug,r is the free pro-

unipotent group generated by the elements ai,bi and cj for 1  i  g and 1 

j  r - 1, and its weight filtration is the finest filtration for which each ai, bi 

W-1Ug,r and each cj  W-2Ug,r. This implies that O(Ug,r) is the shuffle algebra

on symbols Ai, Bi and Cj for 1  i  g and 1  j  r - 1, endowed with the

natural filtration coming from declaring that each Ai, Bi  W1O(Ug,r) and each

Cj  W2O(Ug,r). Thus the kth coefficient of HSUg,r is equal to the number of words in the letters (Ai)gi=1, (Bi)gi=1, (Cj )rj=-11 of total weight k. A standard combinatorial

argument shows that this is equal to the kth coefficient of (1 - 2gt - (r - 1)t2)-1 =

 l=0

(2gt

+

(r

-

1)t2)l,

as

claimed.

When r = 0, the filtration on Ug,r is its descending central series, so the dimen-

sions of the graded pieces of the Lie algebra of Ug,r are given by

dimF

grW -k Lie(Ug,r )

=

1 k

·

d|k

d/2 µ(k/d)  i=0 (-1)i d

d -

i

d-i i

 (2g)d-2i

by the main theorem of [Lab70]. The proof of [Lab70, Proposition 4] shows that the

integers appearing on the right-hand side of the above expression are the unique

integers dk such that 1 - 2gt + t2 =

 k=1

(1

-

tk

)dk

.

This

implies

that

the

Hilbert

series of Ug,r is (1 - 2gt + t2)-1, as desired.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

13

2.1.4. Example: homogenous spaces under pro-unipotent groups. We give here a slightly more involved example, that of homogenous spaces under filtered prounipotent groups. Unlike the previous examples, we define the filtration here in an indirect manner, so that the homogenous space in question represents a particular functor. This kind of abstract definition will be typical for the constructions in the rest of this paper.

Lemma 2.1.9. Let U be a pro-unipotent group over a characteristic 0 field F endowed with a separated filtration in the sense of Example 2.1.5, and let U +  U be a closed subgroup-scheme. Give U + the filtration W·U + := W·U  U +.
Then the functor W·AlgF  Set given by
  U +()\U () ,
is represented by a filtered affine F -scheme U +\U  W·Aff F , and the Hilbert series of U +\U satisfies
HSU+\U (t) · HSU+ (t) = HSU (t) .

Proof. Let L+  L denote the Lie algebras of U +  U , respectively, and choose a W -filtered complement V of L+ inside L, i.e. a pro-finite-dimensional subspace of L such that L+  V = L as filtered pro-finite-dimensional vector spaces. Consider the
map

()

U+ × V  U

given by (u, v)  u·exp(v). We will show that () is an isomorphism of filtered affine

F -schemes. This implies the lemma: we see that V represents the functor  

U +()\U (), and the equality of Hilbert series follows from Lemma 2.1.2.

The proof that () is an isomorphism is routine. If we identify U with its Lie

algebra L, then the multiplication map is given by (u, v)  BCH(u, v), where

BCH(x, y)

=

x

+

y

+

1 2

[x,

y]

+

.

.

.

is

the

Baker­Campbell­Hausdorff

power

series.

It

suffices to show that this map is bijective on -points for every filtered F -algebra .

To do this, suppose that w is a -point of L, and write wn for its image in L()/W-n-1 for n  0. We will show that there are unique elements vn  V ()/W-n-1 and un  L+()/W-n-1 such that wn = BCH(un, vn). The elements (vn)n0 and (un)n0 then define unique elements v  V () and u  L+()

such that w = BCH(u, v), as desired.

We show the existence of vn and un by induction on n, the base case n = 0 being trivial. Suppose that we have elements vn and un satisfying wn = BCH(un, vn), and let vn  V ()/W-n-2 and un  L+()/W-n-2 be arbitrarily chosen lifts. For vn  grW -n-1V () and un  grW -n-1L+(), we have

BCH(un + un, vn + vn) = BCH(un, vn ) + un + vn

in L()/W-n-2. Since grW -n-1V grW -n-1L+ = grW -n-1L and BCH(un, vn )-wn+1  grW -n-1L(), we see that there are unique choices of vn  grW -n-1V () and un  grW -n-1L+() such that BCH(un + un, vn + vn) = wn+1. This completes the induction, setting vn+1 = vn + vn and un+1 = un + un.

Remark 2.1.10. It is not immediately obvious from the above definition that the underlying affine scheme of U +\U is the quotient of U by U + in the usual (nonfiltered) sense. However, this is easy to show using Lemma 2.1.3: if U  and U +

14

L. ALEXANDER BETTS

denote the underlying affine F -schemes of U and U +, respectively, then we have
(U +\U )() = (U +\U )(triv) = U +(triv)\U (triv)
= U +()\U () = (U +\U )()
for every F -algebra , so (U +\U ) = U +\U  is the quotient of U by U + in the usual non-filtered sense.
Remark 2.1.11. An alternative way to define the filtration on the homogenous space U +\U is to note that O(U +\U ) is a subring of O(U ), so we can endow it with the restriction of the filtration on O(U ). This in fact gives the same filtration as Lemma 2.1.9: it follows from Lemma 2.1.9 that the morphism U  U +\U is split in W·Aff F (it is a surjection of functors), so the inclusion O(U +\U )  O(U ) is split as a morphism of filtered F -algebras. This ensures that the filtration on O(U +\U ) constructed in Lemma 2.1.9 is the restriction of the filtration on O(U ).
2.2. Filtrations on cohomology schemes. Suppose that G is a profinite group, and that U/Qp is a pro-unipotent group on which G acts continuously (in the sense that it acts continuously on U (Qp)). If  is any Qp-algebra, we endow it with the direct limit topology over its finite-dimensional Qp-subspaces. This induces a topology on U () for which the G-action is continuous, and we define H1(G, U ()) to be the non-abelian continuous cohomology set [Ser02, §I.5.1]3. This is a pointed set, functorial in , and hence the sets H1(G, U ()) assemble into a continuous cohomology functor
H1(G, U ) : AlgQp  Set .
Suppose now that U is endowed with a G-stable separated filtration
1  · · ·  W-3U  W-2U  W-1U = U ,
in the sense of Example 2.1.5, and assume for simplicity that each subgroup W-nU is of finite codimension4 in U . Suppose moreover that the following two conditions are satisfied:
0) H0(G, Vn) = 0 for all n; and 1) H1(G, Vn) is finite-dimensional for all n, where Vn = grW -nU (regarded as a vector space) as in Notation 2.1.6. Then the functor H1(G, U ) is representable by an affine Qp-scheme [Kim05, Proposition 2]5, which is of finite type if U is finite-dimensional. We denote the representing affine Qp-scheme also by H1(G, U ).
Our aim here is to explain how the filtration W· on U induces a filtration on the cohomology scheme H1(G, U ). We do this abstractly, by describing the functor it represents; for a more concrete description, see §2.2.2.

3Strictly speaking, [Ser02] deals only with non-abelian continuous cohomology with coefficients
in a discrete group. However, the definition still makes sense when the coefficients are permitted
to have other topologies. 4This is automatically the case if U is finitely generated, which will be the case in almost all
our examples. 5Strictly speaking, [Kim05, Proposition 2] only proves this result under the additional assump-
tion that Hi(G, Vn) is finite-dimensional for all i and n: a condition which is always satisfied in
the cases we care about. However, this extra assumption turns out to be unnecessary, and our
arguments in §2.2.1 will re-prove representability under these weaker assumptions.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

15

2.2.1. The functor of points of the filtered cohomology scheme. If now  is a filtered Qp-algebra, then the set U () of -points of U is a subset of the set U () of -points of the underlying (non-filtered) scheme U . We have already seen how to endow U () with a topology; we give U ()  U () the subspace topology. This makes U () into a topological group with a continuous G-action, functorial in   W·AlgQp . We thus have a filtered continuous cohomology functor
H1(G, U ) : W·AlgQp  Set
given by   H1(G, U ()). This will be the functor of points of the desired filtered cohomology scheme.

Theorem 2.2.1. Suppose that the filtration on U satisfies conditions (0) and (1) above. Then the functor
H1(G, U ) : W·AlgQp  Set
is representable by a pointed filtered affine Qp-scheme.
Remark 2.2.2. The underlying scheme of the filtered affine Qp-scheme H1(G, U ) produced by Theorem 2.2.1 is the same as the non-abelian cohomology scheme H1(G, U ) associated to the underlying (non-filtered) pro-unipotent group U  of U , as defined at the beginning of this section (justifying our use of the same notation for both objects). This follows from Lemma 2.1.3 since the underlying affine Qpscheme of H1(G, U ) represents the functor   H1(G, U (triv)) = H1(G, U ()).

The proof of Theorem 2.2.1 is ultimately inductive. For any n  0, we let
Un = U/W-n-1U and Vn = grW -nU = W-nU/W-n-1U as in Notation 2.1.6, so that we have a central extension

()

1  Vn  Un  Un-1  1

for all n  1. Since this sequence is split in W·Aff Qp , it follows that for every filtered Qp-algebra , the central extension

1  Vn()  Un()  Un-1()  1

is topologically split: Un()  Un-1() admits a continuous splitting and Vn()  Un() has the subspace topology. We thus obtain part of a long exact sequence in non-abelian cohomology [Ser02, Proposition 43]6

() H1(G, Vn())  H1(G, Un())  H1(G, Un-1()) - H2(G, Vn()) .
This deserves a little more explanation. The sequence above is an exact sequence of pointed sets, but carries further structure which is relevant for us. Specifically, there is an action of the abelian group H1(G, Vn()) on the set H1(G, Un()), given by pointwise multiplication of cocycles, whose orbits are the fibres of the map H1(G, Un())  H1(G, Un-1()).
Proposition 2.2.3. The action of H1(G, Vn()) on H1(G, Un()) is free.

6Again, [Ser02] only the treats the case where all topological groups in question are discrete. The same applies in general providing one restricts attention to topologically split central extensions.

16

L. ALEXANDER BETTS

Proof. If  : G  Un() is a continuous cocycle, then the stabiliser of the class []  H1(G, Un()) is the image of a certain coboundary map H0(G, Un-1())  H1(G, Vn()), where Un-1() denotes the topological group Un-1() with the twisted G-action g : u  (g) · g(u) · (g)-1. But Un-1() is an iterated central
extension of the groups Vi() = Wi Qp Vi for i < n, so that condition (0) implies H0(G, Un-1()) = 1. Thus the action on [] has trivial stabiliser, and hence the
action is free.

Now the construction of the sequence (), including the group action, is functorial in , and hence constitutes an exact sequence

()

H1(G, Vn)  H1(G, Un)  H1(G, Un-1) - H2(G, Vn)

of functors W·AlgQp  Set, where the leftmost term is a functor valued in abelian groups, acting pointwise freely on the second term. The outer terms of the sequence
are controlled by the following proposition.

Proposition 2.2.4. For a filtered Qp-algebra , let Hi(G, Vn()) denote the ith continuous cohomology of Vn() = Wn Qp Vn, endowed with topology described at the beginning of §2.2.1, i.e. the inductive limit topology over its finite-dimensional Qp-subspaces. Let Hi(G, Vn) := Hi(G, Vn(Qp)) denote the continuous cohomology of Vn viewed as a Qp-vector space. Then for any integer i, we have
Hi(G, Vn()) = Wn Qp Hi(G, Vn) ,
natural in .

Proof. The continuous cohomology H·(G, Vn()) is calculated as the cohomology of a complex C·(G, Vn()), whose ith term is the group of continuous maps from Gi to Vn() = Wn Qp Vn. It thus suffices to show that
Mapcts(Gi, Wn Qp Vn) = Wn Qp Mapcts(Gi, Vn) .
A little care is needed here, since maps out of compact spaces do not commute
with filtered colimits in general [MP11, Example 2.5.5]. We provide instead a
direct argument. It suffices to show that any continuous map from Gi to a Qp-vector space factors
through a finite-dimensional subspace. Indeed, suppose that  : Gi  Qp J is a continuous map for some indexing set J. We may suppose without loss of generality that no coordinate of the map  is zero. For each j  J we choose an open subset Uj  Qp containing 0 but not the image of the jth coordinate of . For a finite subset J0  J we define UJ0 = jJ\J0 Uj  jJ0 Qp, which is an open subset of Qp J . The sets UJ0 cover Qp J and are closed under finite unions, hence there is some J0 such that the image of  is contained in UJ0. But by construction this is only possible if J0 = J, hence J is finite as desired.

Corollary 2.2.5.
· The cohomology functor H1(G, Vn) : W·AlgQp  Ab is representable by a commutative filtered affine Qp-group scheme. Precisely, the representing object is the vector group associated to the vector space H1(G, Vn), given the filtration supported in degree -n as per Example 2.1.4.
· The cohomology functor H2(G, Vn) : W·AlgQp  Ab is a subfunctor of a representable functor.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

17

Proof. For the first point, we simply note that the functor of points of the finitedimensional vector space H1(G, Vn) is given by   Wn Qp H1(G, Vn), which is the cohomology functor H1(G, Vn) by Proposition 2.2.4.
For the second point, we cannot necessarily apply the same argument, since we have not assumed that the vector space H2(G, Vn) is finite-dimensional. Instead, we set H2(G, Vn) := Spec(Sym·(H2(G, Vn))), which is the affine space associated to the double-dual H2(G, Vn). Endowing H2(G, Vn) with its natural filtration, its functor of points is given by
  HomQp (H2(G, Vn), Wn) ,
and this clearly contains the cohomology functor   Wn Qp H2(G, Vn) as a subfunctor.

Using this proposition, we are now in a position to complete the proof of Theorem 2.2.1. The functor H1(G, U0) is representable by the trivial group. From here, we proceed inductively, assuming henceforth that H1(G, Un-1) is representable by a filtered affine Qp-scheme.
Now the coboundary map  : H1(G, Un-1)  H2(G, Vn) is a natural transformation from a representable functor to a subfunctor of a representable functor, and hence its kernel ker() is representable (by a closed subscheme of H1(G, Un-1) with the induced filtration).
Now sequence () implies that the functor H1(G, Un) is a H1(G, Vn)-torsor over ker(), in the sense that its -points are a H1(G, Vn())-torsor over ker()() for every filtered Qp-algebra . In particular, H1(G, Un)  ker() is a surjection of functors with representable codomain, hence is split. Thus H1(G, Un)  ker() × H1(G, Vn) is the trivial H1(G, Vn)-torsor over ker(), so is representable by the product of ker() and H1(G, Vn).
This completes the inductive step, showing that H1(G, Un) is representable for all n, and hence concludes the proof of Theorem 2.2.1 in the case that U is finite-
dimensional. The general case is then given by the following proposition.

Proposition 2.2.6. We have the equality H1(G, U ) = lim-n H1(G, Un) of functors W·Aff Qp  Set.

Proof. The assumption that the filtration on U is separated implies that the natural

map U  lim-n Un is a G-equivariant isomorphism of filtered affine Qp-schemes. Hence for every filtered Qp-algebra , the natural map U ()  lim-n Un() is a G-equivariant isomorphism of topological groups. It thus suffices to show that the

map

H1(G, lim- Un())  lim- H1(G, Un())

n

n

is bijective. We do this by a Mittag­Leffler argument, following [Bet18, Lemma 4.0.5].

For injectivity, ages n and n in

suppose that  and  Un() represent the

are lim-n Un()-valued cocycles whose imsame cohomology class for every n. This

says that there is an element un  Un() such that n (g) = u-n 1 · (g) · g(un) for

all g  G. In fact, the element un is unique, for, if un were another element, then

we would have

(g) · g(unu-n 1) · (g)-1 = unu-n 1

for all g  G. In other words, unun-1 is fixed under the -twisted G-action on Un(). However, we saw above that H0(G, Un()) = 1, whence un = un as claimed.

18

L. ALEXANDER BETTS

It follows from unicity that the image of un in Un-1() is the element un-1, and hence the elements (un)nN define an element u  lim-n Un(). It then follows that (g) = u-1 · (g) · g(u) for all g  G, so that  and  represent the same cohomology class. This proves injectivity.
For surjectivity, suppose we are given a compatible sequence of elements [n]  H1(G, Un()). Choose a cocycle 1 representing [1]. We show how to lift 1 to a cocycle 2 representing [2]. To begin with, choose any cocycle 2 representing [2]. The image of 2 in U1() represents the same cohomology class as 1, hence there is a u1  U1() such that the image of 2 is the cocycle g  u-1 1 · 1(g) · g(u1). Let u2  U2() be any lift of u1 along the surjection U2()  U1(); then the cocycle 2 : g  u-2 1 · 2 (g) · g(u2) also represents [2] and lies over 1.
Iterating this construction, we obtain continuous cocycles n  Z1(G, Un()) representing the classes [n] which are compatible under the maps Un()  Un-1(). These maps define a continuous cocycle  : G  lim-n Un(), and it follows from the construction that [] maps to [n] in Un() for all n. This implies that the map H1(G, lim-n Un())  lim-n H1(G, Un()) is surjective, as desired.
We note for later use the following consequence of our construction, which provides the archetypal example of a bound on Hilbert series.

Corollary 2.2.7. The filtered cohomology scheme H1(G, U ) is (non-canonically) a closed subscheme of n>0 H1(G, Vn), with the induced filtration. In particular,

HSH1 (G,U ) (t)

(1 - tn)- dimQp (H1(G,Vn)) .

n>0

2.2.2. An alternative construction. Although we will not need this in what follows, we also describe an alternative construction of the filtration on H1(G, U ) which is more explicit than the construction in Theorem 2.2.1. Let Z1(G, U ) denote the affine
Qp-scheme parametrising continuous U -valued cocycles. For every g  G there is an evaluation map evg : Z1(G, U )  U which is a morphism of affine Qp-schemes. We endow the affine ring of Z1(G, U ) with the finest filtration making all the maps evg filtered. This filtration then restricts to a filtration on O(H1(G, U ))  O(Z1(G, U )), making H1(G, U ) into a filtered affine Qp-scheme.
This explicitly constructed filtration is the same as the one from Theorem 2.2.1.
This can be proved in two steps, the verification of which we leave to the interested reader. Firstly, one shows that Z1(G, U ), with the filtration constructed explicitly above, represents the functor   Z1(G, U ()) for   W·AlgQp . Then one uses the description of the functor of points from Theorem 2.2.1 to show that the map Z1(G, U )  H1(G, U ) is split as a morphism of filtered affine Qp-schemes. This ensures that the filtration on O(H1(G, U )) from Theorem 2.2.1 is the restriction of the filtration on O(Z1(G, U )), and hence the two definitions of the filtration agree.

3. Filtrations on Selmer schemes
With the general machinery of filtered affine Qp-schemes now set up, we come to the first of the two main strands of this work: endowing the local and global Selmer schemes appearing in the Chabauty­Kim method with filtrations induced from the weight filtration on the fundamental group. This is purely a matter of representation theory, so we will describe here the construction for a general prounipotent group U , not just those arising from the fundamental group of a curve.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

19

We treat two different kinds of Selmer schemes separately: local Bloch­Kato Selmer schemes in §3.1 and global Selmer schemes in §3.2. Importantly, we will compute the Hilbert series of both kinds of Selmer schemes, and comparing the coefficients of these Hilbert series is what will ultimately allow us to control the algebraic functionals  coming out of the Chabauty­Kim method.
For an introduction to the theory of global Selmer schemes, see [BDCKW18, §2].
3.1. Local Bloch­Kato Selmer schemes. Suppose to begin with that Kv is a finite extension of Qp, with absolute Galois group Gv. We write Kv,0 for the maximal unramified subfield of Kv. Suppose that we are given a Qp-pro-unipotent group U , endowed with a continuous action of Gv and a Gv-stable separated filtration
1  · · ·  W-3U  W-2U  W-1U = U
in the sense of Example 2.1.5, where each subgroup W-nU is of finite codimension in U . We make moreover the following two assumptions on U :
· U is pro-crystalline, in the sense that Lie(U ) is an inverse limit of crystalline representations; and
· the eigenvalues7 of the crystalline Frobenius acting on Dcris(Vn) are all pWeil numbers of weight -n, for all n > 0.
These two assumptions ensure that conditions (0) and (1) from §2.2 are met, and hence the cohomology functor H1(Gv, U ) is representable (we ignore its filtration for the time being).
In the Chabauty­Kim method, one is interested not in the whole cohomology scheme H1(Gv, U ) but in a certain subscheme H1f (Gv, U ) cut out by Bloch­Katostyle Selmer conditions.
Definition 3.1.1. If   AlgQp is a Qp-algebra, then we define
H1f (Gv, U ()) := ker H1(Gv, U ())  H1(Gv, U (Bcris Qp )) ,
where Bcris denotes Fontaine's ring of crystalline periods, with its usual Galois action. The assignment   H1f (Gv, U ()) is functorial in , hence defines a functor H1f (Gv, U ) : AlgQp  Set. This is a subfunctor of the cohomology functor H1(Gv, U ).
Remark 3.1.2. Strictly speaking, in order to make sense of the above definition, we need to also specify a topology on the group U (Bcris Qp ) for which the Gv-action and the map U ()  U (Bcris Qp ) are continuous. However, H1f (Gv, U ()) does not actually depend on the choice of topology: H1f (Gv, U ()) consists of those classes of continuous U ()-valued cocycles which are coboundaries of elements of U (Bcris Qp ).
The following fact is foundational in the Chabauty­Kim method.
Proposition 3.1.3. H1f (Gv, U ) is representable by a closed Qp-subscheme of the cohomology scheme H1(Gv, U ).

7Note that the crystalline Frobenius is not in general Kv,0-linear. By its eigenvalues, we simply
mean its eigenvalues as a Qp-linear automorphism of Dcris(grW -nU ). This is the same as the f th roots of the eigenvalues of the Kv,0-linear automorphism f , where f = [Kv,0 : Qp].

20

L. ALEXANDER BETTS

However, the proof of this assertion in [Kim09, p118]8 seems to contain a gap. There, it is shown H1f (Gv, U ) is the image of a certain morphism of affine Qpschemes  : H0(Gv, U Bcris /U )  H1(Gv, U ), in the sense that it is the pointwise image of the corresponding morphism of functors of points. It is deduced from this that H1f (Gv, U ) is representable by a subscheme of H1(Gv, U ). However, this step does not follow, since the pointwise image of a morphism is not the same as the scheme-theoretic image in general, and need not even be representable9.
Nonetheless, a proof of representability of H1f (Gv, U ) can be extracted from the literature. In [Kim12, Proposition 1.4], Kim shows that there is an isomorphism10
logBK : H1f (Gv, U ) - ResKQpv F0\DdR(U )
of functors AlgQp  Set, which we call the Bloch­Kato logarithm by way of analogy with (the inverse of) [BK07, Definition 3.10]. Since the right-hand side is the Weil restriction of the quotient of a Kv-pro-unipotent group by a subgroup, it is representable by an affine space (possibly of infinite dimension), and hence so too is H1f (Gv, U ). Note, however, that this does not prove that the inclusion H1f (Gv, U )  H1(Gv, U ) is a closed immersion; for the proof of the full statement of Proposition 3.1.3, see Remark 3.1.7.
3.1.1. Weight filtration on H1f (Gv, U ). We want to explain how to enrich this construction to put a weight filtration on the affine ring of H1f (Gv, U ). This will turn out to be the subspace filtration induced from H1(Gv, U ), but it is more convenient to define the filtration via its functor of points.
Definition 3.1.4. If   W·AlgQp is a filtered Qp-algebra, then we define
H1f (Gv, U ()) := ker H1(Gv, U ())  H1(Gv, U (Bcris Qp )) ,
where U () and U (Bcris Qp ) denote the - and Bcris Qp -points of U in the sense of §2.1.2. The filtration on Bcris Qp  is the tensor product of the given filtration on  and the trivial filtration on Bcris.
The assignment   H1f (Gv, U ()) is functorial in , hence defines a functor H1f (Gv, U ) : W·AlgQp  Set. This is a subfunctor of H1(Gv, U ).
Remark 3.1.5. As in Remark 3.1.2, the definition of H1f (Gv, U ()) does not actually depend on the topology on U (Bcris Qp ). However, this topology will be relevant at a few points in the following proofs, in which we adopt the following convention. If B is a topological Qp-algebra, then we topologise the group U (B Qp ) for any filtered Qp-algebra  by identifying
U (B Qp ) = lim- B Qp W0( Qp Lie(Un)) via the logarithm isomorphism, and endowing the right-hand side with the inverse limit of the direct limit topologies on the free B-modules B Qp W0( Qp Lie(Un)).
8Strictly speaking, the assertion in [Kim09] is that H1f (Gv, U ) is representable by a subscheme of H1(Gv , U ), with no claim that it is closed. Nonetheless, we will show that it is closed.
9For example, the pointwise image of the squaring map A1Qp  A1Qp is the functor sending a Qp-algebra  to the set of squares in , which is not representable.
10Here, we use a different convention for the quotient F0\DdR(U ) = F0DdR(U )\DdR(U ) from [Kim09, Kim12], where the right quotient DdR(U )/F0DdR(U ) is used instead. One can translate between the two conventions via the isomorphism F0\DdR(U ) = DdR(U )/F0 given by u  u-1.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

21

In the particular case that B = Qp with the p-adic topology, this recovers the topology on U () from §2.2.1.
We then have the following filtered analogue of Proposition 3.1.3.
Proposition 3.1.6. The functor H1f (Gv, U ) : W·AlgQp  Set is representable by a closed Qp-subscheme of H1(Gv, U ), with the induced filtration.
Remark 3.1.7. Similarly to in Remark 2.2.2, once we know that the functor H1f (Gv, U ) : W·AlgQp  Set is representable, it immediately follows that its underlying affine Qp-scheme represents the functor H1f (Gv, U ) : AlgQp  Set from Proposition 3.1.3. Thus, Proposition 3.1.6 in particular gives us a proof of Proposition 3.1.3. Of course, there is a more direct proof of Proposition 3.1.3 which avoids considering filtrations ­ this is easily adapted from the proof we will give of Proposition 3.1.6 by ignoring the filtrations everywhere.
In preparation for our proof of Proposition 3.1.6, we note the following preparatory proposition, a filtered version of [Kim09, Lemma 1].
Lemma 3.1.8. Let  be a filtered Qp-algebra and let  : Gv  U () be a continuous cocycle whose class lies in H1f (Gv, U ). Then there exists a unique -invariant element ucris  U (Bcris Qp ) whose coboundary is . Here,  denotes the automorphism induced by the crystalline Frobenius on Bcris.
Proof. Unicity is easy to see. Two elements u, u  U (Bcris Qp ) represent the same cohomology class if and only if uu-1 lies in the Gv-fixed subgroup. If u and u are in addition -fixed, then uu-1 lies in the , Gv-fixed subgroup of U (Bcris Qp ). But this group is an iterated extension of the groups Bcris Qp Wn Qp Vn, which have no non-identity , Gv-fixed elements by assumption on the weights of crystalline Frobenius. Hence U (Bcris Qp ) also has no non-identity , Gv-fixed elements, so uu-1 = 1 and we have unicity.
To prove existence, it suffices to prove that the composite n : Gv - U ()  Un() is the coboundary of a -invariant element un,cris  Un(Bcris Qp ) for all n  0. For, then unicity implies that the elements un,cris are mapped to one another under the maps Un  Un-1, and hence define a -invariant element ucris  U (Bcris Qp ) = lim- Un(Bcris Qp ) whose coboundary is .
We prove the existence of the elements un,cris by induction on n, the base case n = 0 being trivial. Suppose then that we have a -invariant element un-1,cris  Un-1(Bcris Qp ) whose coboundary is n-1. Since the class of  lies in H1f (Gv, U ), there is an element un  Un(Bcris Qp ) whose coboundary is n. The image of un in Un-1 then has the same coboundary as un-1,cris, so that wn-1 = un-1,crisu-n 1 is a Gv-fixed element of Un-1(Bcris Qp ). Then, the map
Un(Bcris Qp )Gv  Un-1(Bcris Qp )Gv
can be identified with the map Dcris(Lie(Un)) Qp   Dcris(Lie(Un-1)) Qp , and hence is surjective by our assumption that Lie(U ) is pro-crystalline. Thus wn-1 is the image of a Gv-fixed point wn  Un(Bcris Qp ). Replacing un by wnun if necessary, we may assume without loss of generality that un maps to un-1,cris under the map Un  Un-1.
Now the cocycle n is invariant under the action of  (it is valued in U ()), so n is also the coboundary of (un). It follows that (un)u-n 1 is a Gv-fixed element

22

L. ALEXANDER BETTS

of Vn(Bcris Qp ) = Bcris Qp Wn Qp Vn. But the assumption on weights of Frobenius again implies that the endomorphism of (Bcris Qp Wn Qp Vn)Gv given by  - 1 is bijective; hence there is a vn  (Bcris Qp Wn Qp Vn)Gv such that (vn) - vn = (un)u-n 1. It follows that the coboundary of un,cris := vn-1un is n, and un,cris is -fixed by construction. This completes the inductive proof of
existence.

Remark 3.1.9. Lemma 3.1.8 shows in particular that H1f (Gv, U ()) is also equal to the kernel of the map H1(Gv, U ())  H1(Gv, U (Bcr=is1 Qp )), which would usually be denoted H1e(Gv, U ()).
We are now ready to prove Proposition 3.1.6. The observation underlying the proof is the following: if the functor   H1(Gv, U (Bcris Qp )) were representable by a filtered affine Qp-scheme, then H1f (Gv, U ) would be a closed subscheme of H1(Gv, U ) with the induced filtration, simply by virtue of being a kernel of a morphism of pointed filtered affine Qp-schemes. It is not actually the case that this functor is representable, but with sufficient care, this idea yields a proof of Proposition 3.1.6.

Proof of Proposition 3.1.6. For n  0, write Un := U/W-n-1U and Vn = grW -nU as usual, and define

H1f,n(Gv, U ()) := ker H1(Gv, U ())  H1(Gv, Un(Bcris Qp )) .

This is a subfunctor of H1(Gv, U ). We will show the following two facts, which together imply Proposition 3.1.6:

(1) H1f,n(Gv, U ) is representable by a closed subscheme of H1(Gv, U ) with the induced filtration for all n  0; and
(2) H1f (Gv, U ) = n H1f,n(Gv, U ) as subfunctors of H1(Gv, U ).

For the second point, the left-to-right inclusion is immediate. Conversely, a

-valued point on the right-hand side is represented by a continuous cocycle 

whose class maps into H1f (Gv, Un()) for all n. Lemma 3.1.8 ensures that there

are unique elements un,cris  Un(Bcr=is1 Qp ) whose coboundaries are congruent to  modulo W-n-1U . Unicity implies that the un,cris define an element u 

U (Bcr=is1 Qp ) that   H1f (Gv

= lim- Un , U ()).

(Bcr=is1

Qp

)

whose

coboundary

is

,

from

which

it

follows

The first point we prove by induction on n, the base case n = 0 being trivial.

For the inductive step, we consider the central extension

() 1  Vn(Bcr=is1 Qp )  Un(Bcr=is1 Qp )  Un-1(Bcr=is1 Qp )  1 .

We endow each term with a topology as in Remark 3.1.5.
With respect to these topologies, () is a Gv-equivariant central extension of topological groups with continuous Gv-action. It is moreover topologically split, since the exact sequence 1  Vn  Un  Un-1  1 is split in the category of filtered affine schemes. The long exact sequence in non-abelian cohomology provides an action of H1(Gv, Vn(Bcr=is1 Qp )) on H1(Gv, Un(Bcr=is1 Qp )), whose orbits are the fibres of the map H1(Gv, Un(Bcr=is1 Qp ))  H1(Gv, Un-1(Bcr=is1 Qp )). The stabiliser of the base point of H1(Gv, Un(Bcr=is1 Qp )) is the image of the coboundary map H0(Gv, Un-1(Bcr=is1 Qp ))  H1(Gv, Vn(Bcr=is1 Qp )). However,

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

23

H0(Gv, Un-1(Bcr=is1 Qp )) is the , Gv-invariant subgroup of Un-1(Bcris Qp ), which is trivial by our assumptions. It follows that the action on the base point gives an identification of H1(Gv, Vn(Bcr=is1 Qp )) with the kernel of the morphism H1(Gv, Un(Bcr=is1 Qp ))  H1(Gv, Un-1(Bcr=is1 Qp )).
Now if []  H1f,n-1(Gv, U ()), then the image of [] in H1(Gv, Un(Bcr=is1 Qp )) lies in the kernel of H1(Gv, Un(Bcr=is1 Qp ))  H1(Gv, Un-1(Bcr=is1 Qp )) by definition. We have thus described a map

H1f,n-1(Gv, U ())  H1(Gv, Vn(Bcr=is1 Qp )) ,
whose kernel is easily checked to be H1f,n(Gv, U ()). This map is natural in , so induces a morphism

()

H1f,n-1(Gv , U )  H1(Gv , V ) n,Bcr=is1

of functors, whose kernel is H1f,n(Gv, U ), where Vn,Bcr=is1 is shorthand for the functor   Vn(Bcr=is1 Qp ) = Bcr=is1 Qp Wn Qp Vn.
Now an argument similar to that of Proposition 2.2.4 shows that

H1(Gv , Bcr=is1 Qp Wn Qp Vn) = Wn Qp H1(Gv , Bcr=is1 Qp Vn) .
Thus, by an argument similar to the proof of Corollary 2.2.5, H1(Gv, V ) n,Bcr=is1 is a subfunctor of a representable functor.
Thus, assuming inductively that H1f,n-1(Gv, U ) is representable by a closed subscheme of H1(Gv, U ) with the induced filtration, then () is a morphism from a representable functor to a subfunctor of a representable functor. It follows that its kernel H1f,n(Gv, U ) is representable by a closed subscheme of H1f,n-1(Gv, U ) with the induced filtration. This completes the inductive step, and thus the proof of
Proposition 3.1.6.

3.1.2. Compatibility with the Bloch­Kato logarithm. Now let BdR denote Fontaine's ring of de Rham periods, and let DdR(U ) denote the filtered pro-unipotent group over Kv representing the functor

  U (BdR Kv )Gv

from filtered Kv-algebras to pointed sets, where BdR is endowed with the trivial
filtration (WnBdR = BdR for all n). This functor is indeed representable, by the
filtered pro-unipotent group associated to the filtered pro-nilpotent Lie algebra DdR(Lie(U )). There is a subgroup scheme F0DdR(U ) representing the subfunctor   U (B+dR Kv )Gv , and we write ResKQpv F0\DdR(U ) for the filtered affine Qp-scheme representing the functor

  U (B+dR Qp )\U (BdR Qp ) .

This functor is representable by Lemma 2.1.9, since it is the quotient of the filtered Qp-pro-unipotent group corresponding to the pro-nilpotent Lie algebra ResKQpv DdR(Lie(U )) by the subgroup corresponding to the subalgebra ResKQpv F0DdR(Lie(U )).
In [Kim12, Proposition 1.4], Kim shows that there is an isomorphism

(3.1.1)

logBK : H1f (Gv, U ) - ResKQpv F0\DdR(U )

on the level of underlying (non-filtered) Qp-schemes. Our aim here is to show that this isomorphism is filtered, for the filtrations defined above.

24

L. ALEXANDER BETTS

Proposition 3.1.10. The Bloch­Kato logarithm (3.1.1) is an isomorphism of filtered affine Qp-schemes.

As a consequence, we can compute the Hilbert series of the local Bloch­Kato Selmer scheme H1f (Gv, U ).

Corollary 3.1.11. There is a (non-canonical) isomorphism

H1f (Gv, U ) = H1f (Gv, Vn)
n>0
of filtered affine Qp-schemes, where the vector space H1f (Gv, Vn) is given the filtration supported in filtration-degree -n. In particular, we have

HSH1f (Gv ,U) =

(1 - tn)- dimQp H1f (Gv,Vn) .

n>0

Proof. Proposition 3.1.10 and Lemma 2.1.9 together imply that H1f (Gv, U ) is isomorphic to V , where V is a filtered Qp-linear complement to F0DdR(Lie(U )) inside DdR(Lie(U )). By choosing a splitting of the filtration on V we have
V = grW -nV .
n>0
But we have

dimQp grW -nV = dimQp grW -nDdR(Lie(U )) - dimQp F0grW -nDdR(Lie(U )) = dimQp H1f (Gv, Vn)
by [BK07, Corollary 3.8.4]. Hence grW -nV  H1f (Gv, Vn) as Qp-vector spaces with filtrations supported in filtration-degree -n. The result follows.

For the proof of Proposition 3.1.10, we will construct both the Bloch­Kato loga-
rithm and its inverse as morphisms of filtered Qp-schemes and verify that these are mutually inverse. To construct logBK, we use the following proposition, a filtered version of the discussion on [Kim09, p. 118].

Lemma 3.1.12. Let  be a filtered Qp-algebra and let  : Gv  U () be a continuous cocycle whose class lies in H1f (Gv, U ). Then there exists an element udR  U (B+dR Qp ) whose coboundary is .

Proof. We follow a similar strategy to the proof of Lemma 3.1.8, except that we

are not proving ­ and cannot use ­ unicity. We show that there exists a compatible

system of elements un,dR  Un(B+dR Qp ) such that the coboundary of un,dR is 

modulo W-n-1U . These elements then define an element udR  U (B+dR Qp ) =

lim- Un(B+dR Qp ) whose coboundary is , as desired. We begin by taking u0,dR the unique element of the trivial

group

U0(B+dR

Qp

),

which clearly works. Suppose that we have constructed un-1,dR. We construct the

element un,dR as follows. To begin with, choose any element un  Un(B+dR Qp )

lifting un-1,dR. The twisted cocycle

n : g  un(g)g(un)-1

is then valued in Vn(B+dR Qp ), so defines a class in H1(Gv, Vn(B+dR Qp )). Here, we adopt conventions on topologies as in Remark 3.1.5.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

25

Now the image of [n] in H1(Gv, Un(BdR Qp )) is trivial (since [n] = []  H1f (Gv, Un())). We will show that the map

()

H1(Gv, Vn(B+dR Qp ))  H1(Gv, Un(BdR Qp ))

has trivial kernel. This implies the proposition, since then n is the coboundary of some element vn  Vn(B+dR Qp ), whence  is the coboundary of un,dR := vnun  Un(B+dR Qp ) modulo W-n-1U as desired.
To prove that () has trivial kernel, we factor it as the composite

H1(Gv, Vn(B+dR Qp ))  H1(Gv, Vn(BdR Qp ))  H1(Gv, Un(BdR Qp ))
and show that both maps have trivial kernel. The left-hand map is identified as the map

Wn Qp H1(Gv, B+dR Qp Vn)  Wn Qp H1(Gv, BdR Qp Vn) ,
which is injective by [BK07, Lemma 3.8.1]. For the right-hand map, we consider the central extension

1  Vn(BdR Qp )  Un(BdR Qp )  Un-1(BdR Qp )  1 ,
which is topologically split. The fact that Lie(Un) is de Rham implies that the map H0(Gv, Un(BdR Qp ))  H0(Gv, Un-1(BdR Qp ))
is surjective, and hence H1(Gv, Vn(BdR Qp ))  H1(Gv, Un(BdR Qp )) has trivial kernel, as claimed.

Using this lemma, the Bloch­Kato logarithm is defined as follows. Given a class []  H1f (Gv, U ()), we choose a representing cocycle . According to Lemmas 3.1.8 and 3.1.12, we have elements ucris  U (Bcr=is1 Qp ) and udR  U (B+dR Qp ) whose coboundary is . It follows that the element udRuc-r1is  U (BdR Qp ) is Gv-fixed. It is then easy to check that the class of udRu-cr1is  U (B+dR Qp )Gv \U (BdR Qp )Gv is independent of the choice of udR and the choice of representing cocycle . The construction   udRu-cr1is thus provides a map
H1f (Gv, U ())  U (B+dR Qp )Gv \U (BdR Qp )Gv ,
natural in   W·AlgQp , and hence a morphism
logBK : H1f (Gv, U )  ResKQpv F0\DdR(U )
of filtered affine Qp-schemes. This map is the Bloch­Kato logarithm.
Remark 3.1.13. The Bloch­Kato logarithm constructed above is the same as that from [Kim09, p. 119], [Kim12, Proposition 1.4], once one forgets the filtrations. If P is a Gv-equivariant U -torsor over a Qp-algebra  whose class lies in H1f (Gv, U ()), then DdR(P ) := Spec(DdR(O(P ))) is an admissible DdR(U )-torsor over Kv Qp , in the sense of [Kim09, p. 104]. In [Kim09], the Bloch­Kato logarithm is defined to be the map sending the class of P to the element d-R1cris  F0\DdR(U )(), where dR  F0DdR(P )() and cris  DdR(P )() is the unique Frobenius-invariant element.
If  is a cocycle representing the class of P , then P is isomorphic to U with the twisted Gv-action g : u  (g) · g(u). Under this identification, the elements cris  P (Bcr=is1 Qp )Gv and dR  P (B+dR Qp )Gv are equal to u-cr1is  U (Bcr=is1 Qp ) and ud-R1  U (B+dR Qp ) for elements ucris and udR whose coboundaries are both .

26

L. ALEXANDER BETTS

Thus d-R1cris = udRu-cr1is, so our definition of the Bloch­Kato logarithm above agrees with that in [Kim09].

Next, we construct the inverse of the Bloch­Kato logarithm, as a morphism of filtered affine Qp-schemes. Here, we follow a different approach to [Kim12, Proposition 1.4], taking a strategy closer to that of [Bet18, §6]. The construction revolves around the following result.

Lemma 3.1.14. For every filtered Qp-algebra , the multiplication map
U (B+dR Qp ) × U (Bcr=is1 Qp )  U (BdR Qp )
is surjective, and
U (B+dR Qp )  U (Bcr=is1 Qp ) = U () ,
where the intersection is taken inside U (BdRQp ). Moreover, the topology on U () is the subspace topology induced from U (BdR Qp ), where the topology on the latter is as in Remark 3.1.5.

Proof. We work in the Lie algebra Lie(U ). The fundamental exact sequence [BK07, (1.17.1)] implies that Lie(U )(B+dR Qp ) and Lie(U )(Bcr=is1 Qp ) together span Lie(U )(BdR Qp ) and their intersection is Lie(U )(). An argument similar to the proof of Lemma 2.1.9 then shows surjectivity of the multiplication map. The
statement regarding the intersection is also immediate.
For the assertion regarding topologies, we observe that the topology on BdR restricts to the p-adic topology on Qp, so W0( Qp Lie(Un))  BdR Qp W0( Qp Lie(Un)) has the subspace topology with respect to the free Qp- and BdR-module topologies on either side. Taking an inverse limit, we see that U ()  U (BdR Qp ) has the subspace topology.

We now construct the inverse of the Bloch­Kato logarithm logBK. Given an element u  U (BdR Qp )Gv , we have, courtesy of Lemma 3.1.14, elements ucris  U (Bcr=is1 Qp ) and udR  U (B+dR Qp ) such that u = udRu-cr1is. Since u is Gv-fixed by assumption, it follows that the coboundaries of ucris and udR are equal. By construction, this coboundary is a continuous cocycle  taking values in U (B+dR Qp )  U (Bcr=is1 Qp ) = U (). Moreover, since  is the coboundary of the element ucris  U (Bcris Qp ), it follows that the class of  lies in H1f (Gv, U ()).
Now the class of  is easily checked to be independent of the choices of ucris and udR, hence depends only on u. The construction u   thus gives a map
U (BdR Qp )Gv  H1f (Gv, U ()) ,
natural in   W·AlgQp . It is easy to check that this map is invariant under the right-multiplication action of U (B+dR Qp )Gv on the domain, and hence we obtain a morphism
ResKQpv F0\DdR(U )  H1f (Gv, U )
of filtered affine Qp-schemes, which is easily seen to be inverse to the Bloch­Kato logarithm. This concludes the proof of Proposition 3.1.10.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

27

3.2. Global Selmer schemes. Now we come to the corresponding global theory. We fix a number field K, and write GK for its absolute Galois group. Suppose that we are given a Qp-pro-unipotent group U , endowed with a continuous action of GK and a GK -stable separated filtration
1  · · ·  W-3U  W-2U  W-1U = U
in the sense of Example 2.1.5, where each subgroup W-nU is of finite codimension in U . We make moreover the following assumptions on U :
· the GK -action on U is ramified at only finitely many places of K; · U is pro-crystalline at every place v | p, in the sense that Lie(U ) is an
inverse limit of representations which are crystalline at all v | p; and · for every finite place v and all n  N, the Gv-invariant subgroup H0(Gv, Vn) =
0 is zero, where Gv denotes a decomposition group at v and Vn = grW -nU as usual.
In other words, U is finitely ramified and the restriction of U to the decomposition group Gv at a finite place v satisfies the assumptions of §3.1 whenever v | p, and satisfies the assumptions of §2.2 whenever v  p. This ensures that the local cohomology functors H1(Gv, U ) are all representable, as are the subfunctors H1f (Gv, U ) whenever v | p. It also ensures that the subfunctors H1nr(Gv, U )  H1(Gv, U ) consisting of the unramified cohomology classes are representable for every v  p, albeit in a trivial way.
Lemma 3.2.1. Let v  p. Then the kernel of the restriction map H1(Gv, U )  H1(Iv, U ) is trivial, i.e. consists exactly of the base point of H1(Gv, U ).
Proof. It follows from non-abelian inflation­restriction [BDCKW18, Lemma in §2.8] that the kernel of the restriction map is the cohomology functor H1(Gv/Iv, U Iv ). We endow the subgroup-scheme U Iv  U with the restriction of the filtration W on U .
Our assumptions ensure that 1 is not an eigenvalue of the Frobenius  acting on Lie(U )Iv , so that  acts without fixed points on grW -n(U Iv ) for all n. Hence we have
H0(Gv/Iv, grW -n(U Iv )) = ker(( - 1)|grW -n(UIv )) = 0 , H1(Gv/Iv, grW -n(U Iv )) = coker(( - 1)|grW -n(UIv )) = 0 .
Thus the cohomology functor H1(Gv/Iv, U Iv ) is representable by [Kim05, Proposition 2] and is trivial by Corollary 2.2.7.

Now we define a global Selmer scheme relative to a choice of closed subscheme Sv  H1(Gv, U ) for each place v  p, such that Sv = {} is just the basepoint of H1(Gv, U ) for all but finitely many v. We refer to such a collection S = (Sv)vp as a Selmer structure for U , by way of analogy with [LZ18, §1.3c].
Definition 3.2.2. Let S = (Sv)vp be a Selmer structure for U . Restriction to the decomposition groups at each finite place provides a morphism
H1(GK , U )  H1(Gv, U ) ,
v

28

L. ALEXANDER BETTS

of functors and we define the global Selmer scheme SelS,U  H1(GK , U ) to be the preimage of the closed subscheme v|p H1f (Gv, U ) × vp Sv  v H1(Gv, U ) under this map.
Example 3.2.3. Suppose that T0 is a finite set of places, containing S, all places dividing  and all places of bad reduction, and not containing any prime above p. One choice of Selmer structure is given by taking Sv = H1(Gv, U ) for v  T0 and Sv = {} otherwise. The corresponding Selmer scheme is denoted H1f,T0 (GK , U ), and consists of those non-abelian cohomology classes which are unramified outside T0  {v | p} and crystalline at all p-adic places.
There is a small subtlety in the definition of the global Selmer scheme, in that the global cohomology functor H1(GK , U ) need not be representable. Nonetheless, the global Selmer scheme is representable.
Proposition 3.2.4. The global Selmer scheme SelS,U is representable by an affine Qp-scheme, which is of finite type if U is finite-dimensional.
Proof. We follow the argument of [BDCKW18, Proposition in §2.8]. Let T be a set of places of K, containing all places dividing p, all places where the Galois action on U ramifies, and all places where Sv = {}. We write GK,T for the largest quotient of GK unramified outside T , so that the GK -action on U factors through GK,T by assumption. The cohomology functor H1(GK,T , U ) is a subfunctor of H1(GK , U ) by inflation­restriction [BDCKW18, Lemma in §2.8], and H1(GK,T , U ) is representable since each H1(GK,T , Vn) is finite-dimensional by [NSW13, Theorem 8.3.20(i)].
It thus suffices to prove that SelS,U  H1(GK,T , U ) as subfunctors of H1(GK , U ), for then SelS,U is the preimage of the closed subscheme v|p H1f (Gv, U )× vp Sv under the morphism H1(GK,T , U )  v H1(Gv, U ) of affine Qp-schemes, so is representable by a closed subscheme of H1(GK,T , U ). To show this, suppose that  is a Qp-algebra and  : GK  U () is a continuous cocycle whose class lies in SelS,U (). For every place v / T , the restriction |Iv to inertia at v represents the basepoint in the set H1(Iv, U ()) = Hom(Iv, U ()), hence we have |Iv = 1.
Now it follows from the cocycle condition that the intersection of the kernel of  with the kernel of the action map GK  Aut(U ()) is a closed normal subgroup of GK . We have just shown that the inertia group Iv is contained in this subgroup whenever v / T , so this subgroup contains the kernel of GK  GK,T . Hence  factors through GK,T , so []  H1(GK,T , U ()). Thus we have shown that SelS,U  H1(GK,T , U ), which completes the proof.
3.2.1. Weight filtration on SelS,U . Now we endow the global Selmer scheme SelS,U with a filtration, induced from that on U . The easiest way to construct this is to note that the proof of Proposition 3.2.4 shows that SelS,U is a closed subscheme of H1(GK,T , U ), and so we can endow it with the induced filtration. As always, we can also characterise this filtration in terms of the functor it represents.
Lemma 3.2.5. Let S = (Sv)vp be a Selmer structure for U . Endow each Sv with the induced filtration as a closed subscheme of H1(Gv, U ) and endow the global Selmer scheme SelS,U with the induced filtration as a closed subscheme of H1(GK,T , U ), where the set T is as in the proof of Proposition 3.2.4. Then the square

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

29

SelS,U

H1(GK,T , U )

v|p H1f (Gv, U ) × vp Sv

v H1(Gv, U )

is a pullback square in the category of filtered affine Qp-schemes. In particular, this filtration on SelS,U is independent of the choice of T .

Proof. This is in fact an abstract statement about filtered affine Qp-schemes: if f : X  Y is a morphism of filtered affine Qp-schemes and Z  Y is a closed subscheme with the induced filtration, then the induced map X ×Y Z  X is the inclusion of a closed subscheme with the induced filtration. This is easily verified
on the level of affine rings.

To conclude this section, we give a bound on the Hilbert series of the global Selmer scheme SelS,U , analogous to the bound in Corollary 2.2.7.

Lemma 3.2.6. Let S be a Selmer structure for U . Then the global Selmer scheme SelS,U is (non-canonically) a closed subscheme of

H1f (GK , Vn) ×

Sv ,

n>0

vp

with the induced filtration. Here, Sv is given the induced filtration from H1(Gv, U ), and H1f (GK , Vn) denotes the Qp-vector space of Galois cohomology classes which are crystalline at all places above p and unramified at all other places, given the
filtration supported in filtration-degree -n. In particular, we have

HSSelS,U

HSSv ×

(1 - tn)- dimQp H1f (GK ,Vn) .

vp

n>0

For our proof of Lemma 3.2.6, we introduce some auxiliary notation. We fix a set T as in the proof of Proposition 3.2.4, and for n  0, we define SelS,n to be the pullback

SelS,n

H1(GK,T , Un)

v|p H1f (Gv , Un) × vp Sv

v H1(Gv, Un)

in the category of filtered affine Qp-schemes. That is, a -point of SelS,n consists of a global cohomology class []  H1(GK,T , Un()) and local cohomology classes [v]  Sv()  H1(Gv, U ()) for each v  p, such that []|Gv  H1f (Gv, Un()) for all v | p and []|Gv is congruent to [v] modulo W-n-1U for all v  p.
There are natural maps SelS,n  SelS,n-1 for every n > 0, and it follows from Lemma 3.2.1 that there is an action of H1f (GK , Vn) on SelS,n, induced from the natural pointwise multiplication actions on H1(GK,T , Un), H1(Gv, Un) and H1f (Gv, Un) and the trivial action on Sv. The bulk of the proof of Lemma 3.2.6 is then contained
in the following lemma.

Lemma 3.2.7. The pointwise image of the map SelS,n  SelS,n-1 is a closed subscheme of SelS,n-1 with the induced filtration, and H1f (GK , Vn) acts freely and simply transitively on the fibres of SelS,n  SelS,n-1.

30

L. ALEXANDER BETTS

Proof. First, recall from the proof of Theorem 2.2.1 that there is a coboundary map

 : H1(GK,T , Un-1)  H2(GK,T , Vn)
whose kernel is the pointwise image of H1(GK,T , Un)  H1(GK,T , Un-1). It follows that the image of SelS,n  SelS,n-1 is contained in the kernel SelS,n-1 of the composite map

SelS,n-1  H1(GK,T , Un-1) - H2(GK,T , Vn) .
By construction, SelS,n-1 is a closed subscheme of SelS,n-1 with the induced filtration.
Next, we let V denote the cokernel of the restriction map

()

H1(GK,T , Vn) 

H1(Gv, Vn)/H1f (Gv, Vn) ×

H1(Gv, Vn)

v|p

vp

of Qp-vector spaces. We endow V with the filtration supported in filtration-degree -n, and regard V as a filtered affine Qp-scheme as in Example 2.1.4. We will define a map
 : SelS,n-1  V
of filtered affine Qp-schemes whose kernel is the pointwise image of SelS,n  SelS,n-1 ­ this proves the proposition. In this, we regard the vector space V as a filtered affine Qp-scheme by giving the filtration supported in filtration-degree -n, as in Example 2.1.4.
The map  is constructed as follows. Suppose that ([], [v]vp) is a -valued point of SelS,n-1. The condition that this point lies in SelS,n-1 says exactly that [] is the image of a class []  H1(GK,T , Un()). Now for every v  p, the classes []|Gv and [v] map to the same class in H1(Gv, Un-1()), so differ by the action of a unique element [v]  H1(Gv, Vn()).
Similarly, for every v | p, we know that the image of []|Gv in H1(Gv, Un-1()) lies in H1f (Gv, Un-1()). It follows from Proposition 3.1.10 that H1f (Gv, Un()) surjects onto H1f (Gv, Un-1()), and that H1f (Gv, Vn()) acts freely and transitively on the fibres of H1f (Gv, Un())  H1f (Gv, Un-1()). It follows that []|Gv differs from an element of H1f (Gv, Un()) by the action of some element [v]  H1(Gv, Vn()), and that the element [v] is unique modulo H1f (Gv, Vn()).
We then define ([], [v]vp) to be the image of ([v]v) inside V (). The choice of []  H1(GK,T , Un()) in the above construction is unique up to multiplication by an element of H1(GK,T , Vn()), so by construction ([], [v]vp) is independent of this choice. We have thus described a map
 : SelS,n-1()  V ()
natural in , and hence the desired morphism  : SelS,n-1  V of filtered affine Qp-schemes.
Now by construction, a point of ([], [v]vT0)  SelS,n-1() lies in the kernel of  if [] has a lift to []  H1(GK,T , Un()) for which all the elements [v] vanish. But this is equivalent to saying that ([], [v]vT0 )  SelS,n(), so the kernel of  is the pointwise image of SelS,n  SelS,n-1 as claimed.
Finally, we observe that the choice of [] for which all the [v] vanish is welldefined up to the action of the kernel of (), which is H1f (GK , Vn()) by Lemma 3.2.1. This shows that the action of H1f (Gv, Vn) on SelS,n is pointwise transitive on the

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

31

fibres of SelS,n  SelS,n-1. That it is free follows from the fact that H1(GK,T , Vn) acts freely on H1(GK,T , Un).

Remark 3.2.8. For the particular Selmer scheme H1f,T0 (GK , U ) from Example 3.2.3, a similar argument to the proof of Lemma 3.2.6 gives the bound

HSH1f,T0 (GK ,U)(t)

(1 - tn)- dimQp H1f,T0 (GK ,Vn) ,
n>0

where H1f,T0 (GK , Vn) denotes the subgroup of the cohomology group consisting of cohomology classes unramified outside T0  {v | p} and crystalline at p-adic places.

4. Weights and Coleman analytic functions
Let Kv be a finite extension of Qp with ring of integers Ov and residue field kv. Let Y be a smooth hyperbolic curve over Kv, and write Y = X \ D where D is a divisor in a smooth proper curve X. Assume that Y has good reduction at p, that is, there is a smooth proper curve X /Ov and an ´etale divisor D  X whose generic fibres are X and D respectively. We write Y = X \ D, and fix a choice of base point b  Y(Ov).
We write Y0 for the special fibre of Y, and write ]Y0[ for the tube of Y0 inside X [Ber96, §1]. This is an admissible open in the rigid analytification Xan of X, whose Kv-points is equal to the Ov-points of Y (i.e. the complement of the residue discs of each Kv-point of D).
In this setup, one has the ring ACol(Y) of Coleman analytic functions on Y, as constructed by Besser [Bes02]. This is a subring of the locally Kv-analytic functions on ]Y0[ which contains all overconvergent Kv-rigid-analytic functions.
The ring ACol(Y) plays an important role in the non-abelian Chabauty method. Specifically, if U dR/Kv denotes the pro-unipotent de Rham fundamental group of (Y, b), then there is a certain map
jdR : Y(Ov)  F0\U dR(Kv)
known as the de Rham non-abelian Kummer map, which is defined in terms of the crystalline Frobenius and Hodge filtration on the de Rham fundamental groupoid of Y . The coordinates of the de Rham non-abelian Kummer map are known to be Coleman analytic functions, and this is ultimately how one proves Faltings­Siegeltype results in the Chabauty­Kim method: by exploiting the fact that a non-zero Coleman analytic function has only finitely many zeroes.
Our goal in this section is to explain how to enrich this picture to take account of weight filtrations. We will introduce a certain subring AaClogl(Y )  ACol(Y) of Coleman algebraic functions, and endow it with a natural weight filtration. We will show that the coordinates of the de Rham non-abelian Kummer map are in fact Coleman algebraic, and that the weight filtration on AaClogl(Y ) is compatible with the natural weight filtration on F0\U dR. In the next section, we will show that the number of zeroes of a non-zero Coleman algebraic function can be bounded in terms of its weight: this is ultimately how we produce effective results of Faltings­Siegel type in our effective Chabauty­Kim method.
Remark 4.0.1. The whole ring ACol(Y) of Coleman analytic functions on Y also carries a natural weight filtration, but this is much less useful in the theory. For instance, W0ACol(Y) is the ring of overconvergent Kv-rigid analytic functions on ]Y0[,

32

L. ALEXANDER BETTS

so one cannot put an upper bound on the number of zeroes of a general Coleman analytic function in terms of its weight. By contrast, we have W0AaClogl(Y ) = Kv is just the constant functions.
4.1. Coleman analytic functions.
4.1.1. Isocrystals and Coleman analytic functions. To begin with, we recall Besser's definition of the ring ACol(Y) of Coleman analytic functions on Y [Bes02, §4]11. Let IsocuKnv (Y0) denote the Tannakian category of unipotent isocrystals on Y0, in the sense of [Bes02, p. 6]. These are coherent modules over the sheaf jOXan of overconvergent rigid-analytic functions on Xan endowed with a connection , which are iterated extensions of the unit object (jOXan , d).
If E = (E, ) is a unipotent isocrystal on Y0 and y0  Y0(kv) is a point on the special fibre, we write (E|]y0[)=0 for the Kv-vector space of flat sections of E over the residue disc ]y0[. If x0  Y0(kv) is another point, then there is a canonical Kv-linear isomorphism
Tx0,y0 : (E |]x0[)=0 - (E |]y0[)=0 ,
known as analytic continuation along Frobenius [Bes02, Definition 3.5], uniquely characterised by the fact that Tx0,y0 is tensor-natural in E and compatible with Frobenius [Bes02, Corollary 3.3].
Using the category IsocuKnv (Y0) of unipotent isocrystals on Y0, Besser defines a ring ACol(Y) as follows.
Definition 4.1.1. An abstract Coleman analytic function [Bes02, Definition 4.1] is a triple (E, ,  ) consisting of:
· a unipotent isocrystal E  IsocuKnv (Y0); · an jOXan -linear map  : E  jOXan ; and · for every point y0  Y0(kv), a flat section y0  (E|]y0[)=0 of E over the
residue disc of y0; such that y0 = Tx0,y0 (x0 ) for all x0, y0  Y0(kv).
The ring ACol(Y) of Coleman analytic functions [Bes02, Definition 4.3] is defined to be the set of abstract Coleman functions, modulo the equivalence relation generated by identifying (E, ,  )  (E, ,  ) whenever there is a morphism f : E  E of isocrystals such that f (y0 ) = y 0 for all y0  Y0(kv) and    f =  . The addition in ACol(Y) is induced from the direct sum of isocrystals; the multiplication is induced from the tensor product of isocrystals. This makes ACol(Y) into a Kv-algebra [Bes02, Proposition 4.4].
The ring ACol(Y) is a subring of the ring Aloc(Y) of locally analytic functions on the tube ]Y0[ of Y0 [Bes02, Definition 4.9 & Proposition 4.12]. Explicitly, if f  ACol(Y) is represented by a triple (E, ,  ), then for every y0  Y0(kv) we obtain an analytic function f |]y0[ on the residue disc ]y0[ via the formula f |]y0[ :=  (y0 )  H0(]y0[, OXan ). In particular, we can view f as a function Y(Ov)  Kv, given on each residue disc by f |]y0[.
Example 4.1.2. Every overconvergent rigid-analytic function f  H0(Xan, jOXan ) is a Coleman analytic function. Specifically, to f we can associate the abstract
11Officially, we mean that ACol(Y) is the ring of Coleman analytic functions associated to the rigid triple T = (Y0, X0, X^), where X^ denotes the formal completion of X along its special fibre.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

33

Coleman function (E, ,  ) where E = (jOXan , d), i = 1  Kv = (E|]b0[)=0, and  : E  jOXan is given by multiplication by f . It is easy to check that the underly-
ing locally analytic function of this abstract Coleman analytic function is again f . In this way, we see that the ring H0(Xan, jOXan ) of overconvergent rigid-analytic
functions is a subring of ACol(Y).

4.1.2. Log-connections and Coleman algebraic functions. For our purposes, we will

be we

interested not in the whole ring ACol(Y), but call the ring of Coleman algebraic functions.

in a For

ctehritsa, ilnetsuMbrIiCngunA(XaClog,lD(Y))dwenhoicthe

the Tannakian category of unipotent vector bundles with log-connection on (X, D),

i.e. the category of vector bundles E on X endowed with a connection  with

logarithmic poles along D such that (E, ) is an iterated extension of the unit

object (OX , d).

Definition 4.1.3. An abstract Coleman algebraic function is a triple (E, b,  ) consisting of:
· a unipotent vector bundle with log-connection E  MICun(X, D); · an OX -linear map  : E  OX ; and · a point b  Eb in the fibre of E at the basepoint b. The ring AaClogl(Y ) of Coleman algebraic functions is defined to be the set of abstract Coleman algebraic functions, modulo the equivalence relation generated by identifying (E, b,  )  (E, b ,  ) whenever there is a morphism f : E  E of vector bundles with log-connection such that f (b) = b and    f =  . The addition in AaClogl(Y ) is induced from the direct sum of vector bundles with log-connection; the multiplication is induced from the tensor product. This makes AaClogl(Y ) into a Kv-algebra, just as in [Bes02, Proposition 4.4].
It is not immediately obvious that AaClogl(Y ) is a subring of ACol(Y). To see this, recall that if E is a unipotent vector bundle on X, then one can form the sheaf jEan of overconvergent sections of E [Ber96, §2.1.1]. Moreover, since D is supported outside a strict neighbourhood of ]Y0[, we have j(1X (D))an = j(1X )an = 1Xan OXan jOXan , and hence any unipotent log-connection on E gives rise to a connection on jEan, making it into a unipotent isocrystal.

Lemma 4.1.4. The functor E  jEan is a tensor-equivalence from the Tannakian category MICun(X, D) of unipotent vector bundles with log-connection on (X, D) to the Tannakian category Isocun(Y0) of unipotent isocrystals on Y0. Moreover, for any y  Y(Ov) reducing to some y0  Y0(kv), taking the fibre at y provides a Kv-linear isomorphism
(jE an|]y0[)=0 = Ey ,
tensor-natural in E  MICun(X, D).

Proof. We introduce as an intermediate step the category MICun(Y ) of unipotent vector bundles with connection on Y . On the one hand, the restriction functor MICun(X, D)  MICun(Y ) given by E  E|Y is a tensor-equivalence of Tannakian categories by Deligne's theory of the canonical extension [Del70, Proposition II.5.2(a)]. On the other, the functor MICun(Y )  Isocun(Y0) given by E  jEan is a tensor-equivalence by [CLS99, Proposition 2.4.1]. Combining these shows the first part of the lemma.

34

L. ALEXANDER BETTS

For the second part, taking the fibre at y provides a map (jEan|]y0[)=0  Ey which is tensor-natural in E. Standard properties of Tannakian categories imply that this is automatically an isomorphism [DMOS82, Proposition 1.13].
Now if E is a unipotent vector bundle with log-connection on (X, D) and b  Eb is a point in the fibre over b, then according to Lemma 4.1.4 there is a unique flat section b0 of jEan over the residue disc ]b0[ whose fibre at b is b0 . Via analytic continuation along Frobenius, we then obtain a flat section y0 of jEan over every other residue disc ]y0[ by setting y0 := Tb0,y0(b0 ). This construction gives our embedding of AaClogl(Y ) in ACol(Y).
Proposition 4.1.5. The ring AaClogl(Y ) is a Kv-subalgebra of ACol(Y) via the embedding given by (E, b,  )  (jEan, , j an), where the flat sections y0 are defined by y0 := Tb0,y0 (b0 ) with b0 the unique flat section of jEan over the residue disc ]b0[ whose fibre at b is b.
For the proof of Proposition 4.1.5, we will need to know when a triple (E, b,  ) represents the element 0  AaClogl(Y ).
Lemma 4.1.6.
(1) Let (E, b,  ) be an abstract Coleman algebraic function, and let - ker( ) be the largest -stable subbundle of the kernel of  : E  OX . Then (E, ,  ) represents the element 0  AaClogl(Y ) if and only if b  - ker( )b.
(2) Let (E, ,  ) be an abstract Coleman function, and let - ker( ) be the largest -stable jOXan -submodule of the kernel of  : E  jOXan , as in [Bes02, Lemma 2.1]. Then (E, ,  ) represents the element 0  ACol(Y) if and only if b0  - ker( )|]b0[ =0.
Proof. We prove only the first part, the second following by a similar argument. In one direction, if b  - ker( )b, then let E = E/- ker( ) and let   : E  OX be the map through which  factors. We then have (E, ,  )  (E, 0,  )  (0, 0, 0), and hence (E, ,  ) represents 0  AaClogl(Y ).
In the other, it suffices to prove that the property that b  - ker( )b is invariant under the equivalence relation in Definition 4.1.3. So suppose that (E, ,  ) and (E, ,  ) are abstract Coleman algebraic functions, and that f : E  E is a morphism of vector bundles with log-connection such that f (b) = b and  f =  . This latter property implies that - ker( ) = f -1- ker( ), and hence that b  - ker( )b if and only if b  - ker( )b. This completes the proof.
Proof of Proposition 4.1.5. It is easily checked that the construction (E, b,  )  (jEan, , j an) gives rise to a Kv-algebra homomorphism AaClogl(Y )  ACol(Y). Suppose that f  AaClogl(Y ) is represented by a triple (E, b,  ). Let - ker( ) denote the largest -stable OX -submodule of the kernel of  : E  OX , and let - ker(j an) denote the largest -stable jOXan -submodule of the kernel of j an : jEan  jOXan . It follows from Lemma 4.1.4 that in fact - ker(j an) = j- ker( )an.
Now suppose that f lies in the kernel of the map AaClogl(Y )  ACol(Y). According to Lemma 4.1.6, we have b0  - ker(j an)|]b0[ =0. It follows that b  - ker( )b, and hence (E, b,  ) represents 0  AaClogl(Y ). In other words, AaClogl(Y )  ACol(Y) is injective.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

35

Remark 4.1.7. Although the definition of AaClogl(Y ) appears to depend on the basepoint b, Proposition 4.1.5 shows AaClogl(Y ) is the subring of ACol(Y) consisting of those Coleman analytic functions f which can be represented by a triple (E, ,  ) in which  = j alg for a morphism  alg : Ealg  OX of algebraic vector bundles, where Ealg  MICun(X, D) is the unipotent vector bundle with log-connection corresponding to E under the equivalence of Lemma 4.1.4. Thus, the ring AaClogl(Y ) is actually independent of b, when viewed as a filtered subring of ACol(Y).
Remark 4.1.8. In the particular case that Y = X is projective, then the inclusion AaClogl(Y )  ACol(Y) is an equality, since by rigid-analytic GAGA [FvdP04, Theorem 4.10.5] any morphism  : E  OXan of analytic vector bundles on Xan is the analytification of a morphism  alg : Ealg  OX of algebraic vector bundles.
On the other hand, if Y X is affine, then the inclusion AaClogl(Y )  ACol(Y) is strict. Indeed, ACol(Y) contains all overconvergent rigid-analytic functions on ]Y0[ by Example 4.1.2, so in particular has uncountable dimension over Kv. However, one can check that AaClogl(Y ) always has countable dimension over Kv, so the inclusion AaClogl(Y )  ACol(Y) must be strict. 4.1.3. Weight filtration. The ring AaClogl(Y ) of Coleman algebraic functions comes with a natural filtration called the weight filtration, defined as follows.
Definition 4.1.9 (Weight filtration on AaClogl(Y )). (1) A unipotent vector bundle E with log-connection on (X, D) is said to have weight at most m just when it admits a -stable filtration
0 = W-1E  W0E  W1E  · · ·  WmE = E
such that: · grW i E := WiE/Wi-1E is a trivial vector bundle with connection (direct sum of copies of (OX , d)) for all 0  i  m; and · the connection on WiE/Wi-2E is regular on X (i.e. takes values in 1X OX (WiE/Wi-2E)) for all 0 < i  m.
(2) A Coleman algebraic function is said to have weight at most m just when it is represented by an abstract Coleman algebraic function (E, b,  ) where E has weight at most m. We write WmAaClogl(Y ) for the set of elements of AaClogl(Y ) of weight at most m. It is easy to check that this defines an exhaustive Kv-algebra filtration on AaClogl(Y ).
Remark 4.1.10. In the particular case that Y = X is projective, the weight filtration is the same as the filtration considered in [Bes02, Definition 5.4].
We conclude this section with some illustrative examples of Coleman algebraic functions of small weight. None of this will be directly used in what follows.
Example 4.1.11. A unipotent vector bundle E with log-connection on (X, D) has weight at most 0 if and only if it is a direct sum of copies of (OX , d). In particular, if f  W0AaClogl(Y ), then f can be represented by a triple (E, b,  ) where  : E  OX is compatible with the connection. It follows that f can be represented by a triple where E = (OX , d) and  is the identity. In other words, f  Kv is constant.
Example 4.1.12. Suppose that f  W1AaClogl(Y ), so that f is represented by a triple (E, b,  ) where E is an extension
0  W0E  E  grW 1 E  0

36

L. ALEXANDER BETTS

of vector bundles with connection on X with W0E and grW 1 E both trivial. The restriction of  to W0E automatically preserves the connection, so quotienting E by
the kernel of  |W0E if necessary, we may assume without loss of generality that W0E
has rank at most 1 and that  |W0E is injective. Similarly, the smallest subbundle of grW 1 E containing the image of b is stable under the connection, so we may also assume without loss of generality that grW 1 E has rank at most 1, and that its fibre at b is spanned by the image of b  Eb.
Now if either W0E = 0 or grW 1 E = 0 then E has weight at most 0 and f is constant. Otherwise, E has rank 2, and the map  : E  OX yields a splitting E = OX2 as vector bundles (not necessarily compatible with the connection) for which  is the projection onto the first factor and b  Eb = Kv2 is of the form (a, 1) for some a. Using this splitting E = OX2, we may write the connection on E as

=d-

0 0

 0

for some   H0(X, 1X ). Put together, this says that f is given by the Coleman integral
z
z a+ .
b
Thus, W1AaClogl(Y ) consists exactly of the constant functions plus Coleman integrals of differential forms  of the first kind.

Already in weight 2, the theory of Coleman algebraic functions is much richer, and involves the kinds of functions seen in quadratic Chabauty.

Lemma 4.1.13. Let E0 be an effective divisor on X, supported outside the residue disc of b, such that H1(X, OX (E0)) = 0, and write E = E0 + supp(E0). Let 1, . . . , 2g  H0(X, 1X(E)) be differentials of the second kind forming a basis of H1dR(X/Kv), such that that 1, . . . , g form a basis of H0(X, 1X ).
Suppose f  W2AaClogl(Y ) is a Coleman algebraic function of weight at most 2. Then there are constants aij  Kv for 1  i  2g and 1  j  g, constants ai  Kv for g + 1  i  2g, a differential   H0(X, 1X (E + D)) of the third kind, and a rational function h  H0(X, OX (E + D)) such that f is given by the iterated Coleman integral

f (z) =

aij

1i2g 1jg

z

ij +

ai

b

g+1i2g

z
i +
b

z
 + h(z)
b

outside the residue discs meeting the divisor E + D. Here, we adopt the same convention for iterated integrals as [Kim09, p. 109]: that the right-hand differential is integrated "first".

Proof. We begin by explaining why the basis 1, . . . , 2g exists. A de Rham cohomology class [E]  H1dR(X/Kv) is represented by an extension

0  OX  E  OX  0

of vector bundles with connection on X. We write E  E for the preimage of

the subbundle OX (-E0)  OX under the map E  OX , which is an extension

of OX (-E0) extension E

by OX splits.

. A

ScihnoceiceExotf 1OsXp(liOttXin(g-EE 0

), OX ) = OX

= 

H1(X, OX (E0)) OX (-E0) gives

= 0, the rise to a

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

37

splitting of the bundle E over the generic point of X, with respect to which the connection can be written as

=d-

0 0

 0

for some rational differential . If now E  E denotes the preimage of the subbundle OX (-E)  OX , then
E  E and (E)  1X Kv E. Using this, we see that   H0(X, 1X (E)). Thus, we have seen that every de Rham cohomology class [E]  H1dR(X/Kv) is represented by a differential   H0(X, 1X (E)), which establishes the existence of the claimed basis 1, . . . , 2g.
Now we come to the main part of the proof: showing that f has the claimed form. Choose a triple (E, b,  ) representing f , where E has a weight filtration

0  W0E  W1E  W2E = E

as in Definition 4.1.9. As in Example 4.1.12, we may suppose without loss of generality that W0E = OX and the restriction of  to W0E is the identity map on OX , and that grW 2 E = OX and the image of b in grW 2 Eb = Kv is equal to 1. We have grW 1 E = OXm and the extension

0  OX  W1E  OXm  0

is split by  , so W1E = OXm+1, with connection

0 1 2 . . . m

0 0 0 · · · 0 

 = d - 0 0

0 ···

0

 

  

...

...

... . . .

...

  

0 0 0 ··· 0

for some differentials 1, . . . , m  H0(X, 1X ). Now we let E  E denote the preimage of OX (-E0) under the map E 
grW 2 E = OX . As above, E splits as an extension of OX (-E0) by W1E, so we have E = OXm+1  OX (-E0), with  being the projection on the first factor. This splitting gives a trivialisation of E over the generic point of X and, arguing as above, the connection on E can be written with respect to this basis as

0 1 2 . . . m  

0 0 0 · · · 0 1 

0 0



=

d

-

  

...

...

0 ··· ... . . .

0 ...

2

 

...

  

0 0

0 ···

0

m

 

0 0 0 ··· 0 0

for differentials 1, . . . , m  H0(X, 1X ), 1 , . . . , m  H0(X, 1X(E)) and   H0(X, 1X (E + D)). In other words, f is given by the iterated Coleman integral

mz

z

m

z

f (z) =

kk +  + ak k + a0 ,

k=1 b

b

k=1

b

where (a0, a1, . . . , am, 1) are the coordinates of b  Eb = Kvm+2.

38

L. ALEXANDER BETTS

The differentials i are of the second kind, since they represent classes inside

H1dR(X/Kv). the identity

Hence, writing each k

z b

(dg)

=

z b

g

-

g(b)

abnz d,wk einmtaeyrmresaorfratnhgee

basis i, and using f into the claimed

form.

Remark 4.1.14. Note that the form of f in Lemma 4.1.13 is more restrictive than what is asserted in [BD19a, Proposition 2.3] in the case D = , both in the number of quadratic terms (2g2 instead of 4g2) and the possible pole orders of h. This is ultimately why we obtain better bounds than [BD19a] in the case of quadratic Chabauty (see Example 1.2.2): we end up bounding the number of zeroes of a more restrictive class of functions than considered in [BD19a], so end up with better bounds.
4.2. Relation with the unipotent de Rham fundamental group. As might be expected from the definition, the ring AaClogl(Y ) of Coleman algebraic functions is closely related to the unipotent de Rham fundamental group of Y , in a sense we now make precise. Recall that the unipotent de Rham fundamental group U dR is defined to be the Tannaka group of the category MICun(Y ) of unipotent vector bundles with connection on Y at (the fibre functor associated to) the basepoint b. Equivalently, via Deligne's canonical extension, U dR is the Tannaka group of the category MICun(X, D) of unipotent vector bundles with log-connection on (X, D), again at the basepoint b.
The de Rham fundamental group comes endowed with two extra structures: a weight filtration and a Hodge filtration. Of these, the weight filtration is easier to describe [AMO95, Definition 1.5]: it is the filtration given by setting:
· W-1U dR = U dR; · W-2U dR is the kernel of the map from U dR to the abelianised de Rham
fundamental group of X; and · for k  3, W-kU dR is the subgroup-scheme generated by commutators of
elements in W-iU dR and W-j U dR for i + j = k.
The description of the Hodge filtration is rather more complicated. The original definition is due to Wojtkowiak [Woj93, §5.6], but for our applications we will only need the following description of F0, due to Hadian [Had11].
Lemma 4.2.1. The subgroup F0U dR is canonically isomorphic to the Tannaka group of the category of unipotent vector bundles on X ( without connection) at the basepoint b. The inclusion F0U dR  U dR corresponds under the Tannakian formalism to the functor MICun(X, D)  Modun(OX ) given by forgetting the connection.

Proof. When Y is affine (i.e. D is non-empty), this is [Had11, Remark 3.8]; the projective case can be reduced to the affine case e.g. by the argument outlined in [Fal07].

Remark 4.2.2. There is a subtle technical point at play in the proof of Lemma 4.2.1 above, which has to do with the definition of the Hodge filtration on the de Rham fundamental group. Namely, in most of the literature on the Chabauty­ Kim method, e.g. in [Kim09], the definition of the Hodge filtration used is the one given by Wojtkowiak [Woj93, §5.6], rather than that defined by Hadian [Had11,

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

39

Lemma 3.6]12. These two definitions of the Hodge filtration presumably agree, but there does not appear to be a published proof of this fact in the literature13.
So, for clarity, whenever we refer to the Hodge filtration on the de Rham fundamental groupoid in this paper, we always mean the one constructed by Hadian. This means that when we later use the comparison isomorphism between ´etale and de Rham fundamental groups, we cannot use the comparison isomorphism of Olsson [Ols11, Theorem 1.8], since it is important for us that this comparison isomorphism is compatible with Hodge filtrations, and Olsson proves this only for Wojtkowiak's definition of the Hodge filtration [Ols16, Corollary 8.13]. Instead, we have to follow the approach described in [Had11, §7][Fal07, §5], and use a comparison isomorphism for unipotent fundamental groups deduced from Faltings' comparison isomorphism for cohomology with coefficients in crystalline local systems. Again, the comparison isomorphism constructed in this way presumably coincides with that defined by Olsson, but we do not need, or prove, this fact.

Using this description of the weight and Hodge filtrations on U dR, we can now make precise the relationship between U dR and the ring AaClogl(Y ) of Coleman algebraic functions. Given an abstract Coleman algebraic function (E, b,  ), we obtain a corresponding coordinate map (E,b,) : U dR  A1, namely the composite

(4.2.1)

U dR  Aut(Eb) --b-- Hom(Eb, A1) -e-v-b A1 ,

where the first map is the action of U dR on the fibre of E, the second is composition

with the fibre of  , and the third is evaluation at b  Eb. It is easy to check, using tensor-naturality of the action of U dR on the fibres Eb for various E, that the construction (E, b,  )  (E,b,) defines a homomorphism

 : AaClogl(Y )  O(U dR)

of Kv-algebras.

Theorem 4.2.3. The map  : AaClogl(Y )  O(U dR) is an isomorphism onto the subring O(F0\U dR), and is strictly compatible with the weight filtration.

Proof. We proceed in several steps.
Step 1: the image of  lies in O(F0\U dR). Suppose that f  AaClogl(Y ) is represented by a triple (E, b,  ). It follows from
Lemma 4.2.1 and the fact that  is a morphism of vector bundles that the map b : Eb  Kv is invariant under the action of F0U dR. It follows that the map U dR  Hom(Eb, A1) given by the composite of the first two maps in (4.2.1) factors through F0\U dR, and hence that (f ) = (E,b,)  O(F0\U dR).
Step 2: the map  preserves the weight filtration.

12There is a small error in the statement of [Had11, Lemma 3.6]. Namely, in order that the filtration satisfying the list of properties is unique, one should also require that the element pn lies in F0. This is not, as claimed, a consequence of the other properties.
13Richard Hain has suggested to me that one should be able to prove the equivalence of these two definitions by appealing to the Hodge theory of the unipotent fundamental group. Specifically, one can show using the theorem of the fixed part that the universal pro-unipotent C-local system on a curve over C can be made into a pro-unipotent variation of mixed Hodge structure in an essentially unique way (subject to a mild condition on the fibre over b). So checking that Hadian's definition of the Hodge filtration agrees with Wojtkowiak's amounts to showing that the filtration defined in [Had11, Lemma 3.6] underlies a variation of mixed Hodge structure. This should be an easy consequence of Hadian's constructions, but I have not checked this sufficiently carefully.

40

L. ALEXANDER BETTS

Suppose that f  WmAaClogl(Y ), so that f is represented by a triple (E, b,  ) with E of weight at most m, as in Definition 4.1.9. We fix a weight filtration

0 = W-1E  W0E  W1E  · · ·  WmE = E

on E. Since this weight filtration is a filtration by vector subbundles with logconnection, whose graded pieces are trivial, it follows that the action of U dR on Eb
is unipotent with respect to the induced filtration on Eb. Thus, the derivative of the action of U dR is given by a map

()

Lie(U dR)  W-1End(Eb) ,

where W-1End(Eb) denotes the vector space of endomorphisms of Eb taking WiEb into Wi-1Eb for all 0  i  m.
Now by assumption, each quotient WiE/Wi-2E is a vector bundle with connection on X, so the action of U dR on WiEb/Wi-2Eb factors through U dR/W-2U dR. It follows that () takes W-2Lie(U dR) into W-2End(Eb), and hence that () is a morphism of filtered (pro-)nilpotent Lie algebras.
Then, since the map b : Eb  Kv is filtered, it follows that the map U dR  Hom(Eb, A1) given as the composite of the first two arrows in (4.2.1) is a morphism of filtered affine Kv-schemes, when Hom(Eb, A1) = Spec(Sym·(Eb)) is given its natural filtration. Since b  WmEb, it follows that (f ) = (E,b,)  WmO(U dR), as desired.
Step 3: the map  is injective. We use the criterion of Lemma 4.1.6(1). Suppose that f  AaClogl(Y ) is represented
by a triple (E, b,  ), and let - ker( ) denote the largest -stable subbundle of the kernel of  : E  OX . Then the fibre of - ker( ) at b is the largest U dRsubrepresentation of Eb contained in the kernel of b : Eb  Kv.
If f lies in the kernel of , then this says exactly that b(u(b)) = 0 for points u of U dR (valued in any Kv-algebra). In other words, b is contained in the largest U dR-subrepresentation of Eb contained in the kernel of b. Thus, b  (- ker( ))b, so f = 0 by Lemma 4.1.6.
Step 4: the map  is surjective and strict for the weight filtration. Suppose that   WmO(F0\U dR). The left-multiplication action of U dR on
itself makes O(U dR) into an ind-U dR-representation. The corresponding coaction of O(U dR) [Mil17, §4a] is just the left-comultiplication of the Hopf algebra O(U dR). Since the Hopf algebra structure is compatible with the weight filtration by Example 2.1.5, it follows that WmO(U dR) is a U dR-subrepresentation of O(U dR), of finite dimension.
Now consider the map  : (WmO(U dR))  Kv given by evaluation on . This map is F0U dR-invariant by choice of . Hence by Lemma 4.2.1, the U dRrepresentation (WmO(U dR)) corresponds under the Tannakian formalism to a vector bundle Em with log-connection on (X, D), and the map  corresponds to a morphism  : Em  OX of vector bundles on X. If we let b  (WmO(U dR)) denote the restriction of WmO(U dR) of the counit of the Hopf algebra O(U dR), then the triple (Em, b, ) is an abstract Coleman algebraic function. We write f  AaClogl(Y ) for the element it represents.
Now if u  U dR() for some Kv-algebra , then we have
(f)(u) = (u(b)) = (evu) = (u) ,

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

41

where evu : O(U dR)   is the "evaluate at u" map. It follows that (f) = ,
and hence that  is surjective. To prove strictness, it suffices to prove that in fact f  WmAaClogl(Y ), for which
it suffices to prove that Em has weight  m in the sense of Definition 4.1.9. For this, we consider the filtration on WmO(U dR) given by the subspaces WiO(U dR) for 0  i  m. This is a filtration by U dR-subrepresentations. Since the O(U dR)coaction on each graded piece factors through the subcoalgebra Kv = W0O(U dR)  O(U dR), it follows that the action of U dR on each graded piece is trivial. Similarly, since the O(U dR)-coaction on each WiO(U dR)/Wi-2O(U dR) factors through the subcoalgebra W1O(U dR)  O(U dR), it follows that the action of U dR on each of these partial quotients factors through U dR/W-2.
Translated through the Tannakian formalism, this filtration on WmO(U dR) in-
duces a corresponding filtration W· on the associated vector bundle with logconnection Em on (X, D), whose graded pieces are all trivial, and such that each quotient WiEm /Wi-2Em is a vector bundle with connection on X. Taking a suitable shift of the dual filtration on Em, we see that f  WmAaClogl(Y ), as desired.
This concludes the proof of Theorem 4.2.3.

As a consequence, we can determine the Hilbert series of AaClogl(Y ).

Corollary

4.2.4.

The

Hilbert

series

of

AaClogl(Y )

is

1-gt 1-2gt-(r-1)t2

.

Proof. The Hilbert series of AaClogl(Y ) is the same as that of F0\U dR; we compute the latter Hilbert series instead. By Lemma 2.1.9, this Hilbert series is given by

HSF0\UdR (t) = HSUdR (t)/HSF0UdR (t).

Now U dR is the Kv-pro-unipotent completion of the surface group g,r, so

HSUdR (t)

=

1 1-2gt-(r-1)t2

by Lemma 2.1.8.

Also, F0U dR is the free Kv-pro-

unipotent group on g generators and the restriction of the weight filtration is the

descending central series filtration. Thus O(F0U dR) is the tensor algebra on g

generators in weight 1, and hence HSF0UdR (t) =

1 1-gt

.

Combined, this yields the

result.

4.2.1. The de Rham Kummer map. We want to reinterpret Theorem 4.2.3 in terms

of the de Rham Kummer map14 jdR appearing in the Chabauty­Kim method

[Kim09, §1]. We recall the definition.

For any Kv-rational point y  Y (Kv), one has the de Rham torsor of paths PydR, which represents the scheme Iso(bdR, ydR) of isomorphisms between the de Rham fibre functors MICun(X, D)  ModfiKnv associated to b and y, respectively. If y  Y(Ov) is Ov-integral, reducing to a point y0  Y0(kv), then one also has the crystalline torsor of paths15 Pyc0r,iKs v , which represents the scheme Iso(bc0ris, ycr0is) of isomorphisms between the crystalline fibre functors IsocuKnv (Y0)  ModfiKnv associated to b0 and y0, respectively. There is then an isomorphism

()

Pyc0r,isKv = PydR

14This map is also known as the de Rham unipotent Albanese map in the works of Kim. 15The subscript Kv is there to remind the reader that, according to this definition, the crys-
talline path-torsor is a scheme over Kv, not over its maximal unramified subfield Kv,0, as might be expected. In fact, one can define a crystalline path-torsor Pyc0ris over Kv,0 [Shi00], and the crystalline path-torsor Pyc0ri,sKv defined above is just the base change of Pyc0ris to Kv. Of course, in our applications we will have Kv = Qp, so this distinction will be unnecessary.

42

L. ALEXANDER BETTS

arising from Lemma 4.1.4. The path-torsors PydR and Pyc0r,isKv carry additional structures: the crystalline
path-torsor Pyc0r,iKs v carries a crystalline Frobenius automorphism f [Bes02, p. 8]16, and the de Rham path-torsor PydR carries a Hodge filtration F0 on its affine ring. The subscheme F0PydR := Spec(O(PydR)/F1) is non-empty ­ indeed, it follows from a similar discussion to Lemma 4.2.1 that F0PydR is the Tannakian path-torsor from b to y in the category Modun(OX ) of unipotent vector bundles on X.
Besser has proved [Bes02, Corollary 3.2] that Pyc0r,isKv has a unique f -fixed Kvpoint ycris, while F0PydR has a Kv-point ydR by virtue of being a torsor under F0U dR. The element ydR is unique up to left-multiplication by elements of F0U dR(Kv). The de Rham non-abelian Kummer map
jdR : Y(Ov)  F0\U dR(Kv)
is then the map y  (ydR)-1ycris ,
where we view both ycris and ydR as Kv-points of PydR via ().
The coordinates of the de Rham non-abelian Kummer map are known to be Coleman analytic functions; we wish here to point out the slightly stronger fact that they are in fact Coleman algebraic, and to clarify the role of the weight filtration. This is essentially a rephrasing of Theorem 4.2.3.

Theorem 4.2.5. Let   O(F0\U dR), and let f  AaClogl(Y ) be the Coleman algebraic function corresponding to  under the isomorphism of Theorem 4.2.3. Then the composite
Y(Ov) -j-dR F0\U dR(Kv) - Kv
is equal to f. In particular, if   WmO(F0\U dR), then   jdR is a Coleman algebraic function of weight at most m.

Proof. Let (E, b,  ) be a the de Rham path-torsor

triple PydR,

representing f both ycris and

 AaClogl(Y ). ydR induce

Being Kv-points of isomorphisms Eb -

Ey. Following through the definition of the isomorphism AaClogl(Y ) = O(F0\U dR)

in (4.2.1), we see that

(jdR(y)) = b((ydR)-1ycris(b))
for all y  Y(Ov). Now on the one hand, F0PydR is isomorphic to the Tannakian torsor of paths
from b to y in the category Modun(OX ) of unipotent vector bundles on X, and the inclusion F0PydR  PydR corresponds to the tensor-functor MICun(X, D)  Modun(OX ) given by forgetting the connection. Since the map  : E  OX is a morphism of vector bundles, it follows that b  (ydR)-1 = y by naturality.
On the other hand, it follows by definition of analytic continuation along Frobenius [Bes02, §3] that the square

16The Frobenius automorphism is denoted by  in [Bes02]. We prefer the notation f to avoid confusion with the semilinear crystalline Frobenius on Pyc0ris [Shi00, p. 594]. It is presumably the case that Besser's Frobenius automorphism [Bes02, p. 8] is the f th power of Shiho's [Shi00, p. 594], where f = [Kv,0 : Qp], though we have not carefully checked this. We persist in the notation f
nonetheless.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

43

(jE an|]b0[)=0 Tb0,y0 (jE an|]y0[)=0





Eb

ycris

Ey

commutes, where the two vertical maps are given by evaluating a flat section at b and y, respectively, as in Lemma 4.1.4.
Put all together, this says that jdR(y) = y(y0 (y)), where y0 = Tb0,y0 (b0 ) with b0 the unique flat section of jEan over the residue disc ]b0[ which is equal to b at b. In other words, (jdR(y)) is given by evaluating the abstract Coleman function (jEan, , j an) at y. Since this represents f, we thus have (jdR(y)) = f(y), as desired.
4.2.2. Coleman algebraic functions associated to a quotient. In our effective Chabauty­ Kim method, we will use a slight refinement of the theory of Coleman algebraic functions which focuses just on a subcategory of MICun(X, D). Let U be a quotient of U dR. We say that an object E of MICun(X, D) is associated to U just when the U dR-action on Eb factors through U .
Definition 4.2.6. A Coleman algebraic function f is said to be associated to U just when it can be represented by a triple (E, b,  ) where E is associated to U . We write AaClogl(Y )U for the set of Coleman algebraic functions associated to U , which is a subalgebra of AaClogl(Y ), and endow it with the subspace filtration.
Remark 4.2.7. Just like the whole algebra AaClogl(Y ), the subalgebra AaClogl(Y )U is independent of the basepoint b, in the following sense. Given a second basepoint b, the de Rham fundamental group U dR of Y based at b is isomorphic to U dR via the isomorphism given by conjugating by a de Rham path. This isomorphism is unique up to conjugation by elements of U dR, so the quotient U  of U dR corresponding to U under U dR  U dR is independent of this choice. Since U and U  correspond to the same Tannakian subcategory of MICun(X, D), it follows that AaClogl(Y )U and AaClogl(Y )U are equal as subalgebras ACol(Y), as in Remark 4.1.7.
Just as the algebra AaClogl(Y ) of all Coleman algebraic functions is closely linked to the whole de Rham fundamental group U dR, the subalgebra AaClogl(Y )U is closely linked to the quotient U . For instance, we have the following version of Theorem 4.2.3.
Proposition 4.2.8. The isomorphism AaClogl(Y ) = O(F0\U dR) from Theorem 4.2.3 restricts to a weight-filtered isomorphism AaClogl(Y )U = O(F0\U ).
Proof. It is easy to see that the isomorphism  : AaClogl(Y ) - O(F0\U dR) from Theorem 4.2.3 carries the subalgebra AaClogl(Y )U into O(F0\U ) = O(U )  O(F0\U dR), since for any triple (E, b,  ) where E is associated to U , the functional (E,b,) : U dR  A1 factors through U . Conversely, if   WmO(F0\U ), then we know from the proof of Theorem 4.2.3 that the corresponding Coleman algebraic function f is represented by the triple (Em, b, ), where Em is the vector bundle with integrable logarithmic connection corresponding to (WmO(U dR)) under the Tannakian formalism, and  : Em  OX is the map corresponding the evaluation map ev : (WmO(U dR))  Kv. But since   O(U ), we know that ev factors through

44

L. ALEXANDER BETTS

(WmO(U )), so f is also represented by a triple of the form (EmU , bU , U ), where EmU corresponds to the U dR-representation (WmO(U )). Since EmU is associated to U , it follows that so too is f.
This proves that the isomorphism AaClogl(Y ) = O(F0\U dR) of Theorem 4.2.3 restricts to an isomorphism AaClogl(Y )U = O(F0\U ). That this restricted isomorphism is a filtered isomorphism is automatic, since both sides have the subspace filtrations from AaClogl(Y ) and O(F0\U dR).
In the proof of Proposition 4.2.8, the triple (EmU , bU , U ) representing the Coleman algebraic function f has the property that EmU is simultaneously associated to U and also of weight  m. Hence we obtain the following consequence, which can also be proved by more elementary means.
Corollary 4.2.9. Any f  WmAaClogl(Y )U can be represented by a triple (E, b,  ) where E is associated to U and has weight  m.

5. Bounding zeroes of Coleman algebraic functions

The final ingredient we will need in our proof of effective Chabauty­Kim is a

method to bound the number of zeroes of Coleman algebraic functions. We keep

notation as in the previous section. That is, Kv/Qp is a finite extension, Y /Kv is a smooth hyperbolic curve, X is the smooth compactification of Y , and D is the

complementary divisor. We assume that X is the generic fibre of a smooth proper

curve X /Ov over the ring of integers Ov of Kv, and that the closure D of D in X is ´etale over Ov. We write Y = X \ D, and assume for simplicity that Y(Ov) = .

The result we prove in this section is an explicit upper bound on the number of

zeroes of a Coleman algebraic function in terms of its weight. To state this result,

we write g for the genus of X and r for the degree of the divisor D, so that 2g+r > 2

by hyperbolicity. We write ev and fv for the ramification and residue class degrees

of Kv/Qp, respectively. We set v :=

ev +1 p-1

, and define a positive constant v by

v := p(v-1)fv ·

1

+

(v

-

ev

ev p-1

)

log(p)

.

In the particular case that Kv = Qp, the constants v = p are as in Theorem B.

Theorem 5.0.1. Let U be a quotient of U dR, let m  1, and suppose that f  WmAaClogl(Y )U is non-zero. Then the number of points of Y(Ov) at which f vanishes is at most
m-1
v · #Y0(kv) · (4g + 2r - 2)m · (ci + 1) ,

i=1

where ci := dimKv grW i AaClogl(Y )U are the coefficients of the Hilbert series of AaClogl(Y )U ,

and #Y0(kv) is the number of points of the special fibre of Y which are rational over

the residue field of Kv. (In the case m = 1, the empty product

0 i=1

(ci

+

1)

above

has value 1.)

Remark 5.0.2. The bound in Theorem 5.0.1 is almost certainly non-optimal. In Section 7 we will give considerably better bounds in the case of P1 \ {0, 1, }. I
was unable to find a similar construction in the general case.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

45

Remark 5.0.3. For our applications, we will only need Theorem 5.0.1 in the case Kv = Qp. However, when it comes to the better bounds we will discuss in §5.4, it will be necessary to pass up finite extensions, so it is easiest to work over a general Kv to begin with.
5.1. Action of algebraic differential operators on Coleman algebraic functions. For the proof of Theorem 5.0.1, we follow a strategy similar to that of [BD19a]. In outline, we will cook up a certain differential operator D such that D(f ) = 0, and then use D to analyse the Newton polygon of the power series of f on a residue disc and thereby the number of zeroes of f .
To begin with, we describe the action of differential operators on Coleman algebraic functions. To do so, it is useful to introduce a slight generalisation of the ring of Coleman algebraic functions, by allowing them to take values in a line bundle. This definition follows [Bes02, Definition 4.1].
Definition 5.1.1. Fix a basepoint b  Y(Ov), and let L be an OX -module. An abstract Coleman algebraic section of L (or abstract Coleman algebraic section) is a triple (E, b,  ) consisting of:
· a vector bundle E on X with log-connection along D; · an OX -linear map  : E  L; and · a point b  Eb in the fibre of E at the basepoint b.
We let AaClogl(Y, L) denote the set of abstract Coleman algebraic sections, modulo the equivalence relation generated by identifying (E, b,  )  (E, b ,  ) whenever there is a morphism f : E  E of vector bundles with log-connection such that f (b) = b and    f =  . The direct sum of vector bundles with log-connection induces on AaClogl(Y, L) the structure of a Kv-vector space. As in Definitions 4.1.9 and 4.2.6 (cf. Corollary 4.2.9), we let WmAaClogl(Y, L)U denote the subspace of elements represented by triples (E, b,  ) where E has weight at most m and is associated to U .
Just as for Coleman algebraic functions, a Coleman algebraic section s of L gives rise to a section s|]y0[ of Lan over each residue disc ]y0[ for y0  Y0(kv). Specifically, if (E, b,  ) is a triple representing s, then we define s|]y0[ :=  (Tb0,y0 (b0 )) where b0 is the unique flat section of Ean over ]b0[ which is equal to b  Eb at b, and Tb0,y0 denotes analytic continuation along Frobenius [Bes02, Definition 3.5].
We will be interested in two particular cases. Firstly, we will be interested in the case that L = MX is the constant sheaf with value the function field Kv(X). In this case, the ring AaClogl(Y, MX ) might be called the ring of Coleman rational functions on X. Secondly, we will be interested in the case that L = 1X OX MX, in which case AaClogl(Y, 1X OX MX ) might be called the space of Coleman rational differential forms on X. As this terminology suggests, the differential of an element of AaClogl(Y, MX ) is an element of AaClogl(Y, 1X OX MX ).
Definition 5.1.2. If E is a unipotent vector bundle with log-connection on (X, D), we write d for the natural connection on the Hom-sheaf HomOX (E, MX ). Explicitly, this is the map
d : HomOX (E, MX )  HomOX (E, 1X OX MX )

46

L. ALEXANDER BETTS

sending an OX -linear map  : E  MX to the map df := d   - (1   )  , i.e. the difference between the two diagonal composites in the (not necessarily commuting)

square

E



MX



d

1X (D) OX E 1 1X OX MX .
The Leibniz rules for  and d imply that df is OX -linear. Following [Bes02, Definition 4.6], we define the de Rham differential

d : AaClogl(Y, MX )  AaClogl(Y, 1X OX MX ) to be the map sending a triple (E, b,  ) to (E, b, d ). Proposition 5.1.3 (cf. [Bes02, Proposition 4.11]). Let f  AaClogl(Y, MX ) have de Rham differential df  AaClogl(Y, 1X OX MX ). Then for all y0  Y0(kv), df |]y0[ is the derivative of f |]y0[ as a meromorphic function on the disc ]y0[.

Proof. Let (E, b,  ) be a triple representing f . Then we have df |]y0[ = (d   - (1   )  )(y0 ) = d( (y0 )) = d(f |]y0[) ,
since the section iy0 is flat. This is what we wanted to show. Now fix a non-zero rational differential form   H0(X, 1X OX MX) on X. An
algebraic differential operator is a sum

D=

N

gi

·

di i

i=0

of

powers

of

the

differentiation

operator

d 

,

where

the

coefficients

gi

are

rational

functions on X. We say that the operator D has order N provided gN = 0. The

set of algebraic differential operators forms a non-commutative ring Kv(X)[d/].

The de Rham differential induces an action of the non-commutative ring Kv(X)[d/]

on the ring AaClogl(Y, MX ) of Coleman rational functions.

Lemma 5.1.4. Let E be a unipotent vector bundle with log-connection on (X, D).

Then there is an action of Kv(X)[d/] on HomOX (E, MX ), where Kv(X) acts via

multiplication

on

the

constant

sheaf

MX

and

d 

acts

via

the

composite

HomOX (E , MX ) -d HomOX (E , 1X OX MX ) ---1 HomOX (E , MX )

where the first map is the derivative from Definition 5.1.2, and the second map is induced from the isomorphism 1X OX MX = MX given by dividing by .
This induces an action of Kv(X)[d/] on AaClogl(Y, MX ), where a differential operator D acts via (E, b,  )  (E, b, D( )).

Proof.

For the first part, we need to verify that the action of

d 

on HomOX (E, MX )

satisfies

d 

(g

)

=

g

d 

(

)

+

dg 

for

all



 HomOX (E, MX )

and

all

g

 Kv(X).

This

is easy to check from the definitions, since

d 

(g

)

=

d

(g ) - (1  (g ) 

 )

=

g·d

- (1  g) · (1   )   + (dg) ·  

=

g

d 

(

)

+

dg 

.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

47

The second part (action on AaClogl(Y, MX)) is then clear, since the action of Kv(X)[d/] on HomOX (E, MX ) is clearly natural in E.

5.1.1. Pole orders. In what follows, we will also need to control the "pole orders" of

Coleman log-meromorphic functions. For this, we write div() for the divisor of  as

a section of 1X (D) (so div() is a log-canonical divisor). We write supp(div())Y for the support of div() outside D, viewed as a reduced divisor, and set div()+ :=

div() + (supp(div())  Y ).

We say that an algebraic differential operator D =

N i=0

gi

di i

is regular

out-

side div() just when each gi has no poles outside div(). If D = 0 is regular

outside div(), then we define (in an ad hoc manner) its divisor to be

div(D) := min div(gi) - idiv()+ 0iN , 0 ,
where min denotes the pointwise minimum of divisors. This is an anti-effective divisor, and it is easily verified that the divisor of an algebraic differential operator is superadditive under composition, i.e.
div(D  D)  div(D) + div(D)
for all D, D  Kv(X)[d/] \ {0}. Now for any divisor E on X, the space AaClogl(Y, OX (E)) is a subspace of AaClogl(Y, MX),
and we can control how algebraic differential operators act on these spaces.

Lemma 5.1.5. Let E be a divisor on X and let D  Kv(X)[d/] be a non-zero algebraic differential operator which is regular outside div(). Assume that the support of E is contained in the support of . Then

D AaClogl(Y, OX (E))  AaClogl(Y, OX (E - div(D)))

as subspaces of AaClogl(Y, MX ).

Proof.

It suffices to prove the result in the special case D

=

d 

,

the

general

case

then

following by linearity. For this, we simply note that for any   HomOX (E, OX (E)),

the Coleman differential d is given by the difference between the two diagonal

composites in the square

E



OX (E)



d

1X (D) OX E 1 1X (E + (D  supp(div()))) .

Composing with the isomorphism 1X (E + (D  supp(div()))) = OX (E + div()+)

given

by

division

by

,

we

see

that

d 

(

)



HomOX (E, OX (E

+ div()+)).

This

in

turn

implies

that

d 

(f

)



AaClogl(Y, OX (E + div()+))

for

all

f



AaClogl(Y, OX (E)),

which is what we wanted to show.

5.2. PD-nice differential operators. The theory which enables us to bound the number of zeroes of a Coleman algebraic function f via a differential operator is the "nice differential operators" machinery of [BD19a, §3]. We will in fact use a slight variant on the theory, systematically replacing power series rings with their divided power envelopes. One advantage of this variant is that it deals more naturally with the case p = 2, which is not addressed by the theory in [BD19a].

48

L. ALEXANDER BETTS

Let Ov[[t]]PD denote the algebra of divided power series with coefficients in Ov;

that is, the ring of power series f =

 i=0

ai

ti i!

with ai  Ov.

This is a subring

of the ring of power series convergent on the open disc of radius p-1/(p-1) (with

respect to the norm on Kv satisfying |p| = p-1).

Definition 5.2.1. A differential operator D =

N i=0

gi(t)

di dti



Kv

((t))[

d dt

]

in

the

formal variable t is called PD-nice17 just when each gi  Ov[[t]]PD is a divided

power series with Ov-coefficients for 0  i  N and gN  Ov[[t]]PD,× is an invertible

divided power series. We refer to N as the order of D.

The following is easily verified.

Lemma 5.2.2. The composite of two PD-nice differential operators is PD-nice.

As in [BD19a, Proposition 3.2], PD-nice differential operators can be used to bound the number of zeroes of power series.

Proposition 5.2.3. Let D be a PD-nice differential operator of order N . Suppose

that f  Kv[[t]] is a non-zero power series such that D(f ) = 0. Then f converges

on

the

open

disc

of

radius

p-1/(p-1),

and

for

every



>

1 p-1

,

the

number

of

zeroes18

of f in the closed disc of radius p- is at most

1

+

(

-

1

1 p-1

)

log(p)

· (N - 1) .

Remark 5.2.4. Proposition 5.2.3 in the case Kv = Qp is roughly analogous to [BD19a, Proposition 3.2], which constrains the number of Qp-rational19 zeroes of a power series f in terms of the number of Cp-rational zeroes of D(f ) when p is odd. In fact, it is relatively straightforward to prove [BD19a, Proposition 3.2] from Proposition 5.2.3, though we omit the proof here.
Proposition 5.2.3 also fixes a small gap in the proof of [BD19a, Theorem 1.1]. Specifically, in order to apply [BD19a, Proposition 3.2] to the power series G in the proof of Theorem 1.1(i) on p. 1069 of [BD19a], it is necessary to know that D(G) is non-zero, and it is not obvious why this should be the case. Proposition 5.2.3 clarifies what happens in the case that D(G) = 0: since D has order 3g + 1, the number of Qp-rational zeroes of G is at most p · 3g, and this is even better than the bound obtained in the case D(G) = 0.

For the proof of Proposition 5.2.3, we use the following result, which asserts that if the differential operator D is PD-nice, then the differential equation D(f ) = 0 has a full basis of solutions over the PD-power series.

Proposition 5.2.5. Let D be a PD-nice differential operator of order N and

let a0, . . . , aN-1  Ov. Then there is a unique sequence aN , aN+1, . . . of ele-

ments of Ov such that the divided power series f :=

 i=0

ai

ti i!

 Ov[[t]]PD

sat-

isfies D(f ) = 0.

17Standing for "pretty darn nice". 18Here, "zeroes" means zeroes defined over the completed algebraic closure of Kv, counted
with multiplicity. 19The phrasing of [BD19a, Proposition 3.2] is somewhat unclear as to what field the zeroes
of f are defined over, but what is proven is a bound on the Qp-rational zeroes.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

49

Proof. Write the differential operator D as

N l=0

gl(t)

dl dtl

,

and

write

each

gl

as

 i=0

bli

ti i!

.

We may assume without loss of generality that gN = 1.

Thus, f

satisfies D(f ) = 0 if and only if

N -1
aN+k +

k i

blial+i = 0

l=0 i+j=k

for all k  0. This sets up a recurrence relation giving the values of aN+k in terms of a0, . . . , aN+k-1, and hence f is uniquely determined by the values of a0, . . . , aN-1.

Proof of Proposition 5.2.3. By Proposition 5.2.5, the kernel of D on Ov[[t]]PD is a
free Ov-module of rank N , while the kernel of D on Kv[[t]] is a Kv-vector space of dimension N . Thus, if f  Kv[[t]] satisfies D(f ) = 0, then f  Kv Ov Ov[[t]]PD, so f converges on the open disc of radius p-1/(p-1).

Now rescaling f if necessary, we may assume that f  Ov[[t]]PD but f / mvOv[[t]]PD

where mv

Ov is the maximal ideal. If we write f =

 i=0

ai

ti i!

,

then

by

Proposi-

tion 5.2.5 we must have aI  Ov× for some I < N .

If f has at most N - 1 zeroes on the closed disc of radius p-, then we are

certainly done. If instead f has L  N zeroes on this closed disc, then by the usual

Newton polygon considerations [Gou97, Corollary 6.4.11] we have

vp(ai/i!)  vp(aL/L!) + (L - i)

for all i  L. Taking i = I, this then implies that

()

(L - I)  vp(L!/I!) .

But

by

[BD19a,

Lemma

3.4],

we

have20

vp (L!/I !)



logp(I) +

L-I p-1



I log(p)

+

L-I p-1

.

Combined with (), this yields

L as desired.

1

+

(

-

1

1 p-1

)

log(p)

·I 

1

+

(

-

1

1 p-1

)

log(p)

· (N - 1)

5.3. Constructing a PD-nice algebraic differential operator. Now we come to the proof of Theorem 5.0.1. Fix an Ov-integral point b  Y(Ov). We will bound the number of Ov-integral zeroes of f in a small disc about b, obtaining Theorem 5.0.1 by summing these bounds over discs covering Y(Ov). We choose an integral logarithmic differential   H0(X , 1X (D)) on X which does not vanish at b0 on the special fibre of X . This can be arranged, for example, by choosing a logarithmic differential 0 on the special fibre which doesn't vanish at b0 [Har77, Lemma IV.5.1], and lifting 0 to an integral logarithmic differential by Grauert's Theorem [Har77, Corollary III.12.9].
We also fix an integral local parameter t at b, i.e. a rational function on X which vanishes at b such that the maximal ideal of X at b0 is generated by t and a uniformiser of Kv. Taking Laurent series expansions provides an injective homomorphism
Kv(X)[d/]  Kv((t))[d/dt]

20Strictly speaking, the first inequality here only holds for I = 0. Nonetheless, the inequality between the outer terms holds even in the case I = 0.

50

L. ALEXANDER BETTS

from the algebra of algebraic differential operators to the algebra of formal differential operators in the variable t. We say that an algebraic differential operator D is PD-nice (at b) just when its Laurent series expansion is a PD-nice differential operator in the sense of Definition 5.2.1.
Our aim is to construct a PD-nice algebraic differential operator Dm annihilating all Coleman algebraic functions of weight at most m, and to control the order and divisor of such a differential operator. Here is the precise result we will prove.

Proposition 5.3.1. Let U be a quotient of U dR. For every m  1, there is a PD-nice algebraic differential operator Dm of order at most
m-1
(deg(div()+) + 2)m · (ci + 1) ,
i=1
which is regular outside div(), with divisor

m
div(Dm)  -(deg(div()+) + 2)m · (ci + 1) · div()+ ,
i=1

such that Dm(f ) = 0 for all f  WmAaClogl(Y )U . Here, the constants ci = dimKv grW i AaClogl(Y )U

are the coefficients of the Hilbert series of AaClogl(Y )U . (In the case m = 1, the empty

product

0 i=1

is

to

be

interpreted

as

1.)

Before we come to the proof of this proposition, let us describe how it completes the proof of Theorem 5.0.1.

Proof of Theorem 5.0.1. Let Db ]b0[ denote the closed subdisc of the residue disc

of b defined by the inequality |t|  p-v/ev , where v =

ev +1 p-1

as at the beginning of

this section. By the identity principle for Coleman functions [Bes02, Corollary 4.13],

f is not identically zero on the residue disc ]b0[, so applying Proposition 5.2.3 with

 = v/ev to the differential operator Dm from Proposition 5.3.1 shows that f has at most

()

1

+

(v

-

ev

ev p-1

)

log(p)

n-1
· (deg(div()+) + 2)n · (ci + 1)
i=1

zeroes on Db.
Now the the disc Db contains all Ov-integral points of Y reducing to the same point as b modulo mvv , where mv Ov is the maximal ideal. In other words, the number of zeroes of f on the fibre of the reduction map Y(Ov)  Y(Ov/mvv) containing b is at most (). Since this holds for all b  Y(Ov), we obtain the bound
claimed in Theorem 5.0.1 by summing () over the fibres of the reduction map,
using that #Y(Ov /mvv ) = p(v-1)fv · #Y0(kv) by Hensel's Lemma along with the bound deg(div()+)  2 deg(div()) = 4g + 2r - 4.

In preparation for the proof of Proposition 5.3.1, we prove two preparatory results, which will enable us to construct the operators Dn recursively.
Lemma 5.3.2. Suppose that Dm is an algebraic differential operator which vanishes on WmAaClogl(Y )U . Then for every f  Wm+1AaClogl(Y )U , Dm(f ) is a rational function, lying in H0(X, OX (-div(Dm))).

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

51

Proof. Suppose that f  Wm+1AaClogl(Y )U is represented by a triple (E, b,  ), where E is associated to U and admits a weight filtration

0  W0E  W1E  · · ·  WmE  Wm+1E = E
as in Definition 4.1.9. According to Lemma 5.1.5, Dm(f ) is a Coleman algebraic function valued in OX (-div(Dm)), represented by the triple (E, b, Dm( )).
We claim that Dm( ) vanishes on WmE. Indeed, if b  WmEb, then the triple (E, b ,  ) represents a Coleman algebraic function of weight at most m associated to U . It follows by assumption that (E, b , Dm( )) represents the zero Coleman function, so Dm( )(b ) = 0. This implies that Dm( ) vanishes on WnE.
Thus Dm( ) factors through a map   : E/WmE  OX (-div(Dm)), and Dm(f ) is also represented by the triple (E/WmE, b,  ). Since E/WmE is a trivial vector bundle with connection, it follows as in Example 4.1.11 that Dm(f ) is given by an algebraic section of OX (-div(Dm)), namely the image of the unit section of OX under the composite
OX  E/WmE - OX (-div(Dm)) ,
where the first map is the map sending 1  Kv = OX,b to b.

Lemma 5.3.3. Let E be a divisor on X whose support is contained in the support of , and let V be a subspace of H0(X, OX (E)) of dimension c. Then there is a
PD-nice algebraic differential operator

of order

D=

N

gi

di i

i=0

N  deg(E) + 1

which is regular outside div(), whose divisor satisfies

div(D)  -cE - (c + 1)N · div()+ ,

and which vanishes on V .

Proof. Let VPD denote the set of elements of V  H0(X, OX (E)) whose power

series expansion at b lies in Ov[[t]]PD. This is an Ov-lattice in V .

Let f1, . . . , fc be an Ov-basis of VPD, and write each fi as

 j=0

aij

tj j!

with

aij  Ov. For each i, we let ni denote the least integer such that aini  Ov× (such an index exists since fi / mvVPD). Changing the basis f1, . . . , fc if necessary, we

may assume that 0  n1 < n2 < · · · < nc.

Now following [BD19a, §4.1] we set N = nc+1 := nc + 1, and consider the

c × (c + 1) matrix F given by

Fij

:=

dnj nj

(fi) ,

whose coefficients are rational functions on X, without poles outside div() by

assumption that E is contained in the support of . The desired differential oper-

ator D is defined by

D

:=

c+1
(-1)j+1

det(F

(j) )

dnj nj

,

j=1

52

L. ALEXANDER BETTS

where F (j) denotes the c × c matrix obtained by deleting the jth column of F . The differential operator D is clearly algebraic of degree N and regular outside div(), so it remains to verify the following:

(1) D annihilates V ; (2) D is PD-nice; (3) N  deg(E) + 1; and (4) det(F (j))  H0(X, OX (cE + ((c + 1)N - nj) · div()+)) for all j.

(1) For any rational function f , D(f ) is the determinant of the (c + 1) × (c + 1) matrix F (f ) with entries

F (f )ij =

dnj nj

(fi)

dnj nj

(f )

if i  c, if i = c + 1.

But if f = fi for some i, then the ith and (c + 1)th rows of F (f ) are equal, and hence det(F (f )) = 0. Thus we have D(fi) = 0 for all i, and so D annihilates V .

(2) Since the differential form  was chosen to be regular and non-vanishing at b0,

it

follows

that

the

ratio

u

:=

dt 

is

a

rational

function

on

X

which

is

regular

and

non-vanishing at b0. In particular, the Taylor expansion of u is a unit in Ov[[t]]. It

follows

that

the

differential

operator

d 

=

u

d dt

is

PD-nice;

in

particular,

it

preserves

Ov[[t]]PD. It follows that all the coefficients of the matrix F lie in Ov[[t]]PD, and

hence so too do the coefficients gi of the differential operator D.

It remains to show that the leading coefficient gN of D is a unit in Ov[[t]]PD. For

this, we let mn denote the ideal of Ov[[t]]PD consisting of those divided power series

 j=0

aj

tj j!

such

that

aj

 mv

for

j

< n.

It

follows

from

the

definition

of

nj

that

fj

A·

tnj nj !

mod

mnj +1

for some constant A  Ov× depending on j. It follows by an inductive argument

using

that

d 

=

u

d dt

for

u

 Ov[[t]]×,

that

for

all

n



nj

we

have

dn n

(fj )



A

·

tnj -n (nj - n)!

mod

mnj -n+1

for some constant A  In particular, we see

Othv×atdFeipje=ndidnnngjj

on j and n. (fi) is zero modulo

m1

if

j

<

i

and

is

non-zero

modulo m1 if j = i. In other words, the matrix F modulo m1 is upper triangular

with non-zero diagonal entries. In particular, det(F (c+1)) is non-zero modulo m1,

and hence a unit in Ov[[t]]PD. This is what we wanted to prove.

(3) The rational function fc  H0(X, OX (E)) has no poles on the disc ]b0[, so its power series expansion is convergent on the open disc |t| < 1, and has at

most deg(E) zeroes on this disc. On the other hand, it follows from the definition

of nc that the divided power coefficients acj of fc satisfy vp(acj/j!) > vp(acnc /nc!) for all j < nc. By the usual Newton polygon considerations, it follows that fc has at least nc zeroes on the open unit disc. This implies that N = nc + 1  deg(E) + 1, as desired.

(4) Since each fi  H0(X, OX (E)) and the support of E is contained in the support of , we have
F (f )ij  H0(X, OX (E + nj · div()+)) .

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

53

Since ni  N for all i, this in turn implies that det(F (j))  H0(X, OX (cE + ((c + 1)N - nj) · div()+)) ,
as desired.

Proof of Proposition 5.3.1. Throughout the proof, we write  = deg(div()+) for

short. We proceed by induction, beginning with the base case m = 1. Since

the weight zero Coleman algebraic functions are all constant (see Example 4.1.11),

Lemma

5.3.2

shows

that

d 

(f

)

is

a

rational

function

in

H0(X, OX (div()+))

for

all f  W1AaClogl(Y ).

Thus

the

values

of

d 

(f

)

for

f



W1AaClogl(Y )

span

a

sub-

space of H0(X, OX (div()+)) of dimension  c1 := dimKv grW 1 AaClogl(Y )U . Applying

Lemma 5.3.3, we obtain a PD-nice algebraic differential operator D(1) such that

D(1)(

d 

(f

))

=

0

for

all

f



W1AaClogl(Y ).

The

order

of

D(1)

is



 + 1,

and

its

divisor

is



-(c1 + (c1 + 1)( + 1)) · div()+.

Thus

the

differential

operator

D1

:=

D(1) 

d 

satisfies the conditions of Proposition 5.3.1: its order is at most  + 2 and its divisor

satisfies

div(D1)  -(c1 + 1)( + 2) · div()+ .

Now we proceed inductively, supposing that the differential operator Dm has
already been constructed. Lemma 5.3.2 implies that Dm(f ) is a rational function in H0(X, OX (-div(Dm))) for all f  Wm+1AaClogl(Y )U . Since cm+1 is the dimension of grW m+1AaClogl(Y ) by Corollary 4.2.4, it follows that the values of Dm(f ) for f  Wm+1AaClogl(Y ) span a subspace of H0(X, OX (-div(Dm))) of dimension  cm+1 := dimKv grW m+1AaClogl(Y )U . Applying Lemma 5.3.3 we obtain a PD-nice algebraic differential operator D(m+1) such that D(m+1)(Dm(f )) = 0 for all f  Wm+1AaClogl(Y )U . The order of D(m+1) is at most - deg(div(Dm))+1 and its divisor satisfies

div(D(m+1))  cm+1div(Dm) - (cm+1 + 1) · (- deg(div(Dm)) + 1) · div()+ .

Thus the differential operator Dm+1 := D(m+1)  Dm satisfies the conditions of Proposition 5.3.1. The bounds on the order and divisor of Dm+1 follow from the corresponding bounds for Dm via the calculations

order(Dm+1)  order(Dm) - deg(div(Dm)) + 1

m-1

m

 ( + 2)m (ci + 1) + ( + 2)m (ci + 1) + 1

i=1

i=1

m
 ( + 2)m+1 (ci + 1) ,

i=1

div(Dm+1)  div(Dm) + cm+1div(Dm) - (cm+1 + 1)(- deg(div(Dm)) + 1)div()+

m

m

 -(cm+1 + 1) ( + 2)m (ci + 1) + ( + 2)m (ci + 1) + 1

i=1

i=1

m+1
 ( + 2)m+1 (ci + 1) · div()+ .

i=1

div()+

54

L. ALEXANDER BETTS

5.4. Choosing the differential form . In the proof of Theorem 5.0.1, we showed that Y(Ov) could be covered by p(v-1)fv closed discs, such that f had
at most

()

1

+

(v

-

ev

ev p-1

)

log(p)

n-1
· (deg(div()+) + 2)n · (ci + 1)
i=1

zeroes on each disc. We deduced Theorem 5.0.1 from this using the trivial bound deg(div()+)  2 deg(div()) = 4g + 2r - 4. However, in many cases it is possible to choose  so that deg(div()+) is even smaller than this, and accordingly obtain

a better bound on the number of zeroes of f than claimed in Theorem 5.0.1.
For example, if X has genus 1, then the invariant differential  on X /Ov has divisor D as a section of 1X (D), and is non-vanishing at b0 in the special fibre. Since this divisor is entirely supported within D on the generic fibre, we see that for this particular choice of , we have deg(div()+) = deg(div()) = r. So using

this particular  in the proof of Theorem 5.0.1 yields the better bound

n-1
p · #Y0(kv) · (r + 2)n · (ci + 1)
i=1
on the number of Ov-integral zeroes of f in the genus 1 case.
In the other examples we will examine in this section, the differentials  we will choose will not necessarily be defined over the ground field Kv, instead over a finite extension. This does not affect the conclusion of the method, as per the following more precise version of Theorem 5.0.1.

Proposition 5.4.1. Let O¯v denote the ring of integers of an algebraic closure K¯v of Kv. For N  N0, we say that an integral log-differential   H0(XO¯v , 1X (D)) is N -small just when it is supported at  N points of Y (Kv).
Suppose that for every b0  Y(kv) there is an N -small integral log-differential  which does not vanish at b0. Then for every quotient U of U dR, every m  1 and every non-zero f  WmAaClogl(Y )U , the number of zeroes of f on Y(Ov) is at most
m-1
v · #Y0(kv) · (2g + r + N )m · (ci + 1) ,
i=1
where ci := dimKv grW i AaClogl(Y )U as usual.

Proof. This is proved in exactly the same way as Theorem 5.0.1, with the only

subtlety being that the differential  may be defined over a finite extension of Kv.

For any choice of base point b, let Db ]b0[ be the closed subdisc of radius p-v/ev

containing b, as in the N -small log-differential

proof of Theorem 5.0.1. which does not vanish at

Let b0,

andleHt 0O(Xv O¯v

, 1X Ov

(D)) be an be the ring

of integers of a finite extension Kv /Kv over which  is defined.

The Coleman algebraic function f  WmAaClogl(Y )U determines via base-change

a Coleman algebraic function fKv  WmAaClogl(YKv )UKv , whose restriction to the

disc Db,Kv is just Proposition 5.3.1

the base over the

change of f |Db (indeed, this is true on any disc). finite extension Kv shows that there is a PD-nice

Applying algebraic

differential operator Dm  Kv (X)[d/] of order at most (deg(div()+) + 2)m ·

m-1 i=1

(ci

+

1)

such

that

Dm(f )

=

0.

Applying

Proposition 5.2.3 with  = v/ev

shows that fKv has at most () zeroes on Db,Kv , and hence f also has at most ()

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

55

zeroes on Db. Summing this bound over p(v-1)fv different discs of the form Db for various b  Y(Ov) then completes the proof.

Theorem 5.0.1 is Proposition 5.4.1 combined with the observation that any  is automatically (2g + r - 2)-small. We have just seen that when g = 1, there is a 0-small  which doesn't vanish at any point on the special fibre of Y. We spend the remainder of this section discussing several other examples.

In the relatively

case that X has genus log-canonical whenever

0, the effective z1, z2  D(O¯v)

divisor -z1 - z2 + D on are two different points.

XO¯v If 

is 

H0(XO¯v , 1X (D)) is a log-differential associated to this divisor, then  does not

vanish at any point of the special fibre of Y, and is 0-small by construction. Thus

Proposition 5.4.1 applies in the genus 0 case with N = 0. Note that the differential  here is only defined over O¯v in general.

In the case that X is hyperelliptic of genus at least 2, then the effective divisor (2g - 2)z + D is relatively log-canonical whenever z  X (O¯v) lies in the ramification locus of X  P1Ov . By construction, a log-differential  associated to this divisor is 1-small, and by a suitable choice of z can be chosen not to vanish at any particular point b0  Y0(kv). Thus Proposition 5.4.1 applies for hyperelliptic X with N = 1.

Our remaining two examples are of a much more general nature, and accordingly
weaker than the preceding specific examples. We focus on the case that g  2 and D = , since an N -small   H0(XO¯v , 1X ) is also N -small when viewed as a section of 1X (D). The best result we can get in complete generality only gives a small saving on the naive bound.

Lemma 5.4.2. Suppose that g  2. Then there is an integral differential  
H0(XO¯v , 1X ) which does not vanish at b0 in the special fibre and which is (2g - 3)small.

Proof. We assume that g  3, since we have already dealt with the case that X is hyperelliptic. We will show that there is a point x0 = b0  X0(k¯v) such that h0(b0 + 2x0) = 1. This implies the lemma, since a Riemann­Roch computation then shows that there is a regular differential 0 on X0 which vanishes to order  2 at x0 but doesn't vanish at b0. If we choose an integral point x  X (O¯v) reducing to x0, then we have
g - 2  h0(XK¯v , 1X (-2x))  h0(X0,k¯v , 1X0 (-2x0)) = g - 2
by Riemann­Roch and semicontinuity [Har77, Theorem III.12.8]. Thus the inequalities above are equalities, so 0 lifts to an integral 1-form   H0(XO¯v , 1X (-2x)) by Grauert's Theorem [Har77, Corollary III.12.9]. In other words,  vanishes to order  2 at x, so is certainly (2g - 3)-small.
To find the point x0, if X0 is not hyperelliptic, then we consider the canonical embedding X0  Pgk-v 1. Under this embedding, we have that h0(b0 + 2x0)  2 if and only if the tangent line to X0 at x0 passes through b0. But for a general point x0  X0(k¯v), the tangent line through x0 does not pass through b0 by Samuel's Theorem [Har77, Theorem IV.3.9]. So we are done in this case.
If X0 is hyperelliptic, then we may choose a point x0  X0(k¯v) for which the points b0, x0 and (x0) are distinct, where  is the hyperelliptic involution. The canonical divisor (g - 1)(x0 + (x0)) then represents a class in H0(X0,k¯v , 1X0(-2x0))

56

L. ALEXANDER BETTS

which does not lie in H0(X0,k¯v , 1X0(-b0 - 2x0)). This implies by Riemann­Roch that h0(b0 + 2x0) = h0(2x0) = 1, as desired.
When the residue characteristic p is sufficiently large, this bound can be considerably improved.
Lemma 5.4.3. Suppose that g  2 and p > 2g - 2. Then there is an integral differential   H0(XO¯v , 1X ) which does not vanish at b0 in the special fibre and which is (g + 1)-small.

Proof. As in the proof of Lemma 5.4.2, it suffices to show that there is a point x0 = b0  X0(k¯v) such that h0(b0 + (g - 1)x0) = 1. In fact, we will show this for a general

point x0. Note that the assumption that p > 2g - 2 ensures that X0 is classical, i.e. h0(gx0) = 1 for a general point x0  X0(k¯v) [Lak81, Theorem 11(ii)].

In the case that X0 is hyperelliptic, we are done as in the proof of Lemma 5.4.2, by taking x0 to be any point such that h0((g - 1)x0) = 1 and x0 is different from b0

and its image under the hyperelliptic involution.

We thus assume from now on that X0 is not hyperelliptic, and embedded canonically in Pgk-v 1. For a point x0 of X0, we have that h0((g - 1)x0) = 1 just when there is a unique hyperplane in Pgk-v(1x0) meeting X0,kv(x0) to multiplicity  g - 1 at x0, and we have h0(gx0) = 1 just when this hyperplane meets X0 with multiplicity exactly g - 1. The set of points x0 where h0(gx0) = 1 is open by semicontinuity [Har77, Theorem III.12.8], and is non-empty since X0 is classical. It follows that

this set contains the generic point 0 of X0. In other words, if F = kv(X0) is the function field of X0, then there is a unique hyperplane H  PgF-1 which meets X0,F with multiplicity exactly g - 1 at 0  X0(F ).

The hyperplane H can be described explicitly. Let the projective coordinates of

the point 0  X0(F )  Pg-1(F ) be (f1 : · · · : fg) for some f1, . . . , fg  F . If we

choose a non-constant element t  F , then the module 1F/Fp of K¨ahler differentials

is

one-dimensional

over

F,

spanned

by

dt,

so

we

have

the

differential

operator

d dt

acting on F . With respect to the standard coordinates T1, . . . , Tg on PgF-1, the

hyperplane H is then given by the equation

 f1

det

f2

  

...

fg

d dt

f1

...

ddt...f2

... ...

d dt

fg

...

f dg-2
dtg-2 1

dg-2
dtg-...2

f2

f dg-2
dtg-2 g

 T1

T2

 

...

  

=

0

.

Tg

The fact that H meets X0,F to order exactly g - 1 at 0 implies that the Wron-

skian of f1, . . . , fg is non-vanishing; in other words, the column vectors f (i) :=

di dti

f1,

.

.

.

,

di dti

fg

T
 F g are F -linearly independent for 0  i  g - 1.

Now we claim that the point b0 does not lie on the hyperplane H. For this, write the projective coordinates of b0 as (b1 : · · · : bg), and let b := (b1, . . . , bg)T 

F g be the corresponding column vector. Assuming for contradiction that b0 lies

in H, we find from the explicit equation above that b lies in the F -linear span of

f (0), . . . , f (g-2). Let n  g - 2 denote the least non-negative integer such that b lies

in the span of f (0), . . . , f (n). This implies that all (n + 1) × (n + 1) minors of the

matrix

f (0)|f (1)| . . . |f (n)|b

vanish.

Applying

the

operator

d dt

to

this

matrix

shows

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

57

that all the (n + 1) × (n + 1) minors of the matrix f (0)|f (1)| . . . |f (n-1)|f (n+1)|b also vanish, so that b is also in the span of f (0), . . . , f (n-1), f (n+1). But this implies that b is in fact in the span of f (0), . . . , f (n-1). If n  1, this contradicts the minimality of n; if n = 0 then b is in the span of the empty set, which contradicts b = 0.
We have thus shown that b0 does not lie in H, which implies that we have h0(b0 + (g - 1)0) = 1. Since the locus of points x0 such that h0(b0 + (g - 1)x0) = 1 is open by semicontinuity, there must also be an k¯v-point x0  X0(k¯v) different from b0 with this property. This is what we wanted to show.
We have thus shown that Proposition 5.4.1 holds for N = 2g - 3 if g  2, and for N = g + 1 if moreover p > 2g - 2.
Remark 5.4.4. Avi Kulkarni has suggested to me that one should expect Proposition 5.4.1 to hold for N = g - 1 when g  2, at least for a general curve. Indeed, on X there are 2g-1(2g - 1) odd theta characteristics, each of which has at least one associated divisor of degree g - 1. Taking a differential associated to twice each of these divisors provides a large number of (g - 1)-small differentials on X. It seems highly likely that one should be able to choose one of these differentials so as not to vanish at any chosen point b0 in the special fibre of X , but I have been unable to prove this in any generality.
6. Effective Chabauty­Kim
With all the preliminary machinery set up, we are now ready to describe our effective Chabauty­Kim method and give the proofs of Theorems A, B and C.
We start from the following setup. Let Y /Q be a smooth hyperbolic curve, written as X \ D for X/Q a smooth projective curve of genus g and D  X a reduced divisor of degree r. Let S be a finite set of primes, of size s = #S. Let X /ZS be a regular model of X [Liu02, Definition 10.1.1] over the ring of Sintegers, not necessarily minimal. Let D  X denote the closure of D in X , and set Y := X \ D. We pick an S-integral basepoint21 b  Y(ZS ).
Now choose an auxiliary prime p / S of good reduction for (X , D), i.e. such that X is smooth and D is ´etale over Zp. We let U´et denote the Qp-pro-unipotent ´etale fundamental group of YQ based at b, which is a Qp-pro-unipotent group endowed with a continuous action of the absolute Galois group GQ. The group U´et carries a GQ-invariant weight filtration [AMO95, Definition 1.5]
1  · · ·  W-3U ´et  W-2U ´et  W-1U ´et = U ´et ,
where W-1U´et = U´et, W-2U´et is the kernel of the map from U´et to the abelianisation of the Qp-pro-unipotent ´etale fundamental group of XQ, and for k  3, W-kU´et is the subgroup-scheme generated by the commutator subgroups [W-iU´et, W-jU´et] for i + j = k. When Y = X is projective, this is just the descending central series up to reindexing. We note the following regarding the graded pieces of U´et.
Lemma 6.0.1. For any n > 0, the GQ-representation grW -nU´et is semisimple.
Proof. For n = 1, grW -1U´et is the Qp-linear Tate module of the Jacobian of X, which is semisimple by [Fal83, Theorem (a)].

21The existence of such an S-integral point is of course an assumption on Y and its model Y. However, it is a very mild assumption: there is not much to be said about S-integral points when Y(ZS) = .

58

L. ALEXANDER BETTS

For n = 2, there are GQ-equivariant maps

2 grW -1U ´et  grW -2U ´et

and

Qp(1)  grW -2U ´et ,
zD(Q)

the first of which is the commutator map, and the second of which arises from the inclusions of the cusps of Y . The images of these two maps span grW -2U´et, so grW -2U´et is a quotient of 2 grW -1U´et  zD(Q) Qp(1). Since the class of semisimple representations of GQ is closed under tensor products (see e.g. [Ser97]), direct sums and quotients and contains all Artin­Tate representations, it follows that grW -2U´et is also semisimple.
For n  3, we proceed inductively, noting that the commutator map gives a surjection
(grW -1U ´et  grW 1-nU ´et)  (grW -2U ´et  grW 2-nU ´et)  grW -nU ´et ,
exhibiting grW -nU´et as a quotient of a semisimple representation, so we are done.

Now we fix a GQ-equivariant quotient U of U´et, not necessarily finite-dimensional, and endow it with the induced weight filtration W· from U´et. The quotient U satisfies the three conditions from §3.2: it is unramified at all primes  / S  {p} of good reduction for (X , D); its Lie algebra Lie(U ) is pro-crystalline by [Ols11, Theorem 1.8]; and Vn has no G-invariants for any  since it is a direct summand of grW -nU´et by Lemma 6.0.1 and the latter has no G-invariants by [BL19, Theorem 1.3(1)]. Hence the local cohomology schemes H1(G, U ) are representable for all primes , as are the local and global Selmer schemes H1f (Gp, U ) and SelS,U for any Selmer structure S on U .
Associated to the quotient U , there is a non-abelian Kummer map
jU : Y (Q)  H1(GQ, U (Qp))
given by sending a point y  Y (Q) to the class of the Qp-pro-unipotent ´etale torsor of paths from b to y, pushed out along U´et  U . Similarly, for every prime  there is a local non-abelian Kummer map
j,U : Y (Q)  H1(G, U (Qp))
defined in exactly the same way. For  = p, the image j,U (Y(Z)) of the Z-integral points is finite [KT08, Corollary 0.2], and consists of just the basepoint if  is of good reduction for (X , D).
For  = p, the image jp,U (Y(Zp)) of the Zp-integral points is contained inside H1f (Gp, U )  H1(Gp, U ). There is also a de Rham Kummer map
jdR,U : Y(Zp)  F0\DdR(U )(Qp) ,
given as the composite of the de Rham Kummer map jdR : Y(Zp)  F0\U dR(Qp) from §4.2.1 with the map F0\U dR = F0\DdR(U´et)  F0\DdR(U ). The group U dR here denotes the pro-unipotent de Rham fundamental group of YQp , the functor DdR(-) is the de Rham Dieudonn´e functor at the prime p, and the isomorphism U dR = DdR(U´et) is the ´etale­de Rham comparison isomorphism described in [Had11, §7][Fal07, §5], which preserves the Hodge filtration by its construction.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

59

These Kummer maps fit together in a commuting diagram [Kim09, p. 95]22

(6.0.1)

Y(ZS )
jU

Y (Zp )
jp,U

jdR,U

H1f,T0 (GQ, U (Qp))

locp

H1f (Gp, U )(Qp)

logBK 

F0\DdR(U )(Qp) ,

where T0  p is a finite set of primes, containing S and all primes of bad reduction for (X , D). Collecting what we have proved in the preceding sections, we
see that the sets appearing on the bottom row are the Qp-points of affine Qpschemes H1f,T0 (GQ, U ), H1f (Gp, U ) and F0\DdR(U ), and that these all come with natural weight filtrations on their affine rings, induced from the weight filtration
on U (§3.2, §3.1.1 and §3.1.2). The localisation map locp is a morphism of filtered affine Qp-schemes, since it represents a natural transformation of functors. The Bloch­Kato logarithm logBK is an isomorphism of filtered affine Qp-schemes by Proposition 3.1.10. The map jdR,U has Zariski-dense image by [Kim09, Theorem 1], and for every   WmO(F0\DdR(U )), the composite   jdR,U is a Coleman algebraic function of weight at most m by Theorem 4.2.5. Moreover,   jdR,U is associated to the quotient DdR(U ) of U dR by Proposition 4.2.8; we will say that it is associated to U for short.
Putting all of this together, we obtain our first effective Chabauty­Kim result.

Theorem 6.0.2. Let (cgi,lTo0b)i0 and (clioc)i0 be the coefficients of the power series



HSglob,T0 (t) :=

(1 - tn)- dim H1f,T (GQ,Vn)

n1



HSloc(t) :=

(1 - tn)- dim H1f (Gp,Vn) .

n1

Suppose that m is a positive integer such that the inequality

(6.0.2)

m

m

cgi,lTo0b <

clioc

i=0

i=0

holds. Then:

A) The set Y(ZS) is contained in the vanishing locus of a Coleman algebraic function of weight at most m which is associated to U .
B) We have

m-1
#Y(ZS )  p · #Y(Fp) · (4g + 2r - 2)m · (clioc + 1) ,

i=1

where the constant p is as in Theorem B.

C) If Cmglo,Tb0 :=

m i=0

cgi,lTo0b

and

Cmloc

:=

m i=0

clioc,

and

if

f1, . . . , fCm loc

is

a

basis

of the space of Coleman algebraic functions of weight at most m associated

to U , then for every Cmglo,Tb0 +1-tuple of points x0, x1, . . . , xCm glo,Tb0  Y(ZS ), all

22In [Kim09], the comparison isomorphism used between the ´etale and de Rham fundamental groups is the one of Olsson [Ols11, Theorem 1.8]. However, the proof of commutativity of the diagram only requires one fact about the comparison isomorphism: that it preserves torsor structures. So the diagram also commutes when the comparison isomorphism used is that from [Had11, §7], as here.

60

L. ALEXANDER BETTS

(Cmglo,Tb0 + 1) × (Cmglo,Tb0 + 1) minors of the matrix M with entries Mij = fi(xj ) vanish.

Proof. According to Corollary 3.1.11 and Remark 3.2.8, we see that the Hilbert series of H1f,T0 (GQ, U ) and H1f (Gp, U ) satisfy

HSH1f,T0 (GQ,U)(t) HSglob,T0 (t) and HSH1f (Gp,U)(t) = HSloc(t) .

Hence, when m is such that inequality (6.0.2) holds, we have

m

m

dim WmO(H1f,T0 (GQ, U )) 

cgi,lTo0b 

clioc = dim WmO(H1f (Gp, U )) .

i=0

i=0

In particular, the map locp : WmO(H1f (Gp, U ))  WmO(H1f,T0 (GQ, U )) must fail to be injective for dimension reasons. If  is a non-zero element of the kernel,

then by commutativity of the diagram (6.0.1) and Theorem 4.2.5, the composite

  jp,U : Y(Zp)  Qp vanishes on Y(ZS ), and is a Coleman algebraic function of weight m which is associated to U . This proves (A).

Part (B) follows from Theorem 5.0.1 and the observation that the Hilbert series of H1f (Gp, U ), F0\DdR(U ) and AaClogl(Y )DdR(U) are the same by Propositions 3.1.10 and 4.2.8. Part (C) follows from the simple observation that the kernel of the map
locp : WmO(H1f (Gp, U ))  WmO(H1f,T0 (GQ, U )) has dimension  Cmloc -Cmglo,Tb0 , and hence the image of Y(ZS ) under the map Y(Zp)  QpCm loc given by (f1, . . . , fCm loc ) must be contained in a subspace of dimension  Cmglo,Tb0 . This is equivalent to the vanishing of the minors of the claimed matrix.

Although Theorem 6.0.2 does give effective constraints on the set Y(ZS), it doesn't incorporate any information at places inside the set T0, and as a consequence the inequality (6.0.2) required as input in the theorem depends strongly on S and the bad primes of (X , D). This limitation can be overcome by using a more refined type of Selmer scheme, as defined in [BDCKW18, p. 371] in the case that Y = X is projective, and in [BD19b, Definition 1.2.2] in general.

6.1. Properties of local Kummer maps. The theory of refined Selmer schemes
of the kind studied in [BDCKW18] and [BD19b] revolves around a careful analysis of the images of the local non-abelian Kummer maps j,U for all primes , not just those of good reduction. The image of j,U turns out to be closely related to the mod- reduction type of (X , D) [BD19b], as we now recall.

6.1.1. Local decomposition:  / S. To begin with, let  / S  {p} be prime, and
let C be the set of irreducible components of the special fibre of XZ . If   C is such a component, then we write Y(Z)  Y(Z) for the set of Z-points of Y reducing onto the component  of the special fibre of XZ : we say that Y(Z) is the set of -adic points whose reduction type is . These sets give a partition

(6.1.1)

Y(Z) =

Y (Z )

 C

of the -adic points.
For a reduction type   C, we write S for the image of Y(Z) under the local non-abelian Kummer map j,U . The theory of [BD19b] then shows the following.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

61

Lemma 6.1.1. For all   C, S either is empty or consists of a single point.

Proof. It suffices to prove the result in the case U = U´et. Choose a finite exten-
sion Kv/Q over which Y acquires semistable reduction, and write Ov for the ring of integers of Kv. Let (X , D) be the minimal regular normal crossings23 desingularisation of (XOv , DOv ). The exceptional locus of the map X   XOv is contained in the union of the singular locus of the special fibre of XOv and the special fibre of DOv .
Now let (Xmin, Dmin) be the minimal regular normal crossings model of the
base change (XKv , DKv ). This is a semistable model, and there is a unique morphism (X , D)  (Xmin, Dmin) of models of (XKv , DKv ). If the exceptional locus of the map X   Xmin contains a point in the special fibre of Dmin, then
blowing up this point yields another semistable model of (XKv , DKv ) dominated by (X , D). Repeating this construction if necessary, we find that there is a semistable model (X , D) of (XKv , DKv ) together with a map (X , D)  (X , D) of models, whose exceptional locus does not contain any point in the special fibre of D.
Suppose now that x, y  Y(Z) both reduce onto the component  of the special fibre of X . Since x and y reduce to non-singular points of the special fibre
of X [LT16, Lemma 3.1] and do not reduce onto the special fibre of D, it follows that x and y also reduce onto the same component of the special fibre of X . Moreover, these reductions do not lie in the special fibre of D. Now, via the map (X , D)  (X , D) we see that x and y reduce onto the same component of the special fibre of X , and moreover do not reduce onto the special fibre of D. Thus, x and y are Ov-integral points of Y := X  \ D. Since the model (X , D) is
semistable, we can apply [BD19b, Proposition 3.8.1] to deduce that j,U´et (x) = j,U´et (y)  H1(G, U´et(Qp)), which completes the proof of the claim.

Remark 6.1.2. Lemma 6.1.1 gives an alternative proof of [KT08, Corollary 0.2],
that the image j,U (Y(Z)) is finite. More importantly, it gives us control over the size of the image: for example, we have #j,U (Y(Z))  #C.

6.1.2. Local decomposition:   S. If now   S, then we have a similar decomposition of the set Y (Q), but its description is more complicated. Let (Xmin, Dmin) be the minimal regular normal crossings model of (X, D) over Z, and denote its special fibre by (Xmin,0, Dmin,0). We define C0 to be the set of connected/irreducible components of Xmsmin,0 \ Dmin,0, where Xmsmin,0 denotes the smooth locus in Xmin,0. We also define C1 := |Dmin,0| to be the set of closed points of the special fibre of Dmin, and set C := C0  C1. If   C, then we write Y (Q)  Y (Q) for the set of Q-points of Y reducing onto . These sets give a partition

(6.1.2)

Y (Q) =

Y (Q) .

 C

We note for future reference the following.

23Recall that a model (X , D) of (X, D) over Ov is a pair of a proper flat Ov-scheme X  whose
generic fibre is XKv , and the divisor D  X  of DKv in X . A model (X , D) is said to be regular normal crossings just when X  is a regular scheme and X0 D is a normal crossings divisor on X , where X0 denotes the special fibre of X . A model is semistable just when the special fibre X0 is reduced. See [Liu02, §9.3] for the theory of regular normal crossings models in the case D = ,
and [Bet18, Appendix B] for the general case.

62

L. ALEXANDER BETTS

Lemma 6.1.3. Let 1  C1 be a closed point of Dmin,0. Then Y (Q) =  if and only if 1 is an F-point of Dmin,0. Moreover, when this occurs, there is a unique point z  D(Q) reducing to 1 .
Proof. In one direction, if Y (Q)1 = , then 1 contains the reduction of a Qpoint of X, so must be F-rational. Conversely, since Dmin  Xmin,0 is a normal crossings divisor, Dmin,0 must be contained in the smooth locus of Xmin,0. Hence if 1 is F-rational, then by Hensel's Lemma it is the reduction of infinitely many points of X(Q), in particular Y (Q)1 = .
For the final point, suppose that 1 is F-rational. The component of Dmin containing 1 is Spec(Ov) for Ov the ring of integers in a finite extension Kv/Q. On the one hand, since this component has an F-point, the extension Kv/Q must be totally ramified. On the other, since Dmin  Xmin,0 is a normal crossings divisor, the ring Ov/p must have length 1 as a module over itself, so the extension Kv/Q is unramified. Thus in fact Kv = Q and so 1 is the reduction of a point z  D(Q) as desired.

Similarly to before, for a reduction type   C, we write S  H1(G, U ) for the Zariski-closure of the image of Y (Q) under the local non-abelian Kummer map j,U . The theory of [BD19b] allows us to understand the geometry of these subschemes S .
Lemma 6.1.4.
(1) If 0  C0, then S0 either is empty or a single Q-point. (2) If 1  C1, then S1 either is empty, a single Q-point or a curve of genus 0
(possibly singular). (3) If the cusp 1 is F-rational and contained in the Zariski-closure of the
component 0 , then S0  S1 .
The proof of Lemma 6.1.4 uses the full strength of the theory developed in [BD19b]. We may assume without loss of generality that U = U´et is the whole Qppro-unipotent ´etale fundamental group. Choose a finite Galois extension Kv/Q over which (X, D) acquires semistable reduction, and write Ov for the ring of integers of Kv. Write Gv for the absolute Galois group of Kv, and jv,U´et : Y (Kv)  H1(Gv, U´et(Qp)) for the non-abelian Kummer map, taking a Kv-point y to the class of the torsor of Qp-pro-unipotent ´etale paths from b to y. The cohomology scheme H1(G, U´et) is a closed subscheme of H1(Gv, U´et) via the restriction map [BD19b, Lemma 2.3.1]24, and the non-abelian Kummer map j,U´et : Y (Q)  H1(G, U´et(Qp)) is just the restriction of the map jv,U´et to Y (Q).
Let (X , D) be the minimal normal crossings desingularisation of the base change (Xmin,Ov , Dmin,Ov ). As in the proof of Lemma 6.1.1, there is a semistable model (X (0), D(0)) of (XKv , DKv ) dominated by (X , D) such that the exceptional locus of the map X   X (0) is disjoint from the special fibre of D(0). We then recursively define a sequence of models (X (n), D(n)) for n  0 by setting X (n) to be the blowup

24Strictly speaking, [BD19b, Lemma 2.3.1] only makes an assertion about the Qp-points of these schemes. However, the corresponding result is true for points valued in any Qp-algebra, and the same proof works. Indeed, many of the results from [BD19b] we cite here are phrased in terms of Qp-points but in fact hold functorially; see [BD19b, Remark 2.8.1].

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

63

of X (n-1) at the special fibre of D(n-1) and setting D(n) to be the strict transform of D(n-1) in X (n). All of these models thus fit into a sequence

(Xmin,Ov , Dmin,Ov )  (X , D)  (X (0), D(0))  (X (1), D(1))  · · · .

Now let (n) denote the dual graph of the geometric special fibre of X (n), i.e.
the graph whose vertices correspond to the irreducible components of the geometric
special fibre, and whose edges correspond to the singular points of the geometric special fibre. For n > 0 there is an injection (n-1)  (n) given on the level
of vertices by taking the strict transform of irreducible components, and we set  := l-im (n). The graph  thus admits a decomposition

 = (0) 

z ,

zD(K¯ v )

where z is a half-infinite chain of edges, joined to (0) at the vertex corresponding to the component of the geometric special fibre of X (0) containing the reduction

of z.

For every Kv-point y  Y (Kv), there is some n for which the reduction of y to the special fibre of X (n) does not land in the special fibre of D(n), and we define

red(y)  V () to be the vertex of  corresponding to the irreducible component of

the geometric special fibre of X (n) onto which y reduces. This is independent of

the choice of n, and defines a map red : Y (Kv)  V () called the reduction map [BD19b, Definition 1.1.1]. According to [BD19b, Proposition 3.8.1], the non-abelian

Kummer map jv : Y (Kv)  H1(Gv, U´et(Qp)) factors through the reduction map,

as the composite

Y (Kv) -r-ed V () -j H1(Gv, U ´et(Qp))

for some map j : V ()  H1(Gv, U´et(Qp)). Moreover, for any geometric point z 

D(K¯v), the restriction of j to V (z) is a polynomial map, in the sense that for

every when

  O(H1(Gv, U´et)), the we identify V (z) = N0 in

composite   j|V (z) is the natural way [BD19b,

a polynomial function Corollary 8.1.2 & The-

orem 6.1.1]. In particular, the Zariski-closure of j(V (z)) is the scheme-theoretic image of a morphism A1Qp  H1(Gv, U´et), so is either a single point or a curve of genus 0.

Using this theory, it is easy to deduce Lemma 6.1.4. For point (1), every

point of Y (Q)0 (assumed non-empty without loss of generality) reduces onto the same component of the geometric special fibre of Xmin,Ov by definition. Since all of these points reduce onto smooth points outside the special fibre of Dmin,Ov , they avoid the exceptional locus of the minimal normal crossings desingularisa-

tion (X , D)  (Xmin,Ov , Dmin,Ov ), and so all the same component of the geometric special

fipboirnetsofofXY,(Qavo)id0inaglstohreedspuecceiaolnfito-

bre of D. Since the exceptional locus of X   X (0) is disjoint from the special

fibre of D(0), it follows that all points of Y (Q)0 also reduce onto the same component of the geometric special fibre of X (0), avoiding the special fibre of D(0).

In other words, red(Y (Q)0 ) consists of a single vertex of (0)  . Thus, j(Y (Q)0 ) = jv(Y (Q)0 ) also consists of a single point, as desired.
For point (2), assume without loss of generality that Y (Q)1 = , write z0  Dmin,0(F) as a shorthand for the point 1  C1, and write z  D(Q) for the unique point of D reducing to z0, as in Lemma 6.1.3. The point z0 lies in the

64

L. ALEXANDER BETTS

smooth locus of Xmin  Spec(Z) and the divisor Dmin  Xmin,0 is normal crossings in a neighbourhood of z0, so z0 does not lie in the exceptional locus of the minimal normal crossings desingularisation (X , D)  (Xmin,Ov , Dmin,Ov ). It follows that all points of Y (Q)1 reduce to the same point on the special fibre of X , namely the reduction of z  D(Q). In particular, all points of Y (Q)1 reduce to the same point as z in the special fibre of X (0), so that red(Y (Q)1 )  V (z). In fact, red(Y (Q)1 ) is infinite, since for instance the point z is a limit point of Y (Q)1 , but not of (X (n) \ D(n))(Ov) for any n. It follows that the Zariski-closure of j(Y (Q)1 ) is the same as the Zariski-closure of j(V (z)), which is either a single point or a curve of genus 0, as previously discussed.
Finally, for point (3), write again z0 for the point 1  C1 = Dmin,0(F), and write z  D(Q) for the unique point of D reducing to z0. Following through the arguments of the previous two points, we see that all points of Y (Q)0  Y (Q)1 reduce onto the same component of the special fibre of X (0), namely the component containing the reduction of z. This implies that red(Y (Q)0 )  V (z), and hence that S0  j(V (z))Zar = S1 , as desired. This completes the proof of Lemma 6.1.4.
We will need one final property of the subschemes S , namely a bound on their Hilbert series. For   C0 the Hilbert series is either 0 or 1 according as S is empty or a single Q-point. For   C1, the computation is rather more complicated.

Lemma 6.1.5. Suppose that 1  C1. Then HSS1 (t) (1 - t2)-1 .

Proof. Again, we may suppose without loss of generality that U = U´et and that

Y (Q)1 write z 

= . We D(Q) for

write z0 the point

as a shorthand for the reducing onto z0, as in

cusp 1  Dmin,0(F), Lemma 6.1.3. Let ]z0[

and X an

denote the residue disc of z0 in the model Xmin, and let ]z0[×:=]z0[\{z}. Choose

a Q-rational basepoint b  Y (Q)1 =]z0[×Y (Q) The functor from finite ´etale covers of YQ to finite ´etale coverings of ]z0[×C , given by Y   (YC )an|]z0[× C then induces a morphism

Zp(1) = 1alg,p(]z0[×C , b)  1´et,p(YQ , b)  1´et,p(YQ , b)
on pro-p ´etale fundamental groups, where the left-hand isomorphism comes from [Ber93, Theorem 6.3.5], and the right-hand isomorphism is conjugation by a pro-p ´etale path between b and b. The first fundamental group here is in the sense of [dJ95, p. 94].
The first two of the above maps are equivariant for the action of G, while the final isomorphism exhibits 1´et,p(YQ , b) as a Serre twist of 1´et,p(YQ , b), so the above sequence in particular induces a morphism

H1(G, Q(1))  H1(G, U´et)

on cohomology schemes. The left-hand cohomology scheme is isomorphic to A1Qp
by Kummer theory. If now y  Y (Q)1 =]z0[×Y (Q), then there is a map 1alg,p(]z0[×C ; b, y) 
1´et,p(YQ ; b, y) on pro-p ´etale path-torsors, exhibiting 1´et,p(YQ ; b, y) as the pushout

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

65

of 1alg,p(]z0[×C ; b, y) along the map 1alg,p(]z0[×C , b)  1´et,p(YQ , b). This map on path-torsors is G-equivariant, so we see that there is a commuting square

Y (Q)1
j,z0
H1(G, Qp(1))

Y (Q)
j,U´et
H1(G, U ´et(Qp)) ,

where j,z0 is the map sending y to the class of the Qp-pro-unipotent path-torsor 1alg,Qp (]z0[×; b, y). As mentioned above, H1(G, Qp(1)) = Qp is one-dimensional, and j,z0 is given by y  v(t(y)) - v(t(b)) for t an integral local parameter at z0. It follows that S1 is the scheme-theoretic image of H1(G, Qp(1))  H1(G, U ).
Now the image of the map Qp(1)  U is contained in W-2U , by definition of the weight filtration. Hence this map is filtered if we endow Q(1) with the vector space filtration supported in degree -2, as in Example 2.1.4. Since the map H1(G, Qp(1))  S1 is dominant, we have the inequality
HSS1 (t) HSH1(G,Qp(1))(t) = (1 - t2)-1
by Lemma 2.1.2 and Corollary 2.2.5.

6.2. Effective refined Chabauty­Kim. The partitions (6.1.1) and (6.1.2) of the
local points of Y give rise to a corresponding partition of the S-integral points. We
write C := =p C, which is a finite set since #C = 1 whenever  / S  {p} is a prime of good reduction for (X , D). For an element  = ()=p  C, we write Y(ZS )  Y(ZS ) for the set of S-integral points whose mod- reduction lies in  for all  = p, and say that Y(ZS ) is the set of points of reduction type . As a consequence of the local decompositions (6.1.1) and (6.1.2), these sets constitute a
finite partition

(6.2.1)

Y(ZS ) = Y(ZS )
C

of the S-integral points. For any  = ()=p  C, the closed subschemes S  H1(G, U ) constructed
above form a Selmer structure in the sense of §3.2, and we denote by Sel,U the corresponding Selmer scheme. By construction, Sel,U contains the image of Y(ZS ) under the global non-abelian Kummer map jU , and so the Chabauty­Kim dia-
gram (6.0.1) restricts to a commuting diagram

(6.2.2)

Y(ZS )
jU

Y (Zp )
jp,U

jdR,U

Sel,U (Qp)

locp

H1f (Gp, U )(Qp)

logBK 

F0\DdR(U )(Qp) ,

where again the objects appearing on the bottom row are the Qp-points of filtered affine Qp-schemes, and the maps locp and logBK are a morphism and isomorphism thereof. Following through the same argument as in Theorem 6.0.2 gives the fol-
lowing more refined effective Chabauty­Kim theorem. In the case that Y = X is projective, X is the minimal regular model of X, and S = , this specialises to
Theorems A, B and C of the introduction.

66

L. ALEXANDER BETTS

Theorem 6.2.1. Let s := #S, and let (cgi lob)i0 and (clioc)i0 be the coefficients of the power series


HSglob(t) := (1 - t2)-s · (1 - tn)- dim H1f (GQ,Vn)

n1



HSloc(t) :=

(1 - tn)- dim H1f (Gp,Vn) .

n1

Suppose that m is a positive integer such that the inequality

(6.2.3)

m

m

cgi lob <

clioc

i=0

i=0

holds. Then:

A) For all reduction types   C, the set Y(ZS ) is contained in the vanishing locus of a Coleman algebraic function of weight at most m which is associated to U .
B) We have

m-1

#Y(ZS )  p · (n + r) · n · #Y(Fp) · (4g + 2r - 2)m · (clioc + 1) ,

S

/S

i=1

where n denotes the number of irreducible components of the mod- special

fibre

of

X,

p

=1+

p-1 (p-2) log(p)

if

p

is

odd,

and

p

= 2+

2 log(2)

if

p = 2.

C) If Cmglob :=

m i=0

cgi lob

and

Cmloc

:=

m i=0

clioc,

and

if

f1, . . . , fCm loc

is

a

basis

of the space of Coleman algebraic functions of weight at most m associated

to U , then for every Cmglob + 1-tuple of points x0, x1, . . . , xCm glob  Y(ZS ) of the same reduction type, all (Cmglob +1)×(Cmglob +1) minors of the matrix M

with entries Mij = fi(xj ) vanish.

Proof. The proofs of (A) and (C) follow exactly as the corresponding parts of Theorem 6.0.2 once we have the bound HSSel,U (t) HSglob(t) on the Hilbert series of the refined Selmer scheme, which follows by combining Lemma 3.2.6 with
Lemmas 6.1.5 and 6.1.1. Using part (A), Theorem 5.0.1 gives the bound

m-1
#Y(ZS )  p · #Y(Fp) · (4g + 2r - 2)m · (clioc + 1)
i=1
on the size of each Y(ZS ). Part (B) follows by summing over all .

Remark 6.2.2. The constants n and n + r appearing in Theorem 6.2.1(B) are not always optimal. It can happen that some of the local Selmer schemes S associated to different reduction types  coincide (or one is contained in the other in the case   S). Then if ,   C are such that S  S for all  = p, we have that Sel,U  Sel,U . It follows that, in the setup of Theorem 6.2.1, there is a single non-zero Coleman algebraic function f of weight  m which vanishes on
Y(ZS )  Y(ZS ) . By bounding the size of such unions using Theorem 5.0.1, one can improve the bound in Theorem 6.2.1(B) by replacing the constants n by the size of the finite set j,U (Y(Z)) for  / S  {p}, and the constants n + r by the number of irreducible components of the Zariski-closure of j,U (Y (Q)) for   S.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

67

Remark 6.2.3. The inequality (6.2.3) depends on s := #S and not on the set S itself. Moreover, if the regular model X is defined over Z, then it is easy to see that the quantity S(n + r) · /S n appearing in part (B) of Theorem 6.2.1 is bounded in terms of s only. Hence when X is defined over Z and when inequality (6.2.3) holds for some value of s, then Theorem 6.2.1(B) gives a uniform upper bound on #Y(ZS ) for all finite sets S of primes of size s, not containing p. In other words, the bounds obtained by Theorem 6.2.1(B) are automatically S-uniform, at least for sets S not containing p.

Remark 6.2.4. In general, Theorem 6.2.1 affords better control of S-integral points than Theorem 6.0.2, in that the weight m for which Theorem 6.2.1 holds is in general less than the corresponding weight in Theorem 6.0.2, and the dominant term in the bounds is usually the part depending on m. In fact, it can happen that the inequality in Theorem 6.2.1 holds for some m, while the inequality in Theorem 6.0.2 holds for no m at all, so Theorem 6.0.2 tells us nothing about S-integral points.

6.2.1. Example: quotients of U´et by the weight filtration. In the particular case that the quotient U is chosen finite-dimensional, then the power series HSglob(t) and HSloc(t) appearing in Theorem 6.2.1 are rational functions in t without poles inside the unit disc. The order of their poles at 1 are #S + n>0 dimQp H1f (GQ, Vn) and n>0 dimQp H1f (Gp, Vn), respectively, where (Vn)n>0 denote the graded pieces of the weight filtration on U . In particular, when the inequality

(6.2.4)

#S + dimQp H1f (GQ, Vn) < dimQp H1f (Gp, Vn)

n>0

n>0

holds, then inequality (6.2.3) must hold for m  0, and so we may apply Theorem 6.2.1 to explicitly bound the size of Y(ZS). In other words, Theorem 6.2.1 applies in every case that refined Chabauty­Kim applies.
In fact, the value of m required can be controlled rather explicitly in terms of the
weights of U and the right-hand side of (6.2.4). Suppose that the weight filtration on U is supported in degrees  -n. If we write dglob = #S + i>0 dim H1f (GQ, Vn) and dloc = i>0 dim H1f (Gp, Vn), then the Hilbert series HSglob(t) and HSloc(t) from Theorem 6.2.1 are bounded by

HSglob(t) (1 - t)-dglob and HSloc(t) (1 - tn)dloc ,

respectively. This implies via the binomial theorem that

m
cgi lob 
i=0

m + dglob dglob

and

m
clioc 
i=0

m/n + dloc dloc

for all m. When (6.2.4) holds (i.e. dglob < dloc), this gives the upper bound

m
cgi lob  ndglob
i=0

m/n + dglob dglob

<

ndglob · dloc! (m/n)dloc-dglob · dglob!

m/n + dloc dloc

and hence inequality (6.2.3) holds for m = dloc · ndloc. So Theorem 6.2.1(B) gives the bound

() #Y(ZS )  p ·

dlocndloc -1

n · #Y(Fp) · (4g + 2r - 2)dlocndloc ·

(1 + clioc) .



i=1

68

L. ALEXANDER BETTS

In the particular case that Y = X is projective and S = , this gives the coarse

upper bound on #X(Q) claimed in the Corollary to Theorem B. To extract the

precise form of the bound there, one observes that the coefficients clioc are bounded

above by the

coefficients

ci

of the

power

series

1-gt 1-2gt+t2

by Corollary 4.2.4,

and

these latter coefficients satisfy c0 = 1, c1 = g and ci = 2gci-1 - ci-2 for i  2.

An dloc

eas2ygg-in1d(u2gct)ino.nSguibvsetsittuhteinbgotuhnedsecvlioaclues

1 2

(2g)i

for

i



into () gives

1, the

hence also the bound claimed

bound in the

Corollary.

6.3. The Balakrishnan­Dogra trick. Calculating the dimensions of the global Bloch­Kato Selmer groups in order to compute the power series HSglob(t) from Theorem 6.2.1 can be quite subtle, and in general depends on deep conjectures in
number theory. One already sees this subtlety on the abelian level: the quotient U´et/W-2 = H´e1t(XQ, Qp) is the Qp-linear Tate module VpJ of the Jacobian J of X, so the dimension of H1f (GQ, U´et/W-2) is the p-Selmer rank of J . According to the Tate­Shafarevich Conjecture, this should be equal to the rank of J(Q), but this is still far from known in general.
It was observed in [BD18, Remark 2.3] that one can sidestep the need to assume
the Tate­Shafarevich Conjecture by a suitable modification of the definition of the Selmer scheme and Chabauty­Kim locus. We outline here ­ in sketch form ­
how to adapt our above theory to the variant of the Selmer scheme from [BD18, Definition 2.2].
Let U be a GQ-equivariant quotient of the Qp-pro-unipotent ´etale fundamental group of the hyperbolic curve Y /Q. The quotient V1 = U/W-2U is a quotient of the abelianised Qp-pro-unipotent ´etale fundamental group of X, which is the Qp-linear Tate module VpJ of the Jacobian J of X. Hence the Kummer map for the abelian variety J provides a map

J (Q)  H1f (GQ, VpJ )  H1f (GQ, V1) .

We write H1f,BD(GQ, V1) for the image of this map, which is a Qp-vector space of dimension d1  rk(J (Q)), and conflate H1f,BD(GQ, V1) with its associated vector group as usual.
For a reduction type   C, the Balakrishnan­Dogra Selmer scheme SelBD,U is defined to be the preimage of the closed subscheme H1f,BD(GQ, V1)  H1f (GQ, V1) under the map Sel,U  H1f (GQ, V1) induced from the map U  V1. This is a closed subscheme of the Selmer scheme Sel,U studied in the previous section, and
an inductive argument along the lines of the proof of Lemma 3.2.6 shows that its
Hilbert series is bounded by

HSSelBD,U (t)



HSBglDob(t) := (1 - t2)-s · (1 - t)-d1 ·

(1 - tn)- dim H1f (GQ,Vn) .

n=2

The Balakrishnan­Dogra Selmer scheme SelBD,U still contains the image of Y(ZS ) under the non-abelian Kummer map, and by using this in place of Sel,U , we see
that the statement of Theorem 6.2.1 still holds if the power series HSglob(t) is replaced by HSBglDob(t). Using this variant of Theorem 6.2.1 makes all the bounds in the examples in §1.2 unconditional on the Tate­Shafarevich Conjecture.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

69

7. S-uniformity in Siegel's Theorem

As an application and illustration of our theory, we prove our S-uniform Siegel's
Theorem D. Throughout this section, let Y = P1Z \ {0, 1, }, p be an odd prime, and S a variable non-empty finite set of primes not containing p, of size s = #S.

For the quotient U we take the whole Qp-pro-unipotent ´etale fundamental group of YQ = P1Q \ {0, 1, } (based at some basepoint b  Y(Z(p))). The group U is the free pro-unipotent group on two generators in filtration-degree -2, and hence its

graded pieces are

grW -2nU  Qp(n)M(2,n)

where

M (2, n)

=

1 n

d|n µ(n/d)2i is the nth Moreau necklace polynomial, evalu-

ated at 2 [Reu03, Theorem 6]. Since dimQp H1f (Gp, Qp(n)) = 1 for all n > 0 by

[BK07, Example 3.9], we find via the cyclotomic identity [MR83] that the local

Hilbert series HSloc(t) is given by

HSloc(t) =

(1 - t2n)-M(2,n)

=

1

1 - 2t2

.

n>0

Note that this is the same as in Corollary 4.2.4, and reflects the fact that the affine ring of H1f (Gp, U ) = DdR(U ) is the shuffle algebra in 2 variables. From now on, we will write all our power series in the variable  := t2, which we may do since all the

filtrations we will see are supported in even degrees.

As for the global Hilbert series HSglob(t), Soul´e's vanishing theorem [Sou79] implies that dim H1f (GQ, Qp(n)) = 0 if n = 1 or if n  2 is even, and dim H1f (GQ, Qp(n))  1 if n  3 is odd. This gives the coefficientwise inequality

HSglob(t)  (1 -  )-s ·

(1 -  2n)-M(2,n)

n3 odd

for the global Hilbert series. Although HSglob(t) does not have a simple closed form expression similar to HSloc(t), it does satisfy a functional equation.

Lemma 7.0.1. The power series

F ( ) :=

(1 -  n)-M(2,n)

n>0 odd

satisfies the functional equation

F ( )2

=

1 + 2 1 - 2

· F ( 2) .

Proof. By the cyclotomic identity, we have

1 1 - 2

=

F ( ) ·

(1 -  2n)-M(2,2n) .

n>0

But

we

have

M (2, 2n)

=

1 2n

d|n µ(n/d)4d

=

1 2

M

(4,

n)

if

n is even,

and

have

M (2, 2n)

=

1 2n

d|n µ(n/d)4d

-

1 2n

d|n µ(n/d)2d

=

1 2

M

(4,

n)

-

1 2

M

(2,

n)

if

i

is

odd. Substituting this into the above equation yields

1 1 - 2

= F ( ) ·

(1

-

 2n)-

1 2

M

(4,n)

·

(1

-



2n

)

1 2

M

(2,n)

n>0

n>0 odd

= F ( ) ·

1 1 - 4 2

1/2
· F ( 2)-1/2 .

70

L. ALEXANDER BETTS

Squaring both sides and rearranging gives the desired functional equation.

Remark 7.0.2. Lemma 7.0.1 implies that the coefficients ai of F ( ) satisfy the equation

m

m/2

aiam-i =

bm-2iai

i=0

i=0

for every m  0, where b0 = 1 and bi = 2i+1 for i > 0. Since a0 = 1, this in particular expresses am in terms of the coefficients ai for i < m. This gives an efficient recursive algorithm to compute the coefficients of F ( ) without first

computing the values of M (2, n). Using this method, it is feasible to compute the

first few thousand coefficients of F ( ) on a desktop computer.

Now in order to apply Theorem 6.2.1, we need to find some m for which the

tm

coefficient

of

1 1-t

HSglob

(t)

is

strictly

less

than

the

corresponding

coefficient

of

1 1-t

HSloc(t).

This

is

provided

by

the

following

calculation.

Lemma

7.0.3.

There

is

some

m



4s

such

that

the

t2m

coefficient

of

1 1-t

HSglob

(t)

is

strictly

less

than

the

t2m

coefficient

of

1 1-t

HSloc(t).

Proof. This is easily verified in the case S = ; we deal with the case S = .

We will show that the 4sth coefficient of

1 1-

HSglob

(t)

2
is strictly less than the

4sth coefficient of

1 1-

HSloc(t)

2
; this yields the desired result by expanding both

squares.

Now

on

the

one

hand,

1 1-

HSglob(t)



1 (1- )s-1

· F ( ),

where

F ( )

is

as

in

Lemma 7.0.1. We thus have coefficientwise inequalities

1

1 -



HSglob

(t)

2



1 (1 -  )2s-2

·

1 + 2 1 - 2

· F ( 2)



1 (1 -  )2s-2

·

1 + 2 1 - 2

·

1 1 - 2 2



22s

·

1

1 - 2

,

using,

in

order,

Lemma

7.0.1,

the

identity

1 1-2

= F ( ) ·

n>0(1 -  2n)-M(2,2n) 

F ( ), and the inequalities

1+2 1-2



2 1-2

,

1 1-

·

1 1-2



2 1-2

and

1 1-2 2

·

1 1-2



2 1-2

2

(geometric series). Thus, we see that the 4sth coefficient of

1 1-

HSglob(t)

is at

most 4s · 24s .

On

the

other

hand,

1 1-

HSloc(t)

=

1 1-

·

1 1-2



1 1-2

,

and so

1

1 -



HSloc(

)

2



(1

1 - 2 )2

=

(i + 1)2i i .

i0

Thus the 4sth coefficient of

1 1-

HSloc(t)

2 is at least (4s + 1) · 24s , which is strictly

2

greater than the corresponding coefficient of

1 1-

HSglob

(t)

, as desired.

Remark 7.0.4. The upper bound on m in Lemma 7.0.3 appears to be relatively close to optimal. For s = 0, 1, 2, . . . , 9, the minimal values of m for which  m

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

71

coefficient

of

1 (1- )s-1

· F ( )

is

strictly

less

than

the

m

coefficient

of

1 1-

·

1 1-2

are m = 1, 1, 2, 9, 24, 81, 308, 1212, 4827, 19284. These first few values grow roughly

exponentially, with exponent 4, suggesting that Lemma 7.0.3 captures something

close to the correct growth rate. These values of m were found with the assistance

of Steven Charlton, by computing the first 20000 coefficients of F ( ) using the

recursive algorithm described in Remark 7.0.2.

We can then plug the bound on m from Lemma 7.0.3 into Theorem 6.2.1 to obtain a bound on the size of the set Y(ZS ). The local indices are n = 1 for all , since Y has good reduction everywhere. Hence Theorem 6.2.1(B) gives the bound

4s -1

#Y(ZS )  p · 4s · (p - 2) · 422s+1 ·

(2i + 1) .

i=1

In this particular case, we can actually do considerably better than this bound.

For any prime   S, the Zariski-closure of j,U´et (Y (Q)) has  3 irreducible components, corresponding to the three cusps 0, 1, , which all meet at the point

corresponding to the unique irreducible component of the special fibre of Y by

Lemma 6.1.43. Hence, as in Remark 6.2.2, we see that Y(ZS ) is the union of 3s

subsets, each of which is contained in the vanishing locus of a non-zero Coleman

algebraic function f of weight at most 2 · 4s. Theorem 5.0.1 provides an upper

bound of p · (p - 2) · 422s+1 ·

4s -1 i=1

(2i

+

1)

on

the

number

of

zeroes

of

such

an

f,

but it turns out that one can give a better bound in this particular case.

Lemma 7.0.5. Let f be a non-zero Coleman algebraic function on P1Zp \ {0, 1, } of weight at most 2m. Then the number of Zp-integral zeroes of f is at most p · (p - 2) · 2m+1.

Proof. We follow a similar strategy to the proof of Theorem 5.0.1, except that we can be more explicit about the differential operators involved. For m  0 let Dm denote the differential operator

Dm

:=

(z

-

z2)2m

d2m dz2m

·

(z

-

z 2 )2m-1

d2m-1 dz 2m-1

·

.

.

.

·

(z

-

z2)

d dz

,

where z is the standard coordinate on Y = P1Z \ {0, 1, }. Now we claim that Dm vanishes on all Coleman algebraic functions of weight at
most 2m. We do this by induction on m. In the case m = 0, this is clear since

all Coleman algebraic functions of weight at most 0 are constant. Thus suppose

that Dm vanishes on all Coleman algebraic functions of weight at most 2m. Since the filtration on the ring of Coleman algebraic functions on P1Zp \ {0, 1, } is supported in even degrees, it also vanishes on all Coleman algebraic functions of weight

at most 2m + 1.

Now

the

divisor

of

dz,

as

a

section

of

the

log-canonical

bundle

1
P1Qp

([0]+[1]+[]),

is [0] + [1] - []. It follows that the divisor of Dm satisfies

m
div(Dm)  div

(z

-

z2)2i

d2i dz2i

i=0

= (1 - 2m+1) · [] .

Hence by Lemma 5.3.2 we see that for every Coleman algebraic function f of weight
at most 2m+2, we have that Dm(f ) is a rational function lying in H0(P1Qp , OP1Qp ((2m+1- 1) · [])). In other words, Dm(f ) is a polynomial in z of degree at most 2m+1 - 1.

72

L. ALEXANDER BETTS

Since

the

differential

operator

(z

-

z )2 2m+1

d2m+1 dz2m+1

vanishes on all such polynomials,

it

follows

that

Dm+1

=

(z

-

z 2 )2m+1

d2m+1 dz2m+1



Dm

vanishes

on

all

Coleman

algebraic

functions of weight at most 2m + 2. This completes the induction.

To conclude, we observe that the power series expansion of Dm in the variable t = z - a is a PD-nice differential operator for every a  Zp not in the residue disc of 0 or 1. Since Dm(f ) = 0, the bound on the number of Zp-integral zeroes of f then follows from Proposition 5.2.3.

Remark 7.0.6. The Coleman algebraic functions on P1Zp \ {0, 1, } of weight at most 2m are exactly the linear combinations of p-adic multiple polylogarithms of weight at most m, so Lemma 7.0.5 provides an upper bound on the number of zeroes of any such linear combination. Note that there is a small discrepancy in the usage of the word "weight" between our usage and what is standard in the theory of polylogarithms.

Using this stronger bound, we can now complete the proof of Theorem D. If 2 /
S, then Y(ZS ) =  and so we are certainly done, so we assume henceforth that 2  S. We take p the smallest prime not in S. By Lemma 6.1.4(3), for every   S,
the Zariski-closure of j,U (Y (Q)) has at most three irreducible components, which are genus 0 curves corresponding to the cusps 0, 1,  and which intersect in the
point corresponding to the unique irreducible component of the -adic special fibre of Y. Hence, as in Remark 6.2.2, we see that Y(ZS ) is the union of  3s subsets, each of which is contained in the vanishing locus of a Coleman algebraic function f of weight at most 2 · 4s. Applying the bound from Lemma 5.4.3, we find that

#Y(ZS )  p · 3s · (p - 2) · 24s+1 .

Since p was chosen to be the smallest prime outside S, we know that p  2s+1, so

that

p

·

(p

-

2)

=

p

-

2

+

p-1 log(p)

<

2s+2

and

we

obtain

the

bound

#Y(ZS )  8 · 6s · 24s

as desired.

References

[AMO95] M. Asada, M. Matsumoto, and T. Oda. Local monodromy on the fundamental

groups of algebraic curves along a degenerate stable curve. Journal of Pure and

Applied Algebra, 103(3):235­283, 1995.

[BD18]

J. Balakrishnan and N. Dogra. Quadratic Chabauty and rational points I: p-adic

heights. Duke Mathematical Journal, 167(11):1981­2038, 2018. with an appendix

by J.S. Mu¨ller.

[BD19a]

J. Balakrishnan and N. Dogra. An effective Chabauty­Kim theorem. Compositio

Mathematica, 155(6):1057­1075, 2019.

[BD19b]

L.A. Betts and N. Dogra. The local theory of unipotent Kummer maps and refined

Selmer schemes. arXiv:1909.05734v1, 2019.

[BDCKW18] J. Balakrishnan, I. Dan-Cohen, M. Kim, and S. Wewers. A non-abelian conjecture

of Tate­Shafarevich type for hyperbolic curves. Mathematische Annalen, 372(1­

2):369­428, 2018.

[BDM+19] J. Balakrishnan, N. Dogra, J.S. Mu¨ller, J. Tuitman, and J. Vonk. Explicit Chabauty­

Kim for the split Cartan modular curve of level 13. Annals of Mathematics,

189(3):885­944, 2019.

[Ber93]

V. Berkovich. E´tale cohomology for non-Archimedean analytic spaces. Publications

math´ematiques de l'I.H.E´.S., 78:5­161, 1993.

WEIGHT FILTRATIONS AND EFFECTIVE CHABAUTY­KIM

73

[Ber96] [Bes02] [Bet18] [BK07]
[BL19] [Bro] [CLS99] [Col85] [Del70] [DGH] [dJ95] [DMOS82]
[Eve84] [Fal83] [Fal07]
[FPS97] [FvdP04] [Gou97] [Had11] [Har77] [KC10] [Kim05] [Kim09] [Kim12] [KRZB16]
[KT08] [Lab70] [Lak81]

P. Berthelot. Cohomologie rigide et cohomologie rigide `a supports propres. Premi`ere partie. Institut de recherche math´ematique de Rennes, 1996. preprint 96-03. A. Besser. Coleman integration using the Tannakian formalism. Mathematische Annalen, 322(1):19­48, 2002. L.A. Betts. Heights via anabelian geometry and local Bloch­Kato Selmer sets. PhD thesis, University of Oxford, 2018. S. Bloch and K. Kato. L-Functions and Tamagawa Numbers of Motives. In P. Cartier, L. Illusie, N.M. Katz, G. Laumon, Y.I. Manin, and K.A. Ribet, editors, The Grothendieck Festschrift. Birkh¨auser, 2007. L.A. Betts and D. Litt. Semisimplicity and weight­monodromy for fundamental groups. arXiv:1912.02167v1, 2019. F. Brown. Integral points on curves, the unit equation and motivic periods. arXiv:1704.00555, v1 accessed. B. Chiarellotto and B. Le Stum. F -isocristaux unipotents. Compositio Mathematica, 116:81­­110, 1999. R. Coleman. Effective Chabauty. Duke Mathematical Journal, 52(3):765­770, 1985. P. Deligne. Equations diff´erentielles `a points singuliers r´eguliers. Number 163 in Lecture Notes in Mathematics. Springer Verlag, 1970. V. Dimitrov, Z. Gao, and P. Habegger. Uniformity in Mordell­Lang for curves. Annals of Mathematics. to appear. A.J. de Jong. E´ tale fundamental groups of non-archimedean analytic spaces. Compositio Mathematica, 97(1­2):89­118, 1995. P. Deligne, J. Milne, A. Ogus, and K.-y. Shih. Tannakian Categories. In Hodge Cycles, Motives, and Shimura Varieties, number 900 in Lecture Notes in Mathematics, pages 101­228. Springer Verlag, 1982. J.-H. Evertse. On equations in S-units and the Thue­Mahler equation. Inventiones Mathematicae, 75(3):561­584, 1984. G. Faltings. Endlichkeitss¨atze fu¨r abelsche Variet¨aten u¨ber Zahlk¨orpern. Inventiones Mathematicae, 73:349­366, 1983. G. Faltings. Mathematics around Kim's new proof of Siegel's theorem. In Diophantine Geometry: Proceedings, number 4 in CRM Series, pages 173­188. Edizioni della Normale, 2007. E.V. Flynn, B. Poonen, and E.F. Schaefer. Cycles and quadratic polynomials and rational points on a genus-2 curve. Duke Mathematical Journal, 90(3):435­463, 1997. J. Fresnel and M. van der Put. Rigid Analytic Geometry and its Applications, volume 218 of Progress in Mathematics. Springer Science, 2004. F.Q. Gouv^ea. p-adic Numbers, An Introduction. Universitext. Springer Verlag, second edition, 1997. M. Hadian. Motivic Fundamental Groups and Integral Points. Duke Mathematical Journal, 160(3):503­565, 2011. R. Hartshorne. Algebraic Geometry. Number 52 in Graduate Texts in Mathematics. Springer Verlag, 1977. M. Kim and J. Coates. Selmer varieties for curves with CM Jacobians. Kyoto Journal of Mathematics, 50(4):827­852, 2010. M. Kim. The motivic fundamental group of the projective line minus three points and the theorem of Siegel. Inventiones Mathematicae, 161(3):629­656, 2005. M. Kim. The unipotent Albanese map and Selmer varieties for curves. Publications of the Research Institute for Mathematical Sciences, 45(1):89­133, 2009. M. Kim. Tangential localization for Selmer varieties. Duke Mathematical Journal, 161(2):173­199, 2012. E. Katz, J. Rabinoff, and D. Zureick-Brown. Uniform bounds for the number of rational points on curves of small Mordell­Weil rank. Duke Mathematical Journal, 165(16):3189­3240, 2016. M. Kim and A. Tamagawa. The l-component of the unipotent Albanese map. Mathematische Annalen, 340:223­235, 2008. J.P. Labute. On the Descending Central Series of Groups with a Single Defining Relation. Journal of Algebra, 14:16­23, 1970. D. Laksov. Weierstrass points on curves. Ast´erisque, 87­88:221­247, 1981.

74

L. ALEXANDER BETTS

[Liu02] [LT16] [LZ18]
[Mil17] [MP11]
[MR83] [NSW13]
[Ols11] [Ols16] [PM12]
[Poo98] [Reu03] [Ser97] [Ser02] [Shi00]
[Sou79] [Woj93]

Q. Liu. Algebraic Geometry and Arithmetic Curves, volume 6 of Oxford Graduate

Texts in Mathematics. Oxford University Press, 2002. translated by R. Ern´e.

Q. Liu and J. Tong. N´eron models of algebraic curves. Transactions of the American

Mathematical Society, 368:7019­7043, 2016.

D.

Loeffler

and

S.

Zerbes.

Euler

Systems

(Ari-

zona Winter School 2018 notes),

2018. available at

https://www.math.arizona.edu/~ swc/aws/2018/2018LoefflerZerbesNotes.pdf (downloaded 08/01/21).

J. Milne. Algebraic Groups. Number 170 in Cambridge Studies in Advanced Math-

ematics. Cambridge University Press, 2017.

J. May and K. Ponto. More Concise Algebraic Topology: Localization, Comple-

tion, and Model Categories. Chicago Lectures in Mathematics Series. University of

Chicago Press, 2011.

N. Metropolis and G.-C. Rota. Witt Vectors and the Algebra of Necklaces. Advances

in Mathematics, 50:95­125, 1983.

J. Neukirch, A. Schmidt, and K. Wingberg. Cohomology of Number Fields, volume

323 of Grundlehren der mathematischen Wissenschaften. Springer Verlag, second

edition, 2013. Corrected second printing.

M. Olsson. Towards Non-Abelian p-adic Hodge Theory in the Good Reduction Case.

Memoirs of the AMS, 210:8­164, 2011.

M. Olsson. The Bar Construction and Affine Stacks. Communications in Algebra,

44(7):3088­3121, 2016.

B. Poonen and W. McCallum. The method of Chabauty and Coleman. In M´ethodes explicites en th´eorie des nombres, Points rationnels et E´quations diophantiennes,

volume 36 of Panoramas et Synth`eses, pages 99­117. Soci´et´e Math´ematique de

France, 2012.

B. Poonen. The classification of rational preperiodic points of quadratic polynomials

over Q: a refined conjecture. Mathematische Zeitschrift, 228(1):11­29, 1998.

C. Reutenauer. Free Lie Algebras. volume 3 of Handbook of Algebra, pages 887­903.

North-Holland, 2003.

J.-P. Serre. Semisimplicity and Tensor Products of Group Representations: Converse

Theorems. Journal of Algebra, 194:496­520, 1997.

J.-P. Serre. Galois Cohomology. Springer Monographs in Mathematics. Springer

Verlag, 2002. Translated from the French by P. Ion.

A. Shiho. Crystalline Fundamental Groups I -- Isocrystals on Log Crystalline Site

and Log Convergent Site. Journal of Mathematical Sciences of the University of

Tokyo, 7:509­656, 2000.

C. Soul´e. K-th´eorie des anneaux d'entiers de crops de nombres et cohomologie ´etale.

Inventiones Mathematicae, 55:251­295, 1979.

Z. Wojtkowiak. Cosimplicial Objects in Algebraic Geometry. In P.G. Goerss and

J.F. Jardine, editors, Algebraic K-Theory and Algebraic Topology, volume 47 of

NATO ASI Series, pages 287­327. Springer Dordrecht, 1993.

Harvard University, Department of Mathematics. Science Center Room 325, 1 Oxford Street, Cambridge, MA 02138, USA.
Email address: abetts@math.harvard.edu

