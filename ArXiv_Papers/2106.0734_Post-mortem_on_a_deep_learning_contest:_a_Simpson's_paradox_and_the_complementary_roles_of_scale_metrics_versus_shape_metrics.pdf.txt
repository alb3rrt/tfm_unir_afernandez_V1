Post-mortem on a deep learning contest: a Simpson's paradox and the complementary roles of scale metrics versus shape metrics

Charles H. Martin

Michael W. Mahoney

arXiv:2106.00734v1 [cs.LG] 1 Jun 2021

Abstract
To understand better the causes of good generalization performance in state-of-the-art neural network (NN) models, we analyze of a corpus of models that was made publicly-available for a contest to predict the generalization accuracy of NNs. These models include a wide range of qualities and were trained with a range of architectures and regularization hyperparameters. We identify what amounts to a Simpson's paradox: where "scale" metrics (from traditional statistical learning theory) perform well overall but perform poorly on subpartitions of the data of a given depth, when regularization hyperparameters are varied; and where "shape" metrics (from Heavy-Tailed Self Regularization theory) perform well on subpartitions of the data, when hyperparameters are varied for models of a given depth, but perform poorly overall when models with varying depths are aggregated. Our results highlight the subtly of comparing models when both architectures and hyperparameters are varied, as well as the complementary role of implicit scale versus implicit shape parameters in understanding NN model quality. Our results also suggest caution when one tries to extract causal insight with a single metric applied to aggregate data, and they highlight the need to go beyond one-size-fitsall metrics based on upper bounds from generalization theory to describe the performance of state-of-the-art NN models. Based on these findings, we present two novel shape metrics, one data-independent, and the other data-dependent, which can predict trends in the test accuracy of a series of NNs, of a fixed architecture/depth, when varying solver hyperparameters.
1 Introduction
Contests have been central to much of the recent progress in machine learning. However, contests are very difficult to design and execute well. Some are spectacularly successful [1]; others less so. Even when less than successful, a contest that makes data publicly-available can be valuable, and insights from the contest can be useful to the community. Here, we describe our analysis of data that was made publicly-available recently for a contest on evaluating metrics to predict generalization in deep learning [2, 3]. For Contest participants, the data were so-called pre-trained models. These neural network (NN) models were trained to two computer vision (CV) tasks; and they can be partitioned into sub-groups, where each sub-group had multiple models with a given depth, but trained with different optimization hyperparameter values. Our detailed analysis of these pre-trained models provides new refined insight: on how theories for generalization perform on well-trained versus poorly-trained models; on how this depends in subtle ways on what can be interpreted as implicit scale versus implicit shape parameters of the models learned by these NNs; on how metrics for model quality depend on architectural parameters versus solver parameters; and on how these depend on access (or not) to training/testing data, initialization, etc.
Calculation Consulting, 8 Locksley Ave, 6B, San Francisco, CA 94122, charles@CalculationConsulting.com. ICSI and Department of Statistics, University of California at Berkeley, Berkeley, CA 94720, mmahoney@stat.berkeley.edu.
1

Background. In general, there are two common challenges with designing a good contest: ensemblization and information leakage. By ensemblization, we mean that ensembles of models almost always perform better than any single model. This potentially limits the usefulness of any one model for understanding how it behaves on subsets of the data. By information leakage, we mean ability of contest participants to extract information about the training data by querying the contest repeatedly. Contests comonly offer model development phase, in which participants develop models, submit those models to the contest, and receive quality scores as feedback. For example, in the Contest considered here, on the first day, one might develop a model that applies data translations, the next day, rotations, and the next day, adversarial perturbations. Over time, participants may discover how to win the contest essentially by augmenting training data. Data generation theory and data augmentation theory are interesting and important [4, 5]. However, they are both quite different than model quality theory and generalization theory.1
The Contest [2, 3] made available a data set consisting of pre-trained NN models. This Contest data was more narrow than another corpus analyzed recently [6, 7], which used Heavy-Tailed Self-Regularization (HT-SR) theory [8, 9, 10] to analyze hundreds of state-of-the-art (SOTA) models from CV and natural language processing (NLP). However, the Contest data was more detailed, in the sense there were lower quality models, models in which hyperparameters were suboptimally chosen, etc. Recognizing problems with many metrics developed within traditional statistical learning theory (SLT), the Contest was interested in metrics that were "causally informative of generalization," and it wanted participants to propose a "robust and general complexity measure" [2, 3].
Being aware of challenges with designing good contests and with extracting causality from correlation, and knowing that one-size-fits-all metrics applied to heterogeneous data can lead to Simpson's paradoxes, we adopted a different approach: we tried to identify and understand Simpson's paradoxes within the Contest data. Recall that a Simpson's paradox can arise when there is a larger data set that consists of multiple sub-groups; and it refers to the situation where a predicted trend that holds for a larger data set consisting of multiple sub-groups disappears or reverses when those sub-groups are considered individually [11, 12, 13, 14]. Less relevant if one is simply interested in evaluating training/testing curves, or winning contests, Simpson's paradoxes are particularly relevant when one wants to understand the data, attribute causal interpretations to the underlying data/model, e.g., why a particular metric performs well or poorly, or make decisions about how to improve a model, e.g., via architecture search, etc.2
We consider two classes of metrics that have been used to predict NN model quality: normbased metrics from SLT (e.g., LogSpectralNorm below); and HT-based metrics from HT-SR theory (e.g., Alpha below). The former norm-based metrics describe the "scale" associated with the model implicitly-learned by the training process, whereas the later HT (or Power Law (PL)) metrics describe "shape" of the implicitly-learned model. The former norm-based "scale" metrics have been used to provide generalization theory upper bound on simple models,3 but empirically they can perform in strange and counter-intuituve ways on even moderately-large realistic models [15]. The latter HT-based "shape" metrics4 have been central to HT-SR theory [8, 9, 10],
1That is, obviously augmenting training data helps, and it helps to win contests, but this does not tell us about generalization. If a model gets better when using augmented data, then that is a useful piece of information; but that isn't a way to evaluate the model generalization quality. Instead, it tells us something about how the original model is undercapacitated with respect to the data.
2Simpson's paradoxes often arise in social science and biomedicine, since understanding causal relationships is particularly important in those areas. To our knowledge, this is the first application of these ideas in this area.
3Essentially, a bound on scale leads to a bound on generalization. 4Heavy-tailed distributions are probability distributions with a relatively large amount of probability mass very far from the mean, i.e., in which "unusual" events are relatively likely to happen. The precise functional form of the tail is less relevant for us, but for simplicity we will consider parameters from truncated power laws that have
2

which is based on statistical mechanics5 and heavy-tailed random matrix theory. They do extremely well at predicting trends in the quality of SOTA NNs, even without access to training or testing data [6, 7].
Main results. We apply these SLT and HT-SR metrics to predict generalization accuracies of the pre-trained models provided in the Contest, as a function of both model depth L and solver hyperparameters  (batch size, dropout, weight decay). Our main contributions are the following.
Existence of Simpson's paradox in Contest data. Depending on the specific Contest task and model sub-group, LogSpectralNorm and Alpha are either strongly anti-correlated or modestly to weakly anti-correlated with each other. For both Contest tasks (Task1 and Task2), and for each model sub-group, the LogSpectralNorm increases with increasing model quality (in disagreement with SLT). For Task1, it increases when all models are considered together; however, for Task2, it decreases when all models are considered together, exhibiting a clear Simpson's paradox. Also, for both Contest tasks, and for each model subgroup, Alpha decreases with increasing model quality (in agreement with HT-SR theory). For Task1, it decreases when all models are considered together; however, for Task2, it increases when all models are considered together, again exhibiting a clear Simpson's paradox.
Shape parameters and hyperparameter variation. The scale-based LogSpectralNorm can do well when the data are aggregated, but it does very poorly when the data are segmented by architecture type (in this case depth). More generally, this metric is good at predicting test accuracy as large architectural changes, e.g., depth, are made. However, it may behave in a manner opposite to that suggested by bounding theorems, meaning in particular that it can be anti-correlated with test accuracies, when varying model hyperparemeters such as batch size, dropout, weight decay, etc. This confirms unexplained observations made in a different setting [15].
The shape-based Alpha from HT-SR theory is predictive of test accuracy, on a new/different dataset, as hyperparameters vary, when large-scale architectural changes are held fixed. (Previously, this was only known for varying batch size [8, 9].) These results are the first to demonstrate that Alpha--a shape metric--correlates well with test accuracy as many hyperparameters  are varied. (Previous work focused on metrics that combine shape and scale information--AlphaHat or LogAlphaShattenNorm below--to make predictions about models, where both hyperparameters and architectures varied.)
Extracting scale and shape metrics from pre-trained NN models. While computing norm-based scale metrics is straightforward, computing HT-based shape metrics is much more subtle. From HT-SR theory [8], we want to fit the top part of the empirical spectral density of layer weight matrices to a truncated power law (TPL) distribution, as in Eqn. (1). This can be accomplished with the WeightWatcher tool) [17], as we describe below. Since the parameters xmax (the largest eigenvalue) and  (the PL exponent) in Eqn. (1) (below) have a natural interpretation in terms of the scale and shape of the TPL distribution, we will interpret the corresponding LogSpectralNorm and Alpha as empirically-determined (implicit) scale and shape parameters for pre-trained NN models.
Data-dependent scale and shape metrics. The scale and shape metrics, LogSpectralNorm and Alpha, respectively, do not require training data; but when training data are available, we consider two analogous data-dependent scale and shape metrics--the Sharpness and SVDSmoothing transforms. We reintrepret the Sharpness transform [15] as a data-dependent scale metric; and
been fit to empirical data. See Section 3 for details. 5In the statistical mechanics approach to learning, generalization is related to volumes and thus the shape of a
distribution, moreso than the scale of the distribution [16].
3

we propose a new and effective generalization metric, the SVDSmoothing transform, as a datadependent shape metric. Both outperform baseline; and while both need access to the data, neither requires model fine-tuning (GPUs) to be evaluated.
Broader picture. Overall, our analysis explains the success of previously-introduced metrics that combine norm information and shape/correlational information [6, 7] as well as previouslyobserved peculiarities of norm-based metrics [15]. Our results also highlight the need to go beyond one-size-fits-all metrics based on upper bounds from generalization theory to describe the performance of SOTA NNs, as well as the evaluation of models by expensive retraining on test data. Test data can be extremely expensive to acquire, and there is a need to evaluate models without (much or any) test data [6, 7]. We aim to develop a theory of generalization that practioners can use in their day-to-day training, fine-tuning, validation, and evaluation of models. Practioners do not just want better regularizers, but also cheaper, systemtatic ways of adjusting individual layer hyperparameters; and practioners frequently use pre-trained models without access to training data. Based on our findings, we expect that LogSpectralNorm (and related "scale"-based metrics) can capture coarse model trends (e.g., large-scale architectural changes, such as width or depth or perhaps adding residual connections and convolutional width) more generally; and that Alpha (and related "shape"-based metrics) can capture fine-scale model properties (e.g., fine-scale optimizer/solver hyperparameters changes, such as batch size, step scale, etc.) more generally. Clearly, this has implications beyond generalization and even model training, to problems such as fine-tuning of pre-trained models, improved model engineering, and improved neural architecture search.
2 Background and preliminaries
Predicting trends in model quality. There is a large body of (older [18] and more recent [19, 20, 21]) work from statistical learning theory on providing upper bounds on generalization quality of models; and there is a smaller body of (older [16] and more recent [22, 8, 23]) work using ideas from statistical mechanics to predict performance of models. Most relevant for us are the recent results on "Predicting trends in the quality of state-of-the-art neural networks without access to training or testing data" [6, 7] and "Fantastic generalization measures and where to find them" [15], and references therein. The former work [6, 7] considered a very broad range of CV and NLP models, including nearly every publicly-available pretrained model, totaling to hundreds of SOTA models; and it focused on metrics that perform well on SOTA, without any access to training and/or testing data. The latter work [15] considered a larger number models drawn from a much narrower range of CV models, including thousands of low-quality and high-quality models, obtained by varying architecture (e.g., depth or width) and solver hyperparameters in a systematic way; and it considered a broad range of metrics, most of which require access to the training and/or testing data. There is a large body of other related work; see, e.g., [24, 25, 26] and references therein.
Models from a contest. The Contest [2, 3] (motivated by the observations of [15], but not considering [6, 7]), covered a rather narrow class of CV models, but it provided multiple versions of each, trained with different numbers of layers (depths) and regularization hyperparameters. The approximately 150 CV models were organized into two architectural types, VGG-like models and Network-in-Network models, each with several sub-groups, trained with different batch sizes, dropout, and weight decay.
See Table 2 in Appendix A for a summary. There are two model groups: Task1 and Task2. Importantly, in every model sub-group (i.e., each row in Table 2), all the models have the same
4

Complexity Metric
Alpha QualityOfAlphaFit LogSpectralNorm LogFrobeniusNorm AlphaHat LogAlphaShattenNorm DistanceFromInit TrainingAccuracy Sharpness SVDSmoothing

Average



DKS

log10

W

2 2

log10

W

2 F

^

log10

W

2 2

init

N/A

N/A

N/A

Ref.
(here) (here) ([15]) ([15]) ([7]) ([7]) ([15]) N/A ([15]) (here)

Scale or Shape?
Shape Shape Scale Scale Both Both N/A N/A Scale Shape

Need data?
No No No No No No No Yes Yes Yes

Need initial weights?
No No No No No No Yes No No No

Need GPUs?
No No No No No No No No Yes No

Table 1: Overview of model quality metrics. Based on our initial analysis of Contest models, we propose and demonstrate the quality of Alpha, QualityOfAlphaFit, and SVDSmoothing.

depth (number of layers), and only the solver hyperparameters are varied. (Note that, in some cases, the weight matrices may have different shapes, e.g., 256 × 256 or 512 × 512.) The models groups and subgroups are outlined in Table 2; breifly, they are: · Task1 (`task1 v4"): 96 VGG-like models, trained on CIFAR10, with 4 subgroups having 24
models each: 0xx, 1xx, 2xx, 5xx, 6xx, and 7xx.6 · Task2 ("task2 v1"): 54 models, with stacked Dense layers, trained on SVHN, with 3 subgroups
having 18 models each: 2xx, 6xx, 9xx, and 10xx.7
Complexity metrics. We have evaluated many quality metrics, including: several from statistical learning theory (including some provided in the contest, in particular LogSpectralNorm, LogFrobeniusNorm, DistanceFromInit, and Sharpness) [15, 2, 3]; several from statistical mechanics and HT-SR Theory (including AlphaHat and LogAlphaShattenNorm) [8, 9, 10]; and several (Alpha, QualityOfAlphaFit, and SVDSmoothing) that we introduce here. Table 1 presents a summary of the best performing (along with TrainingAccuracy, as a data-dependent baseline). See Appendix B for a detailed description of these metrics. These metrics are implemented by the publicly-available WeightWatcher tool [17]. For details on how to reproduce our results, see our publicly-available repo: https://github.com/charlesmartin14/contest-postmortem/.
What can be assumed to be known? We taxonomize the metrics we examined based on available information: some require only the pre-trained NN model itself, i.e., the layer weight matrices W; some require access to the weight matrices Winit at the initialization of training; and some require the model training data itself. More fine-grained versions of this taxonomy can be considered. For example, Sharpness (and TrainingAccuracy) requires access to Backprop, which as a practical matter requires access to GPUs; while SVDSmoothing simply requires the ability to compute low-rank approximations of moderately-large matrices, which is much less expensive.8
6Task1 also includes 2 different Convolutional widths for each, 256, 512, and there is a large flattening layer which does not appear actual VGG models.
7The Dense layers in Task2 are actually Conv2D(N, M, 1, 1) layers, of width 512 8For those with access to enormous compute resources, this distinction may not matter. For others, it does.

5

3 Extracting scale and shape parameters from pre-trained models
Here, we describe how to identify metrics from the spectrum of NN weight matrices (and in the absence of any training/testing data), and we evaluate these metrics on the data from Table 2.

3.1 Computing scale and shape parameters with norms and TPL exponents

From prior work [8, 7], we know that the ESDs of well-trained SOTA NN models are well-fit by TPL distributions of the form:

()  -, xmin    xmax

(1)

Moreover, for models that generalize well, the fitted  2.0 for every (or nearly every) layer
[8, 7]. The QualityOfAlphaFit is determined using a Kolmogorov-Smirnov Goodness of Fit Test
(or KS-test), denoted DKS. Based on this, we can interpret the parameters of this fit-- and xmax--as shape and scale parameters, respectively.9

Computing "scale" parameters. Since weight matrices from Table 2 are not extremely large, computing LogSpectralNorm (e.g., with the power method) and LogFrobeniusNorm (e.g., by summing the squares of all the entries) is simple. These are norms, and each has a natural interpretation as a "scale" parameter for the model implicitly learned by the NN.10

Computing "shape" parameters. To extract finer-scale "shape" information, recall that the spectral/Frobenius norms are unitarily invariant, i.e., they depend just on matrix singular values. Thus, we can remove the "scale" of this vector by normalizing it to be a probability distribution; and then we can fit the "shape" of this normalized distribution to a TPL distribution (or some other HT distribution). We use the empirical parameter  that is the PL exponent that arises in the recently-developed HT-SR theory [8, 9, 10]. Operationally,  is determined by using the publicly-available WeightWatcher tool [17] to fit the ESD of X, i.e., the histogram of eigenvalues, call it (), to a TPL of the form given in Eqn. (1). We need to be clear about the role of xmin, xmax, and  in Eqn. (1). In the fitting procedure, xmax = max, i.e., it is not a parameter to be fit, but instead it is set to be the largest eigenvalue of X = WT W; xmin is a parameter to be fit, that is chosen to yield the best fit for  as it is varied, i.e., xmin = min, it is not the smallest eigenvalue of X = WT W; and  is the shape parameter, i.e., the PL exponent, of the TPL distribution. Each of these quantities is defined for a given layer W matrix; and the Alpha metric reported here is the average PLexponent over all NN layers (in the same way as LogSpectralNorm is the average of the log of max over all NN layers).

3.2 Fitting ESDs to TPLs
In practice, these TPL fits require some care to obtain consistent, reliable results. Among other things, it is important to understand the behavior of the TPL fit as xmin is varied. See Figure 1 for an illustrative example.
In Figure 1, we consider the third fully connected (FC) layer from VGG16 (which was studied previously [8, 7]), which is a nearly "ideal" example that we use to illustrate the method. In 1(a),
9There are subtleties (we will not get into) for interpreting xmin as a scale parameter in PL versus TPL fits. 10Clearly, this metric ignores inter-layer structure, etc. In light of our results, developing improved methods to extract better location/scale/shape parameters from pre-trained NN models is an important direction for future work.

6

(a) ESD (log-log plot)

(b) ESD (lin-lin plot)

(c) ESD (log-lin plot) (d) PL fit quality vs xmin

Figure 1: Illustration of the role of the shape of the ESD in determining the PL parameter  in the TPL fit. Shown is VGG16, FC3 (a nearly "ideal" example). (See Appendix C for less ideal examples.)

1(b), and 1(c), respectively, we show the ESD in log-log plot, linear-linear plot, and log-linear plot; and in each of those plots, we mark the position of xmax, the xmin found by the fitting procedure, and a subpotimal value of xmin chosen by hand. The log-log plots, in 1(a) highlight the (well-known but often finicky) linear trend on a log-log plot. To aid the eye, in 1(a), we show the slopes on a log-log plot, as determined by the  fit for that value of xmin. The linear-linear plots, in 1(b), the usual so-called scree plots, are particularly non-informative. The log-linear plots, in 1(c), shows that the optimal value of xmin is near the peak of the distribution, and that the distribution is clearly not log-normal, having a strong right-ward bias, with a spreading out of larger eigenvalues as max is approached.
In 1(d), we show the quality of the fit, measured by the KS distance, as a function of xmin. The interpretation of these TPL fits is that, above that value of xmin and below the value of xmax, the ESD is fit to a line, with slope -, in a log-log plot. In 1(d), we see that the suboptimal value of xmin was chosen to be a local minimum in the the KS distance plot, and that the fit quality gradually degrades as xmin increases. Looking at 1(c), we see that there is a very slight "shelf" in the ESD probability mass; and that the suboptimal value of xmin corresponds to fitting a much smaller portion of the ESD with a PL fit.11 For high-quality models, like this one, smaller values of  corresponds to better models, and decreasing  is well-correlated with increasing max.12 See Appendix C for more discussion of these fitting issues, including dealing with such non-ideal ESDs.
3.3 Comparing scale versus shape parameters
Figure 2 compares Alpha and LogSpectralNorm for models from Table 2, segmented into subgroups corresponding to models with the same depth. See Table 3 in Appendix D.1 for more details. For some model sub-groups, Alpha and LogSpectralNorm are strongly anti-correlated; while for other sub-groups, they are modestly to weakly anti-correlated, at best. For example, for Task1, in the 2xx and 9xx models, the two metrics are strongly anti-corelated metrics, with R2 > 0.6 and a Kendal- rank correlation metric of  > 0.75;13 in the 1xx models, they are modestly so, with R2  0.4 and   0.4; and in the remaning model sub-groups, R2 < 0.2 and   0.3, which we identify as weakly correlated. Similarly, in Task2, we can identify model sub-group 9xx has having well anti-correlated average metrics, with large R2 and Kenadal- ;
11Indeed, choosing xmin introduces a scale, somewhat like fixing a rank parameter--since where the PL exponent starts is related to the dimensionality of the subspace of the low-rank approximation. As opposed to more popular rank parameter selection methods, choosing xmin simply from visual inspection of the ESDs, without computing the KS distance as a function of xmin, seems not to be possible when working with TPL distributions.
12This is predicted by HT-SR Theory [8, 7], but it can be surprising from the perspective of SLT [15, 2, 3]. 13A strong linear correlation, not just good rank correlation, is predicted for good models by HT-SR theory [8], and this has been observed previously for SOTA CV and NLP models [7].
7

(a) Task1 models.

(b) Task2 models.

Figure 2: Comparison of the LogSpectralNorm and Alpha metrics, for Task1 and Task2 models. Observe that, depending on the subtask, these implicitly-defined model "scale" and "shape" parameters can behave very differently.

model sub-groups 6xx and 10xx exhibit intermediate behavior, as R2 < 0.3 for each; and model sub-group 2xx shows no substantial correlation at all between Alpha and LogSpectralNorm. See Appendix D.2 for more details on two illustrative pairs of examples.
4 A Simpson's paradox: Architecture versus solver knobs
We start with a brief summary of properties of the data (in Section 4.1); then we present the results visually (in Section 4.2); and then we describe our analysis in more detail (in Section 4.3).
4.1 Basic properties of the data

(a) Task1 models.

(b) Task2 models.

Figure 3: Relationship between training accuracy and testing accuracy for Task1 and Task2 models. One would expect a positive correlation or (if the training error is very close to zero) at least not a negative correlation. Observe, however, that in many cases they are strongly anti-correlated. See also Table 4 in Appendix E.1.

The obvious Baseline is the training accuracy.14 If we have access only to trained models
14The Contest provided a few sample baselines. We examined several, and they performed worse than training accuracy. See Section 5 for how to use our shape-versus-scale ideas to develop data-dependent metrics that improve

8

and no data (as in prior work [6, 7] and as is assumed with Alpha and LogSpectralNorm), then we cannot check this baseline. Similarly, if the training error is exactly zero, then this is not a useful baseline.15 Otherwise, we can check against it, and we expect testing accuracy to improve as training accuracy improves.
Figure 3 plots the relationship between training and testing accuracies for the Task1 and Task2 models, color-coded by model number (0xx, 1xx, . . . ). See also Table 4 in Appendix E.1, which presents more detailed numerical results. For both Task1 and Task2, there is a very large gap between the training and testing accuracies. A positive correlation in Figure 3 indicates that improving the training accuracy, even marginally, would lead to improved testing accuracy. Instead, we see that for Task1, for all model sub-groups, training and testing accuracies are (very) anticorrelated. In this sense, these Task1 models are over-trained; they clump into two sub-groups, those for this R2  0 and those for which R2 > 0.1. Similarly, for Task2, for model number 9xx, they are (very) anti-correlated, and otherwise they are (slightly) anti-correlated. (In a Contest, one would expect test data to reflect accurately the qualitative nature of the (secret) Contest data; these results suggest that this may not be the case.) In all cases, improving training accuracy leads either to no noticible improvement in test accuracy, or to worse testing performance.
4.2 Visualizing the Simpson's paradox in NN contest data

(a) Task1 models.

(b) Task2 models.

Figure 4: Test accuracy versus LogSpectralNorm, for Task1 and Task2, overall and segmented by model sub-group. Observe the clear Simpson's paradox, in particular for Task2 models.

We plot test accuracy of models from Table 2 as a function of model quality metrics. Consider Figure 4 and Figure 5, which show test accuracy versus LogSpectralNorm and Alpha, respectively, overall and broken down for each model sub-group, for all models from Table 2. In our analysis, we first look at each model sub-group (0xx, 1xx, 2xx, . . . ) individually, which corresponds to a specific depth L, and we measure the regression and rank correlation metrics on the test accuracy as the hyperparemeters vary.
From Figure 4, for each model sub-group, the LogSpectralNorm increases with increasing model quality. For Task1, the LogSpectralNorm increases when all models are considered together; but for Task2, the LogSpectralNorm decreases when all models are considered together,
on training accuracy as well as the data-independent Alpha and LogSpectralNorm. 15Models that exactly interpolate the data are different, in that we can't just "add data" (and without retraining
work with the same baseline), since then we won't have exactly 0% error with the augmented data set. For many model diagnostics, exactly interpolating and approximately interpolating are very different.

9

(a) Task1 models.

(b) Task2 models.

Figure 5: Test accuracy versus Alpha, for Task1 and Task2, overall and segmented by model sub-group. Observe the clear Simpson's paradox, in particular for Task2 models.

exhibiting a clear Simpson's paradox. Similarly, from Figure 5, for each model subgroup, the Alpha decreases with increasing model quality. For Task1, the Alpha decreases when all models are considered together; but for Task2, the Alpha increases when all models are considered together, exhibiting a clear Simpson's paradox.
Based on bounding theorems from statistical learning theory, one might expect that smaller values of LogSpectralNorm would correspond to better models. Similarly, based on HT-SR theory, one would expect that smaller values of Alpha would correspond to better models. With respect to these references, the LogSpectralNorm behaves the opposite of what theory would suggest, except when considering the aggregated data when a Simpson's paradox is present; and the Alpha behaves precisely as what theory would predict, except when considering the aggregated data when a Simpson's paradox is present. Overall, these trends are most pronounced in Task2 (in Figures 4(b) and 5(b)), but similar but less pronounded results are seen in Task1 (in Figures 4(a) and 5(a)).
4.3 Changing architectures versus changing solver hyperparameters
Here, we provide a more detailed analysis of the main results presented in Figure 4 and Figure 5. See Table 5 and Table 6 in Appendix E.2 for detailed statistics, including R2 and Kendel- statistics, for metrics from Table 1; and see also Figure 6 for histograms summarizing some of these results, in particular for Alpha and LogSpectralNorm.16
From these, we see that Alpha (the mean PL exponent, averaged over all layers, which corresponds to a "shape" parameter) is correlated with the test accuracy for each NN, when changing just the hyperparameters, . While it does not always exhibit the strongest correlation, it is the most consistent. We also see that LogSpectralNorm (the mean log10 spectral norm, also averaged over all layers, which corresponds to a "scale" parameter) is correlated with the test accuracy, when changing the number of layers, but it is anti-correlated when changing the hyperparameters. Thus, it performs quite poorly when trying to identify more fine-scale structure.
For completeness, we have included LogFrobeniusNorm, showing that it is often but not always correlated with test accuracy, and QualityOfAlphaFit (the KS distance), showing that it is correlated with test accuracy in about half the cases. Table 6 also includes results for Sharpness
16See our publicly-available repository for details on reproducing these and other results.

10

(a) Task1, R2

(b) Task2, R2

(c) Task1, Kendal-

(d) Task2, Kendal-

Figure 6: Comparison of predictions for test accuracies by Alpha  and LogSpectralNorm

log10

W

2 2

,

as

measured

using

R2

and

Kendal-

correlation

and

rank

correlation

metrics,

re-

spectively, for Task1 and Task2, for each model sub-group. (See Table 5 for more details.)

and SVDSmoothing, which will be discussed in Section 5.
4.4 Combining shape and scale
One can combine shape and scale information, e.g., with a weighted average (both LogSpectralNorm and Alpha are unweighted averages), as with AlphaHat and LogAlphaShattenNorm. Table 5 and Table 6 show that--when one is interested in aggregating data over various depth and hyperparameter values--these metrics compensate for some of the deficiencies of LogSpectralNorm and Alpha. This suggests an explanation of why AlphaHat was so successful at predicting quality trends in SOTA NN models [6, 7], where both depth and hyperparameter values varied.
5 Data-dependent scale and shape metrics
Metrics. In some cases, one has access to training/testing data. Here, we consider two (complementary) data-dependent metrics, Sharpness and SVDSmoothing. Each depends on the training data, and each transforms (or "smooths") the layer weight matrices W: informally, the Sharpness transform is a kind of scale adjustment, and the SVDSmoothing transform a shape adjustment.
The Sharpness metric revaluates training accuracy after smoothing weight matrices, W, as follows: (1) clip large and small elements Wi,j; (2) run 1 to 3 iterations of backprop; (3) repeat steps (1) and (2) a few times until some stopping critera is reached; and (4) evaluate the training accuracy as a predictor. This metric was considered in [15] and is related to a metric of [27]. Since Sharpness clips large entries, in light of our discussion of scale versus shape parameters in Section 3, we interpret it as a data-dependent scale metric. As a practical matter, in addition to needing the training data, the Sharpness transform needs access to GPUs (to run backprop).
The SVDSmoothing metric (which we propose here) also "smooths out" the layer weight matrices W, but it does so by exploiting the information contained in the tail of the layer ESDs and taking a low rank approximation of each W. In HT-SR theory, the generalization capacity of a NN arises due to correlations concentrated in the tail of the ESD, and the shape of the tail (i.e., the PL exponent ) is itself correlated with test accuracy. This is illustrated in Figure 1. This suggests that we can estimate the test accuracy by evaluating training data on a low-rank approximation to W that effectively captures the correlations in tail of the ESD of W. Since the SVDSmoothing transform keeps the singular vectors of W correpsonding to the tail of the ESD, we interpret it as a data-dependent shape metric. As a practical matter, while SVDSmoothing assumes access to training data, it does not require the use of backprop (GPUs), and thus it is less expensive than the Sharpness transform.

11

(a) Task1 models.

(b) Task2 models.

Figure 7: Performance of Sharpness and SVDSmoothing (SVD20), reported as the Kendal- rank correlation metric, for each model sub-group in each task, and compared to the training accuracy Baseline. Results tabulated in Table 6.

Results. We applied the Sharpness and SVDSmoothing transforms to every model and computed the training accuracy on the "smoothed" models. For the Sharpness transform, we used the code provided by the contest. For the SVDSmoothing transform, we ran two different cases, SVD10 and SVD20, where we kept either 10% or 20% of top eigenvectors, respectively. We compare the baseline, Sharpness, and SVD20 metrics to the test accuracy, computing the R2 and Kendal- and rank correlation metrics for each model sub-group. See Table 6 for these results.
For a data-dependent Baseline, we compute the training accuracy for each pretrained model, and we report the R2 and Kendal- . Figure 7 plots the results. We also compare all of the metrics used to predict the test accuracies. These include training accuracy Baseline, the Sharpness metric, both the SVD10 and SVD20 SVDSmoothing metrics, as well as other metrics from Table 1, including DistanceFromInit, Alpha, and LogSpectralNorm. Figure 8 presents the average Kendal- , averaged over all models for each metric tested.

Figure 8: Comparison of all models and metrics, with the Kendal- rank correlation metric, averaged over all model sub-groups in both tasks. (Note: we denote DistanceFromInit as distance, and the LogSpectralNorm as spnorm)
From Figure 7, we see that both data-dependent transforms, Sharpness and SVDSmoothing, outperform the Baseline (unsmoothed training accuracy), for all but two of the model sub-
12

groups. In particular, for Task1 2xx and Task2 9xx, Sharpness performs comparably but worse than the Baseline, and SVDSmoothing (SVD20) outperforms the Baseline for all model subgroups, generally comparing well to Sharpness. For Task1, SVDSmoothing (SVD20) performs best on half the model sub-groups, and the Sharpness performs best on the other half; and for Task2, SVDSmoothing (SVD20) performs best on three of four of the cases. It only performs poorly on model 6xx, which is a very poorly trained model. Comparing all of the metrics in Figure 7, our novel data-dependent "shape" metric, SVDSmoothing (SVD20), performs the best. From Figure 8, we see that metrics that have access to the data perform better. However, SVDSmoothing (that does not require GPUs) does as well as or better than Sharpness, and Alpha does slightly better than LogSpectralNorm, both of which do better than Baseline.
6 Conclusion
We have identified a Simpson's paradox in the data used in a recent machine learning contest aimed at understanding causes of good generalization. Our results suggest that LogSpectralNorm and related "scale" metrics are appropriate for understanding trends for very coarse architectural changes. However, Alpha and related "shape" matrics (including SVDSmoothing and others) are more appropriate for understanding finer-scale hyperparameter/algorithm changes. Our results also suggest that, before evaluating a metric for all models at once, as one would do in a contest, one should first examine the models across increasing depth L, while varying hyperparameters  separately, e.g., using standard standard correlation measures (R2 and Kendal-Tau).
We conclude with a few more general thoughts on our results. The Contest that provided the data we analyzed wanted to develop causal metrics. As is well known, trying to extract causality from correlation is difficult--precisely since there may be Simpson's-like paradoxes present in the data, depending on how the data are partitioned. When confronted with a Simpson's paradox, one is tempted to ask whether the marginal associations or partial associations are correct. Often, the answer is that both are correct, depending on what is of interest. For example, if you just want to catalogue relationships among variables (e.g., as when trying to win a model) then one may be appropriate; while if you are interested in more fine-grained understanding (e.g., a deeper understanding of why generalization behaves as it does in SOTA models), then the other may be appropriate. In particular, simple statistical analysis does not provide any guidance as to causal relationships and whether the marginal association or the partial association is the spurious relationship. For that reason, rather than trying to extract causality, we took a different approach: we looked for a Simpson's paradox; and when we found it, we tried to interpret it in terms of scale versus shape metrics from SLT and HT-SR theory. One might wonder "why" LogSpectralNorm and Alpha perform as well as they do, when restricted to changes in the model depth and/or solver hyperparameters, respectively. Establishing such a causal explanation, of course, requires going beyond the data at hand and requires some sort of counterfactual analysis. This is beyond the scope of this paper. A plausible hypothesis, however, is the following. Since upper bounds from SLT suggest that models with smaller norms have less capacity, these norms are used (either explicitly as a regularizer, or implicitly by adjusting large matrix elements/columns/rows) during the training process, in particular when one varies coarse model parameters such as depth. On the other hand, coming from HT-SR theory, Alpha is not used explicilty or implicitly during the training process. Instead, the training process extracts correlations over many size scales from the data, and it is these correlations that are captured by smaller Alpha values, consistent with HT-SR theory and practice [8, 9]. This hypothesis is consistent with "why" fitted PL metrics from HT-SR theory--in particular the fitted AlphaHat metric­perform so well, both for the models considered in this contest, as well as for a much wider range of publicly-available SOTA NN models [6, 7]. Testing this hypothesis is an important question raised by our results.
13

Just as the data-independent LogSpectralNorm and Alpha have complementary interpretations in terms of "scale" and "shape" parameters, so too the data-dependent metrics Sharpness and SVDSmoothing can be thought of as "scale" and "shape" parameters. Sharpness controls the scale of the layer W by clipping large elements Wi,j. SVDSmoothing captures the shape by keeping the eigenvectors corresponding to the tail of the layer ESD. We expect this would be particularly useful in situations where test data is limited/unavailable, and/or when peeking at the test data could cause the model to overfit (as in quantitative finance / market prediction).
Note that our use of low-rank approximation in SVDSmoothing is very different than how low-rank approximations are used in training/validating models, and to our knowledge is has not been suggested before to estimate the test error. Essentially, it involves taking a well-trained model, removing part of it, and using the rest to predict test performance. While SVDSmoothing uses a low-rank approximation to the weight matrix, this does not assume that matrices are well-approximated by low-rank matrices. Indeed, the entire point of HT-SR theory [8, 9] is that the ESD has a heavy-tailed shape, but that a low-rank approximation to it tends to capture the most generalizing components of the layer W. This is consistent with the observation that the shape of the tail of the layer ESD (through the PL exponent ) can be used to predict trends in the test accuracies when varying regularization and/or solver hyperparameters.
An important direction raised by our results has to do with the role of having access to data. Neither LogSpectralNorm nor Alpha require access to the data to compute; they only require access to the trained model. The model depends on the data, of course, but these two metrics can be evaluated without access to any training or testing data. This agrees with the setup of [6, 7], but it is a more limited model of data access than in the contest [15]. Intermediate between these two extremes, an important practical problem is to fine-tune a previously-trained model: can we improve transfer learning or model fine-tuning, e.g., by doing SVDSmoothing before fine-tuning, e.g., in SOTA language models? Another important practical problem has to do with developing new models: can we use these results--either data-independent LogSpectralNorm or Alpha or data-dependent Sharpness or SVDSmoothing to perform better architecture search, e.g., by using scale versus shape parameters to explore the search space? These are important questions raised by our results.
Acknowledgements. MWM would like to acknowledge ARO, DARPA, IARPA (under contract W911NF20C0035), NSF, and ONR as well as the UC Berkeley BDD project and a gift from Intel for providing partial support of this work. Our conclusions do not necessarily reflect the position or the policy of our sponsors, and no official endorsement should be inferred.
References
[1] R. M. Bell and Y. Koren. Lessons from the Netflix prize challenge. SIGKDD Explorations, 9(2):75­79, December 2007.
[2] Y. Jiang, P. Foret, S. Yak, D. M. Roy, H. Mobahi, G. K. Dziugaite, S. Bengio, S. Gunasekar, I. Guyon, and B. Neyshabur. NeurIPS 2020 competition: Predicting generalization in deep learning (version 1.0). Technical Report Manuscript, June 28, 2020, 2020.
[3] Y. Jiang, P. Foret, S. Yak, D. M. Roy, H. Mobahi, G. K. Dziugaite, S. Bengio, S. Gunasekar, I. Guyon, and B. Neyshabur. NeurIPS 2020 competition: Predicting generalization in deep learning (version 1.1). Technical Report Preprint: December 16, 2020: arXiv:2012.07976v1, 2020.
[4] P. Nakkiran, G. Kaplun, Y. Bansal, T. Yang, B. Barak, and I. Sutskever. Deep double descent: Where bigger models and more data hurt. Technical Report Preprint: arXiv:1912.02292, 2019.
14

[5] Y. Min, L. Chen, and A. Karbasi. The curious case of adversarially robust models: More data can help, double descend, or hurt generalization. Technical Report Preprint: arXiv:2002.11080, 2020.
[6] C. H. Martin, T. S. Peng, and M. W. Mahoney. Predicting trends in the quality of state-of-the-art neural networks without access to training or testing data. Technical Report Preprint: arXiv:2002.06716, 2020.
[7] C. H. Martin, T. S. Peng, and M. W. Mahoney. Predicting trends in the quality of state-of-the-art neural networks without access to training or testing data. Nature Communications, 00(00):000­000, 2021.
[8] C. H. Martin and M. W. Mahoney. Implicit self-regularization in deep neural networks: Evidence from random matrix theory and implications for learning. Technical Report Preprint: arXiv:1810.01075, 2018.
[9] C. H. Martin and M. W. Mahoney. Traditional and heavy-tailed self regularization in neural network models. In Proceedings of the 36th International Conference on Machine Learning, pages 4284­4293, 2019.
[10] C. H. Martin and M. W. Mahoney. Heavy-tailed Universality predicts trends in test accuracies for very large pre-trained deep neural networks. In Proceedings of the 20th SIAM International Conference on Data Mining, 2020.
[11] E. H. Simpson. The interpretation of interaction in contingency tables. Journal of the Royal Statistical Society. Series B (Methodological), 13(2):238­241, 1951.
[12] P. J. Bickel, E. A. Hammel, and J. W. O'Connell. Sex bias in graduate admissions: Data from Berkeley. Science, 187(4175):398­404, 1975.
[13] W. S. Robinson. Ecological correlations and the behavior of individuals. International Journal of Epidemiology, 38:337­341, 2009.
[14] R. A. Kievit, W. E. Frankenhuis, L. J. Waldorp, and D. Borsboom. Simpson's paradox in psychological science: a practical guide. Frontiers in Psychology, 4(513):1­14, 2013.
[15] Y. Jiang, B. Neyshabur, H. Mobahi, D. Krishnan, and S. Bengio. Fantastic generalization measures and where to find them. Technical Report Preprint: arXiv:1912.02178, 2019.
[16] A. Engel and C. P. L. Van den Broeck. Statistical mechanics of learning. Cambridge University Press, New York, NY, USA, 2001.
[17] WeightWatcher, 2018. https://pypi.org/project/WeightWatcher/.
[18] P. L. Bartlett. For valid generalization, the size of the weights is more important than the size of the network. In Annual Advances in Neural Information Processing Systems 9: Proceedings of the 1996 Conference, pages 134­140, 1997.
[19] B. Neyshabur, R. Tomioka, and N. Srebro. Norm-based capacity control in neural networks. In Proceedings of the 28th Annual Conference on Learning Theory, pages 1376­1401, 2015.
[20] P. Bartlett, D. J. Foster, and M. Telgarsky. Spectrally-normalized margin bounds for neural networks. Technical Report Preprint: arXiv:1706.08498, 2017.
[21] S. Arora, R. Ge, B. Neyshabur, and Y. Zhang. Stronger generalization bounds for deep nets via a compression approach. Technical Report Preprint: arXiv:1802.05296, 2018.
[22] L. Zdeborov´a and F. Krzakala. Statistical physics of inference: thresholds and algorithms. Advances in Physics, 65(5):453­552, 2016.
[23] Y. Bahri, J. Kadmon, J. Pennington, S. Schoenholz, J. Sohl-Dickstein, and S. Ganguli. Statistical mechanics of deep learning. Annual Review of Condensed Matter Physics, 11:501­528, 2020.
[24] G. K. Dziugaite, A. Drouin, B. Neal, N. Rajkumar, E. Caballero, L. Wang, I. Mitliagkas, and D. M. Roy. In search of robust measures of generalization. Technical Report Preprint: arXiv:2010.11924, 2020.
15

[25] Z. Liao, T. Drummond, I. Reid, and G. Carneiro. Approximate Fisher information matrix to characterise the training of deep neural networks. Technical Report Preprint: arXiv:1810.06767, 2018.
[26] V. Thomas, F. Pedregosa, B. van Merrienboer, P.-A. Mangazol, Y. Bengio, and N. Le Roux. On the interplay between noise and curvature and its effect on optimization and generalization. Technical Report Preprint: arXiv:1906.07774, 2019.
[27] N. S. Keskar, D. Mudigere, J. Nocedal, M. Smelyanskiy, and P. T. P. Tang. On large-batch training for deep learning: generalization gap and sharp minima. Technical Report Preprint: arXiv:1609.04836, 2016.
[28] J. P. Bouchaud and M. Potters. Theory of Financial Risk and Derivative Pricing: From Statistical Physics to Risk Management. Cambridge University Press, 2003.
[29] M. E. J. Newman. Power laws, Pareto distributions and Zipf's law. Contemporary Physics, 46:323­ 351, 2005.
[30] D. Sornette. Probability distributions in complex systems. Technical Report Preprint: arXiv:0707.2194, 2007.
[31] A. Clauset, C. R. Shalizi, and M. E. J. Newman. Power-law distributions in empirical data. SIAM Review, 51(4):661­703, 2009.
[32] J. M. Beggs and N. Timme. Being critical of criticality in the brain. Frontiers in Physiology, 3(163), 2012.
[33] J. Alstott, E. Bullmore, and D. Plenz. powerlaw: A python package for analysis of heavy-tailed distributions. PLoS ONE, 9(1):e85777, 2014.
[34] N. Marshall, N. M. Timme, N. Bennett, M. Ripp, E. Lautzenhiser, and J. M. Beggs. Analysis of power laws, shape collapses, and neural complexity: New techniques and MATLAB support via the NCC toolbox. Frontiers in Physiology, 7(250):1­18, 2005.

A Models considered in our analysis
See Table 2 for a summary of the models we considered in our analysis. These are described in more detail in Section 2. See also [2, 3] for more details.

Series Task1 "task1 v4" (VGG-like)
Task2 "task2 v1" (Networkin-Network)

# L Batch Size

Dropout Weight Decay Conv Width Dense (k)

0xx 4 8, 32, 512

0.0, 0.5

0.0, 0.001

256, 512

1

1

1xx 5 8, 32, 512

0.0, 0.5

0.001

256, 512

2

1

2xx 5 8, 32, 512

0.0, 0.5

0.0

256, 512

2

1

5xx 8 8, 32, 512

0.0, 0.5

0.001

256, 512

1

3

6xx 8 8, 32, 512

0.0, 0.5

0.0

256, 512

2

3

7xx 9 8, 32, 512

0.0, 0.5

0.0

256, 512

2

3

2xx 13 32, 512, 1024 0.0, 0.25, 0.5 0.0, 0.001

512

-

-

6xx 7 32, 512, 1024 0.0, 0.25, 0.5 0.0, 0.001

512

-

-

9xx 10

1024

0.0, 0.25, 0.5 0.0, 0.001

512

-

-

10xx 10 32, 512, 1024 0.0, 0.25, 0.5 0.0, 0.001

512

-

-

Table 2: Overview of models we considered in each task and sub-group, including variations in depth (L), regularization hyperparameters (Batch Size, amount of Dropout, and Weight Decay), and architectural changes (Width of selected Convolutional Layers, number of selected Dense layers, and kernel-size (k = 1, 3) for selected Convolutional layers). See [2, 3] for complete details.

16

B Metrics considered in our analysis
Here, we describe metrics presented in Table 1 that we used in our analysis. We start by describing metrics that depend only on the (pre-)trained model (and that do
not require any data to evaluate). This includes both average Power-Law (PL) metrics, from HT-SR Theory, and average log-norm metrics, from SLT, as well as metrics that combine the two approaches.

Average Power-Law (PL) metrics. Given a (pre-)trained NN with L layer weight matrices

W, PL metrics are computed by fitting the ESD of the correlation matrix X = WT W of each

layer to a TPL, and then averaging over all layers.17 In more detail, each layer ESD is fit to a

TPL of the form:

()  -, xmin    xmax.

The fitting procedure selects the optimal PL exponent , and the adjustable parameter xmin.

The PL exponent  characterizes the tail of the ESD; it measures what may be interpreted as

the "shape" of most important part of the spectrum.

· Alpha:



=

1 L

l l. This is a simple average of fitted  over all layers L. From the

perspective of statistical mechanics, Alpha quantifies amount of correlation in the layer weight

matrices.18 From the perspective of statistics, Alpha may be viewed a shape parameter.

· QualityOfAlphaFit: DKS . For the given set of parameters (, xmin, xmax), the quality of

the TPL fit can be measured by the Kolmogorov-Smirnov (KS) distance (DKS) between the

empirical and theoretical distributions. The smaller DKS is, the better the fit.

We describe the PL fitting procedure in more detail (in Section 3.1), and we give examples of

both high and low quality fits (in Appendix C). To our knowledge, we are the first to use Alpha and QualityOfAlphaFit to gauge model complexity.19

Average Log-Norm metrics. Log-Norm metrics are related to product-norm measures of the model complexity C. Given a (pre-)trained NN with L layers, and layer weight matrics Wl, we define the C as the product over a norm of the layer weight matrices

C := W1 × W2 × · · · WL ,

(2)

where Wl denotes some arbitrary matrix norm for layer l.20 If we take the logarithm of both side, we can express this complexity as an average over all layers (L), in log-units

1N

log10 C  log10 W

:= L

log10 Wl .

(3)

l=1

Metrics of this form provide a measure of the "scale" (in log units) of a model.

· LogSpectralNorm:

log10

W

2 2

.

This

is

the

(average)

of

the

log

of

the

layer

Spectral

norms.

The layer Spectral Norm is just maximum eigenvalue max of the correlation matrix X.21

17For Conv2D(k, k, N, M ) layers, we extract N = k × k matrices of shape N × M ; typically, k = 1 or 3. 18Prior work [8] has argued that NNs resemble the strongly correlated systems, e.g., in electronic structure
theory and statistical mechanics, which was the origin of early work in heavy-tailed random matrix theory [28]. 19Prior work [6, 7] used a weighted version of this metric (AlphaHat). There, PL exponents  were computed,
but they were not evaluated as a measure of test accuracy, and they were not shown to correlate with variations in
solver hyperparameters (such as batch size, dropout, weight decay, etc.), as we do for the first time here. 20We drop the layer subscript l when it is clear from the context. 21Prior work has shown that using norm-based metrics in log-scale tends to be superior to working with them in
non-log scale [6, 7]. Even when taking averages, however, norm-based metrics, unlike Alpha, are not scale invariant.

17

· LogFrobeniusNorm:

log10

W

2 F

.

This is the average of the log of the Frobenius norm for

each layer weight matrix. It is included for completeness.

Importantly, these metrics take a layer average, and not a sum, since otherwise these metrics will

trivially depend on the depth L of the network.

Combining PL and Log-Norm metrics. Previous work considered metrics that combine

"scale" and "shape" ideas [10, 6, 7], two of which we consider here.

·

AlphaHat:

^ =

1 L

l l log10 ml ax. This has been used previously as a complexity measure for

a large number of pre-trained NNs of varying depth and hyperparameters [10, 6, 7]. AlphaHat

may be viewed in one of two complementary ways: either as a weighted Alpha (weighted by the layer ml ax); or, equivalently, as a weighted LogSpectralNorm (weighted by the layer l). As a weighted Alpha, the spectral norm weighting corrects for the fact that Alpha is scale-invariant,

accounting for the variation in the scale of each weight matrix across different layers. As a

weighted LogSpectralNorm, the  weighting corrects for the fact that the LogSpectralNorm

is anti-correlated with the test accuracy when varying the regularization hyperparameters.

· LogAlphaShattenNorm:

log10

W

2 2

=

log10

X

 

.

This has been used previously [10],

and it is the average of the Log of the standard Shatten norm, defined with the value of 2

from the PL fit of the ESD of each layer weight matrix W. The AlphaHat metric approximates

the LogAlphaShattenNorm under certain conditions [10].

Distance metrics. If we have access to the initial weight matrices Winit, then we can measure an average distance from initialization. Here, we examine the simplest such choice. · DistanceFromInit: init  W - Winit F . This is the average Frobenius norm of the
pointwise difference of each layer weight matrix W from it's initial value Winit.

Data-dependent Complexity metrics. If one has access to the training data, then one can design complexity metrics that peforms better than the data-independent above. In all cases considered here, the metric corresponds to evaluating the training accuracy after transforming the model weight matrices in some way. · Training Accuracy: Baseline
The most obvious, practical complexity metric is just the training accuracy itself. Of course, this only works if the models are not over-fit, and/or the model training accuracy is not exactly 100%. We use this as the natural baseline for comparison to other metrics. · Sharpness: [clip(W); run BackP rop] repeat N times As proposed previously, the Sharpness Transform modifies the weight matrices W iteratively, by clipping exteme values and then running an iteraton of BackProp over the training data. This is usually done 3 - 10 times, subject to some stopping criteria. This acts as a Sscale Transform, removing anamolously large and/or small elements of W. · SVDSmoothing: [run SV D(W)]; keep top N % singular-vectors We introduce the SVD Smoothing Transform, which modifies a NN by taking a low rank approximation of each layer weight matrix. The SVD10 approximation retains the subspace of each layer W corresponding to the top 10% largest eigenvalues of the ESD. The SVD20 method keeps the top 20%. This acts as a Shape Transform, as the intent is to keep the subspace corresponding to the heavy, PL tail of each ESD. Table 1 provides a summary of the metrics we considered. There are many other metrics that we examined but that we do not describe here: the path norm and Fisher-Rao metcics [2, 3] are more expensive, perform worse, and/or don't add new insight; the Jacobian Norm is also too expensive

18

to compute; and other metrics described in the Contest [2, 3] either were uninteresting (e.g., the sum--not average--of layer norms, which is a proxy for depth) or performed very poorly.
C More on determining shape parameters (fitting ESDs to TPLs), from Section 3.2
Fitting data to PLs and TPLs is very finicky [29, 30, 31, 32, 33, 34]. We have found it best to proceed with a combination of visual inspection and analysis with the WeightWatcher tool [17].
Visual inspection of ESDs. The following advice, taken directly from Sornette [30], is particularly helpful for visual inspection of ESDs: "we recommend a preliminary visual exploration by plotting the survival and density distributions in (i) linear-linear coordinates, (ii) log-linear coordinates (linear abscissa and logarithmic ordinate) and (iii) log-log coordinates (log-arithmic abscissa and logarithmic ordinate). The visual comparison between these three plots provides a fast and intuitive view of the nature of the data.
· A power law distribution will appear as a convex curve in the linear-linear and log-linear plots and as a straight line in the log-log plot.
· A Gaussian distribution will appear as a bell-shaped curve in the linear-linear plot, as an inverted parabola in the log-linear plot and as strongly concave sharply falling curve in the log-log plot.
· An exponential distribution will appear as a convex curve in the linear-linear plot, as a straight line in the log-linear plot and as a concave curve in the log-logp lot.
Having in mind the shape of these three reference distributions in these three representations provides fast and useful reference points to classify the unknown distribution under study." It is helpful to examine ESDs such as those in Figure 1 (in Sectionn 3.2) and Figure 9 (here) in light of these comments.
Of course, such a visual inspection is just a first step to a more detailed analysis, since by itself visual analysis of HT data can be misleading. Sornette [30] goes on to say: "While we recommend a first visual inspection, it is only a first indication, not a proof. It is a necessary step to convince oneself (and the reviewers and journal editors) but certainly not a sufficient condition. It is a standard rule of thumb that a power law scaling is thought to be meaningful if it holds over at least two to three decades on both axes and is bracketed by deviations on both sides whose origins can be understood (for instance, due to insufficient samplingand/or finite-size effects)." It is for these reasons that understanding the behavior of the ESDs near xmin and xmax (of Eqn. (1)) is so important.
Fitting to non-ideal ESDs. In Figure 1, we illustrated how TPL fits of ESDs perform on a nearly "ideal" example. Here, we discuss how it performs on less-than-ideal examples (that occurred in the Contest data). See Figure 9.
In Figure 9, we see several examples of layers that are less well-fit by a TPL. In these cases, we see that the linear-linear plots are non-informative; the log-linear plots show that the distributions have a strong left-ward bias, indicating a tail of increasingly small eigenvalues; and there is not a broad range of large eigenvalues on the right of the distribution. This relative paucity of large eigenvalues is seen on the log-linear plots by a (more or less aggressive) truncation in probability mass for larger eigenvalues, and on the log-log plots by a steeper downward slope on the right of the ESD. (In these cases, compare with Figure 1.) The first row (Task1, model 152, layer
19

(a) ESD (log-log plot)

(b) ESD (lin-lin plot)

(c) ESD (log-lin plot) (d) PL fit quality vs xmin

(e) ESD (log-log plot)

(f) ESD (lin-lin plot)

(g) ESD (log-lin plot) (h) PL fit quality vs xmin

Figure 9: Illustration of the role of the shape of the ESD in determining the PL parameter  in the TPL fit. Rows correspond to different layers in different models. Columns correspond to viewing the same ESD in different ways--on a log-log plot (first column), a linear-linear plot (second column), and a log-linear plot (third)--and the KS Distance D of the TPL fit as a function of xmin (final column). Row 1: Task1, model 152, layer 1. Row 2: Task2, model 1006, layer 10.

1) illustrates an incompletely-developed right tail (alternatively a "bulk-plus-spikes" model may be a more appropriate fit than a TPL fit), meaning that the spectral norm is somewhat smaller and that the fitting procedure has difficulty choosing xmin near the peak of the distribution. The second row (Task2, model 1006, layer 10) illustrates an aggressively-shortened (effectively truncated, i.e., not even spikes) right tail, which leads to a much smaller spectral norm (xmax) and thus a much larger xmin (since there is such a small range over which a linear fit is appropriate), as well as a broad range of (large) xmin values over which low-quality fits are obtained. In each of these of these cases, the KD distance plots have less of a well-defined minimum as a function of xmin.
Additional discussion. In simple cases, scale and shape parameters do capture similar information. For models whose ESDs are very well-approximated by a Marchenko-Pastur (MP) distribution or a MP bulk-plus-spike distribution (Random-like and Bulk+Spikes phases from [8]), visual inspection of ESD plots often yields insight, and there is a strong correspondence between norm-based scale metrics and random MP-based shape metrics. Similarly, for models whose ESDs are very well-approximated by both PL and TPL distributions (Heavy-Tailed phase from [8], where the xmax = max truncation is not signigicant [8] to the fit), there is a strong correspondence between norm-based scale metrics and PL-based shape metrics, in the sense that smaller  values correspond closely to larger max values. For realistic models, however, and for the models from Table 2, these two metrics can be very different and can reveal very different information.
The broad range of behavior seen in the Contest data arises since ESDs look like ones in the rows of Figure 9 (rather than the more "ideal" case shown in Figure 1) where the linear fit to the ESD on log-scale is not very good. For models where Alpha against LogSpectralNorm behave more similarly, the ESDs look more like Figure 1. For the Contest models shown in Figure 9 (and others), for a simple (non-truncated) PL distribution, smaller exponents  correspond to a longer tail, which corresponds to a larger max. However, since the tail of the ESDs are typically best fit by a TPL--often with exponents  much larger than expected, since many of the models from

20

Table 2 are of lower quality--the situation is not so simple. This simple connection only holds for a few model sub-groups. Generally speaking, these scale and shape metrics (LogSpectralNorm and Alpha) characterize the model ESDs differently and capture different properties of the models.

D More on comparing scale versus shape parameters, from Section 3.3
D.1 Additional details on Figure 2

See Table 3 for additional details on the results presented in Figure 2.

Task1- 0xx Task1- 1xx Task1- 2xx Task1- 5xx Task1- 6xx Task1- 7xx Task1- AVG
Task2- 2xx Task2- 6xx Task2- 9xx Task2- 10xx Task2- AVG

R2 0.162 0.405 0.803 0.124 0.124 0.64 0.38
0.113 0.282 0.754 0.273 0.36

Kendal- 0.29 0.394 0.788 0.117 0.263 0.909 0.46
0.0327 0.451 0.600 0.636 0.43

Correlation Weak Modest Strong Weak Weak Strong
None Modest Strong Modest

Table 3: Comparison of the Alpha and LogSpectralNorm metrics, for Task1 and Task2 models. R2 and Kendal- for Task1 and Task2, both aggregated and partitioned into model sub-groups.

D.2 Illustrative examples: comparing scale versus shape parameters

(a) Task1, 2xx

(b) Task1, 5xx

(c) Task2, 2xx

(d) Task2, 10xx

Figure 10: Comparison of Alpha and LogSpectralNorm for selected model sub-groups from both tasks. Lines (simply to guide the eye) shows a linear regression on the data.

We saw in Figure 2 a comparison of the Alpha and LogSpectralNorm metrics, for Task1 and Task2 models. To get more detailed insight, Figure 10 plots Alpha versus LogSpectralNorm for two illustrative pairs of examples, from each of Task1 and Task2. Consider, as a baseline example, Task1, model sub-group 2xx, in Figure 10(a). Here, the two metrics are strongly anti-correlated, with linear correlation metric R2 = 0.803 and Kendal- rank correlation metric  = 0.788. In
contrast, for Task1, model sub-group 5xx, shown in 10(b), the two metrics are (at best) only weakly correlated, with R2 = 0.124 and  = 0.177. This is typical; some model sub-groups

21

exhibit large rank and/or linear correlations, others virutally none at all. For Task2, model subgroup 2xx, versus Task2, model sub-group 10xx, shown in 10(c) and 10(d), we see an example where the two plots look similar visually, and both have small(ish) linear correlation R2, but they
have very different Kendal- rank correlation metrics.

E Additional details on results from Section 4 on Simpson's paradox
E.1 Additional details on Figure 3
See Table 4 for additional details on the results presented in Figure 3.

Task1 0xx Task1 1xx Task1 2xx Task1 5xx Task1 6xx Task1 7xx Task1 AVG
Task2 2xx Task2 6xx Task2 9xx Task2 10xx Task2 AVG

R2 RMSE Ktau Correlation

0.01 0.02 0.10

Weak

0.12 0.02 0.33 Modest

0.22 0.02 0.54 Strong

0.01 0.04 0.01

Weak

0.16 0.05 0.31 Modest

0.78 0.02 0.60 Strong

0.22 0.03 0.31

0.24 0.02 0.25 0.02 0.02 -0.05 0.83 0.01 0.73 0.02 0.02 0.02

Modest Weak Strong Weak

0.28 0.02 0.24

Table 4: Quality metrics (for R2, larger is better; for RMSE, smaller is better; and for Kendall rank correlation, larger magnitude is better) for the relationship between training error and testing error, as illustrated in Figure 3.

E.2 Additional details on changing architectures versus changing solver hyperparameters
See Table 5 and Table 6 for additional details on changing architectures versus changing solver hyperparameters, from Section 4.3.

22

Task1- 0xx Task1- 1xx Task1- 2xx Task1- 5xx Task1- 6xx Task1- 7xx Task1- AVG
Task2- 2xx Task2- 10xx Task2- 6xx Task2- 9xx Task2- AVG

LogSpectralNorm R2 Kendal-

0.34

0.41

0.68

0.73

0.59

0.73

0.58 0.60

0.22

0.59

0.58

0.61

0.50

0.61

0.05

0.01

0.32

0.60

0.21

0.36

0.17

0.47

0.19

0.36

LogFrobeniusNorm R2 Kendal-

0.00

-0.03

0.29

-0.30

0.42

0.55

0.19

-0.25

0.05

-0.10

0.38

0.58

0.22

0.07

0.67

-0.84

0.60

-0.53

0.01

-0.05

0.65

-0.87

0.48

-0.57

Alpha R2 Kendal-

0.55 -0.55

0.88 -0.48

0.69 -0.52

0.09

-0.10

0.67 -0.32

0.45

-0.51

0.55 -0.41

0.69 0.62 0.36 0.64 0.58

-0.74 -0.67 -0.25 -0.87 -0.63

QualityOfAlphaFit

R2

Kendal-

0.02

-0.10

0.00

0.15

0.67

-0.82

0.04

0.18

0.10

-0.13

0.60

-0.58

0.24

-0.22

0.89 0.70 0.35 0.91 0.71

-0.83 -0.67 -0.25 -0.87 -0.66

Table 5: Model quality for different metrics (all those mentioned in Table 1), for Task1 and Task2, both overall and by model sub-group. (This table is part 1 of 2; see also Table 6.) Bar plots for Alpha and LogSpectralNorm data from here are shown in Figure 6.

Task1 - 0xx Task1 - 1xx Task1 - 2xx Task1 - 5xx Task1 - 6xx Task1 - 7xx Task1 - AVG
Task2 - 2xx Task2 - 6xx Task2 - 9xx Task2 - 10xx Task2 - AVG

AlphaHat R2 Kendal- 0.55 -0.55 0.88 -0.48 0.69 -0.52 0.09 -0.10 0.61 -0.37 0.45 -0.51 0.55 -0.42

0.69 0.36 0.64 0.65 0.58

-0.74 -0.25 -0.87 -0.70 -0.64

DistanceFromInit R2 Kendal-

0.47

0.74

0.58

0.85

0.32

0.61

0.60

0.77

0.52

0.73

0.28

0.61

0.46

0.72

0.22

0.49

0.21

0.37

0.49

0.60

0.41

0.73

0.33

0.55

Sharpness R2 Kendal- 0.26 0.72 0.43 0.82 0.30 0.48 0.63 0.76 0.59 0.76 0.54 0.64 0.46 0.70
0.34 0.75 0.22 0.39 0.39 0.73 0.41 0.68 0.34 0.64

SVDSmoothing R2 Kendal-

0.53

0.61

0.75

0.79

0.84 0.76

0.38

0.43

0.40

0.45

0.67 0.67

0.60 0.62

0.95 0.27 0.71 0.68 0.65

0.83 0.27 0.87 0.73 0.67

Table 6: Model quality for different metrics (all those mentioned in Table 1), for Task1 and Task2, both overall and by model sub-group. (This table is part 2 of 2; see also Table 5.) Bar plots for Alpha and LogSpectralNorm data from here are shown in Figure 6.

23

