arXiv:2106.01058v1 [math.DS] 2 Jun 2021

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY
SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN
Abstract. We show that, under finitely many ergodicity assumptions, any multicorrelation sequence defined by invertible measure preserving Zd-actions with multivariable integer polynomial iterates is the sum of a nilsequence and a null sequence, extending a recent result of the second author. To this end, we develop a new seminorm bound estimate for multiple averages by improving the results in a previous work of the first, third and fourth authors. We also use this approach to obtain new criteria for joint ergodicity of multiple averages with multivariable polynomial iterates on Zd-systems.
Contents
1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 1.1 Decomposition of multicorrelation sequences . . . . . . . . . . . . . . . . . . 2 1.2 The joint ergodicity phenomenon . . . . . . . . . . . . . . . . . . . . . . . . 4
2 Main results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 2.1 Splitting results. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 2.2 Convergence to the expected limit. . . . . . . . . . . . . . . . . . . . . . . . . 7 2.3 Strategy of the paper . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 2.4 Notation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9
3 Background Material . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10 3.1 Host-Kra Seminorms and factors . . . . . . . . . . . . . . . . . . . . . . . . . 10 3.2 Nilsystems, nilsequences and Structure Theorem . . . . . . . . . . . . . . . . 13 3.3 Bessel's inequality . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 3.4 General properties of subgroups of Zd and properties of polynomials . . . . . 14
4 PET induction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 4.1 The van der Corput lemma . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 4.2 The van der Corput operation . . . . . . . . . . . . . . . . . . . . . . . . . . 17
5 Finding a characteristic factor . . . . . . . . . . . . . . . . . . . . . . . . . . 21 6 Proof of Main results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31 7 Potential future directions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37
7.1 The two-term case with no ergodicity assumptions . . . . . . . . . . . . . . . 37 7.2 Integer part polynomial iterates . . . . . . . . . . . . . . . . . . . . . . . . . 38 References . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40
2010 Mathematics Subject Classification. Primary: 37A05; Secondary: 37A30, 28A99. Key words and phrases. Multicorrelation sequences, nilsequences, nulsequences, joint ergodicity. The first author was supported by ANID/Fondecyt/1200897 and Grant Basal-ANID AFB170001.
1

2 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

1. Introduction
1.1. Decomposition of multicorrelation sequences. The structure and limiting behaviour of (averages of) multicorrelation sequences, i.e., sequences of the form

(n1, . . . , nk)  f0 · T1n1f1 · . . . · Tknk fk dµ,
X
where k  N, T1, . . . , Tk : X  X are invertible and commuting (i.e., TiTj = TjTi for all i, j) measure preserving transformations on a probability space (X, B, µ),1 f0, . . . , fk  L(µ) and n1, . . . , nk  Z, is a central topic in ergodic theory. For k = 1, Herglotz-Bochner's theorem implies that the sequence X f0 · T1nf1 dµ is given by the Fourier coefficients of some finite complex measure  on T (see [20] and [21]). More specifically, decomposing  into the sum of its atomic part, a, and continuous part, c, we get

f0 · T1nf1 dµ = e2inx d(x) = e2inxda(x) + e2inxdc(x) = (n) + (n),

X

T

T

T

where ((n)) is an almost periodic sequence,2 and ((n)) is a nullsequence, i.e.,

(1)

lim
N -M 

N

1 -M

N -1
|(n)|2 = 0.

n=M

More generally, after Furstenberg's celebrated ergodic theoretic proof of Szemerédi's theorem ([14]), for a single transformation T and iterates of the form in, 1  i  k, there has been a particular interest in the study of the corresponding multicorrelation sequences

(2)

(n) = f0 · T nf1 · . . . · T knfk dµ.

X

For T ergodic (i.e., every T -invariant set in B has trivial measure in {0, 1}), Bergelson, Host
and Kra ([3]) showed that the sequence ((n)) in (2) admits a decomposition of the form
a(n) = (n) + (n), where ((n)) is a uniform limit of k-step nilsequences (see Section 3.2 for the definition) and ((n)) satisfies (1).3 Leibman, in [27] for ergodic systems and [28] for
general ones, extended the result of Bergelson-Host-Kra to polynomial iterates. For d  N, we say that a tuple (X, B, µ, (Tn)nZd ) is a Zd-measure preserving system (or a
Zd-system) if (X, B, µ) is a probability space and Tn : X  X, n  Zd, are measure preserving transformations on X such that T(0,...,0) = id and Tm  Tn = Tm+n for all m, n  Zd.4 It is natural to ask whether splitting results still hold for systems with commuting transformations:

Question 1.1 (Question 2, [25]). Let (X, B, µ, (Tn)nZd ) be a Zd-system, k  N, p1, . . . , pk : Z  Zd a family of polynomials, and f0, f1, . . . , fk  L(µ). Under which conditions on the system

1We say that T preserves µ if µ(T -1A) = µ(A) for all A  B. The tuple (X, B, µ, T1, . . . , Tk) is a (measure

preserving) system.

2I.e., there exists a compact abelian group G, a continuous function  : G  C, and a  G such that

(n) = (an), n  N.

3Note that k is the number of linear iterates that appear in (2).

4We use the notation Tpi(n) to stress the fact that T is a Zd-action. If T is generated by the Z-actions

T1, . . . , Td and pi = (pi,1, . . . , pi,d), we have Tpi(n) =

d j=1

T pi,j j

(n)

.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

3

can the multicorrelation sequence

(3)

f0 · Tp1(n)f1 · . . . · Tpk(n)fk dµ

X

be decomposed as the sum of a uniform limit of nilsequences and a nullsequence?

The extension of the aforementioned results from Z to Zd-actions is, to this day, a challenging open problem. The main issue is that the proofs of the splitting theorems crucially depend on the theory of characteristic factors via the structure theory developed by Host and Kra ([16]), a tool that is unavailable in the more general Zd-setting. As an aside, Frantzikinakis provided a partial answer to Question 1.1 (for d = 1) in [11] that avoided the use of characteristic factors. The answer was partial in the sense that the nullsequence part was allowed to have an 2(Z) error term. A similar decomposition result for general d was proven by Host and Frantzikinakis in [12].5 From the point of view of applications, it is useful to have such splitting results for studying weighted averages, in particular for multiple commuting transformations.6
It was demonstrated in [6] that under finitely many ergodicity assumptions, the characteristic factors for the corresponding averages

(4)

1 N

N

Tp1(n)f1 · . . . · Tpk(n)fk, 7

n=1

as in the case of Z-actions, are rotations on nilmanifolds (a similar result was obtained in [18] under infinitely many ergodicity assumptions). So, it is reasonable to expect that Question 1.1 holds after postulating finitely many ergodicity assumptions (this is an open problem even in the k = 2 case­see [12]).
A partial answer towards this direction was obtained in [8] by the second author. Namely, [8, Theorem 1.5] shows that for any system (X, B, µ, T1, . . . , Tk) with Ti and TiTj-1 ergodic (for all i and j = i) and f0, . . . , fk  L(µ), the sequence

(5)

f0 · T1nf1 · . . . · Tknfk dµ

X

can be decomposed as a sum of a uniform limit of k-step nilsequences plus a nullsequence.
For more general expressions (as in (3)), exploiting results from [18], it is also shown in [8] that, if we further assume ergodicity in all directions, i.e., T1a1 · . . . · Tdad is ergodic for all (a1, . . . , ad)  Zd\{0}, then for any family of pairwise distinct polynomials p1, . . . , pk : Z  Zd, the sequence

(6)

f0 · Tp1(n)f1 · . . . · Tpk(n)fk dµ

X

5The third author showed in [23] the analogue to this result for integer parts, or any combination of rounding functions, of real polynomial iterates. For a refinement of this result, with the average of the error term taken along primes, see [25].
6It is worth mentioning that the splitting of (2), where the average in the null term is taken along primes, was used by Tao and Teräväinen to show the logarithmic Chowla conjecture for products of odd factors ([31]).
7Such multiple ergodic averages always have L2-limits as N   ([33]).

4 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

can be decomposed as a sum of a uniform limit of D-step nilsequences plus a nullsequence.8 The proof of this result makes essential use of a seminorm bound estimate obtained in [18], where the (infinitely many) ergodicity assumptions are reflected (see [8, Theorem 1.6]).
In [6], the first, third and fourth authors improved the seminorm bound estimates of [18] by imposing only finitely many ergodic assumptions. Although the results in [6] are stronger than those in [18], one cannot apply them directly to [8] to improve the aforementioned results, due to the incompatibility of the methods between [6] and [8] (see Subsection 2.3 for more details).
In this article, we extend results from [6] in order to obtain splitting theorems for multicorrelation sequences involving multiparameter polynomials, postulating ergodicity assumptions which are even weaker than those in [6] on the transformations that define the Zd-action in (6); for example, we will see that the sequence X f0 · T1n2T2nf1 · T3n2T4nf2 dµ admits the desired splitting if we assume that T1, T3, T1T3-1 are ergodic.

1.2. The joint ergodicity phenomenon. In his ergodic theoretic proof of Szemerédi's theorem, Furstenberg studied the averages of the multicorrelation sequence (2). In particular, a stepping stone in the proof is the special case when the transformation T is weakly mixing (i.e., T × T is ergodic for µ × µ), in which he showed that the averages

(7)

1 N

N

T nf1 · . . . · T knfk

n=1

converge in L2(µ) to

k i=1

X fi dµ (which we will refer to as the "expected limit") as N  .9

It was Berend and Bergelson ([1]) who characterized when the average of the more general

expression (5), i.e., for multiple commuting transformations, converges to the expected limit

(and this happens exactly when T1 × · · · × Tk and TiTj-1 for all i = j are ergodic). Generalizing Furstenberg's result, Bergelson showed (in [2]) that, for a weakly mixing trans-

formation T and essentially distinct polynomials p1, . . . , pk (i.e., pi, pi - pj are non-constant

for all 1  i, j  k, i = j)

lim
N 

1 N

N
T p1(n)f1
n=1

·

...

·

T pk(n)fk

=

k i=1

fi dµ.10
X

One can think of this last result as a strong independence property of the sequences (T pi(n))nZ, 1  i  k in the weakly mixing case. It is reasonable to expect a characterization in the case of polynomial iterates, which naturally leads to a general notion of joint
ergodicity:

8Here D depends on k, d and the maximum degree of the pi's. It also has a connection to the number of van der Corput operations we have to run in the induction (see Remark 5.8 for details).
9Throughout this paper, unless otherwise stated, all limits of measurable functions on a measure preserving system are taken in L2.
10For T totally ergodic (i.e., T n is ergodic for all n  N) and p1, . . . , pk "independent" integer polynomials, it is proved in [13] that we have the same conclusion. This fact remains true for an ergodic T and "strongly independent" real-valued polynomials iterates, [p1(n)], . . . , [pk(n)] ([·] denotes the floor function), as well (see [19]). These last two results also follow by a recent work of Frantzikinakis, [9], in which, for single T, we have a plethora of joint ergodicity results for a number of classes of iterates (not just polynomial). Finally, for variable real "good" polynomial iterates, one is referred to [24].

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

5

Definition 1.2. for µ if for every

We f1, .

say that the sequence of . . , fk  L(µ) and every

tuples Følner

(Tp1(n), . . sequence

.(,ITNp)kN(n)N)nofZZL Lis,11jowinetlhyaveergtohdaict

1

(8)

lim
N 

|IN |

nIN

Tp1(n)f1

·

.

.

.

·

Tpk (n) fk

=

f1 dµ · . . . ·
X

fk dµ.
X

When k = 1, we also say that (Tp1(n))nZL is ergodic for µ.

The following conjecture was stated in [6]:

Conjecture 1.3 (Conjecture 1.5, [6]). Let d, k, L  N, p1, . . . , pk : ZL  Zd be polynomials and (X, B, µ, (Tg)gZd ) be a Zd-system. Then the following are equivalent:
(C1) (Tp1(n), . . . , Tpk(n))nZL is jointly ergodic for µ. (C2) The following conditions are satisfied:
(i) (Tpi(n)-pj(n))nZL is ergodic for µ for all 1  i, j  k, i = j; and (ii) (Tp1(n) × · · · × Tpk(n))nZL is ergodic for the product measure µk on Xk.
Answering a question of Bergelson, it was shown in [6, Theorem 1.4] that, for a polynomial p : ZL  Z, the sequence (T1p(n), . . . , Tkp(n))nZL is jointly ergodic for µ if and only if ((T1 × · · · × Tk)p(n))nZL is ergodic for µk and TiTj-1 is ergodic for µ for all i = j. In this paper, the strong decomposition results that we obtain allow us to deduce joint ergodicity results for a larger family of polynomials (see Theorems 2.3 and 2.4), thus addressing some additional cases in the aforementioned conjecture.

2. Main results

In this section we state the main results of the paper, and provide a number of examples to better illustrate them. We also comment on the approaches that we follow.

2.1. Splitting results. Our first main concern is to resolve the incompatibility between [6] and [8], and improve the method in [6], in order to obtain an extension of the results in [8].

Before we state our first result, we need to introduce some notations: For d, L  N, the polynomial q = (q1, . . . , qd) : ZL  Zd is non-constant if some qi is
non-constant. The polynomials p1, . . . , pk : ZL  Zd are called essentially distinct if they are non-constant
and pi - pj is non-constant for all i = j.12 For a subset A of Qd, we denote G(A) := spanQ{a  A}  Zd. The following subgroups of
Zd play an important role in this paper:

Definition 2.1. Let p = (p1, . . . , pk), p1, . . . , pk : ZL  Zd be a family of essentially distinct

polynomials with pi NL0 nonzero.13 For

(n) = vNL0 convenience,

bi,vnv for some we artificially

bi,v  Qd with denote p0 as

at most finitely many bi,v, v  the constant zero polynomial

and b0,v := 0 for all v  NL0 . For 0  i, j  k, set di,j := deg(pi - pj) and Gi,j(p) :=

G({bi,v - bj,v : |v| = di,j}), where, for v = (v1, . . . , vL)  NL0 , we write |v| = v1 + . . . + vL.

11A sequence of finite subsets (IN )NN of ZL with the property limN |IN |-1 · |(g + IN )IN | = 0 for all g  ZL is called a Følner sequence in ZL.
12In general, a polynomial q : ZL  Zd has rational coefficients (i.e., vectors with rational coordinates). 13Here we denote nv := nv11 . . . nvLL for n = (n1, . . . , nL)  ZL and v = (v1, . . . , vL)  NL0 ,where 00 := 1.

6 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

Our main result provides an affirmative answer to Question 1.1 under finitely many ergod-
icity assumptions on the groups Gi,j(p), which generalizes [8, Theorem 1.5]. We say that the group Gi,j(p) is ergodic for µ if any function f  L2(µ) that is Ta-invariant for all a  Gi,j(p) is constant.

Theorem 2.2 (Decomposition theorem under finitely many ergodicity assumptions). For d, k, K, L  N, let p = (p1, . . . , pk), where p1, . . . , pk : ZL  Zd is a family of essentially distinct polynomials of degree at most K, and let (X, B, µ, (Tn)nZd ) be a Zd-system. If Gi,j(p) is ergodic for µ for all 0  i, j  k, i = j, then, for all f0, . . . , fk  L(µ), the multicorrelation
sequence

a(n) := f0 · Tp1(n)f1 · . . . · Tpk(n)fk dµ
X
can be decomposed as a sum of a uniform limit of D-step nilsequences and a nullsequence,14 where D  N is a constant depending only on d, k, K, L.

Note that Theorem 2.2 goes beyond Question 1.1 as it deals with multi-variable polynomial iterates (i.e., L > 1).

Example 1. It was proved in [8, Theorem 1.5] that for any probability space (X, B, µ) and commuting transformations T1, . . . , Tk acting on X, if Ti and TiTj-1 ergodic (for all i and all j = i respectively), then for all f0, . . . , fk  L(µ), the multicorrelation sequence

a(n) := f0 · T1nf1 · . . . · Tknfk dµ
X
can be decomposed as a sum of a uniform limit of k-step nilsequences plus a nullsequence. Theorem 2.2 implies a similar result.15

The following example shows that Theorem 2.2 is stronger than [8, Theorem 1.6], which deals with single variable essentially distinct polynomial iterates:

Example 2. Let (X, B, µ, T1, . . . , T6) be a system with commuting transformations T1, . . . , T6 and f0, f1, . . . , f4  L(µ). Using [8, Theorem 1.6], we have that the multicorrelation sequence

(9)

(n) = f0 · T1n2 T2nf1 · T1n2T3nf2 · T4n3f3 · T5n3T6nf4 dµ

X

can ...·

be decomposed as the sum of a uniform limit T6a6 is ergodic for all (a1, . . . , a6)  Z6\{0}. In

of nilsequences and a nullsequence contrast, via Theorem 2.2, one can

if T1a1 · get the

same conclusion by T(a1,...,a6) := T1a1 · .

only assuming that . . · T6a6 , and ei the

T1, T2T3-1, T4, vector whose

T5, T4T5-1 i-th entry

are is

ergodic. (Indeed, denoting 1 and all other entries are

0, since p = ((n2, n, 0, 0, 0, 0), (n2, 0, n, 0, 0, 0), (0, 0, 0, n3 , 0, 0), (0, 0, 0, 0, n3 , n)), we have that

G1,0(p) = G2,0(p) = G(e1), G1,3(p) = G2,3(p) = G3,0(p) = G(e4), G1,4(p) = G2,4(p) = G4,0(p) = G(e5), G1,2(p) = G(e2 - e3), G3,4(p) = G(e4 - e5).)

14The precise definition of a D-step nilsequence will be given in the following section. Furthermore, we say

that a : ZL 15While

 C is a nullsequence Theorem 2.2 does not

if for any Følner specify the step

sequence D of the

(IN )

we

have

limN 

1 |IN |

nIN |a(n)|2 = 0.

nilsequence, a quick argument shows that in this

case one can indeed take D = k (see Remark 6.1 for details).

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

7

2.2. Convergence to the expected limit. In [6, Theorem 1.4], the first, third and fourth authors proved the following case of Conjecture 1.3: If T1, . . . , Tk are commuting transformations acting on a probability space (X, B, µ), then (T1p(n), . . . , Tkp(n))nZL is jointly ergodic for µ if and only if ((T1 × · · · × Tk)p(n))nZL is ergodic for µk and TiTj-1 is ergodic for µ for all i = j. In this paper, we further extend this result:
Theorem 2.3. Let p = (p1(n)v1, . . . , pk(n)vk), p1, . . . , pk : ZL  Z, v1, . . . , vk  Zd be a family of essentially distinct polynomials. Suppose that for all 1  i, j  k, if deg(pi) = deg(pj), then either vi and vj are linearly dependent over Z, or pi(n) and pj(n) are linearly dependent over Z (i.e., there is a non-trivial linear combination of them over Z which equals to a constant). Let (X, B, µ, (Tg)gZd ) be a Zd-system. Then the following are equivalent:
(C1) (Tpi(n)vi : 1  i  k)nZL is jointly ergodic for µ (C2') The following conditions hold:
(i) (Tpi(n)vi-pj(n)vj )nZL is ergodic for µ for all 1  i, j  k, i = j with deg(pi) = deg(pj );
(ii) (Tp1(n)v1 × · · · × Tpk(n)vk )nZL is ergodic for µk. Moreover, (C2') is equivalent to
(C2) The following conditions hold: (i) (Tpi(n)vi-pj(n)vj )nZL is ergodic for µ for all 1  i, j  k, i = j; (ii) (Tp1(n)v1 × · · · × Tpk(n)vk )nZL is ergodic for µk.
Note that the conditions in (C2) are consistent with those in Conjecture 1.3. On the other hand, the reason we provide an alternative set of equivalent conditions (C2') is that these conditions are easier to check in practise.
We now give some examples to illustrate Theorem 2.3. The first one is for polynomials of distinct degrees:
Example 3. Let (X, B, µ, T1, . . . , Tk) be a system. Using Theorem 2.3, we conclude that (T1n, T2n2 , . . . , Tknk )nZ is jointly ergodic if and only if (T1n × · · · × Tknk )nZ is ergodic for µk, and all the Ti's are ergodic for µ.
We remark that Example 3 can also be proved by using arguments from [5]. We next present two examples in which the polynomials can be taken to be not necessarily of different degrees, and so, cannot be recovered by the methods of [5]:
Example 4. Let (X, B, µ, T1, T2, T3, T4) be a system. Theorem 2.3 implies that (T1n, T2n, T3n2, T4n2)nZ is jointly ergodic if and only if (T1n × T2n × T3n2 × T4n2)nZ is ergodic for µ4, and both T1T2-1 and ((T3T4-1)n2 )nN are ergodic for µ.
Example 5. Let (X, B, µ, T1, T2, T3) be a system. Theorem 2.3 implies that (T1n4+n2, T12n4+3n, T22n2+2n+1, T33n2+3n)nZ is jointly ergodic if and only if (T1n4+n2 × T12n4+3n × T22n2+2n+1 × T33n2+3n)nZ is ergodic for µ4, and both sequences (T1-n4+n2-3n)nZ and ((T22T3-3)n2+n)nZ are ergodic for µ.
Another direction for the joint ergodicity problem is verifying whether (C1) implies (C2) in Conjecture 1.3. Namely, assuming that (Tp1(n) × · · · × Tpk(n))nZL is ergodic for µk, to find a condition, say (P), of certain sequences of actions to be ergodic, under which, we

8 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

have that (Tp1(n), . . . , Tpk(n))nZL is jointly ergodic for µ. By combining existing results from [16, 18, 26] (see also [6, Proposition 1.2]), (P) can be taken to be: "Tg is ergodic for µ for all g  Zd\{0}." Denoting pi(n) = vNL0 ,0|v|K bi,vnv for some bi,v  Qd and K  N0, this result was extended in [6, Theorem 1.3], where the previous property is replaced by: "Tg is
ergodic for µ for all g that belongs to the finite set R," where

R=

{bi,v, bi,v - bj,v : 1  i, j  k}\{0}.

0<|v|K

In this paper, we replace the latter condition with an even weaker one:

Theorem 2.4. Let d, k, L  N, p = (p1, . . . , pk), p1, . . . , pk : ZL  Zd be a family of essentially distinct polynomials and X = (X, B, µ, (Tg )gZd ) a Zd-system. Then (Tp1(n), . . . , Tpk(n))nZL is jointly ergodic for µ if both of the following conditions hold:
(i) Gi,j(p) is ergodic for µ for all 0  i, j  k, i = j; (ii) (Tp1(n) × · · · × Tpk(n))nZL is ergodic for µk.
The last example for this section reflects the stronger nature of the previous theorem compared to what was previously known.

Example 6. Let (X, B, µ, T1, T2, T3, T4) be a system. Then, [6, Theorem 1.3] implies that (T1n2T2n, T3n2 T4n)nZ is jointly ergodic if ((T1n2 T2n) × (T3n2 T4n))nZ is ergodic for µ2, and all T1, T2, T3, T4, T1T3-1, T2T4-1 are ergodic for µ. Using Theorem 2.4, we conclude that (T1n2 T2n, T3n2T4n)nZ is jointly ergodic if we instead only assume that ((T1n2 T2n) × (T3n2 T4n))nZ is ergodic for µ2, and all T1, T3, T1T3-1 are ergodic for µ.
2.3. Strategy of the paper. The central ingredient in proving the main results of the paper (Theorems 2.2, 2.3 and 2.4) is to find proper characteristic factors for the average (4), i.e., sub-algebras D1, . . . , Dk of B such that the average (4) remains invariant if we replace each fi by its conditional expectation (see Section 3 for the definition) with respect to Di. An important type of characteristic factor, called the Host-Kra characteristic factor, was invented in [16] to study multiple averages for Z-systems (see Section 3 for the definition of these factors). This concept was generalized to systems with commuting transformations in [15] (see also [30]). The main tool used in our results, special cases of which have been studied extensively in the past (see for example [5, 13, 15, 16, 18]), is the following:

Theorem 2.5. Let d, k, K, L, s  N, p = (p1, . . . , pk), p1, . . . , pk  ZL  Zd be a family of essentially distinct polynomials of degrees at most K. There exists D  N0 depending only on d, k, K, L, s such that for every Zd-system X = (X, B, µ, (Tn)nZd ), every f1, . . . , fk  L(µ), and every Følner sequence (IN )NN of ZL, if fi is orthogonal to the Host-Kra characteristic factor Z{Gi,j(p)}×0Djk,j=i (X) for some 1  i  k (i.e. the conditional expectation of fi under Z{Gi,j (p)}×0Djk,j=i (X) is 0), then we have that

(10)

1

k

lim
N 

|IN |

nIN

i=1

Tpi(n)fi

=

0.

In particular, if for some 1  i  k, Gi,j(p) is ergodic for µ for all 0  j  k, j = i and fi is orthogonal to the Host-Kra characteristic factor Z(Zd)×kD (X), then (10) holds.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

9

It is worth noting that the factor Z{Gi,j(p)}×0Djk,j=i (X) we obtain in Theorem 2.5 is not optimal, but it is good enough for our purposes.
A special case of Theorem 2.5 was proved in [6, Theorem 5.1]. In particular, Theorem 2.5 generalizes [6, Theorem 5.1] in the following ways:
(I) The characteristic factor obtained in Theorem 2.5 is of finite step, whereas the one in [6, Theorem 5.1] is of infinite step.
(II) The groups Gi,j(p) involved in Theorem 2.5 are larger than those in [6, Theorem 5.1], which makes the characteristic factors in Theorem 2.5 smaller.
We remark that the aforementioned technical distinctions have significant influences in the applications of Theorem 2.5. First, the essential reason why one cannot directly use [6, Theorem 5.1] to improve [8, Theorem 1.5] is that the method used in [8] requires a characteristic factor of finite step. This problem is resolved by (I), enabling us to extend [8, Theorem 1.5] in this paper. Second, [6, Theorem 5.1] does not provide a strong enough characteristic factor in certain circumstances. For example, in the case of Example 3, [5, Theorem 6.5] suggests that the Host-Kra seminorms controlling (10) depend only on the transformations T1, . . . , Tk, whereas the upper bound provided by [6, Theorem 5.1] depends not only on the transformations T1, . . . , Tk but also on many compositions of them. With the help of (I) and (II), we are able to obtain (and generalize) the aforementioned upper bound of [5, Theorem 6.5].
Roughly speaking, the achievement of (I) relies on a sophisticated development of a Besseltype inequality first obtained by Tao and Ziegler in [32, Proposition 3.6]. The most technical part of this paper is the approach we use to get (II). In [6], a method was introduced to keep track of the coefficients of the polynomials while running a variation of the PET induction. However, the tracking provided there is not strong enough to imply Theorem 2.5. To overcome this difficulty, we introduce more sophisticated machinery in order to have a better control of the coefficients.
The paper is organized as follows: We provide some background material in Section 3. In Section 4, we present the variation of PET induction that we use. In Section 5, we address how (I) and (II) above can be achieved with Propositions 5.2 and 5.3, which improve Propositions 5.6 and 5.5 of [6] respectively. We conclude the section by proving Theorem 2.5. This is the bulk of the paper. In Section 6, we use Theorem 2.5 to deduce Theorems 2.2, 2.3, and 2.4, which are the main results of the paper. We conclude with some discussions on future directions in Section 7.

2.4. Notation. We denote with N, N0, Z, Q, R and C the set of positive integers, non-negative

integers, integers, rational numbers, real numbers and complex numbers respectively. If X is

a set, and d  N, Xd denotes the Cartesian product X × · · · × X of d copies of X.

We will denote by ei the vector which has 1 as its ith coordinate and 0's elsewhere. We

use in general lower-case letters to symbolize both numbers and vectors but bold letters to

symbolize vectors of vectors to highlight this exact fact. The only exception to this convention

is the vector 0 (i.e., the vector with coordinates only 0's) which we always symbolize in bold.

Throughout this article, we use the following notation for averages: Let (a(n))nZL be a sequence of complex numbers, or a sequence of measurable functions on a probability space

(X, B, µ). We let

EnAa(n)

:=

1 |A|

nA a(n), where A is a finite subset of ZL;

10 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

EnZL a(n) := limN En[-N,N]La(n);16

EnZL a(n) := sup (IN )NN limN EnIN a(n);
Følner seq.

EnZL a(n) EnZL a(n)

:= :=

limN  limN 

En[-N,N]La(n) (provided EnIN a(n) (prov. the limit

that the limit exists); and exists for all Følner seq. (IN

)N N ).17

We also consider iterated averages: Let (a(h1, . . . , hs))h1,...,hsZL be a multi-parameter sequence. We let

Eh1,...,hsZL a(h1, . . . , hs) := Eh1ZL . . . EhsZL a(h1, . . . , hs)

and adopt similar conventions for Eh1,...,hsZL , Eh1,...,hsZL and Eh1,...,hsZL respectively. We end this section by recalling the notion of a system indexed by an abelian group (G, +).
We say that a tuple (X, B, µ, (Tg)gG) is a G-measure preserving system (or a G-system) if (X, B, µ) is a probability space and Tg : X  X are measurable, measure preserving transformations on X such that TeG = id (eG is the identity element of G) and Tg  Th = Tg+h for all g, h  G. A G-system will be called ergodic if for any A  B such that TgA = A for all g  G, we have that µ(A)  {0, 1}. In this paper, we are mostly concerned about Zd-systems and L2(µ)-norm limits of (multiple) ergodic averages. For the corresponding norm, when it is
clear from the context, we will write · 2 instead of · L2(µ).

3. Background Material
In this section we recall some background material and prove some intermediate results that will be used later throughout the paper.

3.1. Host-Kra Seminorms and factors. Host-Kra seminorms and their associated factors
are arguably the main tools used to analyze the behaviour of multiple averages and correlation
sequences. In what follows we give general results about these seminorms and factors, following
the notation used in [6].
We first recall the notions of a factor and of the conditional expectation with respect to a factor. We say that the Zd-system (Y, D, , (Sg)gZd ) is a factor of (X, B, µ, (Tg)gZd ) if there exists a measurable map  : (X, B, µ)  (Y, D, ) such that µ(-1(A)) = (A) for all A  D, and   Tg = Sg   for all g  Zd.
A factor (Y, D, , (Sg)gZd ) of (X, B, µ, (Tg)gZd ) can be identified with an invariant sub-algebra B of B by setting B := -1(D). Given two -algebras B1 and B2, their joining B1  B2 is the -algebra generated by B1  B2 for all B1  B1 and B2  B2, i.e., the smallest -algebra containing both B1 and B2.
Given a factor  : (X, B, µ)  (Y, D, ) and a function f  L2(µ), the conditional expectation of f with respect to Y is the function g  L2(), which we denote by E(f | Y ), with the property

g   dµ = f dµ for all A  -1 (D) .

A

A

16We use the symbol to highlight the fact that the averages are taken along the boxes [-N, N ]L. 17It is worth noticing that if the limit limN EnIN a(n) exists for all Følner sequences (in ZL), then this limit does not depend on the chosen Følner sequence.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

11

Let X = (X, B, µ, (Tg)gZd ) be a Zd-system and let B1 be an invariant sub--algebra of B. The relatively independent joining of X with itself with respect to B1 is the measure preserving system obtained by considering the product space with the relatively independent joining,
denoted by µ ×B1 µ, which is given by the formula:

f1  f2 d(µ ×B1 µ) = E(f1|B1)E(f2|B1) dµ,

X ×X

X

for all f1, f2  L(µ).
For a G-system X = (X, B, µ, (Tg)gG), if H is a subgroup of G, we denote by I(H)(X) the
set of A  B such that TgA = A for all g  H. When there is no confusion, we write I(H). For a Zd-system (X, B, µ, (Tg)gZd ), define

µH1 = µ ×I(H1) µ

and for k > 1, let

µH1,...,Hk = µH1,...,Hk-1 ×I(Hk[k-1]) µH1,...,Hk-1 ,
where Hk[k-1] denotes the subgroup of (Zd)2k-1 consisting of all the elements of the form hk × · · · × hk (2k-1 copies of hk) for some hk  Hk. The characteristic factor ZH1,...,Hk (X) is defined to be the sub--algebra of B characterized by

E(f |ZH1,...,Hk (X)) = 0 if and only if |||f |||2Hk1,...,Hk :=

C||f dµH1,...,Hk = 0
X[k] {0,1}k

for all f  L(µ), where X[k] = X × · · · × X (2k copies of X), || = 1 + · · · + k for  = (1, . . . , k)  {0, 1}k, and C2r+1f = f , the complex conjugate of f , C2rf = f for all r  Z.
The quantity |||f |||H1,...,Hk denotes the Host-Kra seminorm of f with respect to the subgroups H1, . . . , Hk. Similar to the proof of [15, Lemma 4] (or [16, Lemma 4.3]), one can show that
ZH1,...,Hk (X) is well defined. We summarize some basic properties of the Host-Kra seminorms and their associated factors.

Proposition 3.1 (Lemma 2.4, [6]). Let X = (X, B, µ, (Tg)gZd ) be a Zd-system, H1, . . . , Hk, H be subgroups of Zd and f  L(µ).
(i) For every permutation  : {1, . . . , k}  {1, . . . , k}, we have that

ZH1,...,Hk (X) = ZH(1),...,H(k) (X),

hence the corresponding seminorm does not depend on the particular order taken for
the subgroups H1, . . . , Hk. (ii) If I (Hj ) = I (H ), then ZH1,...,Hj,...,Hk (X) = ZH1,...,Hj-1,H,Hj+1,...,Hk (X). (iii) For k  2 we have that

while for k = 1,

|||f |||2Hk1,...,Hk = EgHk |||f · Tgf |||2Hk1-,.1..,Hk-1 ,

|||f |||2H1 = EgH1 f · Tgf dµ.
X
(iv) Let k  2. If H  Hj is of finite index, then

ZH1,...,Hj,...,Hk (X) = ZH1,...,Hj-1,H,Hj+1,...,Hk (X).

12 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

(v) If H   Hj , then ZH1,...,Hj,...,Hk (X)  ZH1,...,Hj-1,H,Hj+1,...,Hk (X). (vi) For k  2, |||f |||H1,...,Hk-1  |||f |||H1,...,Hk-1,Hk and thus
ZH1,...,Hk-1 (X)  ZH1,...,Hk-1,Hk (X).
(vii) For k  1, if H1 , . . . , Hk are subgroups of Zd, then
ZH1,...,Hk (X)  ZH1 ,...,Hk (X)  ZH1 ,...,Hk ,H1,...,Hk (X).
As an immediate corollary of Proposition 3.1 (iv), we have:
Corollary 3.2 (Corollary 2.5, [6]). Let H1, . . . , Hk be subgroups of Zd. If the Hi-action (Tg)gHi is ergodic on X for all 1  i  k, then ZH1,...,Hk (X) = Z(Zd)×k (X).
Convention 3.3. Thanks to Proposition 3.1 we may adopt a flexible and convenient notation while writing the Host-Kra characteristic factors. For example, if A = {H1, H2}×3, then the notation ZA,H3,H4×2,(Hi)i=5,6 (X) refers to ZH1,H1,H1,H2,H2,H2,H3,H4,H4,H5,H6 (X).
Recall that for a subgroup H  Zd, H[1] denotes the subgroup {(h, h) : h  H}  Zd × Zd.
Lemma 3.4. Let d  N. Let (X, B, µ, (Tg)gZd ) be a Zd-system and H1, . . . , Hk, H be subgroups of Zd. Let f  L(µ). Then,
|||f  f¯|||H1[1],...,Hk[1]  |||f |||2H1,...,Hk,H ,
where in the left hand side we consider the product space (X × X, B  B, µ × µ).

Proof. We proceed by induction on k. For k = 1, using the Cauchy-Schwartz inequality, we have

|||f  f |||2H1[1] = EgH1 = EgH1

f  f · (Tg × Tg)f  f d(µ × µ)

2

2

Tgf · f dµ = EgH1 E(Tgf · f |I(H))dµ

 EgH1 |E(Tgf · f |I(H))|2dµ = EgH1|||Tgf · f |||2H = |||f |||4H,H1 = |||f |||4H1,H ,

from where we conclude the required relation by taking square roots. Suppose that the result holds for k - 1. By Proposition 3.1 and the induction hypothesis,

|||f



f |||2Hk1[1],...,Hk[1]

=

EgHk |||(Tg

×

Tg )f



f

·

f



f

|||2k-1
H1[1],...,Hk[1-] 1

=

EgHk |||Tgf

·

f



Tg f

·

f

|||2k-1
H1[1],...,Hk[1-] 1

 EgHk |||Tg f · f |||2Hk1,...,Hk-1,H

= |||f |||H1,...,Hk-1,H,Hk = |||f |||H1,...,Hk-1,Hk,H

and the claim follows.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

13

3.2. Nilsystems, nilsequences and Structure Theorem. Let X = N/, where N is a (k-step) nilpotent Lie group and  is a discrete cocompact subgroup of N . Let B be the Borel -algebra of X, µ the Haar measure on X, and for n  Zd, let Tn : X  X with Tnx = bn · x for some group homomorphism n  bn from Zd to N . We say that X = (X, B, µ, (Tn)nZd) is a (k-step) Zd-nilsystem. For k  1, we say that (an)nZd is a (k-step) Zd-nilsequence if there exist a (k-step) Zd-nilsystem X = (X, B, µ, (Tn)nZd ), a function F  C(X) and x  X such that an = F (Tnx) for all n  Zd. For k = 0, a 0-step nilsequence is a constant sequence. An important reason which makes the Host-Kra characteristic factors powerful is their connection with nilsystems. The following is a slight generalization of [35, Theorem 3.7] (see [30, Theorem 3.7]), which is a higher dimensional version of Host-Kra structure theorem ([16]).
Theorem 3.5. Let X be an ergodic Zd-system. Then Z(Zd)×k (X) is an inverse limit of (k -1)step Zd-nilsystems.

3.3. Bessel's inequality. An essential difference in the study of multiple ergodic averages between Z-systems and Zd-systems is that in the former case, one can usually bound the
average by some Host-Kra seminorm of a function f appearing in the average, whereas in the
latter, one can only bound the averages by an average of a family of Host-Kra seminorms of f .
To overcome this difficulty, inspired by the work of Tao and Ziegler ([32]), in this subsection
we derive an upper bound for expressions of the form EiI |||f |||Hi,1,...,Hi,s , where I is a finite set and Hi,j are subgroups of Zd.
The proof of the following statement is similar to [32, Corollary 1.22]:

Proposition 3.6 (Bessel's inequality). Let s  N, (X, B, µ, (Tg)gZd ) be a Zd-system, I be a finite set of indices, and Hi,j, i  I, 1  j  s be subgroups of Zd. Then for all f  L(µ),

EiI

E(f |ZHi,1,...,Hi,s )

2 2



f 2·

Ei,jI

2 1/2

E(f |Z{Hi,i +Hj,j }1i,js ) 2

.

Proof. For convenience, let fi := E(f |ZHi,1,...,Hi,s). Then

EiI

E(f |ZHi,1,...,Hi,s )

2 2

=

f, EiI fi

which, by the Cauchy-Schwartz inequality is bounded by

1/2
f 2 · Ei,jI fi, fj .

By [32, Corollary 1.21], L(ZHi,1,...,Hi,s) and L(ZHj,1,...,Hj,s) are orthogonal on the orthogonal complement of L(Z{Hi,i +Hj,j }1i,js ), hence
2
fi, fj = E(f |Z{Hi,i +Hj,j }1i,js ) 2 and we have the conclusion.

By repeatedly using Proposition 3.6, we have:

Corollary 3.7. Let s, t  N, (X, B, µ, (Tg)gZd ) be a Zd-system, I be a finite set of indices, and Hi,j, i  I, 1  j  s, be subgroups of Zd. Then for all f  L(µ) and T := 2t we have

EiI

E(f |ZHi,1,...,Hi,s )

2 2

T


f

2T -2 2

·

Ei1,...,iT

I

E(f |Z{

2

) . T
j=1

Hij

,ij

}1i1

,...,iT

s

2

14 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

The next proposition provides an upper bound for EiI|||f |||Hi,1,...,Hi,s which can be combined with the previous two statements.

Proposition 3.8. Let s, t  N, (X, B, µ, (Tg)gZd ) be a Zd-system, I be a finite set of indices, and Hi,j, i  I, 1  j  s be subgroups of Zd. Then for all f  L(µ), with f L(µ)  1,

EiI |||f |||Hi,1,...,Hi,s  (EiI

(E(f |ZHi,1,...,Hi,s )

2 2

)1/2s

.

Proof. Note that

(11) Also, for all i we have

|||f |||Hi,1,...,Hi,s 

f L2s (µ) 

f

1/2s-1 2

.

|||f |||Hi,1,...,Hi,s  |||f - E(f |ZHi,1,...,Hi,s )|||Hi,1,...,Hi,s + |||E(f |ZHi,1,...,Hi,s )|||Hi,1,...,Hi,s

= |||E(f |ZHi,1,...,Hi,s )|||Hi,1,...,Hi,s ,

so

(12)

EiI |||f |||Hi,1,...,Hi,s EiI |||E(f |ZHi,1,...,Hi,s )|||Hi,1,...,Hi,s

EiI

E(f |ZHi,1,...,Hi,s )

1/2s-1 2



(EiI

(E(f |ZHi,1,...,Hi,s )

2 2

)1/2s

,

as was to be shown.

3.4. General properties of subgroups of Zd and properties of polynomials. Recall that for a subset A of Qd, we denote G(A) := spanQ{a  A}  Zd. Next we summarize some properties of these sets.

Lemma 3.9. The following properties hold:
(i) For any set A  Zd, G(A) is a subgroup of Zd.
(ii) Let A be a finite set and M (A) the matrix whose columns are the elements of A. Then G(A) = (M (A) · Q|A|)  Zd.
(iii) If H  Zd is the subgroup generated by h1, . . . , hk  Zd, then G(H) = G({h1, . . . , hk}). In particular, letting M (h1, . . . , hk) be the matrix whose columns are h1, . . . , hk, we have that G( h1, . . . , hk ) = (M (h1, . . . , hk) · Qk)  Zd.
(iv) For any subgroup H  Zd, H has finite index in G(H). Moreover, G(H) is the largest subgroup of Zd which is a finite index extension of H.
(v) If not all of a1, . . . , ak belong to a common proper subspace of Qd, then G({a1, . . . , ak}) = Zd.

Proof. Properties (i), (ii) and (iii) follow directly from the definitions.

To prove (iv), let {g1, . . . , gk} be a set such that g1, . . . , gk = G(H). For each i = 1, . . . , k

there

exist

mi

and

hi



H

such

that

gi

=

hi mi

.

The

group

m1g1, . . . , mkgk

is of finite index

in g1, . . . , gk = G(H) and is contained in H. Therefore H is of finite index in G(H).

To see that G(H) is the largest finite index extension of H, take H to be any finite index

extension of H and take h  H. Since H is a finite index extension of H, we have that there

exists n  N such that nh  H. This implies that h  G(H).

To show (v), reordering a1, . . . , ak if needed, we may assume that a1, . . . , ad are linearly independent vectors over Q. It follows that spanQ({a1, . . . , ad}) = Qd and then G({a1, . . . , ak})  G({a1, . . . , ad}) = Zd.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

15

Remark 3.10. If H1 and H2 are subgroups of Zd, then G(H1) + G(H2)  G(H1 + H2), with the inclusion possibly being strict. For instance, for H1 = (1, 2) , H2 = (2, 1) we have that G(H1) = H1, G(H2) = H2 and H1 + H2 G(H1 + H2) = Z2. Nevertheless, Lemma 3.9 implies that that G(H1) + G(H2) has finite index in G(H1 + H2).

In the remainder of the section, we provide some algebraic lemmas that will be used later in

the paper. For a set E  Zd, we define its upper Banach density (or just upper density when

there

is

no

confusion)

with

d(E)

:=

limN 

maxtZd

|(E

-t){1,...,N Nd

}d

|

.

If

the

limit

exists,

we

say that its value is the Banach density (or just density) of E. The proof of the following

lemma is routine (see also [6, Lemma 2.12] for a more general version):

Lemma 3.11 (Lemma 2.12, [6]). Let c : (ZL)s  R be a polynomial. Then either c  0 or the set of h  (ZL)s such that c(h) = 0 is of (upper) Banach density 0.

Lemma 3.12. Let vi  ZL, 1  i  k and U be a subset of Zk of positive density. Then

(13)

G

hivi : h = (h1, . . . , hk)  U = G({vi : 1  i  k}).

1ik

Proof. Note that in (13) the right hand side clearly includes the left hand side. To prove the converse inclusion it suffices to show that

(14)

spanQ{h : h  U } = Qk.

Since U has positive density, it cannot be contained in any hyperplane of Qk, so it must have at least k elements that are linearly independent over Q. Thus, (14) follows immediately.

Definition 3.13. Let P : ZLK  R be a polynomial. Denote by P : ZL(K+1)  R the polynomial given by P (n, h1, . . . , hK ) := P (n + hK , h1, . . . , hK-1) - P (n, h1, . . . , hK-1) for all n, h1, . . . , hK  ZL. For a polynomial P : ZL  R, let KP :=  · . . . · P (where  acts K times).

Lemma 3.14. Let K  N and Q : ZL  R be a homogeneous polynomial with deg(Q) > K. If Q(n) / Q[n]+R, then the set of (h1, . . . , hK )  (ZL)K such that KQ(·, h1, . . . , hK ) / Q[n]+R
is of density 1.

Proof. We may write Q(n) =

M i=1

aiQi

(n)

for some

M



N,

homogeneous

polynomials

Q1, . . . , QM in Q[n] of degrees deg(Q), and real numbers a1, . . . , aM  R which are linearly

independent over Q (this can be done by taking a1 . . . , aM to be a basis of the Q-span of the

coefficients of Q). Since Q(n) / Q[n] + R, there exists some 1  i  M such that ai / Q

and Qi  0. Without loss of generality assume that i = 1. Since deg(Q1) > K, we have that

K Q1  0.

Suppose that KQ(·, h1, . . . , hK )  Q[n] + R for some (h1, . . . , hK )  (ZL)K . Note that

KQ(·, h1, . . . , hK ) =

M i=1

aiK

Qi

(·,

h1

,

.

.

.

,

hK

).

Since

each

K Qi(·, h1, . . . , hK )

is

a

ratio-

nal polynomial of degree deg(Q) - K and a1, . . . , aM  R are linearly independent over Q,

we must have that KQ1(·, h1, . . . , hK )  0. So if the set of (h1, . . . , hK )  (ZL)K such that

KQ(·, h1, . . . , hK )  Q[n] + R has positive density, then the set of (n, h1, . . . , hK )  (ZL)K

such that KQ1(n, h1, . . . , hK ) = 0 has positive density too. By [6, Lemma 2.12], KQ1  0,

a contradiction. This finishes the proof.

16 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

4. PET induction

In this section we present the method we use to reduce the complexity of the polynomial iterates, i.e., PET induction,18 which was first introduced in [2]. To this end, we start by recalling a variation of van der Corput's lemma from [6] that is convenient for our study. We then continue by presenting the inductive scheme via the use of van der Corput operations.

4.1. The van der Corput lemma. The standard tool used in reducing the complexity of polynomial families of iterates is van der Corput's lemma (also known as "van der Corput's trick"). We will use the following variation of it, the proof of which can be found in [6, Lemma 2.2]:

Lemma 4.1 (van der Corput lemma). Let (a(n; h1, . . . , hs))(n;h1,...,hs)(ZL)s+1 be a bounded sequence by 1 in a Hilbert space H.19 Then, for   N0,

Eh1,...,hsZL

sup
(IN )NN

lim
N 

EnIN a(n; h1, . . . , hs) 2

Følner seq.

 4 Eh1,...,hs,hs+1ZL

sup
(IN )NN

lim
N 

|EnIN

a(n + hs+1; h1, . . . , hs), a(n; h1, . . . , hs) | .

Følner seq.

We also provide two applications of Lemma 4.1 for later use. The first one is to get an upper
bound for single averages with polynomial iterates and a polynomial exponential weight. Let exp(x) := e2ix and recall Definition 3.13 for the polynomial KP .

Lemma 4.2. Let P : ZL  R and p : ZL  Zd be polynomials. Let X = (X, B, µ, (Tg)gZd) be a Zd-system and f  L(µ) be a function bounded by 1. For all K  N0 and  > 0, there
exists a universal constant CK, > 0 such that

sup
(IN )NN

lim
N 

EnIN exp(P (n))Tp(n)f

2 2

Følner seq.

 CK, Eh=(h1,...,hK )(ZL)K

sup
(IN )NN

lim
N 

EnIN exp(K P (n, h))TK p(n,h)f


.
2

Følner seq.

Proof. When K = 0, there is nothing to prove. We now assume that the relation holds for

some K  N0 and we show it for K + 1. Using Lemma 4.1 and the T -invariance of µ, we get

Eh=(h1,...,hK )(ZL)K

sup
(IN )NN

lim
N 

EnIN exp(K P (n, h))TK p(n,h)f

2 2

Følner seq.

 4 Eh=(h1,...,hK+1)(ZL)K+1

sup
(IN )NN

lim
N 

EnIN

Følner seq.


exp(K+1P (n, h))TK+1p(n,h)f · f dµ
X

 4 Eh=(h1,...,hK+1)(ZL)K+1

sup
(IN )NN

lim
N 

EnIN exp(K+1P (n, h))TK+1p(n,h)f


,
2

Følner seq.

18PET is an abbreviation for "Polynomial Exhaustion Technique." 19We use this unorthodox notation to separate the variable n from the hi's. The variable n plays a different, compared to the hi's, role in our study.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

17

hence the result (the constant that appears depends only on  and K).

The second application of Lemma 4.1 provides an upper bound for single averages, with linear iterates and an exponential weight evaluated at a linear polynomial, on a product system. The proof is inspired by [6, Lemma 5.2] and [17, Proposition 2.9].

Lemma 4.3. Let (X, B, µ) be a probability space, k, L  N and Ti,j, 1  i  k, 1  j  L
be commuting measure preserving transformations on X. Denote Sj = T1,j × · · · × Tk,j for
all 1  j  L. Let Gi be the group generated by Ti,1, . . . , Ti,L. Then for any polynomial P : ZL  R of degree 1 and f1, . . . , fk  L(µ) bounded by 1, we have that

(15)

sup
(IN )NN

lim
N 

EnIN exp(P (n))Rnf

L2(µk)  2 1miink|||fi|||G×i 2 ,

Følner seq.

where, f = f1  · · ·  fk and for n = (n1, . . . , nL), Rn := S1n1 · . . . · SLnL.

Proof. Fix 1  i  k and let P (n) = a · n + b for some a  RL, b  R. Then, by Lemma 4.1, the 4th power of the left hand side of (15) is bounded by

16 · EhZL

sup
(IN )NN

lim
N 

Følner seq.

2
EnIN exp(P (n + h) - P (n))Rn+hf · Rnf dµk
X

= 16 · EhZL

sup
(IN )NN

lim
N 

Følner seq.

2
EnIN exp(a · h)Rhf · f dµk
X

2

= 16 · EhZL

Rhf · f dµk
X

 16 · Eh=(h1,...,hL)ZL

 16 · Eh=(h1,...,hL)ZL

2
E(Sihifi · f i|I(Gi)) dµ
X

2

= 16 · EhiZ

E(Sihifi · f i|I(Gi)) dµ
X

= 16|||fi|||4G×i 2 ,

2
Sihi fi · f i dµ
X

from where the result follows.

4.2. The van der Corput operation. To review the PET induction scheme, we will follow, and slightly modify, the approach from [6]. To this end, we extend the definitions that we have already given on the polynomial families of interest (see the beginning of Subsection 2.1), taking into account that we treat the first L-tuple of variables of the polynomials differently.
Definition 4.4. For a polynomial p(n; h1, . . . , hs) : (ZL)s+1  Z, we denote with deg(p) the degree of p with respect to n (for example, for s = 1, L = 2, the degree of p(n1, n2; h1,1, h1,2) = h1,1h1,2n21 + h51,1n2, is 2).
For a polynomial p(n; h1, . . . , hs) = (p1(n; h1, . . . , hs), . . . , pd(n; h1, . . . , hs)) : (ZL)s+1  Zd, we let deg(p) = max1id deg(pi) and we say that p is non-constant if deg(p) > 0 (i.e., some pi is a non-constant function of n). The polynomials q1, . . . , qk : (ZL)s+1  Zd are called

18 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

essentially distinct if they are non-constant and qi - qj is non-constant for all i = j. Finally, for a tuple q = (q1, . . . , qk), we let deg(q) = max1ik deg(qi).20
Let (X, B, µ, (Tg)gZd ) be a Zd-system, q1, . . . , qk : (ZL)s+1  Zd be polynomials and g1, . . . , gk : X ×(ZL)s  R be functions such that each gm(·; h1, . . . , hs) is an L(µ) function bounded by 1 for all h1, . . . , hs  ZL, 1  m  k. If q = (q1, . . . , qk) and g = (g1, . . . , gk), we say that A = (L, s, k, g, q) is a PET-tuple, and for   N0 we set

k



S(A,  ) := Eh1,...,hsZL

sup lim
(IN )NN N  Følner seq.

EnIN

Tqm(n;h1,...,hs)gm(x; h1, . . . , hs)

m=1

.
2

We define deg(A) = deg(q), and say that A is non-degenerate if q is a family of essentially
distinct polynomials (for convenience, q will be called non-degenerate as well). For 1  m  k, the tuple A is m-standard for f  L(µ) if deg(A) = deg(qm) and gm(x; h1, . . . , hs) = f (x) for every x, h1, . . . , hs. That is, f is the m-th function in g, only depending on the first variable, and the polynomial qm that acts on f is of the highest degree.21 The tuple A will be called semi-standard for f if there exists 1  m  k such that gm(x; h1, . . . , hs) = f (x) for every x, h1, . . . , hs. In this case we do not require the function f to have a specific position in g nor that the polynomial acting on f to be of the highest degree.

For each non-degenerate PET-tuple A = (L, s, k, g, q) and polynomial q : (ZL)s+1  Zd, we define the vdC-operation, qA, according to the following three steps:22
Step 1: For all 1  m  k, let gm = gm +k = gm, and q1, . . . , q2k : (ZL)s+2  Zd be the polynomials defined as

qm (n; h1, . . . , hs+1) =

qm(n + hs+1; h1, . . . , hs) - q(n; h1, . . . , hs) qm-k(n; h1, . . . , hs) - q(n; h1, . . . , hs)

,1  m  k , k + 1  m  2k

,

i.e., we subtract the polynomial q from the first k polynomials after we have shifted by hs+1 the first L variables, and for the second k ones we subtract q.23 Denote q = (q1, . . . , q2k).
Step 2: We remove from q1(n; h1, . . . , hs+1), . . . , q2k(n; h1, . . . , hs+1) the polynomials which are constant and the corresponding terms with these as iterates (this will be justified via the use of the Cauchy-Schwarz inequality and the fact that the functions gm are bounded), and then put the non-constant ones in groups Ji = {q~i,1, . . . , q~i,ti }, 1  i  k for some k, ti  N such that two polynomials are essentially distinct if and only if they belong to different groups.24 Next, we write q~i,j(n; h1, . . . , hs+1) = q~i,1(n; h1, . . . , hs+1) + p~i,j(h1, . . . , hs+1) for some polynomial p~i,j for all 1  j  ti, 1  i  k. For convenience, we also relabel g1, . . . , g2k accordingly as g~i,j for all 1  j  ti, 1  i  k.

20For clarity, we use non-bold letters for vectors (of polynomials) and bold letters for vectors of vectors (of polynomials).
21Here, we say m-standard for f to highlight the function of interest as, after running the vdC-operation, the position of the functions in the expression we deal with changes.
22Actually, the vdC-operation can be defined for any PET-tuple, not just for non-degenerate ones. Similarly, being a procedure that reduces complexity, PET induction can be applied to any family of polynomials. As the expressions of interest in this paper correspond to non-degenerate tuples, we consider only this case.
23In practice, this q will be one of the qi's of minimum degree. 24After removing the constant polynomials, the terms from A that are grouped are of degree 1.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

19

Step 3: For all 1  i  k, let qi = q~i,1 and

ti
gi(x; h1, . . . , hs+1) = g~i,1(x; h1, . . . , hs+1) Tp~i,j(h1,...,hs+1)g~i,j(x; h1, . . . , hs+1).
j=2

We (L,

set s+

1q, k=, g(,qq1 ,)...25.

,

qk ), g = (g1 , It follows from

..., the

gk  ) and we construction

denote the that qA is

new PET-tuple non-degenerate.

by

q A

:=

If q = qt for some 1  t  , we write tq instead of q to highlight the fact that we have

subtracted the polynomial qt; we also write tA instead of qtA to lighten the notation. We say that the operation A  tA is 1-inherited if q1 = q1 and g1 = f1, i.e., if we did not
drop q1 or group it with any other qi in Step 2.

Example 7. Let p = (p1, p2) with p1, p2 : Z  Zd be polynomials given by pi(n) = bi,2n2 + bi,1n for some bi,1, bi,2  Zd for 1  i  2 with b1,2, b2,2, b1,2 - b2,2 = 0 (hence, we have that
L = s = 1 and k = 2). Subtracting p2 in the Step 1 of the vdC operation, we have that 2p = (q1, q2, q3), is a tuple of 3 polynomials, q1, q2, q3 : Z2  Zd, given by

q1(n, h1) = (b1,2 - b2,2)n2 + 2b1,2nh1 + (b1,1 - b2,1)n + b1,1h1 + b1,2h21, q2(n, h1) = 2b2,2nh1 + b2,1h1 + b2,2h21, q3(n, h1) = (b1,2 - b2,2)n2 + (b1,1 - b2,1)n,

where we removed 1 essentially constant polynomial in Step 2 of the vdC operation.26 Actually, after using a series of vdC-operations, one can convert p into a PET-tuple of linear polynomials.
Indeed, if we run the vdC-operation once more by subtracting q2 in the Step 1 of the vdC operation, we have that 22p = (q1 , . . . , q4 ) is a tuple of 4 polynomials, q1 , . . . , q4 : Z3  Zd, given by

q1 (n, h1, h2) = (b1,2 - b2,2)n2 + 2(b1,2 - b2,2)nh1 + 2(b1,2 - b2,2)nh2 + (b1,1 - b2,1)n + r1 (h1, h2), q2 (n, h1, h2) = (b1,2 - b2,2)n2 - 2b2,2nh1 + 2(b1,2 - b2,2)nh2 + (b1,1 - b2,1)n + r2 (h1, h2), q3 (n, h1, h2) = (b1,2 - b2,2)n2 + 2(b1,2 - b2,2)nh1 + (b1,1 - b2,1)n + r3 (h1, h2), q4 (n, h1, h2) = (b1,2 - b2,2)n2 - 2b2,2nh1 + (b1,1 - b2,1)n + r4 (h1, h2),

where ri : Z2  Zd, 1  i  4, are polynomials in h1, h2, and we removed 2 essentially constant polynomials (i.e. q2(n, h1) - q2(n, h1) and q2(n + h2, h1) - q2(n, h1)) in Step 2 of the vdC operation.

25Here we abuse the notation by writing qA to denote any such tuple, obtained from Step 1 to 3. Strictly
speaking, qA is not uniquely defined as the order of the grouping of q1 , . . . , q2 k in Step 2 is ambiguous. However, this is done without loss of generality, since the order does not affect the value of S(qA, ·).
26Here we use qi's instead of pi's in the first step to ease the notation of Example 9 that is given in the next section.

20 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN
Finally, if we apply vdC-operation again by subtracting q4 in Step 1 of the vdC operation, we have that 422p = (q1, . . . , q7) is a tuple of 7 polynomials, q1, . . . , q7 : Z4  Zd, given by
q1(n, h1, h2, h3) = 2b1,2nh1 + 2(b1,2 - b2,2)nh2 + 2(b1,2 - b2,2)nh3 + r1(h1, h2, h3), q2(n, h1, h2, h3) = 2(b1,2 - b2,2)nh2 + 2(b1,2 - b2,2)nh3 + r2(h1, h2, h3), q3(n, h1, h2, h3) = 2b1,2nh1 + 2(b1,2 - b2,2)nh3 + r3(h1, h2, h3), q4(n, h1, h2, h3) = 2(b1,2 - b2,2)nh3 + r4(h1, h2, h3), q5(n, h1, h2, h3) = 2b1,2nh1 + 2(b1,2 - b2,2)nh2 + r5(h1, h2, h3), q6(n, h1, h2, h3) = 2(b1,2 - b2,2)nh2 + r6(h1, h2, h3), q7(n, h1, h2, h3) = 2b1,2nh1 + r7(h1, h2, h3),
where ri : Z3  Zd, 1  i  7, are polynomials in h1, h2, h3, and we removed 1 essentially constant polynomial in the Step 2 of the vdC operation. It is clear that deg(422p) = 1.
The vdC-operation provides us with a non-degenerate tuple, the value S(·, ·) of which satisfies the following:
Proposition 4.5 (Proposition 4.1, [6]). Let (X, B, µ, (Tg)gZd ) be a Zd-system, A = (L, s, k, g, q) a PET-tuple, and q : (ZL)s+1  Zd a polynomial. Then qA is non-degenerate and S(A, 2 )  4 S(qA,  ) for every   N0.
The following crucial result (cf. [6, Theorem 4.2]) shows that when we start with a PETtuple which is 1-standard for a function, then, after finitely many vdC-operations, we arrive at a new PET-tuple of degree 1 which is still 1-standard for the same function, so we can then use some Host-Kra seminorm to bound the lim sup of the average of interest.
Theorem 4.6. Let (X, B, µ, (Tg)gZd ) be a Zd-system and f  L(µ). Let A = (L, s, k, g, q) be a non-degenerate PET-tuple which is 1-standard for g1. Then, there exist 1, . . . , t  N, for some t  N0, such that for all 1  t  t, t . . . 1A is a non-degenerate PET-tuple which is still 1-standard for g1, and that t-1 . . . 1 A  t . . . 1 A is 1-inherited. Moreover, deg(t . . . 1 A) = 1.27
If A is an m-standard for the function f PET-tuple then, by rearranging the terms if necessary, one can get a new tuple A which is 1-standard for f with S(A,  ) = S(A,  ). However, if A is semi-standard but not standard for f , then the PET-induction does not work well enough to provide an upper bound for S(A,  ) in terms of some Host-Kra seminorm of f . To overcome this difficulty one follows [6]. More specifically, using [6, Proposition 6.3], which is a "dimension-increment" argument, A can be transformed into a new PET-tuple which is 1-standard for f (at the cost of increasing the dimension from L to 2L which is harmless for our approach). So, following this procedure, for any fixed function f, we may assume without loss of generality that the corresponding polynomial iterate p is of maximum degree, making the PET-tuple, after potential rearrangement of the terms, 1-standard for f . A combination of the previous results will allow us to obtain the required upper bound for each function.
27In [6, Theorem 4.2] the PET tuple is not required to be 1-standard nor 1-inherited; this comes at no extra cost as the polynomials chosen at each step to run the vdC-operation are of minimum degree.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

21

5. Finding a characteristic factor
This lengthy section is dedicated in proving Theorem 2.5. To this end, we need to show two intermediate results, i.e., Propositions 5.2 and 5.3, which improve two technical results from [6], namely [6, Proposition 5.6], and [6, Proposition 5.5] respectively.
Recall that for a subset A of Qd, G(A) = spanQ{a  A}  Zd.
Convention 5.1. For the rest of the paper, for every u = (u1, . . . , uL)  (Qd)L, we denote G(u) := G({u1, . . . , uL}).

The first result, which enhances [6, Proposition 5.6], gives a bound for the average of interest by finite step seminorms (recall Convention 3.3 for notions on Host-Kra seminorms). To pass from infinite step seminorms to finite step ones, we use the implications of Propositions 3.6 and 3.8.

Proposition 5.2 (Bounding averaged Host-Kra seminorms by a single one). Let s, s, t  N and cm : (ZL)s  (Zd)L, 1  m  t, be polynomials with cm  0 given by

(16)

cm(h1, . . . , hs) =

ha11 . . . hass · um(a1, . . . , as)

a1,...,asNL0 ,|a1|+···+|as|s

for some

um(a1, . . . , as) = (um,1(a1, . . . , as), . . . , um,L(a1, . . . , as))  (Qd)L.

Denote Hm := G({um,i(a1, . . . , as) : a1, . . . , as  NL0 , 1  i  L}).
There exists D  N0 depending only on s, s, L such that for every Zd-system (X, B, µ, (Tg)gZd) and every f  L(µ),

(17)

Eh1,...,hsZL |||f |||{G(cm(h1,...,hs))}1mt = 0 if |||f |||H1×D,...,Ht×D = 0.

We start by explaining the idea behind Proposition 5.2 with an example:

Example 8. Let p1, p2 : Z  Z2 be polynomials given by p1(n) = (n2 + n, 0) and p2(n) = (0, n2), and (X, B, µ, (Tg)gZ2 ) be a Z2-system. Consider the following expression:

sup
(IN )NN

lim
N 

EnIN Tp1(n)f1 · Tp2(n)f2

.
2

Følner seq.

Put e1 = (1, 0), e2 = (0, 1) and e = (1, -1). Using [6, Proposition 5.5], we get

(18)

sup
(IN )NN

lim
N 

EnIN Tp1(n)f1 · Tp2(n)f2

2  C · EhZ3 |||f1|||G(c1(h)),...,G(c7(h)),

Følner seq.

22 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

where C is a universal constant, and

c1(h1, h2, h3) = -2h1e1, c2(h1, h2, h3) = 2h2e, c3(h1, h2, h3) = -2h1e1 + 2h2e, c4(h1, h2, h3) = 2h3e, c5(h1, h2, h3) = -2h1e1 + 2h3e, c6(h1, h2, h3) = 2(h2 + h3)e, c7(h1, h2, h3) = -2h1e1 + 2(h2 + h3)e.

Using [6, Proposition 5.6], one can show that if |||f1|||e×1 D,e×D = 0 for all D  N, then the right hand side of (18) is 0. In this paper, we strengthen this result by only assuming that |||f1|||e×1 D,e×D = 0 for some D  N.
Indeed, using Proposition 3.8 (for I = [-N, N ]3, letting N  ) and Corollary 3.7, we have that the right hand side of (18) is 0 if

Eh,h Z3

E(f |Z{G(ci(h),cj (h))}1i,j7 )

2 = 0.28
2

On the other hand, for "almost all" h, h  Z3, the group G(ci(h), cj (h)) equals Ze1 if i = j = 1, Ze if i, j  {2, 4, 6} and Z2 otherwise. So, Z{G(ci(h),cj(h))}1i,j7 is contained in Ze1,e×9,(Z2)×39 , which is contained in Ze×1 25,e×25 by Proposition 3.1. Hence, the right hand side of (18) is 0 if |||f1|||e×1 25,e×25 = 0.

We now prove the general case.

Proof of Proposition 5.2. We may assume without loss of generality that f L(µ)  1. For convenience, denote h := (h1, . . . , hs). Using Proposition 3.8, and Corollary 3.7 for I = [-N, N ]sL, and then letting N  , we have that

(19)

2t W

2

EhZsL |||f |||{G(cm(h))}1mt

 Eh1,...,hW ZsL E(f |Z{G(cm1 (h1),...,cmW (hW ))}1m1 ,...,mW t ) 2

for all W = 2w, w  N0. Let w be the smallest integer such that 2w  t(s + 1)sL and  the set of (h1, . . . , hW )  (ZsL)W such that for every 1  m1, . . . , mW  t, the group G(cm1 (h1), . . . , cmW (hW )) contains at least one of H1, . . . , Ht. By Proposition 3.1, for every (h1, . . . , hW )  , Z{G(cm1 (h1),...,cmW (hW ))}1m1,...,mW t is a factor of ZH1×D,...,Ht×D for D := sW , and thus E(f |Z{G(cm1 (h1),...,cmW (hW ))}1m1,...,mW t ) = 0 since |||f |||H1×D,...,Ht×D = 0. So, by (19), it suffices to show that  is of upper density 1. Let h~ := (h1, . . . , hW )  (ZsL)W and 1  m1, . . . , mW  t. By the pigeonhole principle, at least (s + 1)sL many of the m1, . . . , mW take the same value. Assume that mi1 = · · · = miW = m, where W   (s + 1)sL is the

28Strictly speaking, Proposition 3.8 only implies that the right hand side of (18) is 0 if

Eh,h Z3

E(f |Z{G(ci (h))+G(cj (h))}1i,j7 )

2 2

= 0. However, since G(ci(h)) + G(cj(h)) is a finite index sub-

group of G(ci(h), cj(h)), we can use Lemma 3.9 (iv) and replace it by the latter as a seminorm subindex.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

23

number of a1, . . . , as  NL0 with |a1| + · · · + |as|  s. Note that W  depends only on s, s and L. Write hi := (hi,1, . . . , hi,s)  ZsL and consider the W  × W  matrix
Ai1,...,iW  (h~) := (haij1,1 . . . haijs,s)a1,...,asNL0 ,|a1|+···+|as|s,1jW  .
If det(Ai1,...,iW (h~)) = 0, then by the definition of cm(h), we have that
G(cm1 (h1), . . . , cmW (hW ))  G(cm(hi1 ), . . . , cm(hiW ))  Hm.
In conclusion, h~   if for all 1  i1 < · · · < iW   W , det(Ai1,...,iW (h~)) = 0. Thus, it suffices to show that for all 1  i1 < · · · < iW   W , the set of h~  (ZsL)W
with det(Ai1,...,iW (h~)) = 0 is of density 0. We may assume without loss of generality that i1 = 1, . . . , iW  = W . Note that det(A1,...,W (h~)) is a polynomial in hi,j , 1  i  W , 1  j  s. Looking at the term h1(s,1,0,...,0)h(2s,2,0,...,0) . . . hW (s,0,,W...,0), we see that det(A1,...,W  (h~)) is a non-constant polynomial. Therefore, the set of solutions to det(A1,...,W (h~)) = 0 is of 0 density by Lemma 3.11, completing the argument.

The second statement, which strengthens [6, Proposition 5.5], is the following (check Definition 2.1 for the various notions appearing in the statement):

Proposition 5.3 (Bounding the average by averaged Host-Kra seminorms). Let d, k, L  N,

p = (p1, . . . , pk), p1, . . . , pk : ZL  Zd a family of essentially distinct polynomials of degrees at

most K, with pi(n) = depending only on d, k,

Kv,LN,L029,|va|nKd

bi,vnv for some bi,v  Qd. There exist polynomials ci,m : (ZL)s  (Zd)L, 1 

s, s, t1, . i  k, 1

.. 

, tk  N m  ti,

with ci,m  0, such that the following hold:

(i) (Control of the coefficients) Each ci,m is of the form

ci,m(h1, . . . , hs) =

ha11 . . . hass · vi,m(a1, . . . , as)

a1,...,asNL0 ,|a1|+···+|as|s

for some vi,m(a1, . . . , as) = (vi,m,1(a1, . . . , as), . . . , vi,m,L(a1, . . . , as))  (Qd)L, which is a polynomial function in terms of the coefficients of pi, 1  i  k, and whose degree depends only on d, k, K, L.
In addition, denoting

Hi,m := G({vi,m,j (a1, . . . , as) : a1, . . . , as  NL0 , 1  j  L}),

we have that Hi,m contains one of Gi,j(p), 0  j  k, j = i. (ii) (Control of the average) For every Zd-system (X, B, µ, (Tg)gZd) and every f1, . . . ,
fk  L(µ) bounded by 1, we have that

(20)

k

2t0

sup
(IN )NN

lim
N 

EnIN

Tpi(n)fi

i=1

2



C

·

min
1ik

Eh1,...,hsZL |||fi|||(G(ci,m(h1,...,hs)))1mti

,

Følner seq.

29The fact that s, s depend only on d, k, K, L was not stated in [6, Proposition 5.1], but it can be derived from its proof.

24 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

where t0 and C > 0 are constants depending only on p.30

Proposition 5.3 improves on [6, Proposition 5.5] as the description of the subgroup Hi,m is much more precise than that of the set Ui,r(a1, . . . , as) defined in the latter. The rest of this section is devoted to proving Proposition 5.3, which is the most technical result of this paper.

Next we introduce some convenient notation. Let q = (q1, . . . , q) be a tuple of polynomials qi : (ZL)s+1  Zd, 1  i  , where

qi(n; h1, . . . , hs) =

ha11 . . . hass nb · ui(b; a1, . . . , as)

b,a1 ,...,as NL0

for some ui(b; a1, . . . , as)  Qd, 1  i  . Then, by writing

u(b; a1, . . . , as) := (u1(b; a1, . . . , as), . . . , u(b; a1, . . . , as))  (Qd),

we can express q as

q(n; h1, . . . , hs) =

ha11 . . . hass nb · u(b; a1, . . . , as).

b,a1 ,...,as NL0

We call u(b; a1, . . . , ad) the data of q at level (b; a1, . . . , ad), or simply the level data of q.

For the rest of the section, p = (p1, . . . , pk) denotes a family of essentially distinct polynomials p1, . . . , pk : ZL  Zd of degrees at most K, with pi(n) = vNL0 ,|v|K bi,vnv, where bi,v  Qd.

One sees that the left hand side of (20) is S(A, 1), where A is the PET-tuple (L, 0, k, p,
(f1, . . . , fk)). To prove Proposition 5.3, we first need to perform a series of vdC-operations to convert A into a PET-tuple t . . . 1A of degree 1, and then compare the coefficients of the polynomials in A with those in t . . . 1A. Even though the coefficients in the latter are very difficult to compute directly, one can keep track of the connection between them and those of
the original polynomial family p. This was first achieved in [6] by introducing an equivalence
relation pertaining to the vdC-operation (see [6, Section 5.3] for details). In this paper, we
introduce another approach which is more intricate than the one used in [6], but that achieves a better tracking of the coefficients, which in turn gives us a stronger upper bound for the
multiple averages.

Recalling that bw,v, 1  w  k, v  NL0 are the coefficients that arise from the family p (we also put b0,v := 0  Qd for all v  NL0 ), for r  Q, v  NL0 and 0  i  k, we set
Qr,i,v := {r(bw,v - bi,v) : 1  w  k}.

Definition 5.4 (Types and symbols of level data). For all b, a1, . . . , as, v  NL0 , r  Q, and 0  i  k, we say that u(b; a1, . . . , as) is of type (r, i, v) if

u1(b; a1, . . . , as), . . . , u(b; a1, . . . , as)  Qr,i,v, and u1(b; a1, . . . , as) = r(b1,v - bi,v).

We say that u(b; a1, . . . , as) is non-trivial if at least one of um(b; a1, . . . , as) is nonzero.

30Actually both t0 and C depend on d, k, L and the highest degree of p1, . . . , pk. More specifically, t0 can be chosen to be the max{t1, . . . , tk}, where ti is the number of vdC-operations that we have to perform in order for the PET tuple to be non-degenerate, 1-standard for fi and with degree equal to 1.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

25

Let u(b; a1, . . . , as) be of type (r, i, v). Suppose that (u1(b; a1, . . . , as), . . . , u(b; a1, . . . , as)) = (r(bw1,v - bi,v), . . . , r(bw,v - bi,v)),
for some 0  w1, . . . , w  k. We call w := (w1, . . . , w) a symbol of u(b; a1, . . . , as).

Note that the definition of type and symbol depend on the prefixed polynomial family p and that we always have w1 = 1.
We use the types and symbols of level data to track the coefficients of PET-tuples. We start with an example to illustrate this concept:

Example 9. Let p = (p1, p2) be defined as in Example 7 and let q = 2p = (q1, q2, q3) (recall that by this we mean the polynomial iterates we get after running the vdC-operation, subtracting the second polynomial, p2). In this case,
u(0; 1) = (b1,1, b2,1, 0) is of type (1, 0, 1) and has symbol (1, 2, 0),
u(0; 2) = (b1,2, b2,2, 0) is of type (1, 0, 2) and has symbol (1, 2, 0),
u(1; 0) = (b1,1 - b2,1, 0, b1,1 - b2,1) is of type (1, 2, 1) and has symbol (1, 2, 1),
u(1; 1) = (2b1,2, 2b2,2, 0) is of type (2, 0, 2) and has symbol (1, 2, 0),
u(2; 0) = (b1,2 - b2,2, 0, b1,2 - b2,2) is of type (1, 2, 2) and has symbol (1, 2, 1).

Definition 5.5. Let S denote the set of all (a, a)  NL0 such that a and a are both 0 or both different than 0. Let q be a polynomial family of degree at least 1. We say that q satisfies

(P1)­(P4) if its level data u satisfy:

(P1) For all a1, . . . , as, b, there exist r, i, v such that u(b; a1, . . . , as) is of type (r, i, v).

(P2) Suppose that u(b; a1, . . . , as) is of type (r, i, v), then r = · · · + as (in particular, r = 0).31

b+a1 +···+as a1 ,...,as

and v = b + a1 +

(P3) Suppose that u(b; a1, . . . , as) is of type (r, i, v) and u(b; a1, . . . , as) is of type (r, i, v).

If (a1, a1), . . . , (as, as)  S, then i = i and u(b; a1, . . . , as), u(b; a1, . . . , as) share a symbol w.

(P4) For every symbol (w1, . . . , w) of some u(b; a1, . . . , as), we have that w1 = 1.

Once again, properties (P1)­(P4) are taken with respect to the prefixed polynomial family p. It is obvious that p itself satisfies (P1)­(P4). An important feature of the type and symbol of a level data is that properties (P1)­(P4) are preserved under vdC-operations.

Example 10. We will verify that the polynomial family q = 2p in Example 9 satisfies all

of (P1)­(P4). Indeed, (P1) holds as all u(0; 1), u(0; 2), u(1; 0), u(1; 1), u(2; 0) have a type.

For all 0  a, b  2, a + b  2, if u(b; a) is of type (r, i, v), then it is not hard to see that

r=

b+a a

,

so

(P2)

holds.

(P3)

can

be

verified

by

comparing

the

types

and

symbols

of

the

pairs

(u(0, 1), u(0, 2)) and (u(1, 0), u(2, 0)). Finally, (P4) also holds since the first entry of every

symbol in q is 1.

We caution the reader that the symbol and type may not be unique if the coefficients bi,v satisfy some algebraic relations. For example, in Example 9, if b1,1 = b2,1, then both (1, 2, 0) and (1, 1, 0) are symbols of u(0; 1) = (b1,1, b2,1, 0). However the following result says that there is always a way to choose symbols and types so that properties (P1)­(P4) are preserved under
vdC-operations:

31For vi = (vi,1, . . . , vi,L)  NL0 , 1  i  s, we denote

v1 +···+vs v1 ,...,vs-1

:=

. L (v1,j +···+vs,j )!
j=1 v1,j !...vs,j !

26 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

Proposition 5.6. Let A = (L, s, , g, q) be a non-degenerate PET-tuple and 1    .
Assume that A  A is 1-inherited. Suppose that there exists a choice of symbols and types for A which satisfy (P1)­(P4), then there is also a choice of symbols and types for A which satisfy (P1)­(P4).

Proof. Suppose that q = (q1, . . . , q). Denote q = (q1, . . . , q2), where for all 1  i  , qi(n; h1, . . . , hs+1) = qi(n + hs+1; h1, . . . , hs) - q(n; h1, . . . , hs)
and q+i(n; h1, . . . , hs+1) = qi(n; h1, . . . , hs) - q(n; h1, . . . , hs).
Assuming that

qi(n; h1, . . . , hs) =

ha11 . . . hass nb · ui(b; a1, . . . , as)

b,a1 ,...,as NL0

for all 1  i  , we may write q as

q(n; h1, . . . , hs) =

ha11 . . . hass nb · u(b; a1, . . . , as),

b,a1 ,...,as NL0

and define u(b; a1, . . . , as+1) in a similar way.

One can immediately check that

qi(n + hs+1; h1, . . . , hs) =

ha11 . . . has+s+11 nb ·

b + as+1 b

ui(b + as+1; a1, . . . , as).32

b,a1 ,...,as+1 NL0

Then

 ui(b; a1, . . . , as) - u(b; a1, . . . , as) (as+1 = 0)



(21)

ui (b; a1, . . . , as+1) = b + as+1 b

ui(b + as+1; a1, . . . , as)

(as+1 = 0)

and

(22)

ui+(b; a1, . . . , as+1) =

ui(b; a1, . . . , as) - u(b; a1, . . . , as) 0

(as+1 (as+1

= =

0) 0)

.

We first show that q satisfying (P1)­(P4) implies the same for q.
Fix a1, . . . , as+1. Since q satisfies (P1)­(P4), there exist 0  i  k and a symbol w such that for all b, there is v  NL0 and r  Q such that u(b + as+1; a1, . . . , as) is of type (r, i, v) and has symbol w = (1, w2, . . . , w).
We have that um(b; a1, . . . , as) = r(bwm,v - bi,v). By (21) and (22), it is not hard to see that u(b; a1, . . . , as, as+1) is



of type (r, w, v) and has symbol (w, w) (as+1 = 0)



(23)

of type (r

b + as+1 b

, i, v) and has symbol (w, i, . . . , i)

. (as+1 = 0)

So each u(b; a1, . . . , as, as+1) is of type (, , v) for some v (meaning that it is of type (r, i, v) for some r  Q and i  N) and thus q satisfies (P1).

32For a = (a1, . . . , aL), b = (b1, . . . , bL)  NL0 ,

a b

denotes the quantity

L m=1

am bm

.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

27

To check (P2) for q, suppose that u(b; a1, . . . , as+1) is of type (r, i, v). By (23), we have

that u(b + as+1; a1, . . . , as) is have the same for q as

of

type (r

b+as+1 b

-1, i, v)

for some

i.

Since

q

satisfies

(P2),

we

r=

b + as+1 b

(b + as+1) + a1 + · · · + as a1, . . . , as

=

b + a1 + · · · + as+1 a1, . . . , as+1

and

v = (b + as+1) + a1 + · · · + as = b + a1 + · · · + as+1.
To show (P3), let (a1, a1), . . . , (as+1, as+1)  S and suppose that u(b + as+1; a1, . . . , as) is of type (r, i, v) and u(b + as+1; a1, . . . , as) of type (r, i, v). Since q satisfies (P3), we have that i = i and that u(b + as+1; a1, . . . , as) and u(b + as+1; a1, . . . , as) can be made to have the same symbol w. Since , (as+1, as+1)  S, by (23) have that q satisfies (P3).
Finally, it is straightforward from (23) that Property (P4) is also heritable. Since the polynomials in A are obtained by removing some terms from the tuple q (but not removing the first one, since A  A is 1-inherited), the fact that q satisfies (P1)­(P4) implies that A also satisfies (P1)­(P4).

For the family of essentially distinct polynomials p = (p1, . . . , pk), Proposition 5.6 implies that ik . . . i1p satisfies (P1)­(P4) for all k, i1, . . . , ik  N. In the special case when ik . . . i1p is of degree 1, properties (P1)­(P4) provide us with some information on the seminorm we use to bound S(ik . . . i1A, 1). To be more precise, if (P1)­(P4) hold for some non-degenerate q, then there is some connection between the level data of q and the groups G1,0(p), G1,2(p), . . . , G1,k(p):
Proposition 5.7. Suppose that (P1)­(P4) hold for some non-degenerate q. Then for all 0  m  , m = 1, the group
H1,m(q) := G({u1(b; a1, . . . , as) - um(b; a1, . . . , as) : (b, a1, . . . , as)  (NL0 )s+1, b = 0})
contains at least one of the groups G1,j(p), 0  j  k, j = 1.
We remark that although Proposition 5.7 holds for all non-degenerate q, we will use it for the case deg(q) = 1. We first give an example to explain the idea behind it.
Example 11. Let p = (p1, p2) be as in Example 7. Then G1,0(p) = G(b1,2) and G1,2(p) = G(b1,2 - b2,2). Let u(b; a) be the level data of 2p. Then
u(1; 0) = (b1,1 - b2,1) · (1, 0, 1) is of type (1, 2, 1) and has symbol (1, 2, 1), u(1; 1) = 2b1,2 · (1, 0, 0) + 2b2,2 · (0, 1, 0) is of type (2, 0, 2) and has symbol (1, 2, 0), u(2; 0) = (b1,2 - b2,2) · (1, 0, 1) is of type (1, 2, 2) and has symbol (1, 2, 1).
Here we will not compute u(b; a) for b = 0 as it is irrelevant to our purposes. It is easy to see that H1,0(2p) = G(b1,1 - b2,1, b1,2, b1,2 - b2,2)  G1,0(p)  G1,2(p), H1,2(2p) = G(b1,1 - b2,1, b1,2 - b2,2)  G1,2(p), H1,3(2p) = G(b1,2) = G1,0(p). So, Proposition 5.7 holds for 2p.

28 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN
Let u(b; a1, a2) denote the level data of 22p. Then u(1; 0, 0) = (b1,1 - b2,1) · (1, 1, 1, 1) is of type (1, 2, 1) and has symbol (1, 1, 1, 1), u(1; 1, 0) = 2(b1,2 - b2,2) · (1, 0, 1, 0) - 2b2,2 · (0, 1, 0, 1) has type (2, 2, 2) and sym. (1, 0, 1, 0), u(1; 0, 1) = 2(b1,2 - b2,2) · (1, 1, 0, 0) is of type (2, 2, 2) and has symbol (1, 1, 2, 2), u(2; 0, 0) = (b1,2 - b2,2) · (1, 1, 1, 1) is of type (1, 2, 2) and has symbol (1, 1, 1, 1).
(We do not compute the types and symbols for u(b; a1, a2) for b = 0.) It is easy to see that H1,0(22p) = G(b1,1 - b2,1, b1,2 - b2,2)  G1,2(p), H1,2(22p) = G(b1,2) = G1,0(p), H1,3(22p) = G(b1,2 - b2,2)  G1,2(p), H1,4(22p) = G(b1,2, b1,2 - b2,2)  G1,0(p)  G1,2(p). So, Proposition 5.7 holds for 22p.
Finally, let u(b; a1, a2, a3) denote the level data of 422p. Then deg(422p) = 1 and u(1; 0, 0, 0) = (0, 0, 0, 0, 0, 0, 0) is trivial,
u(1; 1, 0, 0) = 2b1,2 · (1, 0, 1, 0, 1, 0, 1) is of type (2, 0, 2) and symbol (1, 0, 1, 0, 1, 0, 1), u(1; 0, 1, 0) = 2(b1,2 - b2,2) · (1, 1, 0, 0, 1, 1, 0) has type (2, 2, 2) and symbol (1, 1, 2, 2, 1, 1, 2), u(1; 0, 0, 1) = 2(b1,2 - b2,2) · (1, 1, 1, 1, 0, 0, 0) has type (2, 2, 2) and symbol (1, 1, 1, 1, 2, 2, 2).
(Once more, we do not compute the types and symbols for u(b; a1, a2, a3) for b = 0.) It is easy to see that H1,0(422p) = H1,4(422p) = H1,6(422p) = G(b1,2, b1,2 - b2,2)  G1,1(p), H1,2(422p) = G(b1,2) = G1,1(p), and H1,3(422p) = H1,5(422p) = H1,7(422p) = G(b1,2 - b2,2) = G1,2(p). So, Proposition 5.7 holds for 422p.
To briefly explain why Proposition 5.7 holds for Example 11, we explain, for convenience, why H1,0(q) contains either G1,0(p) or G1,2(p) for q = 2p, 22p and 422p. Let u(b; a1, . . . , as) be a level data of type (r, i, v) and symbol w, and u(b; a1, . . . , as) be a level data of type (r, i, v) and symbol w. We say that the level data u(b; a1, . . . , as) dominates (or strictly dominates) u(b; a1, . . . , as) if i = i, w = w and |v|  |v| (or |v| > |v| respectively). In Example 11, it is not hard to see that for all b  N, a1, a2  N0, if u(b; a1, a2) is not of type (, , 2), then there exist b  N, a1, a2  N0 such that u(b; a1, a2) strictly dominates u(b; a1, a2) (in this example, u(1; 0, 0) is strictly dominated by u(2; 0, 0)). Similar conclusions hold for u(b; a) and u(b; a1, a2, a3). In other words, the group H1,0(q) must contain the elements of a level data of type (, , 2), and thus it must contain one of G1,0(p) and G1,2(p).
We are now ready to prove Proposition 5.7. The main point is that given any nontrivial level data u(b; a1, . . . , as), we can find another one, u(b; a1, . . . , as), which dominates u(b; a1, . . . , as) and is of type (, , v) with |v| being as large as possible (in this step we need to exploit the properties (P1)­(P4)). After that, we use the information of the "top" level data u(b; a1, . . . , as) to conclude.
Proof of Proposition 5.7. We start with a claim. Recall that S denotes the set of all (a, a)  NL0 such that a and a are both 0 or both different than 0 (check Definition 2.1 for notation).
Claim. Let d, s  N and b, a1, . . . , as, v  NL0 . If |v|  |b + a1 + · · · + as|, then there exist b, a1, . . . , as  NL0 such that (a1, a1), . . . , (as, as)  S, |b|  |b| and b + a1 + · · · + as = v.
To show the claim, we may first assume that |v| = |b + a1 + · · · + as|. Indeed, write x = (x1, . . . , xL) for x = v, b, a1, . . . , as. If c := |v| - |b + a1 + · · · + as| > 0, then we write b = b + (c, 0, . . . , 0). Then |b| > |b| and |v| = |b + a1 + · · · + as|.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

29

It suffices to show that if |v - (b + a1 + · · · + as)| > 0, then there exist b, a1, . . . , as  NL0 such that (a1, a1), . . . , (as, as)  S, |b| = |b|, and |v - (b + a1 + · · · + as)| < |v - (b + a1 + · · · + as)|. Since |v| = |b + a1 + · · · + as|, |v - (b + a1 + · · · + as)| is at least 2, so, there exist 1  i, j  L, i = j such that the t-th coordinate of v - (b + a1 + · · · + as) is at least 1 for t = i and is at most -1 for t = j. We may assume without loss of generality that i = 1 and
j = 2. Then we have that v1  1, and one of b2, a1,2, . . . , as,2 is at least 1. If b2  1, then b = b + (1, -1, 0, . . . , 0)  NL0 , ai = ai, 1  i  s satisfy the requirement. If one of ai,2 is positive, then b = b, ai = ai + (1, -1, 0, . . . , 0)  NL0 , aj = aj, 1  j  s, j = i satisfy the requirement. This proves the claim.

Consider the group H1,m(q) for some 0  m  , m = 1. Since q is non-degenerate, there exist some b, a1, . . . , as  NL0 , |b|  1 such that u1(b; a1, . . . , as) - um(b; a1, . . . , as) = 0. By (P1), we may assume that u(b; a1, . . . , as) is of type (r, i, v) and has symbol (w1, . . . , w). Since w1 = 1,
u1(b; a1, . . . , as) - um(b; a1, . . . , as) = r(b1,v - bwm,v).
Recall that for p = (p1, . . . , pk), d1,0 = deg(p1) and d1,j = deg(p1 - pj) for 2  j  . Since u1(b; a1, . . . , as) - um(b; a1, . . . , as) = 0, we have that wm = 1 and |v| = |b + a1 + · · · + as|  d1,wm .
By the Claim, for all v  NL0 with |v| = d1,wm , there exist b, a1, . . . , as  NL0 such that (a1, a1), . . . , (as, as)  S, |b|  1 and b + a1 + · · · + as = v. By (P2) and (P3), u(b; a1, . . . , as) is of type (r, i, v), r = 0 and has symbol (w1, . . . , w) (i.e. u(b; a1, . . . , as) dominates u(b; a1, . . . , as)). So
u1(b; a1, . . . , as) - um(b; a1, . . . , as) = r(b1,v - bwm,v ).
In other words, for all v  NL with |v| = d1,wm, the group H1,m(q) contains a nonzero multiple of b1,v - bwm,v . So this group contains G1,wm (p) and we are done.
We are now ready to prove Proposition 5.3.

Proof of Proposition 5.3. Let A denote the PET-tuple (L, 0, k, (p1, . . . , pk), (f1, . . . , fk)). Then for all  > 0,

k



S(A,  ) =

sup lim
(IN )NN N  Følner seq.

EnIN

Tpm(n)fm

m=1

.
L2(µ)

By assumption, A is non-degenerate. We only prove (20) for f1 as the other cases are similar. We first assume that A is 1-standard for f1. By Theorem 4.6, there exist t  N0, depending only on d, k, K, L, and finitely many vdC-operations 1, . . . , t , 1, . . . , t = 1 such that for all 1  t  t, t . . . 1 A is non-degenerate and 1-standard for f1, and that t-1 . . . 1 A  t . . . 1A is 1-inherited. Moreover, A := t . . . 1 A is of degree 1. By Proposition 4.5, S(A, 2t)  C · S(A, 1) for some C > 0 that depends only on t. We may assume that



S(A, 1) = Eh1,...,hsZL

sup lim
(IN )NN N  Følner seq.

EnIN

Tdm(h1,...,hs)·n+rm(h1,...,hs)gm(x; h1, . . . , hs)

m=1

2

for some s,   N, functions g1, . . . , g : X × (ZL)s  R, where g1(·; h1, . . . , hs) = f1, such that each gm(·; h1, . . . , hs) is an L(µ) function bounded by 1, and polynomials dm : (ZL)s  (Zd)L

30 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

and rm : (ZL)s  Zd, 1  m  , where dm, rm take values vectors with integer coordinates as vdC-operations transform integer-valued polynomials to integer-valued polynomials.
Let c1 = -d1 and cm = dm - d1 for m = 1. Since A is non-degenerate, we have that c1, . . . , cs  0. By [6, Proposition 6.1], if   2, we also have that
S(A, 1)  C  · Eh1,...,hsZL |||Tr1(h1,...,hs)f1|||{G(ci(h1,...,hs))}1i
= C  · Eh1,...,hsZL |||f1|||{G(ci(h1,...,hs))}1i
for some C > 0 depending only on the polynomials p1, . . . , pk. If  = 1, using the mean ergodic theorem (see for example [6, Theorem 2.3]) and [6, Lemma 2.4 (iv), (vi)], we have

S(A, 1) = Eh1,...,hsZL E(Tr1(h1,...,hs)f1|I(c1(h1, . . . , hs))) 2 = Eh1,...,hsZL E(f1|I(c1(h1, . . . , hs))) 2

= Eh1,...,hsZL |||f1|||c1(h1,...,hs)

 Eh1,...,hsZL |||f1|||G(c1(h1,...,hs)),c1(h1,...,hs)

= Eh1,...,hsZL |||f1|||G(c1(h1,...,hs))×2 . Combining this with the fact that S(A, 2t)  C · S(A, 1), we get (20).33
We now consider the groups H1,m, 0  m  , m = 1. Suppose that

cm(h1, . . . , hs) =

ha11 . . . hass · vm(a1, . . . , as)

a1 ,...,as NL0

and

dm(h1, . . . , hs) =

ha11 . . . hass · um(a1, . . . , as)

a1 ,...,as NL0

for some vectors um(a1, . . . , as) = (um,1(a1, . . . , as), . . . , um,L(a1, . . . , as)), and vm(a1, . . . , as) = (vm,1(a1, . . . , as), . . . , vm,L(a1, . . . , as))  (Qd)L with all but finitely many terms being zero for each m. Obviously A satisfies (P1)­(P4). Since A = t . . . 1A, by Proposition 5.6, A satisfies (P1)­(P4). Since deg(A) = 1, by Proposition 5.7, each of

G({v1,j (a1, . . . , as) : (a1, . . . , as)  (NL0 )s, 1  j  L}) = G({u1,j (a1, . . . , as) : (a1, . . . , as)  (NL0 )s, 1  j  L}) = H1,0

and G({vm,j (a1, . . . , as) : (a1, . . . , as)  (NL0 )s})
= G({u1,j (a1, . . . , as) - um,j (a1, . . . , as) : (a1, . . . , as)  (NL0 )s}) = H1,m, 2  m  

contains some of the groups G1,j(p), 0  j  k, j = 1.

Next we assume that A is not 1-standard for f1. In this case, we need to invoke the "dimension increment" argument to convert A to be 1-standard for f1. We may assume without loss of generality that pk has the highest degree. Since A is semi-standard for f1, by [6, Proposition 6.3], there exists a PET-tuple A = (2L, 0, , p, g) which is non-degenerate and

33We are using [6, Proposition 6.1] for   2 (which is incorrectly stated for   1 in [6] but does not affect any other result in that work).

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

31

1-standard for f1 such that S(A, 2 )  S(A,  ) for all  > 0. Moreover, p is obtained by selecting some polynomials from the family
q := (p1(n) - pk(n), . . . , pk(n) - pk(n), p1(n) - pk(n), . . . , pk-1(n) - pk(n))
with 2L-dimensional variables (n, n), where p1(n) - pk(n) is selected in p and is associated to f1. It is not hard to compute that G1,j(q) = G1,j(p) for 0  j  k, j = 1. Moreover, for 1  j  k - 1, G1,k+j(q) = G1,0(p) + Gj,0(p)  G1,0(p) if d1,0 = dj,0, G1,k+j (q) = G1,0(p) = G1,j (q) if d1,0 > dj,0, and G1,k+j(q) = Gj,0(p) = G1,j (q) if d1,0 < dj,0. In other words, each G1,j(q) and thus each G1,j(p) contains some G1,j (p). Applying the previous conclusion to A, we are done.
Finally the fact that each vi,m(a1, . . . , as) is a polynomial function in terms of the coefficients of pi, 1  i  k whose degree depends only on d, k, K, L follows easily from the polynomial nature of the vdC-operations.

We now have all the ingredients needed to prove Theorem 2.5. In fact, Theorem 2.5 has a proof similar to that of [6, Theorem 5.1].

Proof of Theorem 2.5. By Propositions 5.3 and 5.2, and the definition of Host-Kra charac-
teristic factors, the left hand side of (10) is 0 if for some 1  i  k, fi is orthogonal to Z{Hi,m}×1Dmi ti (X) for some ti, Di  N, where Hi,m is defined as in Proposition 5.3. By Proposition 5.3, Hi,m is contained in one of Gi,j(p), 0  j  k, j = i. Using Proposition 3.1 (v), if some fi, 1  i  k, is orthogonal to Z{Gi,j(p)}×0Djitik,j=i (X), then it is also orthogonal to Z{Hi,m}×1Dmi ti (X), and thus the left hand side of (10) is 0.
The "in particular" part follows from Corollary 3.2.

Remark 5.8. We remark that the number D derived in Theorem 2.5 is not optimal. To see this, recall that this number indicates the step of the nilsequence in the splitting
results. For multicorrelation sequences with general polynomial iterates, this D can be taken to be equal to the number of vdC-operations we have to perform in order for all the iterates to become constant (e.g., [11] via [10], and [23] via [11]). At this point, a word of caution is necessary for the approach of this paper. Specifically, while the number D in Theorem 2.5 can still be chosen to be the number of transformations in the case of linear iterates (given that there is no dependence on h­the variable arising from the vdC-operations), in the general case the picture is quite different. By carefully tracking the constants that appear in Propositions 5.2 and 5.3, D can be chosen to be the maximum of tis[iti(si+1)siL]+1, 1  i  k, where si is the degree of p, ti is the number of terms remaining when p is converted to a linear family which is 1-standard? for fi for the first time, and si is ti plus the number of vdC-operations needed to convert p in such a way. (The details are left to the interested readers.)

6. Proof of Main results Using Theorem 2.5, we prove in this section Theorems 2.2, 2.3 and 2.4.
Proof of Theorem 2.2. We follow and adapt the proof strategy in [27, Section 3]. To avoid confusion we use ||| · ||| to denote the Host-Kra seminorm on the Zd-system (X, B, µ, (Tn)nZd)

32 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

and ||| · ||| to denote the Host-Kra seminorm on the Zd-system (X2, B2, µ2, (Sn)nZd ), where Sn = Tn × Tn. Let (IN ) be a Følner sequence in ZL. Then, by Theorem 2.5, we have

lim
N 

1 |IN

|

nIN

2
f0 · Tp1(n)f1 · . . . · Tpk(n)fk dµ
X

(24)

=

lim
N 

1 |IN

|

nIN

k

f0  f¯0 · Spi(n)(fi  f¯i) dµ × µ

X2

i=1

 |||fi  f¯i|||{Gi,j (p)}×0Djk,j=i

for all 1  i  k and some D  N, where Gi,j(p) is the group action generated by Sn for all n 

Gi,j (p).34

Using

Lemma

3.4,

the

right

hand

side

of

(24)

is

bounded

by

|||fi

|||2
{Gi,j

(p)}×0Djk,j=i

,Zd

,

which is equal to |||fi|||2(Zd)×(D+1) with D = kD by our ergodicity assumptions and Corollary 3.2.

Therefore, for 1  i  k we have

(25)

lim
N 

1 |IN

|

nIN

k
X2 f0  f¯0 · i=1 Spi(n)(fi  f¯i) dµ × µ  C|||fi|||2(Zd)×(D+1) .

The bound in (25) and Theorem 3.5 imply that the sequence

(26)

a(n) - f0 · Tp1(n)E(f1 | Z(Zd)×(D+1) (X)) · . . . · Tpk(n)E(fk | Z(Zd)×(D+1) (X)) dµ
X

is a null-sequence.

Let  > 0. The factor Z(Zd)×(D+1)(X), via Theorem 3.5, is an inverse limit of D-step nilsys-
tems. Thus, there exists a factor of Z(Zd)×(D+1)(X) with the structure of a D-step nilsystem (X~ , B(X~ ), µX~ , T1, . . . , Td), on which each Ti acts as a niltranslation by an element ai  X~ , such that for f~i = E(fi | X~ ), and a := (a1, . . . , ad), we have

k

k

f0 · Tpi(n)E(fi | Z(Zd)×(D+1) (X)) dµ -

X

i=1

X~

f~0

·

api(n)f~i
i=1

dµX~

<

for all n  ZL, where, if pi = (pi,1, . . . , pi,d), then api(n) denotes the niltranslation by the element (ap11,1(n), . . . , apd1,d(n)). Therefore, there exists a nullsequence  such that

(27)

a(n) -

X~ f~0 · ap1(n)f~1 · . . . · apk(n)f~k dµX~ + (n)

< .
 (ZL )

A standard approximation argument allows us to assume without loss of generality that f~1, . . . , f~k  C(X~ ) in (27). Applying [27, Theorem 2.5] to the nilmanifold X~ k, the diagonal subnilmanifold {(x, . . . , x) : x  X~ }, the polynomial sequence (ap1(n), . . . , apk(n)) and the function f (x1, . . . , xk) = f~1(x1) · . . . · f~k(xk)  C(X~ k), we obtain that the sequence

(n) := X~ f~0 · ap1(n)f~1 · . . . · apk(n)f~k dµX~

34Strictly speaking, Gi,j (p) and Gi,j (p) are the same subgroup of Zd. We distinguish these two notions to indicate that Gi,j (p) and Gi,j(p) are attached to the distinct group actions (Tn)nGi,j(p) and (Sn)nGi,j(p).

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

33

is a sum of a D-step nilsequence and a nullsequence. Therefore, for each  > 0 we can find a D-step nilsequence , a nullsequence  and a
bounded sequence  with  (ZL)   such that

(28)

a(n) = (n) + (n) + (n).

For each l  N, consider the decomposition a = l + l + l, where

l

(ZL) <

1 l

.

For r = l,

we have

(29)

|l(n) - r(n)| = |(l(n) - r(n)) + (l(n) - r(n))|.

Now,

lim|IN |

1 |IN |

nIN

|l(n) - r(n)|

=

0

and

supnZL |r(n) - l(n)|



1 l

+

1 r

.

Therefore,

(30)

|l(n)

-

r (n)|



1 l

+

1 r

for all n  ZL except potentially a subset A  ZL, with its characteristic function, ½A(n),
being a nullsequence. For each l, r  N, the sequence l(n) - r(n) is a nilsequence, so it follows that inequality (30) must, in fact, hold for all n  ZL. Hence, the sequence (l)lN is a Cauchy sequence in (ZL) that consists of D-step nilsequences, and since we already showed that (r)rN is a Cauchy sequence in (ZL) converging to a nullsequence, from where the conclusion follows.

Remark 6.1. It is worth noting that if the polynomials p1, . . . , pk are linear, then there is an easier proof of Theorem 2.2, where one has D = k. The reason is that, instead of Theorem
2.5, one can use [15, Proposition 1] or [6, Proposition 6.1] to improve the right hand side of (25) to |||fi|||2(Zd)×(k+1) .

Next, we provide the proof of Theorem 2.4 (the arguments are similar to those in the proof of [6, Theorem 1.3, Pages 26­27]).

Proof of Theorem 2.4. Using Property (i) and Theorem 2.5, we have that there exists D  N
such that the left hand side of (8) is 0 if one of fi's satisfies |||fi|||(Zd)×D = 0. Thus, it suffices to show (8) under the assumption that all fi's are measurable with respect to Z(Zd)×D . Using Theorem 3.5 and an approximation argument, we may assume without loss of generality that
X is a nilsystem. As a consequence of [26, Theorem B] (see also [6, Theorem 2.9]), Property
(ii) is equivalent to (8) on a nilsystem, which finishes the proof.

Finally, we prove Theorem 2.3. We start with proving that (C1) implies (C2). In fact, we show the following more general result:
Proposition 6.2. Let d, k, L  N, q1, . . . , qk : ZL  Zd be polynomials, and X = (X, B, µ, (Tg)gZd ) be a Zd-system. Suppose that (Tq1(n), . . . , Tqk(n))nZL is jointly ergodic for µ. Then for all 1  i, j  k, i = j, we have that (Tqi(n)-qj(n))nZL is ergodic for µ.
Furthermore, if there exist polynomials p1, . . . , pk : ZL  Z and v1, . . . , vk  Zd such that qi(n) = pi(n)vi for all 1  i  k, then (Tp1(n)v1 × · · · × Tpk(n)vk )nZL is ergodic for µk.
Proof. The sequence (Tqi(n)-qj(n))nZL is ergodic for µ for all 1  i = j  k by an argument similar to the one given in the proof of [6, Proposition 5.3], so, we choose to omit the details.

34 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

We now assume that qi(n) = pi(n)vi for all 1  i  k and show that (Tp1(n)v1 × · · · ×

Tpk(n)vk )nZL is ergodic for µk. It suffices to show that for all fi  L(µ), 1  i  k with

k i=1

X fi dµ = 0, we have that

(31)

sup lim
(IN )NN N  Følner seq.

k

EnIN

Tpi(n)vi fi

i=1

= 0.
L2(µk )

Claim. If E(fi|ZZd,Zd (X)) = 0 for some 1  i  k, then (31) holds. We may assume without loss of generality that deg(p1)  deg(p2)  · · ·  deg(pk). Suppose
that we have shown that for some 1  k0  k, (31) holds if E(fi|ZZd,Zd(X)) = 0 for some 1  i  k0 - 1, where the case k0 = 1 is understood to be always true. It suffices to show that (31) holds if E(fk0|ZZd,Zd(X)) = 0.
By the induction hypothesis, we may assume without loss of generality that fi is ZZd,Zd(X)measurable for all 1  i  k0 - 1. By [6, Lemma 2.7], we can approximate each fi in L2(µ) by an eigenfunction of X. By multi-linearity, we may assume without loss of generality that each
fi, 1  i  k0 - 1 is a non-constant eigenfunction of X given by Tnfi = exp(i(n))fi for all n  Zd and some group homomorphism i : Zd  R, and that fi(x) = 0 µ-a.e x  X. Then the left hand side of (31) is equal to

(32)

sup lim
(IN )NN N  Følner seq.

k0 -1

k

EnIN exp(P (n))

fi

Tpi(n)vi fi

i=1 i=k0

,
L2(µk )

where P (n) :=

k0-1 i=1

i(vi)pi(n).

Denote

P

(n)

=

deg(p1) j=0

Qj

(n),

where

Qj

is

a

homogeneous

polynomial of degree j for all 0  j  deg(p1). Then

deg(p1)

(33)

KP (n, h1, . . . , hK ) =

KQj(n, h1, . . . , hK ).

j=K

We first consider the case when Qj(n) / Q[n] + R for some deg(pk0) + 1  j  deg(p1). In this case, let K = deg(pk0) in (33). Since Kpi(n, h1, . . . , hK ) is constant in n for all k0  i  k, by Lemma 4.2, to show that (32) is 0, it suffices to show that

(34)

Eh1,...,hK ZL

sup
(IN )NN

lim
N 

|EnIN

exp(K P

(n,

h1,

.

.

.

,

hK ))|

=

0

Følner seq.

(see Definition 3.13 for the definition of the polynomial KP ).

As Qj(n) / Q[n] + R for some deg(pk0) + 1  j  deg(p1), Lemma 3.14 implies that KQj(·, h1, . . . , hK ) / Q[n] + R for a set of (h1, . . . , hK ) of density 1. By Weyl's criterion and

(33), we have that (34) holds and thus (31) holds.

We now consider the case when Qj(n)  Q[n] + R for all K + 1  j  deg(p1). Let P (n) =

K j=0

Qj

(n).

It

is

not

hard

to

see

that

there

exists

Q



N

such

that

for

all

r



{0, . . . , Q - 1}L

and n  ZL, we have that

P (Qn + r) - P (Qn + r) = P (r) - P (r).

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

35

By (32), to show (31), it suffices to show that for all r  {0, . . . , Q - 1}L, we have that

(35)

k

sup lim
(IN )NN N  Følner seq.

EnIN exp(P (Qn + r))

Tpi(Qn+r)vi fi

i=k0

= 0,
L2 (µt )

where t = k - k0 + 1. Fix r  {0, . . . , Q - 1}L and set R(n) = P (Qn + r). Let p : ZL  Zdt be the polynomial given by
p(n) = (pi(Qn + r)vi)k0ik. Let (Xt, Bt, µt, (Sg)gZdt ) be the Zdt-system such that

k

S(ui)k0ik :=

Tui

i=k0

for all ui  Zd, k0  i  k, and denote f :=

k i=k0

fi.

We

may

then

rewrite

the

left

hand

side

of (35) as

(36)

sup
(IN )NN

lim
N 

EnIN exp(R(n))Sp(n)f

L2 (µt ) .

Følner seq.

For K = deg(pk0) - 1, using Lemma 4.2, to show that (36) is zero, it suffices to show

(37)

Eh=(h1,...,hK )(ZL)K

sup
(IN )NN

lim
N 

EnIN exp(K R(n, h))SK p(n,h)f

L2(µt) = 0.

Følner seq.

By assumption, KR(n, h1, . . . , hK ) is of degree 1 in the variable n. Since deg(p) = deg(pk0)  deg(pi) for all i  k0, Kp(n, h1, . . . , hK ) is also of degree 1 in the variable n. We may thus assume that
K p(n, h1, . . . , hK ) = ((ci(h1, . . . , hK ) · n + ci(h1, . . . , hK ))vi)k0ik, for some polynomials ck0 , . . . , ck : ZLK  ZL and ck0 , . . . , ck : ZLK  Z. Write c(h1, . . . , hK ) := (ci(h1, . . . , hK )vi)k0ik (which is viewed as a t-tuple of L-tuple of vectors in Zd). If we write
ci(h1, . . . , hK ) = (ci,1(h1, . . . , hK ), . . . , ci,L(h1, . . . , hK ))
for some ci,j(h1, . . . , hK )  Z, then, by definition, G(c(h1, . . . , cK )) is the subgroup of Zdt generated by the elements

(ck0,j(h1, . . . , hK )vk0 , . . . , ck,j(h1, . . . , hK )vk), 1  j  L. By Lemma 4.3, the left hand side of (37) is bounded by a constant multiple of

(38)

(Eh1,...,hK ZL |||fk0 |||4G(ck0 (h1,...,cK )vk0 )×2 )1/4,

where G(ck0 (h1, . . . , cK )vk0) is the subgroup of Zd generated by the elements

ck0,1(h1, . . . , hK )vk0 , . . . , ck0,L(h1, . . . , hK )vk0 ,

i.e., the entries of ck0 (h1, . . . , hK )vk0 . For any uk0  G(ck0 (h1, . . . , hK )vk0 ), note that uk0 is a rational multiple of vk0 . So, if ck0 (h1, . . . , hK ) = 0, then G(ck0 (h1, . . . , hK )vk0 ) = G(vk0 ).

36 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

Since (Tpi(n)vi )nZL is ergodic for µ, we have that Tvi is ergodic for µ. As E(fk0|ZZd,Zd(X)) = 0, by [6, Lemma 2.4], we have that

|||fk0 |||G(ck0 (h1,...,cK)vk0 )×2 = |||fk0 |||vk×02 = |||fk0 |||(Zd)×2 = 0
whenever ck0(h1, . . . , hK ) = 0. Since K = deg(pk0) - 1 = deg(pk0(Q · +r)) - 1, it is easy to see that ck0  0. By [6, Lemma 2.12], the set of such (h1, . . . , hK ) is of density 1. So, averaging over all h1, . . . , hK  ZL, we have that (38) is 0. This finishes the proof of the claim.

Using the claim, it suffices to prove (31) under the assumption that all fi's are measurable with respect to Z(Zd)×2(X). By Lemma 2.7 of [6], we can approximate each fi in L2(µ) by an eigenfunction of X. By multi-linearity, we may assume without loss of generality that each fi is a non-constant eigenfunction of X given by Tnfi = exp(i(n))fi for all n  Zd for some group homomorphism i : Zd  R, and that fi(x) = 0 µ-a.e x  X. Then, since (Tpi(n)vi : 1  i  k)nZL is jointly ergodic for µ, for any Følner sequence (IN )NN of Zd,

k

k

0=
i=1

X

fidµ

=

lim
N 

EnIN

i=1

Tpi(n)vi fi

=

k

lim
N 

EnIN

exp(i(pi(n)vi))

i=1

k
fi.
i=1

This implies that limN EnIN

k i=1

exp(i(pi(n)vi))

=

0.

So,

k

lim
N 

EnIN

Tpi(n)vi fi =

i=1

k

lim
N 

EnIN

exp(i(pi(n)vi))

i=1

k
fi.
i=1

This finishes the proof.

We are now ready to complete the proof of Theorem 2.3.

Proof of Theorem 2.3. Using Proposition 6.2, we have that (C1) implies (C2). It is obvious
that (C2) implies (C2'). So, it suffices to show that (C2') implies (C1).
It is not hard to see that we may assume without loss of generality that pi(0) = 0 for all 1  i  k. By Theorem 2.4, to show that (Tpi(n)vi : 1  i  k)nZL is jointly ergodic for µ, it suffices to show that Gi,j(p) is ergodic for µ for all 0  i, j  k, i = j. Fix any such pair (i, j). We may assume without loss of generality that i = 0. If j = 0, then by (ii), (Tpi(n)vi )nZL is ergodic for µ. So Tvi is ergodic for µ, and thus Gi,0(p) = G(vi) is ergodic for µ. So, we may now assume that j = 0.
Assume first that deg(pi) = deg(pj). By assumption, either vi and vj are linearly dependent, or pi(n) and pj(n) are linearly dependent.
If vi and vj are linearly dependent over Z, then we may assume without loss of generality that vi = av and vj = bv for some a, b  Q and v  Zd. By (i), (T(api(n)-bpj(n))v)nZL is ergodic for µ, which implies that G(v) is ergodic for µ. On the other hand, Gi,j(p) is a group generated by some elements which are linear combinations of vi and vj, which are thus multiples of v. Since p is non-degenerate, Gi,j(p) is not the trivial group. It follows that Gi,j(p) = G(v), so the group Gi,j(p) is ergodic for µ.
If pi(n) and pj(n) are linearly dependent over Z, then we may assume without loss of generality that pi(n) = ap(n) and pj(n) = bp(n) for some a, b  Q and polynomial p. By (i), (T(p(n)(avi-bvj))nZL is ergodic for µ, which implies that G(avi - bvj ) is ergodic for µ. On the other hand, Gi,j(p) is a group generated by some elements which are multiples of

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

37

avi - bvj. Since p is non-degenerate, Gi,j(p) is not the trivial group. It follows that Gi,j(p) = G(avi - bvj), so the group Gi,j(p) is ergodic for µ.
Finally, we consider the case when deg(pi) = deg(pj). We may assume without loss of generality that deg(pi) > deg(pj). In this case, Gi,j(p) = Gi,0(p), which we have shown is ergodic for µ.

7. Potential future directions
We close this article with two potential future directions regarding the splitting of multicorrelation sequences. The first one is for integer polynomial iterates under no assumptions on the transformations other than commutativity (see Theorem 7.1 for a special case of two terms).
The second one pertains to potential results analogous to Theorem 2.2 for iterates of the form [pi(n)], 1  i  k, where pi = (pi,1, . . . , pi,d) : ZL  Rd are vectors of real valued polynomials.35

7.1. The two-term case with no ergodicity assumptions. Given the results in the appendix of [5], we are able to obtain the following splitting result for two commuting transformations without any ergodicity assumptions:

Theorem 7.1. Let (X, B, µ, T, S) be a measure preserving system with T S = ST . Let f0, f1, f2  L(µ) and p  Z[n] with degree K  2. Then, the multicorrelation sequence

a(n) := f0 · T nf1 · Sp(n)f2 dµ
X
can be decomposed as a sum of a uniform limit of K-step nilsequences plus a nullsequence.

Proof. Setting Fi = fi  f¯i, i = 0, 1, 2, and µ~ = µ × µ, we have that

(39)

1 N

N

|a(n)|2

=

1 N

N

n=1

n=1

F0 · (T × T )nF1 · (S × S)p(n)F2 dµ~.
X2

Using [5, Theorem A.3], we get that the rational Kronecker factor36 is characteristic for the
averages appearing in (39). Consequently, we may replace f1 by Pcf1 and f2 by Qcf2 in a(n) up to a nullsequence, where Pc denotes the orthogonal projection onto the compact component of the splitting associated to T , and Qc the one associated to S. (Here we make use of the Hilbert space splitting of L2(µ) into its compact and weakly mixing components for a given

unitary operator. The seeds for these results are already present in the work of Koopman and

von Neumann [21]. They were later generalized by Jacobs, Glicksberg and de Leeuw. See [7, Section 16.3] for a more modern treatment). Thus, the sequence

a(n) - f0 · T nPcf1 · Sp(n)Qcf2 dµ
X

35Here, for x = (x1, . . . , xL)  RL, we write [x] := ([x1], . . . , [xL]), where [·] is the floor function. In fact, one can consider any combination of rounding functions, i.e., floor, ceiling, or closest integer.
36The rational Kronecker factor is the smallest sub--algebra of B that makes all functions with finite orbit in L2(µ) under the transformation T measurable.

38 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

is a nullsequence. Let  > 0 and choose h1, . . . , hk, g1, . . . , gk  L2(µ) such that T hi = ihi and Sgi = igi (for some 1, . . . , k, 1, . . . , k  C of absolute value one) as well as a1, . . . , ak, b1, . . . , bk  C such that

k

k

f0 · T nPcf1 · Sp(n)Qcf2 dµ - f0 · T n aihi · Sp(n) bjgj dµ < .

X

X

i=1

j=1

Observe that

k

k

f0 · T n aihi · Sp(n) bigi dµ =

X

i=1

j=1

k

k

f0 ·

aini hi ·

bjpj(n)gj dµ

X

i=1

j=1

k

=

aibj f0 · hi · gj dµ ni pj(n),

i,j=1

X

which is a K-step nilsequence. Applying the same argument as in the proof Theorem 2.2 we deduce the decomposition result. The rest of the details are omitted for the sake of brevity.

It is natural to ask whether a result analogous to Theorem 7.1 holds for longer expressions (potentially via a generalization of the results in the appendix of [5]), and with more general polynomial iterates, even without necessarily assuming they have distinct degrees. Thus, we state the following problem:

Problem 1. Obtain decomposition results of the form "uniform limit of nilsequences plus a nullsequence" for multicorrelation sequences with (integer) polynomial iterates for general systems under no ergodicity assumptions on the transformations.

7.2. Integer part polynomial iterates. With a, by now, standard argument (introduced in [4] and [29] for a single term, extended for two terms in [34], and further developed in [22], [23] and [25]) one has, for the vectors of real polynomials pi = (pi,1, . . . , pi,d), that the expression

(40)

1 |IN |

nIN

k
T[pi(n)]fi
i=1

=

1 |IN |

nIN

kd
Tj[pi,j (n)] fi
i=1 j=1

is "close" to

(41)

1 |IN

|

nIN

k i=1

d j=1

Sjpi,j (n)gi,

where Sj's are R-flows on an "extension system" Y of X, and the functions gi's are extensions of the fi's (see [23] for details).37 As an application of Theorem 2.2, one can prove splitting theorems for Rd-actions on the extension system.

37We say that a jointly measurable family (St)tRd of measure preserving transformations on a probability space, is an Rd-action (flow ), if it satisfies St+r = St  Sr for all t, r  Rd.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

39

Indeed,38 consider the multicorrelation sequence

(42)

f0 · Sp1(n)f1 · . . . · Spk(n)fk dµ,
X

where S is a measure preserving Rd-action on the probability space (X, B, µ), f0, f1, . . . , fk 

L(X), and p1, . . . , pk : Z  Rd a non-degenerate family of polynomials of degree at most K

with pi(n) =

K h=0

ai,hnh,

ai,h

 Rd.

Then

Spi(n) = S

K

= K
h=0

ai,h

nh

(Sai,h )nh .

h=0

Note that Sai,h, 1  i  k, 1  h  K generate a ZkK-action on (X, B, µ). For convenience, set p0 to be the constant zero polynomial. For 0  i, j  k, i = j, let Di,j be the largest integer h such that Sai,Di,j -aj,Di,j = id. This transformation will be denoted by Ri,j. By Theorem 2.2, one can show that the desired splitting result for the sequence (42), if all the transformations
Ri,j, 0  i, j  k, i = j are all ergodic (as Z-actions on the extension system Y ). Unfortunately, even though we have the previous result for flows, the error term that arises
from the approximation of (40) by (41) prevents us from getting the conclusion of Theorem 2.2
for multicorrelation sequences of the form

f0 · T[p1(n)]f1 · . . . · T[pk(n)]fk dµ.39
X

Remark 7.2. It is important to stress that, for integer part real polynomial iterates, one does
not expect to have the desired multicorrelation splitting in general. The next example shows
that, even for k = 1, an ergodic system, and linear iterates, it can be too much to hope for: Indeed, following [25, Example 7], let X = T := R/Z, T (x) = x + 1/ 2, p(n) = 2n,
f0(x) = e(x) and f1(x) = e(-x), where e(x) := e2ix. Then, we have that

f0 · T [p(n)]f1 dµ =

e(x)e

-x - 1

 [ 2n]

dx = e

- 1

 [ 2n]

=e

1

 { 2n}

,

2

2

2

which cannot be written as a uniform limit of nilsequences and a nullsequence.

Remark

7.3.

One

may

think

that

the

fact

that

 2

and

1 2

are

not

linearly

independent

over Q is behind the impossibility of the splitting in the example above. However, a closer

examination of the proof given in [25] shows that this is not the case, and that the failure

extends quite generally.

Indeed, we can imitate the example quoted above as follows. Let (X, B, µ, T ) be an ergodic

measure preserving system with non-trivial irrational spectrum. Let f1 : X  S1 be an

38We address the L = 1 case for simplicity; following the same argument one can similarly get the corresponding result for the general case of L-variable polynomials by using an ordering on the parameters, e.g.,
n1 > . . . > nL. 39To this day, only splittings of the form nilsequence plus an error term that is small in uniform density are
known for this class of multicorrelation sequences (for this, see [23]. One is referred to [25] for averages along primes for the error term­in this last reference only single variable real polynomials were considered. Using the multivariable approach of [12] instead of [11], one immediately gets the aforementioned result for integer part, or indeed for combinations of any other rounding functions of multivariable real polynomial iterates).

40 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN

eigenfunction of T with eigenvalue e2i, with   R \ Q. Put f0 = f¯1. Then, if we consider the multicorrelation sequence

a(n) := f0 · T [n]f1 dµ,
X
with the choices made above, we observe that, in fact, a(n) = e2i[n]. The same argument as in [25, Example 7] shows that a(n) cannot be written as a uniform limit of nilsequences plus a nullsequence.

On the other hand, if we postulate very strong assumptions on our transformations, we do
have the desired decomposition results. For example (see [23]), if T1, . . . , Tk are commuting weakly mixing transformations on (X, B, µ), qi(n) = pi(n)ei, 1  i  k, where pi : Z  R are real polynomials of distinct, positive degrees, and f1, . . . , fk  L(µ), then we have that

lim
N -M 

N

1 -M

N -1
T[q1(n)]f1 · . . . · T[qk(n)]fk

=

k

n=M

i=1

fi dµ.
X

Hence, for any f0  L(µ), the multicorrelation sequence

f0 · T[q1(n)]f1 · . . . · T[qk(n)]fk dµ
X
can be written as a sum of a constant (i.e., a 0-step nilsequence) and a nullsequence.
We conclude this article with the following problem that arises naturally:
Problem 2. Let d, k, K, L  N, p1, . . . , pk : ZL  Rd be a non-degenerate family of polynomials of degree at most K, (X, B, µ, T1, . . . , Td) a measure preserving system and f0, . . . , fk  L(µ). Find conditions, on the pi's and/or the Zd-action T that is defined by the Ti's, so that the multicorrelation sequence

f0 · T[p1(n)]f1 · . . . · T[pk(n)]fk dµ
X
can be decomposed as a sum of a uniform limit of D-step nilsequences and a nullsequence.

References
[1] D. Berend and V. Bergelson. Jointly ergodic measure-preserving transformations. Israel J. Math. 49 (1984), no. 4, 307­314.
[2] V. Bergelson. Weakly mixing PET. Ergodic Theory Dynam. Systems 7 (1987), no. 3, 337­349. [3] V. Bergelson, B. Host and B. Kra, with an appendix by I. Ruzsa. Multiple recurrence and nilsequences,
Invent. Math. 160 (2005), no. 2, 261­303. [4] M. Boshernitzan, R. L. Jones and M. Wierdl. Integer and fractional parts of good averaging sequences
in ergodic theory. Convergence in Ergodic Theory and Probability, Eds: V. Bergelson, P. March, J. Rosenblatt, by Walter de Gruyter & Co., Berlin, New York 1996, 117­132. [5] Q. Chu, N. Frantzikinakis and B. Host. Ergodic averages of commuting transformations with distinct degree polynomial iterates. Proc. Lond. Math. Soc. (3) 102 (2011), no. 5, 801­842. [6] S. Donoso, A. Koutsogiannis and W. Sun. Seminorms for multiple averages along polynomials and applications to joint ergodicity. To appear in J. d'Analyse Mathématique. [7] T. Eisner, B. Farkas, M. Haase and R. Nagel. Operator theoretic aspects of ergodic theory, Graduate Texts in Mathematics, 272, Springer, Cham, 2015. [8] A. F. Moragues, Properties of multicorrelation sequences and large returns under some ergodicity assumptions, Discrete Contin. Dyn. Syst. 41 (2021), no. 6, 2809­2828.

DECOMPOSITION OF MULTICORRELATION SEQUENCES AND JOINT ERGODICITY

41

[9] N. Frantzikinakis. Joint ergodicity of sequences. Preprint 2021, arXiv:2102.09967. [10] N. Frantzikinakis, B. Host and B. Kra. The polynomial multidimensional Szemerédi theorem along
shifted primes. Israel J. Math. 194 (2013), no. 1, 331­348. [11] N. Frantzikinakis. Multiple correlation sequences and nilsequences. Invent. Math. 202 (2015), no. 2,
875­892. [12] N. Frantzikinakis and B. Host. Weighted multiple ergodic averages and correlation sequences, Ergodic
Theory Dynam. Systems 38 (2018), no. 1, 81­142. [13] N. Frantzikinakis and B. Kra. Polynomial averages converge to the product of integrals. Israel J. Math.
148 (2005), 267­276. [14] H. Furstenberg. Ergodic behavior of diagonal measures and a theorem of Szemerédi on arithmetic
progressions. J. d'Analyse Mathématique 31 (1977), 204­256. [15] B. Host. Ergodic seminorms for commuting transformations and applications. Studia Math. 195 (2009),
no. 1, 31­49. [16] B. Host and B. Kra. Nonconventional ergodic averages and nilmanifolds. Ann. of Math. (2) 161 (2005),
no. 1, 397­488. [17] B. Host and B. Kra. Uniformity seminorms on  and applications, J. Anal. Math. 108 (2009), 219­276. [18] M. C. R. Johnson. Convergence of polynomial ergodic averages of several variables for some commuting
transformations. Illinois J. Math. 53 (2009), no. 3, 865­882 (2010). [19] D. Karageorgos and A. Koutsogiannis. Integer part independent polynomial averages and applications
along primes.Studia Mathematica 249 (2019), no. 3, 233­257. [20] A. Khintchine. The Method of Spectral Reduction in Classical Dynamics. Proceedings of the National
Academy of Sciences May 1933, 19 (5) 567-573. [21] B. O. Koopman and J. von Neumann. Dynamical Systems of Continuous Spectra. Proceedings of the
National Academy of Sciences Mar 1932, 18 (3) 255-263. [22] A. Koutsogiannis. Closest integer polynomial multiple recurrence along shifted primes. Ergodic Theory
Dynam. Systems 38 (2018), no. 2, 666­685. [23] A. Koutsogiannis. Integer part polynomial correlation sequences. Ergodic Theory Dynam. Systems 38
(2018), no. 4, 1525­1542. [24] A. Koutsogiannis. Multiple ergodic averages for variable polynomials. Preprint 2021, arXiv:2101.00534. [25] A. Koutsogiannis, A. Le, J. Moreira and F. K. Richter. Structure of multicorrelation sequences with
integer part polynomial iterates along the primes. Proceedings of the A. M. S. 149 (2021), No 1, 209­216. [26] A. Leibman. Convergence of multiple ergodic averages along polynomials of several variables. Israel J.
Math. 146 (2005), 303­315. [27] A. Leibman. Multiple polynomial correlation sequences and nilsequences. Ergodic Theory Dynam. Sys-
tems 30 (2010), no. 3, 841­854. [28] A. Leibman. Nilsequences, null-sequences, and multiple correlation sequences. Ergodic Theory Dynam.
Systems 35 (2015), no. 1, 176­191. [29] E. Lesigne. On the sequence of integer parts of a good sequence for the ergodic theorem. Comment.
Math. Univ. Carolin. 36 (1995), no. 4, 737­743. [30] W. Sun. Weak ergodic averages over dilated curves. Ergodic Theory Dynam. Systems 41 (2021), No 2,
606­621. [31] T. Tao and J. Teräväinen. The structure of logarithmically averaged correlations of multiplicative func-
tions, with applications to the Chowla and Elliott conjectures. Duke Math. J., 168 (2019), No 11, 1977­2027. [32] T. Tao and T. Ziegler. Concatenation Theorems for anti-Gowers-uniform functions and Host-Kra characteristic factors. Discrete Anal. 2016, Paper No. 13. [33] M. Walsh. Norm convergence of nilpotent ergodic averages. Ann. of Math. (2) 175 (2012), no. 3, 1667­ 1688. [34] M. Wierdl. Personal communication with the third author (2015). [35] T. Ziegler. Nilfactors of Rm-actions and configurations in sets of positive upper density in Rm. J. d'Analyse Mathématique 99 (2006), 249­266.

42 SEBASTIÁN DONOSO, ANDREU FERRÉ MORAGUES, ANDREAS KOUTSOGIANNIS AND WENBO SUN
(Sebastián Donoso) Departamento de Ingeniería Matemática and Centro de Modelamiento Matemático, Universidad de Chile & IRL 2807 - CNRS, Beauchef 851, Santiago, Chile.
Email address: sdonoso@dim.uchile.cl
(Andreu Ferré Moragues) Department of mathematics, The Ohio State University, 231 West 18th Avenue, Columbus, OH 43210-1174, USA
Email address: ferremoragues.1@osu.edu
(Andreas Koutsogiannis) Department of mathematics, The Ohio State University, 231 West 18th Avenue, Columbus, OH 43210-1174, USA
Email address: koutsogiannis.1@osu.edu
(Wenbo Sun) Department of Mathematics, Virginia Tech, 902 Prices Fork RD, Blacksburg, VA, 24061, USA
Email address: swenbo@vt.edu

