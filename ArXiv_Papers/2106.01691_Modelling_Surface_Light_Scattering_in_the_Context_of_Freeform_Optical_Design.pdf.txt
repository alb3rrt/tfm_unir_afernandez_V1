arXiv:2106.01691v1 [physics.optics] 3 Jun 2021

Modelling Surface Light Scattering in the Context of Freeform Optical Design
Vì C.E. Kronberg,1,* Martijn J.H. Anthonissen,1 Jan H.M. ten Thije Boonkkamp,1 and Wilbert L. IJzerman1,2
1Deparment of Mathematics and Computer Science, Eindhoven University of Technology, PO Box 513, 5600 MB Eindhoven, The Netherlands 2Signify Research, High Tech Campus 7, 5656 AE Eindhoven, The Netherlands *s.kronberg@tue.nl https://www.win.tue.nl/~martijna/Optics/
Keywords: Surface scattering · Reflector design · Illumination optics PACS: 02.30.Z · 42.15.-i · z42.25.Fx · 42.79.Fm | AMS: 78A05 · 78A45 · 78A46
Abstract: We present a novel approach of modelling surface light scattering in the context of freeform optical design. The model relies on energy conservation and optimal transport theory. For isotropic scattering in cylindrically or rotationally symmetric systems with in-plane scattering, the scattered light distribution can be expressed as a convolution between a scattering function, which characterises the optical properties of the surface, and a specular light distribution. Deconvolving this expression allows for traditional specular reflector design procedures to be used, whilst accounting for scattering.

1 Introduction

1

1. Introduction
The engineering field of optical design is often restricted to working within the confines of the so-called geometrical optics (GO) approximation, where light propagation is modelled using light rays -- lines collinear with the Poynting vector. Within the GO approximation, phenomena such as diffraction and interference are typically not accounted for [1, p. 159]. The absence of such phenomena in the design procedure of an optical element can result in discrepancies between the raytraced distributions and the ones measured using the actual component. Additionally, it places restrictions on what kind of optical systems one can design, as scattering cannot be utilised or accounted for in the design process.
There are a myriad of approaches one could consider to include scattering. The most drastic, but in some ways most natural, approach is that of solving Maxwell's equations. This would constitute a substantial departure in terms of strategy, and would in theory work for most realistic systems, but it is often impractical due to the enormous complexity of the task. As such, a multitude of approximations based on Maxwell's equations have been formulated which are applicable to problems within several regimes of parameter values, such as surface roughness or incident angle. Some highlights include the rigorous vector perturbation theory published by Lord Rayleigh in 1907 [2], and later expanded by Rice (1951) [3], and the rather different Kirchhoff approach, based on random phase variations due to microtopographic surface features, most commonly attributed to Beckmann and Spizzichino (1963) [4]. These approaches are valid in different regimes. In particular, Rayleigh-Rice vector perturbation theory agrees well with experimental measurements of wide-angle scattering (up to approximately 50 of the polar angle of detector/source) for scattering from optically smooth surfaces. Here, "optically smooth" refers to the root mean square (RMS) surface roughness s divided by the wavelength  being much less than unity, i.e., s/ 1 [5, p. 49]. The Beckmann-Kirchhoff theory, on the other hand, is valid for rougher surfaces, but due to a moderate-angle assumption as part of its derivation, it is not suitable for use with wide scattering angles and/or large angles of incidence.
There have been numerous developments since these early theories were formulated. Here, we highlight the work of Church, who published numerous papers during the 1970s on RayleighRice theory in the context of surface scattering from optically smooth surfaces [6]. According to Harvey, his contributions were instrumental in shaping the applied optics community at the time [5, p. 50]. The last work from this era we want to highlight is that of Harvey and Shack from 1976, where they developed a linear systems formulation of surface scattering based on a surface transfer function [7]. This approach allows for the use of the Fourier transform of the surface transfer function to compute a scattered radiance function "closely related to the bidirectional reflectance distribution function (BRDF)" [5, p. 50]. This was later extended to the generalised Harvey-Shack surface scattering theory, which is able to treat arbitrarily rough surfaces with arbitrary incident and scattering angles [8].
Rather than solving Maxwell's equations, with or without approximations, one could alter the GO rays in some manner such that they can be used to compute scattering phenomena. One example of such an approach, that still still retains many of the computational benefits of GO, is to modify the GO rays such that they carry information regarding the phase of the light, which can form the basis of diffraction calculations. A good overview of this approach can be found in McNamara [9]. Whilst computationally efficient, such an approach would still require substantial modifications to contemporary reflector design procedures.
In our approach, we remain in the domain of traditional GO, and as an alternative to carrying phase information, we propose a surface scattering model inspired by optimal transport theory [10], which leads to a convolution integral for cylindrically and rotationally symmetric problems with isotropic in-plane scattering. This convolution integral yields the scattered light distribution, given a scattering function and a specular target distribution, where the former characterises the optical properties of the surface. This is a forward problem, but it can also

2 Cylindrically Symmetric Problems

2

be cast in terms of an inverse problem -- given a desired target distribution and a scattering function, one may perform deconvolution to find an appropriate intermediate specular target distribution, which can in turn be used to design the optical element using traditional specular design methods. In contrast to the phase-carrying rays formulation, the specular reflector design procedures do not need to be modified, as the effect of scattering can be considered a pre-processing step. In this paper, we utilise Maes's work on specular reflector design, and in particular the two-dimensional procedure applicable to cylindrically and rotationally symmetric problems outlined in [11, Ch. 3]. For three-dimensional freeform specular optical design, there have been several recent developments [12­20]. The advantage of our approach is that we may separate the scattering calculations from the reflector design step, allowing us to greatly benefit from the maturity of specular reflector design procedures, whilst still accounting for scattering.
The structure of the paper is as follows. Cylindrically symmetric problems with in-plane scattering are covered first, together with a few words about deconvolution in Sec. 2, followed by rotationally symmetric problems with in-plane scattering in Sec. 3. Next, two-dimensional specular reflector design is briefly discussed in Sec. 4, followed by some results in the form of reflectors and ray traced distributions for validation of both the cylindrically and rotationally symmetric systems in Sec. 5. Finally, conclusions with some proposals for expansions of the model are presented in Sec. 6.
2. Cylindrically Symmetric Problems

y

y

r() = u()e^r

^t

^t u^

n^

n^ 

^s

P

^s

P





x

x

O



O



Figure 1: Specular reflector.

Figure 2: Diffuse reflector.

Starting with cylindrically symmetric problems, consider the situation depicted in Fig. 1. This specular problem can be viewed as a cross-section of a translationally invariant problem, such as an extruded optical element, with a line-source along the suppressed z-axis. For such a system, the specular problem may be analysed in two-dimensions [11, Ch. 3]. Thus, the intensities and reflector surfaces are independent of z and we may study a cross-section in the plane of incidence, which is spanned by the source and reflected rays, and which contains the unit normal. The reflector is parametrised by r() = u()e^r, where u()  R+,   [1, 2] is at least twice continuously differentiable and e^r = cos(), sin() is the radial unit vector in polar coordinates. The angle  is measured counter clockwise from the positive x-axis, and it fully characterises the source ray along ^s = ^er, emitted form the line source at the origin O. The hat (^) indicates unit vectors throughout this paper. The source ray along ^s intersects the reflector at some point P, where the unit normal of the reflector is given by n^. We take the convention

2.1 Mappings

3

^s · n^ < 0, i.e., the normal is chosen directed towards the light source. From the specular law of reflection (LoR), we get an expression for the reflected direction ^t = cos(), sin() , i.e.,

^t = ^s - 2(^s · n^)n^,

(1)

where we have denoted the angle between the positive x-axis and ^t by . To introduce scattering, consider the situation depicted in Fig. 2. Inherent in this description
is that we have assumed the scattering is limited to the plane of incidence, such that we can again study a cross-section of the translationally invariant problem. Here, the source ray along ^s gets mapped to a scattered ray along u^ = cos(), sin() , where  is measured counter-clockwise from the positive x-axis. The scattered direction u^ can be described as a rotation of ^t by a stochastic parameter  around the axis parallel to the z-axis passing through P, i.e.,

u^ = R()^t,

R() =

cos() sin()

-sin() cos()

.

(2)

The stochastic parameter  is related to the scattering characteristics of the surface. We note that  depends on , both in the sense that it will almost certainly have a different stochastic value for a given  -- in fact, since  is sampled from a probability distribution, it has multiple values for all , and in the sense that the probability distribution from which it is sampled may be different for different values of . We shall return to the meaning of this, both mathematically and physically, in Sec. 2.2. Finally, we also note that  can be negative, which is the case in Fig. 2.

2.1. Mappings
To formulate the above in terms of angles, let us introduce two mappings which give the reflected and scattered directions, i.e.,

m() =  and s(; ) = ,

(3)

where the former is the law of reflection, and the latter represents the scattering. This might seem superfluous, but it will simplify the discussion later, especially in the general three-dimensional case, which we intend to treat in a future publication. In addition to these maps, we require their inverses to exist,

m-1() =  and s-1(; ) = .

(4)

Additionally, we define a mapping yielding , for fixed  and , i.e.,

a(, ) = .

(5)

For a schematic summary, see Fig. 3.

2.2 Energy Balances

4

Reflection

Scattering

^s

LoR

^t

R()

u^



m()



s(; )



a(, )



Figure 3: Relations between the unit vectors and angles.

In total, the maps are

m() =  + arccos 1 - 2 ^s · n^ 2  ,

m-1() =  - arccos 1 - 2 ^s · n^ 2  ,

s(; ) =  +   ,

(6)

s-1(; ) =  -   ,

a(, ) =  -   ,

where the first two relations follow from cos( - ) = ^s ·^t, see Fig. 1, and the LoR, Eq. (1). The existence of inverse mappings is not a priori guaranteed for all situations, but we shall restrict our attention to problems where they do exist.

2.2. Energy Balances

Having presented the mappings for the angles, we are now ready to formulate the energy balances. To start, fix the angles

· 1, 2  (-, ), 1 < 2,

· 1, 2  (-, ), 1 < 2,

· 1, 2  (-, ), 1 < 2,

and introduce the intensity distributions (illuminance) [lm/rad]:

· source intensity distribution f ()  R+,   [1, 2], · intermediate specular intensity distribution g()  R+,   [1, 2], · diffuse target intensity distribution h()  R+,   [1, 2].

In the design procedure outlined in Sec. 4, the source and diffuse target distributions, f and h, are given, and the intermediate specular intensity distribution g is computed, and used in the design of the reflector. Assuming no light is lost along the way from source to target, we may formulate the global energy balances as

2

2

2

f () d = g() d = h() d.

(7)

1

1

1

2.2 Energy Balances

5

Consider next the relationship between  and  for a fixed  = . Suppose we have a perfect specular reflector (i.e., a mirror). Then,  always vanishes, such that    and for fixed  = , we simply get a fixed  = . This is depicted schematically in Fig. 4. Consider now the case where we have nonzero scattering, and indeed where the scattering may vary depending on the incident angle. This yields a situation like the one depicted schematically in Fig. 5. Here, fixing  =  and tracking where all the light emerges, we see that it falls within the interval [1, 2]  [1, 2].





2 
1

  Figure 4: Specular map   .

  Figure 5: Diffuse map   .

Motivated by the more fundamental concept of optimal transport theory, and in particular Monge-Kantorovich problems [10, Ch. 1], let us introduce the density (, )  R+,  
[1, 2],   [1, 2], with the properties

2
(, ) d = g(),

(8a)

1 2
(, ) d = h().

(8b)

1

There are several natural requirements on , including positivity and a compact support. In Fig. 5, its support may be considered the shading, where darker values represent a higher density, and the support is clearly a function of the angles. Notice that the second energy balance in Eq. (7) is trivially fulfilled by direct substitution:

2

2 2

h() d = (, ) dd,

1

1 1

2

2 2

g() d = (, ) dd,

1

1 1

which are the same after a change of integration order.

(9a) (9b)

2.3 Integral Equation

6

Let us now attempt to find a suitable choice of (, ). In particular, consider

(, ) = p a(, );  g(),

(10)

where p is a function describing the redistribution of light, subject to an energy constraint we shall formulate momentarily. Physically, this choice can be motivated as follows. In the specular case, i.e., Fig. 4, p a(, );  = ( - ), where  represents the Dirac delta function, meaning the light will be scattered in exactly one direction   . When p is some other appropriate function, light in direction  is scattered over multiple angles and we have a situation similar to that in Fig. 5, i.e., this choice of  represents the physical properties of light scattering. Note, however, that p includes the parameter , which highlights the possibility of unique p functions for each specular ray, which is what is schematically shown in Fig. 5. We now insert this density in Eq. (8a) to get

2
p a(, );  d = 1.

(11)

1

Transforming the integration variable  to , recalling that  = s(; ) and a(, ) = , yields

2

p(; )

s(; ) 

d = 1,

1

1 = min a(, )   [1, 2],   [1, 2] ,

(12a) (12b)

2 = max a(, )   [1, 2],   [1, 2] .

(12c)

Note that with our choice s(; ) =  +  in Eq. (6), the Jacobian |s/| = 1, so that

2
p(; ) d = 1,
1

  [1, 2].

(13)

With one additional obvious requirement that p(; )  0, it is clear that with our choice of s(; ), p becomes a probability density function (PDF).

2.3. Integral Equation

Let us now focus on Eq. (8b). Substituting our choice of (, ) from Eq. (10) yields

2
h() = p a(, );  g() d.

(14)

1

We once again utilise a(, ) to change the integration variable from  to , together with  = s-1(; ), to get

2
h() = p ; s-1(; ) g s-1(; )
1

s-1(; ) 

d,

(15)

where 1 and 2 were defined in Eq. (12). Here, we note that this is a Fredholm integral equation for g, as p depends on both  (via  = s-1(; )) and . That is, p is a spatially
varying kernel function, h is the prescribed target and g is to be determined.

2.3 Integral Equation

7

In the case of isotropic scattering, the explicit -dependence in p is omitted, meaning we get p(a(, )), or simply p(). The  vs.  plot for such a situation is shown in Fig. 6. In contrast to Fig. 5, the support of  is now a band of constant width, and the data represent that of Example #2 in Sec. 5. Inserting a(, ) and s-1(; ) from Eq. (6) into Eqs. (14) and (15) yields

2
h() = p( - )g() d,

(16a)

1 2
h() = p()g( - ) d,

(16b)

1

which are convolution integrals. We shall use the common notation of h() = (p  g)() for the convolution in Eq. (16a). Due to the commutativity property of convolution integrals, an equivalent definition is h() = (g p)() in Eq. (16b) [21, p. 309]. Obtaining g is now a matter of deconvolving Eq. (16a) or (16b). There are a large number of different deconvolution methods, but not all are equally suitable for our purposes. In particular, g must be nonnegative. This can be achieved using an iterative ratio method, such as Gold's method, or the more common Richardson-Lucy method of deconvolution [22]. We shall return to this topic in Sec. 5.

2 1.5 1 0.5 0
Figure 6: Diffuse map    (isotropic scattering; example #2 in Sec. 5).

3 Rotationally Symmetric Reflectors

8

3. Rotationally Symmetric Reflectors

To introduce the rotationally symmetric three-dimensional

r(, ) = u() e^r

reflectors, consider Fig. 7. The situation is as follows.

A point-source is located at the origin O. The reflec-

tor is parametrised by r(, ) = u()e^r, where u() 

P

R+,   [1, 2] is at least twice continuously differen-

tiable and e^r = sin() cos(), sin() sin(), cos() is

the radial unit vector in spherical coordinates. The an-

gle   [0, ) is measured from the positive z-axis and the angle   (-, ) is measured from the positive xaxis. Consider now a ray in direction ^s emitted from the point source at O. Following its trajectory, it strikes the reflector at a point P, where the unit normal (not

z u^ ^t ^s


shown) is given by n^. Just like in the two-dimensional

case, we adopt the convention ^s · n^ < 0, i.e., the normal points towards the light source. From the LoR, Eq. (1),

O

we get an expression for the reflected ray ^t. Finally, the
scattered ray u^ may in general be computed by picking a new direction in a cone coaxial with ^t. In general, we



y

would thus require two stochastic parameters to fix u^.

x

Figure 7: A rotationally symmetric

3.1. In-plane Scattering

reflector with arbitrary scattering.

If, in addition to the reflector being rotationally sym-

metric, the scattered direction is in the plane of inci-

z

dence, the problem may be analysed in two dimensions.

The fact that the specular problem reduces to two di-

mensions is shown in [11, Ch. 3], and in-plane scatter-



ing preserves this symmetry. The situation is depicted

in Fig. 8, depicting the cross-section in the plane of incidence. The two-dimensional reflector is parametrised

P r() = u()e^r

by r() = u()e^r, where e^r = sin(), cos() ,  

[0, ) measured from the positive z-axis. The source

ray ^s = sin(), cos() intersects the reflector at a
point P with unit normal n^, and the specular direction ^t = sin(), cos() , where   [0, ) is measured

^s

u^



^t 

n^

from the positive z-axis, is given by the LoR, Eq. (1).

The scattered direction u^ = sin(), cos() , where

O

x

  [0, ) is measured from the positive z-axis, is given

by a rotation by a stochastic parameter  in accordance

with Eq. (2).

Figure 8: Cross-section in the plane

Before proceeding, let us briefly discuss when such of incidence under the assumption of

an approximation is valid. The rotationally symmetric in-plane scattering.

reflector is self-explanatory, but the in-plane scattering

is less straight-forward. The proposed situation where

this may hold is as follows. A rotationally symmetric reflector was machined in a manner which

left the surface chiseled. Specifically, the chisel-marks follow a tightly-wound spiral along the

reflector. In this situation, we postulate that we may study the cross-section in the plane of

incidence. Within these restrictions, i.e., a rotationally symmetric reflector with chisel-induced

scattering, and under our postulate of in-plane scattering only, we may readily use the formulae

3.1 In-plane Scattering

9

in the prior sections, with a few changes that shall be highlighted shortly. We furthermore assume that the intensity distributions are rotationally symmetric, such that the following description will suffice [lm/sr]:
· source intensity distribution f ()  R+,   [1, 2], · intermediate specular intensity distribution g()  R+,   [1, 2], · diffuse target intensity distribution h()  R+,   [1, 2],
where 1 < 2, 1 < 2 and 1 < 2 are the supports of the distributions. The energy balances in Eq. (7) become

2

2

2

f () sin() d = g() sin() d = h() sin() d,

(17)

1

1

1

where the sine terms come from integration over the unit sphere. Following the procedure in the previous section, let us introduce the density (, )  R+,   [1, 2], [1, 2], such that

2
(, ) sin() d = g(),

(18a)

1 2
(, ) sin() d = h().

(18b)

1

Comparing these equations to Eq. (8), notice that they are the same up to the sine terms from the spherical area elements. As such, the natural choice for  becomes (recall Eq. (10); assuming isotropic scattering, i.e., no explicit -dependence)

(, ) sin() = p a(, ) g().

(19)

We now substitute this  into Eq. (18a) to get

2
p a(, ) d = 1.

(20)

1

Transforming  to  yields

2
p() s(; ) d = 1, 
1

(21)

where 1 and 2 were defined in Eq. (12). The Jacobian will become unity via the mappings in Eq. (6). Whence, the normalisation of p is

2
p() d = 1.

(22)

1

Substituting , defined in Eq. (19), into Eq. (18b) yields

2
h() sin() = p a(, ) g() sin() d.
1

(23)

4 Specular Reflector Design

10

Absorbing the sine terms in the intensity distributions by defining h~() := h() sin(), g~() := g() sin(),

(24)

and inserting a(, ) from Eq. (6), yields

2
h~() = p( - )g~() d,

(25a)

1 2
h~() = p()g~( - ) d,

(25b)

1

where the second equation is obtained by transforming  to . Comparing these to Eq. (16), it is clear that they are the same, up to the sine terms from the spherical area elements in the modified distributions. As such, deconvolution is still a vital tool to obtain the specular target distribution g, used in the reflector design procedure.

4. Specular Reflector Design
Our goal is as follows. Determine a specular reflector which transforms the given source distribution into the given target distribution. The approach we have chosen involves solving two ordinary differential equations (ODEs) for the radius function u() and the mapping m(), which together fully characterise the reflector. This is similar to the approach outlined in [11, Ch. 3.3].

4.1. Cylindrically Symmetric Reflectors

Recall that the reflector is parametrised by r() = u()e^r, and that  is measured counter clockwise from the positive x-axis (refer to Fig. 1). To start, note that a tangent vector to the reflector is

 = r () = u ()e^r + u()e^,

(26)

where e^r = cos(), sin() and e^ = -sin(), cos() are the standard unit vectors in polar coordinates. The corresponding normal vector can be constructed by rotating this vector counter clockwise, i.e.,

n = R(/2) ,

R(/2) =

0 1

-1 0

,

(27)

where the rotation matrix R was initially defined in Eq. (2). The associated unit normal is

n^

=

n |n|

=

n | |

=

-u()e^r + u ()e^ , u()2 + u ()2

(28)

where we made use of the fact that R(/2)e^r = e^ and R(/2)e^ = -e^r. Let v() := ln u() , so that

n^ = -e^r + v ()e^ . 1 + v ()2

(29)

Let us compute

^s · n^ =

-1 ,

1 + v ()2

(30)

4.1 Cylindrically Symmetric Reflectors

11

which we shall use momentarily. In doing so, we made use of the relation ^s = e^r. Note that ^s · n^ < 0, indicating we rotated  the correct way to get n. From the LoR, Eq. (1), we get

^s · ^t = 1 - 2(^s · n^)2.

(31)

By geometrical arguments -- see Fig. 1, it is clear that ^s · ^t = -^s · -^t = cos( - ), such that together with Eq. (30), we get

cos(

-

)

=

1

-

1

+

2 v ()2

,

(32)

or, equivalently

v () = ±

1 1

+ -

cos( cos(

- -

) )

=

cot

m() -  2

,

(33)

where we used the tangent half-angle relation [21, p. 127] and switched from  to m() in the last step to highlight that this is indeed the specular map, which has an explicit -dependence. To solve this ODE, we shall make use of the arbitrary boundary condition v(1) = 0. We thus have the initial value problem (IVP)

 v () = cot

m() -  2

,

,

1 <  < 2.

v(1) = 0.

(34)

Next, we consider a monotonically increasing or decreasing optical map m(). Suppose we have
a monotonically increasing function m() =: mdiv(), together with the boundary condition mdiv(1) = 1, such that the reflected rays do not intersect, i.e., the ray bundle is divergent. Since mdiv is by construction a valid solution, i.e., it achieves g, given f , the following must hold for all   [1, 2] (recall that 1 <  < 2)



mdiv ()

f (~) d~ =

g(~) d~.

(35)

1

1

Differentiation with respect to  immediately yields the IVP

 mdiv() =

g

f () mdiv()

,

mdiv(1) = 1.

(36)

Analogous considerations with a monotonically decreasing function m() := mconv(), where we instead have a convergent ray bundle, yield, for all ,



2

f (~) d~ =

g(~) d~,

(37)

1

mconv ()

or in terms of the equivalent IVP,

 mconv() = - g

f () mconv()

,

mconv(1) = 2.

(38)

Once the desired m() has been obtained, it is substituted into Eq. (34), which is then solved, yielding v() and consequently u() = ev(), which fully characterises the reflector. Throughout
this paper, we have utilised Matlab's ode15s routine to solve the IPVs.

4.2 Rotationally Symmetric Reflectors

12

4.2. Rotationally Symmetric Reflectors
In the case of rotationally symmetric reflectors, we measure  clockwise from the positive z-axis, in the plane of incidence. Since  is constant, the reflector is now parametrised by r() = u()e^r, where e^r = sin(), cos() is the radial unit vector in this particular polar coordinate system. Thus, the tangent vector becomes

 = r () = u ()e^r + u()e^,

(39)

where e^ = cos(), - sin() is the angular unit vector in this polar coordinate system. To obtain the unit normal pointing towards the source, we rotate the tangent vector clockwise, i.e.,

n = R(-/2) ,

R(-/2) =

0 -1

1 0

.

(40)

Following the procedure from the previous section, we end up with a unit normal n^ = -^er + v ()^e , 1 + v ()2

(41)

after introducing v() := ln u() . Finally, we consider the geometry of the situation (see Fig. 8;  is analogous to ) to conclude that ^s · ^t = -^s · -^t = cos( - ), so that together with the law of reflection, Eq. (1), the boundary condition v(1) = 0, and the tangent half-angle relation, we once again arrive at the IVP in Eq. (34).
As in the cylindrically symmetric case, suppose we have a monotonically increasing specular map m() = mdiv(). Then, for any   [1, 2],



mdiv ()

f (~) sin(~) d~ =

g(~) sin ~ d~,

1

1

(42)

or, formulated as an IVP

 mdiv() =

g

f () sin() mdiv() sin mdiv()

,

mdiv(1) = 1.

(43)

Similarly, for a monotonically decreasing m() = mconv(),



2

f (~) sin ~ d~ =

g(~) sin ~ d~,

1

mconv ()

(44)

and the IVP becomes

 mconv() = - g

f () sin() mconv() sin mconv()

,

mconv(1) = 2.

(45)

With these changes in mind, and the knowledge that the IVP for v remains the same, we can conclude that the design procedure outlined previously may be used without further modifications.

4.3 Raytracing

13

4.3. Raytracing

Irrespective of how the reflector is computed, and whether it is cylindrically or rotationally symmetric, a validation method is required. The natural choice is raytracing, and we have written our own two-dimensional raytracer, which includes the effects of scattering in accordance with our model. In particular, source, specular and diffuse rays are all collected. The source rays are generated from the appropriate source distribution using Matlab's rand routine, followed by an intersection computation. When computing the reflector, we are left with discrete data points, and these form so-called reflector bins. All rays that fall within a reflector bin will result in the normal of the piecewise-linear interpolation between the data points constituting the reflector being used for the computation of the reflected direction. The intersection is computed by checking which centre-angle of the reflector bins is closest to the angle of the generated ray using Matlab's dsearchn routine, thus avoiding a relatively expensive intersection computation. The specular rays are then computed using the law of reflection, Eq. (1), whilst the diffuse rays are computed using a rotation matrix with the stochastic parameter , sampled from the probability distribution p -- recall Eq. (2). The sampling of  depends on the chosen p. We shall use either a Gaußian and Matlab's randn routine or a Lorentzian (Cauchy distribution) and Matlab's rand routine in the appropriate cumulative distribution function. The ray collection is performed by equidistantly dividing the relevant angular domain ((-, ) or [0, ), for cylindrically and rotationally symmetric distributions, respectively), thus forming collection bins. The centres of the collection bins are known, and the appropriate bin for a given ray is then computed via a nearest point search using dsearchn, and the number of rays in the bin is incremented. After this, the process is repeated until the requested number of rays have been traced though the system. Finally, the number of rays per collection bin is converted into an intensity by dividing the probability of falling in each bin by the size of the bins and multiplying with the total flux of the source, i.e.,

2

Ij

=

Pr(j-1   

<

j )

f () d,

1

(46)

for the cylindrically reflectors, and for the jth bin. Here, Pr(j-1   < j) is the number of rays in the jth bin divided by the total number of rays traced, and  is the angular size of the collection bins. The total flux of the source is given by the integral over f . For the rotationally symmetric reflectors, we have

2

Ij

=

Pr(j-1   

<

j )

f () sin() d.

1

(47)

This is outlined in [23, p. 34].

5 Results

14

4.3.1. Angle Convention

We adopt the (-, ) angle convention for cylindrically

reflectors, so that we can make use of Matlab's atan2

y

function to compute the angles of the rays. The rota-

tionally symmetric problems will still use the polar [0, )

convention. In addition to this, we shall define our tar-

get distributions in terms of () and (), where

r() = u()e^r

() := - - ,  < 0,  - ,  > 0.

(48)

^t n^

^s

P

That is, () represents the angle from the negative x-

axis in the (-, ) convention -- see Fig. 9 for (), and

O



x

() 

analogously for (). In addition, we note that () can

be used in the cylindrical angle convention as well, since

the polar angle is always positive, and reflection along Figure 9: The angle convention in the the z-axis results in a change of the azimuthal angle by results section.

.

4.3.2. Validation Criteria
We utilise raytracing as a validation technique, so let us define a criterion to quantify the differences between the raytraced and predicted distributions. Specifically, we use the root mean square (RMS) defined as follows

(h, h) =

1 N

N

|hn - hn|2 ,

n=1

(49)

where N is the number of collection bins of h, and the star indicates raytraced distributions. In
most of our examples, we use the deconvolved specular distribution gdc, obtained by deconvolving Eq. (16) or (25) when designing the reflectors. In this case, h and h will be hrc and hrc, respectively, where the `rc' subscript signifies "reconvolution", that is hrc := gdc  p. For the cases where h itself is used, it was averaged over the bins using Eq. (46) or (47) with f and 
replaced by h and , depending on the symmetry of the problem.

5. Results
This section presents three sample problems: two exhibiting cylindrical symmetry and one with rotational symmetry. To verify our model, we prescribe the specular target distribution g exactly, and construct the diffuse target distribution h by convolving g and the chosen scattering PDF p. We then compute the deconvolved specular distribution gdc and design the reflectors using it. Finally, we raytrace the system and compare the result to our prediction. In the rotationally symmetric example, we no longer know the exact g, but rather we prescribe h exactly. This is more similar to how we envision an optical designer working with our model.

5.1 Example #1: Smooth Target Distribution

15

5.1. Example #1: Smooth Target Distribution

The specular problem consists of a homogeneous source f being transformed into two partly

overlapping Gaußians g. As for the choice of p, we opted for a Gaußian centred around  = 0,

with standard deviation  = 10. This is supposed to represent relatively minor scattering when

compared to, e.g., Lambert's cosine law, whilst still being a significant deviation from a specular

reflector. The diffuse distribution h = p  g. Worth noting is that Gaußians do not have finite

support, meaning we need to truncate the nonzero values outside of [1, 2] when performing

the (de-)convolution. We re-normalised p after truncation to ensure that

2 1

p()

d

=

1.

The

problem is summarised in the box below, where

N (; µ, ) = 1 exp  2

-

1 2

-µ 

2

,

(50)

represents the Gaußian, centred at µ with standard deviation . The value of 2 was chosen such that energy is conserved up to 10-3.

Example #1: Smooth Target Distribution

-range: -range: -range:
Source distribution:
Specular target distribution: Surface scattering function: Diffuse distribution prediction: Boundary condition:

[1, 2] = [-/4, 29/75] [1, 2] : see text [1, 2] = [-, ]
f () = 1,   [1, 2] 0, otherwise
g() = N (; -/8, 10) + N (; /12, 12) p() = N (; 0, 10) h() = (p  g)() u(1) = 1

Since we are interested in validating the whole proposed solution method, the first step is to find the specular target distribution gdc by deconvolving g from h. We shall utilise Richardson-Lucy deconvolution, and in particular Matlab's deconvlucy routine. This iterative ratio method has numerous benefits compared to direct methods, most crucial for our purposes being guaranteed positivity of the solution. The functions f , g, gdc, p, h, and hrc are shown in Fig. 10, for deconvlucy's default settings of 10 iterations with 128 sampling points. Clearly, the recovered gdc resembles the original g relatively well, and the reconvolved hrc = gdc  p is nearly identical to h.
The next step is to design the reflectors. In order to use the procedure outlined in Sec. 4, we need the limits 1 and 2. Recall that these should represent the support of g (or, rather, gdc in this case). In this example, the limits are ambiguous due to the Gaußians. We computed the limits by fixing a threshold  = 0.001 and locating the two extrema of () where gdc() = , using piecewise-linear interpolation between the data points of gdc. The limits are shown in Fig. 11, and the reflectors are shown in Fig. 12. In this case, we do not know the exact solutions, so we shall not discuss the reflectors further for this example. We note that one could renormalise gdc to ensure more accurate energy conservation, but this has not been done in the data shown. We have used 1024 sample points for the reflectors in an attempt to minimise discretisation errors due to the reflectors when validating the mconv reflector using raytracing. The sample points are equidistant in the [1, 2]-range. The raytraced distributions and the RMS error from Eq. (49) is shown in Fig. 13, where we see that the source sampling is appropriate, and the resulting distributions are well predicted by our model. In addition, the convergence shows the

5.1 Example #1: Smooth Target Distribution

16

expected Nr-1/2 behaviour of Monte Carlo raytracing [23, p. 9], where Nr is the number of rays traced through the system.
There are a couple of regions where the raytraced distributions deviate from our predictions. Specifically, f  near 1 = -/4 and 2 = 29/75, gdc near (2)  1.26 and near both peaks of the Gaußians. The discrepancies in f  are due to the binning not aligning perfectly with
the support of f , such that part of a collection bin may cross the 1- and 2-boundaries. The discrepancies of gdc are presumably partly due to energy not being perfectly conserved, and partly from the discretisation of the reflector surface, in addition to the aforementioned binning
issue. Additionally, the very peaks of the Gaußians are only one or two data points wide, and
achieving that level of precision is no easy feat, using a numerical scheme. Keeping all of these
factors in mind, the results are promising, and from the RMS error plot, we see that increasing
the number of rays is likely to improve the result further.

Figure 10: Distributions in Example #1; 128 sample points.

5.1 Example #1: Smooth Target Distribution

17

Figure 11: The ()-boundaries used as the support of gdc in Example #1.

Figure 12: Reflectors associated with Example #1 using gdc from Fig. 10; 1024 sample points.

Figure 13: Raytraced distributions; Example #1 with gdc and mconv; 106 rays.

5.2 Example #2: Block Function as Target Distribution

18

5.2. Example #2: Block Function as Target Distribution
We now move on to our second example, which at first appears much simpler, but will prove to be quite a challenge for our numerical scheme. The specular problem consists of homogeneous illumination of a circular disk within [1, 2] and f is homogeneous on [1, 2]. The scattering PDF p is still a Gaußian, this time with a standard deviation of  = 5. We employ a similar approach to the first example, i.e., prescribe g, compute h = g  p and attempt to recover g via deconvolution, then validate the reflectors we design using gdc with raytracing. The example is outlined in the box below. We wish to highlight that the density  is shown explicitly for this example in Fig. 6.

Example #2: Block Function as Target Distribution

-range: -range: -range:
Source distribution:
Specular target distribution:
Surface scattering function: Diffuse distribution prediction: Boundary condition:

[1, 2] = [-/4, /4] [(1), (2)] = [-/4, /4]
[1, 2] = [-, ]
f () = 1,   [1, 2] 0, otherwise
g() = 1,   [1, 2] 0, otherwise
p() = N (; 0, 5) h() = (p  g)() u(1) = 1

Using the default settings of deconvlucy (10 iterations) yields gdc in Fig. 14, where we immediately see that it deviates significantly from the original g. Readers who are familiar with signal theory are likely not surprised by this, as representing a block function in Fourier space requires an infinite number of frequencies. Let us attempt to increase the number of deconvolution iterations by an order of magnitude -- see Fig. 15. This shows a slight improvement, but we are still quite far from the original g. As such, let us further increase the number of iterations by two orders of magnitude to get the result in Fig. 16, which is certainly a lot closer to the original g. The RMS error (g, gdc), recall Eq. (49), decreased from 0.055 to 0.020 and 0.005, for 10, 102 and 104 iterations, respectively. In a real problem, this metric would not be available to us, so we would have to rely on the RMS error (h, hrc), which decreased from 10-3 to 10-4 and 10-6. Based solely on (h, hrc), it is not unreasonable that one might design the reflector using the first gdc, so we shall include it as a worst-case scenario, as well as the best gdc, in the sense that it has the lowest RMS error.
Turning to the topic of reflector design, consider the reflectors in Figs. 17 and 18, designed using the original g and the deconvolved gdc in Fig. 14, respectively. We note that the exact solutions to this problem are given in [11, p. 28] as a circle segment and a straight line, i.e., we recover them using our numerical scheme. To the naked eye, the two figures appear nigh identical, and it is only when we plot the difference in radii of the mconv reflectors in Fig. 19, that we can appreciate the differences. From the raw (or unaltered) graph, we postulate that the deviations can be decomposed into a sloped straight line and comparatively small oscillations. In order to better appreciate the oscillations, we thus subtracted a linear correction factor from the raw data. This reveals the profile of gdc(),   [1, 2], present in the reflector surface.

5.2 Example #2: Block Function as Target Distribution

19

Figure 14: Initial distributions in Example #2; 128 sample points.

Figure 15: Example #2 with 100 Figure 16: Example #2 with 104

deconvlucy iterations.

deconvlucy iterations.

5.2 Example #2: Block Function as Target Distribution

20

Figure 17: Example #2; reflectors designed using g in Fig. 14; 1024 sample points.

Figure 18: Example #2; reflectors designed using the default gdc in Fig. 14; 1024 sample points.

Figure 19: Difference in reflector radii of the mconv reflectors in Figs. 17 and 18; slope of the subtracted linear correction term was 4.31 · 10-6.
Moving on to raytracing, the results are shown in Figs. 20, 21 and 22 with g and gdc from Fig. 14 (10 iterations) and gdc from Fig. 16 (104 iterations), respectively. In all these cases, we used a total of 106 rays, and the mconv reflectors. It is clear that the scheme works well, and the issues we see were explained when discussing the previous example. That is, binning and numerical errors due to discretisation. A slight asymmetry appears in the results for the reflectors designed using the deconvolved gdc distributions. This can also be seen from the slope in Fig. 19, so the cause appears to be somewhere in the numerical computation of the reflectors, presumably due to integration from left to right. The discrepency is very minor, so an attempt to correct it has not been made, as it is clear that the model predicts the scattered distribution very well, and that the resulting reflector can be validated using raytracing.

5.2 Example #2: Block Function as Target Distribution

21

Figure 20: Raytraced distributions; example #2 with g from Fig. 14 and mconv; 106 rays.

Figure 21: Raytraced distributions; example #2 with gdc from Fig. 14 and mconv; 106 rays.

Figure 22: Raytraced distributions; example #2 with gdc from Fig. 16 and mconv; 106 rays.

5.3 Example #3: Lorentzian Scattering Function

22

5.3. Example #3: Lorentzian Scattering Function

The rotationally symmetric example we have chosen differs from the previous examples in two major ways. The first is that we no longer know the exact g, but rather we prescribe an exact h, and to quantify the accuracy of the results, we shall use (hrc, hrc). The second difference is that the scattering function is a Lorentzian (also known as a Cauchy distribution). This is significant for two reasons. The first is that machined mirrors often exhibit this type of bidirectional reflectance distribution function (BRDF) [24, Ch. 4]. The second is that the tails fall to zero at a significantly lower rate, meaning more large-angle scattering will occur when compared to the Gaußians we have used thus far. As such, we increase the relevance of the method whilst testing the limits of our model. The example is outlined in the box below, where

L(;

)

=

1 

2 2 + 2

,

(51)

is a Lorentzian with a full width at half maximum (FWHM) of 2;  is often denoted  in

literature, but not here for obvious reasons. Note that we again truncated the values of p

outside of [1, 2] and renormalised, such that

2 1

p()d

=

1.

Example #3: Lorentzian Scattering Function

-range: -range: -range:
Source distribution:

[1, 2] = [/4, 3/4 - 0.34] [(1), (2)] = [1.015, 2.222]
[1, 2] = [-, ]
f () = 1,   [1, 2] 0, otherwise

Diffuse target distribution:
Surface scattering function: Boundary condition:

h() = sin4(4) - cos(3 - 3/5),   [1, 2] 0, otherwise
p() = L(; 5) u(1) = 1

The distributions are shown in Fig. 23, where we have opted to absorb the sine terms from the energy balancses, Eq. (17), into the distributions (indicated by the tilde). The deconvolved specular target distribution g~dc was computed using the default deconvlucy settings of 10 iterations. Before designing the reflectors using gdc, let us briefly consider what to expect from the final raytraced distributions. In particular, since we have prescribed h, rather than g, we are no longer guaranteed that the deconvolution converges. We can get an appreciation for this by comparing the reconvolved h~rc := g~dc  p with our prescribed h~ in Fig. 23. This may seem like a disappointing result, but let us compare h~, h~rc and h~  p, where the latter would be the diffuse result if we disregarded scattering in the design procedure entirely, i.e., if we designed the reflectors using f and took h as g in the design procedure, and raytraced the optical system using our scattering model. All of these distributions are shown in Fig. 24, and the RMS error (h~, h~  p) = 0.0624, whilst (h~, h~rc) = 0.0356, i.e., our approach represents an improvement of approximately 40%. Visually, we see that the problematic regions for h~rc are partly the peaks and partly near (1)  1.02 and (2)  2.22. The deviation close to the peaks could perhaps be improved by increasing the number of deconvolution iterations, but the problems close to the boundaries are not solvable in our model. This is due to an inherent "maximum steepness" dictated by the least steep function we are deconvolving (in this case p), and it is a property of (de-)convolution. We are now ready to design the reflectors. By fixing  = 0.001 and locating the two values of () where gdc() = , we found (1) = 1.08 and (2) = 2.14, see Fig. 25. The reflectors

5.3 Example #3: Lorentzian Scattering Function

23

Figure 23: Initial distributions in Example #3; 128 sample points. Figure 24: The prescribed and predicted targets in Example #3.

5.3 Example #3: Lorentzian Scattering Function

24

computed using this specular target gdc and f is shown in Figs. 26 and 27, where the latter is a three-dimensional version of the mconv reflector. The raytraced distributions are shown in Fig. 28, where we see that the source sampling f~ is correct, as is the resulting diffuse distribution h~rc. As for the intermediate specular target distribution, we see some deviations from the target g~dc, especially near the first peak. These deviations are presumably due to difficulties solving the relevant IVPs that give the reflector radius function u, and they are likely the reason why our RMS error convergence slows down after approximately 105 rays. For the sake of completeness, we also raytraced the mdiv reflector in Fig. 29. Here, we only show g~dc, g~dc, h~rc and h~rc, since the source sampling is identical. It is clear that the diffuse distribution is still very closely achieved,
whilst the specular distribution deviates in more obvious ways than with the mconv reflector. This highlights the non-triviality of designing specular reflectors, rather than any apparent flaw in
our model of scattering, and it could perhaps be improved by increasing the sampling frequency
of the distributions, or altering the number of samples in the reflectors themselves. This has
not been attempted, since we are mostly interested in validating our model for scattering, and
indeed, even with these deviations from the specular target distribution, the effect of scattering
smoothes them out greatly.

Figure 25: The ()-boundaries used as the support of gdc in Example #3.

Figure 26: The reflectors computed using Figure 27: A three-dimensional version of

gdc in Fig. 23; 1024 sample points.

the mconv reflector in Fig. 26.

5.3 Example #3: Lorentzian Scattering Function

25

Figure 28: Raytraced distributions; example #3 with gdc and mconv; 106 rays. Figure 29: Raytraced distributions; example #3 with gdc and mdiv; 106 rays.

References

26

6. Conclusions
We have presented a novel modelling approach to include surface scattering in the design of reflectors as part of optical systems. The approach is inspired by concepts from optimal mass transport theory, and it relies on energy conservation. In the case of isotropic in-plane scattering and cylindrical or rotational symmetry, the forward prediction reduces to a convolution integral between a probability density function and a specular target function. By prescribing a desired diffuse target distribution, and the scattering probability density function, one can solve for the specular target distribution using deconvolution methods from literature, and then compute the reflectors using purely specular design procedures. As such, including the effects of scattering can be considered a pre-processing step, and all the mature specular reflector design procedures remain essential. This gives the optical designer a greater ability to use scattering to their advantage, or mitigate it in applications where it is undesirable.
In the future, we would like to treat scattering functions that depend on the incident angle, thus increasing the realism of the model significantly. In addition, we would like to extend the model to treat three-dimensional freeform reflectors.
Funding: This work was partially supported by the Dutch Research Council (Dutch: Nederlandse Organisatie voor Wetenschappelijk Onderzoek (NWO)) through grant P15-36.
Disclosures: The authors declare no conflicts of interest.
Data availability: Data underlying the results presented in this paper are not publicly available at this time but may be obtained from the authors upon reasonable request.

References
[1] E. Hecht, Optics, 5th ed. (Pearson Education, Incorporated, 2017), isbn: 9780133977226.
[2] J. W. Strutt, "On the dynamical theory of gratings", Proc. R. Soc. Lond. A 79, 399­416 (1907) 10.1098/rspa.1907.0051.
[3] S. O. Rice, "Reflection of electromagnetic waves from slightly rough surfaces", Communications on Pure and Applied Mathematics 4, 351­378 (1951) 10.1002/cpa.3160040206.
[4] P. Beckmann and A. Spizzichino, The scattering of electromagnetic waves from rough surfaces, Artech House Radar Library (Artech House, 1987), isbn: 9780890062388.
[5] J. E. Harvey, Understanding surface scatter phenomena: a linear systems formulation, [SPIE Press monograph] (SPIE Press, 2019), isbn: 9781510627871.
[6] E. L. Church and J. M. Zavada, "Residual surface roughness of diamond-turned optics", Appl. Opt. 14, 1788­1795 (1975) 10.1364/AO.14.001788.
[7] J. E. Harvey, "Light-scattering characteristics of optical surfaces", PhD thesis (University of Arizona, 1976), 10.21236/ada095132.
[8] A. Krywonos, J. E. Harvey, and N. Choi, "Linear systems formulation of scattering theory for rough surfaces with arbitrary incident and scattering angles", J. Opt. Soc. Am. A 28, 1121­1138 (2011) 10.1364/JOSAA.28.001121.
[9] D. McNamara, C. Pistorius, and J. Malherbe, Introduction to the uniform geometrical theory of diffraction, Antennas and Propagation Library (Artech House, 1990), isbn: 9780890063019.

References

27

[10] C. Villani, Topics in optimal transportation, Graduate Studies in Mathematics (American Mathematical Society, 2003), isbn: 9780821833124.
[11] M. Maes, "Mathematical methods for reflector design", PhD thesis (University of Amsterdam, 1997), isbn: 90-74445-36-5.
[12] C. Prins, "Inverse methods for illumination optics", PhD thesis (Eindhoven University of Technology, 2014), isbn: 978-90-386-3662-7, 10.6100/IR776340.
[13] C. Prins, J. Thije Boonkkamp, ten, J. Roosmalen, van, W. IJzerman, and T. Tukker, "A Monge-Ampère-solver for free-form reflector design", SIAM Journal on Scientific Computing 36, B640­B660, issn: 1064-8275 (2014) 10.1137/130938876.
[14] C. Prins, J. Thije Boonkkamp, ten, W. IJzerman, and T. Tukker, "A least-squares method for optimal transport using the Monge-Ampère equation", SIAM Journal on Scientific Computing 37, B937­B961, issn: 1064-8275 (2015) 10.1137/140986414.
[15] B. van Lith, "Principles of computational illumination optics", PhD thesis (Eindhoven University of Technology, 2017), isbn: 978-94-6233-812-8.
[16] N. Yadav, "Monge-Ampère problems with non-quadratic cost function: application to freeform optics", PhD thesis (Eindhoven University of Technology, 2018), isbn: 978-90386-4574-2.
[17] R. Beltman, J. ten Thije Boonkkamp, and W. IJzerman, "A least-squares method for the inverse reflector problem in arbitrary orthogonal coordinates", Journal of Computational Physics 367, 347­373, issn: 0021-9991 (2018) 10.1016/j.jcp.2018.04.041.
[18] N. Yadav, L. Romijn, J. ten Thije Boonkkamp, and W. IJzerman, "A least-squares method for the design of two-reflector optical systems", JPhys Photonics 1, 10.1088/2515-7647/ ab2db3, issn: 2515-7647 (2019) 10.1088/2515-7647/ab2db3.
[19] L. B. Romijn, J. H. ten Thije Boonkkamp, and W. L. IJzerman, "Inverse reflector design for a point source and far-field target", Journal of Computational Physics 408, 109283 (2020) 10.1016/j.jcp.2020.109283.
[20] L. Romijn, J. ten Thije Boonkkamp, and W. IJzerman, "Inverse reflector design for a point source and far-field target", Journal of Computational Physics 408, 10.1016/j.jcp.2020. 109283, issn: 0021-9991 (2020) 10.1016/j.jcp.2020.109283.
[21] L. Råde and B. Westergren, Mathematics handbook for science and engineering (SpringerVerlag Berlin Heidelberg, 2004), isbn: 978-3-662-03556-6, 10.1007/978-3-662-03556-6.
[22] P. Jansson, Deconvolution of images and spectra (Academic Press, 1997), isbn: 9780123802224.
[23] C. Filosa, "Phase space ray tracing for illumination optics", PhD thesis (Eindhoven University of Technology, 2018), isbn: 978-90-386-4504-9.
[24] J. Stover, Optical scattering: measurement and analysis, Press Monograph Series (SPIE Press, 2012), isbn: 9781628418408.

