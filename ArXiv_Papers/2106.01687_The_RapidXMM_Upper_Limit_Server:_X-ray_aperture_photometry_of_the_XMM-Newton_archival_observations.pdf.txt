arXiv:2106.01687v1 [astro-ph.HE] 3 Jun 2021

MNRAS 000, 1­20 (2021)

Preprint June 4, 2021

Compiled using MNRAS LATEX style file v3.0

The RapidXMM Upper Limit Server: X-ray aperture photometry of the XMM-Newton archival observations.
A. Ruiz1, A. Georgakakis1, S. Gerakakis2, R. Saxton3, P. Kretschmar4, A. Akylas1, I. Georgantopoulos1
1Institute for Astronomy & Astrophysics, National Observatory of Athens, V. Paulou & I. Metaxa, 11532, Greece 2Planetek Hellas, 44 Kifisias Ave, Athens Space Cluster Bldg C, 15125 Marousi, Athens, Greece 3TPZ-VEGA for ESA, XMM-Newton SOC, ESAC, Apartado 78, 28691, Villanueva de la Cañada, Madrid, Spain 4ESA-European Space Astronomy Centre, 28691 Villanueva de la Cañada, Madrid, Spain
Accepted XXX. Received YYY; in original form ZZZ
ABSTRACT This paper presents the construction of the RapidXMM database that is available through the XMM-Newton Science Archive and offers access to upper limits and aperture photometry across the field of view of the XMM-Newton Pointed and Slew Survey observations. The feature of RapidXMM is speed. It enables the fast retrieval of X-ray upper limits and photometry products in three energy bands (0.2­2, 2­12, 0.2­12 keV) for large numbers of input sky positions. This is accomplished using the Hierarchical Equal Area Iso Latitude pixelation of the sphere (HEALPix). The pre-calculated upper-limits and associated X-ray photometry products are reprojected into the HEALPix grid of cells before being ingested into the RapidXMM database. This results in tables of upper limits and aperture photometry within HEALPix cells of size  3 arcsec (Pointed Observations) and 6 arcsec (Slew Survey). The database tables are indexed by the unique integer number of the HEALPix cells. This reduces spatial nearestneighbor queries by sky position to an integer-matching exercise and significantly accelerates the retrieval of results. We describe in detail the processing steps that lead from the science products available in the XMM-Newton archive to a database optimised for sky queries. We also present two simple show-case applications of RapidXMM for scientific studies: searching for variable X-ray sources, and stacking analysis of X-ray faint populations.
Key words: astronomical data bases: miscellaneous ­ X-rays: general

1 INTRODUCTION
The last two decades have witnessed an explosion in the volume of astronomical observations in the X-ray (0.2­100 keV) part of the electromagnetic spectrum. This is largely thanks to the smooth and uninterrupted operation of ESA's XMM-Newton (Jansen et al. 2001) and NASA's Chandra (Weisskopf et al. 2000) X-ray observatories since 1999 as well as the launch of the NuSTAR telescope (Harrison et al. 2013) in the early 2010s. Moreover, the continuous scanning of the sky by Gamma-Ray Burst missions such as the Swift-BAT (Gehrels et al. 2004) and INTEGRAL (Winkler et al. 2003) resulted in the first 4 surveys at energies > 15 keV (Krivonos et al. 2010; Oh et al. 2018). The above high-energy missions are supported by archives, which store and serve to the community the accumulating volume of observations in the form of raw data and advanced, science-level products. Nearly all high-energy missions also provide (serendipitous) source catalogs (e.g. 4XMM catalogue; Webb et al. 2020), which list in a table-format the properties of all the sources
 E-mail: ruizca@noa.gr  E-mail: gerakakis@planetek.gr
© 2021 The Authors

detected by the telescope/instrument during its operations. They are extensively used by the astronomical community to explore the incidence of X-ray emission in astrophysical populations, search for interesting sources, or carry out statistical studies.
Despite the undisputed legacy value of source catalogues, there are science applications that extend beyond formal detections. There are astrophysical objects that are hidden in the noise of a given set of observations and yet these non-detections contain important information on their physical properties. Transient sources, such as Tidal Disruption Events (TDEs; e.g. Komossa & Bade 1999; Esquej et al. 2008; Saxton et al. 2019) or Changing Look AGN (Matt et al. 2003; LaMassa et al. 2015; Ricci et al. 2016), are examples of physical phenomena, for which upper limits, or more broadly sensitivity estimates, play an important role. Such sensitivity calculations are also necessary in statistical investigations of the X-ray properties of sources selected at wavelengths other than X-rays (e.g. optical, nearinfrared, radio) to account for the often sizeable X-ray­undetected part of the population.
The characterisation of non-detected sources, via e.g. the calculation of upper limits, falls under the broad umbrella of X-ray

2 Ruiz et al.
photometry at arbitrary positions within the field of view of a given observation and therefore requires access to imaging data. The HIgh-energy LIght-curve GeneraTor (HILIGT1, Saxton et al. 2021; König et al. 2021) is an example of a webtool that enables such calculations. This, however, is not trivial in the case of large numbers of input source-positions because of the sheer volume of archived observations. We showcase this challenge with the XMM-Newton X-ray observatory, which is the focus of this paper. This mission currently provides the largest publicly available X-ray dataset in the energy interval 0.2­12 keV. The latest release of the XMM-Newton serendipitous source catalogue that is based on pointed observations (4XMM-DR9, Webb et al. 2020) contains more than half a million unique detections within a footprint that extends over 1000 deg2. Moreover, the XMM-Newton Slew Survey (Saxton et al. 2008), which is carried out as the telescope moves between pointings, currently covers nearly 80% of the sky and provides the only nearly 4 X-ray catalogue at the energy range 2­12 keV. The XMM-Newton Science Archive2 (XSA) includes both pointed and slew survey products. The pointed observations that use the EPIC cameras (PN, MOS1, MOS2; Turner et al. 2001; Strüder et al. 2001) in imaging (i.e. non-timing) modes are relevant to X-ray photometry. There are a total of 11 204 such observations taken between 2000 February 3 and 2019 February 26th and included in the 4XMM-DR9 catalogue (Webb et al. 2020), after filtering for data with technical/observational issues (e.g. high particle background). This translates to a rate of about 590 pointed observations per year that are relevant for X-ray photometry applications. Assuming that XMM-Newton continues operations for the next 10 years a total of up to 18 000 pointed observations are expected in the archive by the end of the mission, each with an approximate field of view of 0.25 deg2. In the case of slews, not all of them contain useful data mainly because of high-particle background intervals leading to significant contamination of the whole observation. For example, the 2nd Slew Survey Catalogue includes 2114 slews executed between 2001-08-26 and 2014-12-31. Extrapolating to the end of the XMM-Newton mission we may expect up to 5 000 Slew Observations in the archive, with a typical single slew size of about 30 deg2.
The above volume of data renders the real-time photometric calculations within the XMM-Newton footprint slow. The main overhead is related to input/output time, i.e. accessing the appropriate XMM-Newton data products such as images, background and exposure maps in different energy bands. This approach also suffers from redundancy since queries to (nearly) the same position need to be repeated. An obvious solution to overcome these issues is to use look-up tables of pre-calculated photometry that can be used for a broad range of sensitivity calculations, e.g. upper limits. The challenge in this case is to design a storage and query architecture that ensures fast retrievals for positional searches. This is particularly important in the case of many independent positions stored. For the projected number of observations by the end of the XMMNewton mission and a pixel size of 4 arcsec, there are about 1011 independent elements (i.e. sky-coordinates) within the Slew Survey footprint (5000 slews of mean size 30 deg2 each) and 4 × 109 positions in the case of pointed observations (18 000 covering an area of 0.25 deg2 each). Nearest position searches over such a large number of records is not trivial and therefore optimisation schemes are essential.
In this paper we describe the RapidXMM, an analysis pipeline
1 http://xmmuls.esac.esa.int/hiligt/ 2 http://nxsa.esac.esa.int/nxsa-web

that produces and stores into a carefully designed database both aperture photometry and upper limits for the XMM-Newton archival imaging observations. These products are estimated in a dense grid of sky positions with a resolution similar to the pixel size of the XMM-Newton images ( 4 arcsec). Despite the large number of stored records, the RapidXMM database is optimised to yield fast responses to queries by sky position.
The RapidXMM analysis pipeline has been applied to archival observations and is also used to process new observations as they become available. In Sect. 2 we motivate the adopted solution for the database architecture and design. The algorithm for the calculation of upper limits is described in Sect. 3. The implementation of this algorithm is presented in Sect. 4, while Sect. 5 describes sanity checks to verify the overall quality of the products stored in the database. A feature of the RapidXMM database is that it enables access to aperture photometry across the footprint of all the observations carried out by XMM-Newton. Sect. 6 demonstrates this potential by presenting show-case science applications examples of the RapidXMM database. The Appendix A presents the database and schema.

2 DATABASE CONCEPT

In this work we use the HEALPix pixelisation of the 2-dimensional

surface of the sphere (Górski et al. 2005) to accelerate positional

searches. The sky is split into equal-area cells using the HEALPix

tessellation scheme. Each cell is identified by a unique integer fol-

lowing the

3 numbering scheme of the HEALPix. There

is therefore a one-to-one correspondence between a cell's integer

number and the sky coordinate of its centre. This is the feature used

in this work to facilitate fast queries at arbitrary sky positions. Upper

limits and aperture photometry products are pre-calculated for each pixel of a given XMM-Newton imaging observation. These are then

projected onto the HEALPix grid of cells and stored in a database. This last step associates upper limits within the XMM-Newton foot-

print with HEALPix cell integer numbers. Querying the upper limit

database by sky position is straightforward. The input sky coordi-

nates are first associated with the integer numbers of the HEALPix

cells that contain them. These integers are then matched against the

HEALPix cell numbers stored in the database to return any upper

limits associated with them. The sky-coordinate nearest-neighbor

search is therefore reduced to an integer matching exercise. An im-

portant parameter in this scheme is the size of the HEALPix cell

that controls the spatial resolution of the database. In HEALPix

terminology the relevant parameters are the

or

of the

sky tessellation. The values of these parameters determine the num-

ber of independent upper limit estimates that will be stored in the

database. For example a HEALPix

of 16 ( =216) corre-

sponds to a resolution of about 3 arcsec, similar to the pixel size of XMM-Newton. The decision on the HEALPix resolution is a trade-

off between accurately describing spatial variations across the sky

and size of the database.

3 THE UPPER-LIMIT ESTIMATION ALGORITHM The estimation of upper limits is based on aperture photometry. The advantage of this approach is that the observed number of
3 https://healpix.sourceforge.io/doc/html/intro.htm MNRAS 000, 1­20 (2021)

PPS Data Products

The RapidXMM Upper Limit Server 3
Upper Limit Products

PPS Data Preparation

Upper Limit Calculator

Quality Flags

HEALPix Projection

Figure 1. Flow chart presenting the RapidXMM data analysis process that estimates upper limits and associated products. Each rectangle within the pink shaded region corresponds to a calculation module. The green cylinders signify data fed into the analysis flow (Processing Pipeline Subsystem prodcuts) or returned from it (Upper Limit Products). The first step of the analysis flow chart is the preparation of the PPS (Processing Pipeline Subsystem) data (see Sect. 4.1). This is followed by the Upper Limit calculation module (Sect. 4.2), the quality flag estimation (Sect. 4.3) and the reprojection onto the HEALPix grid (Sect. 4.4).

photons within the aperture follows the well-known Poisson probability distribution with an expectation value that depends on both the background level and any underlying source contribution. The algorithm for converting observed number of photons to sources' upper limits at a given confidence interval is based on the work of Kraft et al. (1991) and is described below.
Suppose an X-ray observation with a given exposure time and detector characteristics, e.g. Point Spread Function, background level. Given a position within the observation footprint we need to estimate the count-rate upper-limit a source could have had. We choose to approach this problem using aperture photometry. Suppose an aperture of radius  centered at the position of interest. The total number of photons within this aperture, , consists of a background component, , and a possible source contribution, . The level of the background expectation value, , within the aperture can be estimated from source-free regions close to the position of interest. The source contribution to the observed number of photons in the aperture depends on the shape of the Point Spread Function and the exposure time of the observation. If the putative source has a count rate   then

 = CR ·  · EEF,

(1)

where  is the (vignetted) exposure time at the position of interest

and EEF is the Encircled Energy Fraction that measures the fraction

of total source photons within the aperture . The EEF depends

on the shape and extent of the X-ray Point Spread Function and

typically varies with position on the detector and photon energy.

The observed number of photons  in the aperture is a Poisson realisation with expectation value  =  + 

( + ) +

( | + ) =

,

(2)

!

where ( | + ) is the probability of observing  photons given the expectation value ( + ). Next we assume that  can be de-

termined to a very high level of accuracy. This is a reasonable

assumption in the case of the background-limited observations with the EPIC cameras of XMM-Newton. Source confusion is typically

low in these observations and therefore sufficiently large source-

free detector regions are available to provide reliable estimates of

MNRAS 000, 1­20 (2021)

the local background level. Under this assumption it is possible to integrate the probability density function of Eq. 2 with respect to  and determine the corresponding cumulative distribution as a function of this parameter. The upper limit,  , at an arbitrary confidence interval CL is then defined as the value of  for which the cumulative probability equals CL. Following the seminal work of Kraft et al. (1991) this can be expressed as

 UL ( + )  +

×

 = CL,

(3)

0

!

where  is the constant of normalisation. Assuming a prior where the only condition is for the UL to be positive,  is defined as

 -1 =



(

+

) 

+


  =

 


 = ( + 1, ).

0

!

 !

(4)

In the equation above the integration has been expressed in terms of  =  +  and (, ) is the upper incomplete gamma function. We can also change the integration variable to  =  +  in Equation 3

and replace the normalisation constant from Equation 4. Equation

3 can then be rewritten

 +UL   

·

 = CL 



!

 +UL     = CL · -1





!

 +UL   

    

 -



0

!

0 !

= CL · ( + 1, )

(5) 

( + 1, UL + ) - ( + 1, ) = CL · ( + 1, ) 

( + 1, UL + ) = ( + 1, ) + CL · ( + 1, ),

4 Ruiz et al.

Table 1. Parameters used in the calculation of upper limits for Pointed and Slew Survey observations. The columns are: (1) the observation type, Pointed or Slew, (2) the radius  in units of arcseconds within which counts are extracted from the science images, (3) the inner/outer radius of the annulus in units of arcseconds used to extract background counts (4) the Encircled Energy Fractions (EEFs) for each radius . The EEF is different for each EPIC detector. The Slew Survey uses the EPIC-PN only.

Observation type

Source extraction radius
(arcsec)

Background annulus inner/outer radius (arcsec)

Encircled Energy Fraction (EEF) PN MOS1 MOS2

Pointed

15

Slew

30

0/60 60/180

0.68 0.69 0.71

0.85 ­

­

Calculate Masks

Extract Counts

Curated PPS Products

Estimate Average Exp. Time

Extract Background YES Counts
PPS BKGMAP
NO Calculate Background Mask
Calculate Upper Limits

Extract Background
Counts

Figure 2. Flow chart of the Upper Limit module. The rectangles show different analysis steps. The diamond-shaped boxes correspond to decision points in the process. The green cylinder signifies data fed into the analysis flow. The module starts with the calculation of masks (observation, source masks; see Sect. 4.2), proceeds with the aperture count extraction and the calculation of the mean exposure time within the extraction kernel. This is then followed with the determination of the background level within the aperture. At this stage the flow forks into two branches. If PPS background maps are available (Pointed Observations) then these are used to determine the background level. Otherwise the background is determined from the science image. This requires masking non-exposed pixels and regions contaminated by nearby sources (background mask). The background level is then determined from an annulus centered at the position of interest. Finally the products determined in the steps above (extracted counts, exposure time, background level) are combined to determine upper limits (see equations of Sect. 3).

where (, ) is the lower incomplete gamma function. The upper limit at the confidence interval CL can be estimated
by inverting the lower gamma function on the left hand side:

UL = -1 ( + 1, CL · ( + 1, ) + ( + 1, )) - .

(6)

The UL is in units of counts. It can be converted to count-rate by dividing with the exposure time  and the EEF to correct for the fraction of source photons outside the aperture 

CRUL = UL//EEF.

(7)

The relation above corresponds to the count-rate upper limit in the case of a single detector, i.e. one of the EPIC PN, MOS1 and MOS2. This equation is used by the RapidXMM to estimate upper limits. It is some times desirable however, to combine information from different cameras to obtain a deeper and possibly more physically interesting upper limit. The issue that needs to be resolved in this case is the different energy response of the EPIC cameras. This effect can only be accounted for in the context of a spectral model to yield an upper-limit of a source in X-ray flux rather than count rate. In this case some of the equations above need to be modified. The total number of counts within the extraction aperture from all

three detectors is

3

3





 =  ·  · ECF · EEF + ,

(8)

=1

=1

where  is the source's flux in a given energy band, , , EEF are the exposure time, background level and encircled energy fraction of the camera , and ECF is the energy to count conversion factor of the detector . The latter depends on the adopted spectral model of the source and the energy response of the instrument. The left-hand side of Equation 6 should also be modified by substituting the UL term (units of counts) from Equation 8. As a result the flux upper limit is

 =

UL

,

3 =1



·

ECF

·

EEF

(9)

and UL is given by Equation 6 after substituting  with . The RapidXMM database does not store upper limits for the combined EPIC cameras but provides all the necessary products (counts, exposure time, background level), which when combined with a spectral model (i.e. ECFs) can yield flux upper limits via Equation 9.

MNRAS 000, 1­20 (2021)

4 THE RAPIDXMM IMPLEMENTATION
In Sect. 3 we show how count-rate upper limits can be estimated at a given position within an X-ray image from known quantities (, , CL, , and EFF) in terms of incomplete gamma functions. There are a number of implementations of these functions in different programming languages that allow fast calculations. The RapidXMM project is based on Python (Van Rossum & Drake 2009) and uses the fast, vectorized implementation of gamma functions included in the SciPy module (Virtanen et al. 2020).
A flow chart of the RapidXMM data processing algorithm for a given XMM-Newton observation is shown in Fig. 1. The science observations are downloaded from the XSA archive and, if needed, additional products are calculated for the RapidXMM energy bands (Sect. 4.1). These products (images, background maps and exposure maps) are used to extract the information needed to estimate upper limits via Eqs. 6 and 7 (Sect. 4.2). Quality flags are assigned to each upper limit according to the number of counts and the fraction of good (exposed) pixels contained in the corresponding extraction regions (Sect. 4.3). Finally, the upper limits calculated for each image pixel, and their ancillary photometric information (extracted counts, background level, mean exposure time), are reprojected into a HEALPix grid covering the image (Sect. 4.4) and ingested into the RapidXMM database (Sect. 4.5). Each of these steps is described in detail in the following sections.
4.1 Data preparation
The analysis of a particular XMM-Newton observation (Pointed or Slew) starts by downloading the relevant data from the XSA. The RapidXMM analysis is based on the science products generated by the XMM-Newton Pipeline Processing Subsystem (PPS). The calculation of upper limits is only relevant to the imaging observations carried out by the XMM-Newton, i.e. those obtained by the European Photon Imaging Cameras (EPIC, Strüder et al. 2001; Turner et al. 2001). The relevant PPS products include images, background maps and exposure maps in the various PPS energy bands for the three EPIC instruments (PN, MOS1, MOS2), as well as the corresponding X-ray source catalogue. The Slew Survey observations are using the EPIC-PN instrument only. Also, the Slew PPS products do not include background maps. In this case the local background value at a given position within the observation footprint is estimated on the fly from the RapidXMM code.
In the case of XMM-Newton Pointed Observations the PPS products need to be further analysed before calculating upper limits. This is because the energy bands used by RapidXMM and those adopted by the PPS are different. RapidXMM estimates upper limits in three broad energy bands, 0.2­2 (soft), 2­12 (hard) and 0.2­12 keV (full). With the exception of the full-band, the PPS generates Pointed Observation products in narrow energy intervals (Webb et al. 2020).4 Therefore, the Pointed Observation PPS products have to be merged to produce images in the RapidXMM broad bands. The RapidXMM soft-band (0.2­2 keV) is constructed from the PPS bands 1 (0.2­0.5keV), 2 (0.5­1 keV) and 3 (1­2 keV). The RapidXMM hard-band (2­12 keV) is synthesised from the PPS bands 4 (2­4.5 keV) and 5 (4.5­12 keV). The RapidXMM full-band is build from the PPS bands 1 to 5.5 The RapidXMM data prepara-
4 http://xmmssc.irap.omp.eu/Catalogue/4XMM-DR9/4XMM-DR9_ Catalogue_User_Guide.html#TabBands 5 PPS products include images for the energy band 8 that corresponds to the RapidXMM full-band. However the PPS does not provide background maps
MNRAS 000, 1­20 (2021)

The RapidXMM Upper Limit Server 5
tion module merges the Pointed Observation PPS narrow bands to generate the RapidXMM soft and hard bands. In the case of images and background maps this operation is the addition of the individual components. For exposure maps the narrow-band components are averaged. For Slew Observations the PPS products are generated in the same broad energy bands used by RapidXMM, i.e. 0.2­2, 2­12 and 0.2­12 keV. In this case there is no need to further process the PPS data.
Each distinct XMM-Newton observation is characterised by a unique identification number (Obs.ID). Pointed observations include at least one exposure for each of the XMM-Newton instruments. Slew Observations typically have long footprints that extend over many degrees on the sky. For practical reasons the PPS splits them into multiple patches. Each Obs.ID is analysed separately by the RapidXMM. Upper limits are determined independently for each exposure or for each patch of a given Obs.ID.
4.2 Upper Limit Calculation
The estimation of upper limits via Eq. 6 requires knowledge of the total extracted photons within an aperture, the expected background contribution to the observed counts and the exposure time at that position. The calculation module of RapidXMM determines these quantities for each pixel position of individual exposures or patches within an Obs.ID and for each of the three RapidXMM energy bands. Upper limits are estimated at three confidence intervals that correspond to probabilities of 84.13, 97.72 and 99.87% that the true count-rate value lies below the respective upper limit. The probabilities above correspond to the one-sided 1, 2 and 3 confidence levels of a Normal distribution. It is recognised that the use of the one-sided probability definitions above is not common. The calculation of upper limits however, involves an integration that is essentially bounded only on one side (Eq. 3). It therefore makes sense in this case to express the confidence interval in only one direction.
At a given pixel position, image counts are integrated within a circular aperture of radius . The expected background level within that aperture is estimated from either the PPS background map (Pointed Observations) or the image itself (Slew Survey). Counts are extracted in an annulus of inner and outer radii ,  respectively. The average exposure time within the aperture  is also estimated using the corresponding exposure map. These calculations account for non-exposed pixels within the extraction apertures, e.g. CCD gaps (Pointed observations only), observation field of view, hot/bad pixels. If the background is determined from the science image rather than the PPS background maps (e.g. Slew observations), areas in the vicinity of detected sources are masked out to avoid contamination. The adopted values of ,  and  are shown in Table 1. All the count extraction operations are equivalent to the convolution of the input image with a kernel that matches the aperture/annulus size. RapidXMM uses Fast Fourier Transforms to perform convolutions and significantly accelerate the calculations. The prescription outlined above is described in more detail below and is graphically demonstrated in Fig. 2.
First RapidXMM calculates two sets of masks, one that describes the exposed area of a given observation (observation masks) and a second one that masks regions within which the observed counts are dominated by X-ray point-source detections (source
in that energy band. For consistency, we decided to calculate the RapidXMM full-band images from the narrow band PPS images.

6 Ruiz et al.

Figure 3. Demonstration of the quality flag products generated by the RapidXMM. The left panel is the 0.2­12 keV EPIC-PN image of the Pointed Observation with Obs.ID number 0404967501. Only a section of the image is shown to highlight details. The green circles mark the positions of sources detected in this observation by the PPS. The radius of the each circle depends on the apparent brightness of each source. The second panel from the left shows the exposure map of this observation. Darker regions correspond to lower exposure time and black identifies non-exposed areas, e.g. outside the field of view, CCD gaps or bad pixels. The third panel from the left is the RapidXMM Quality Flag image of this observation. Each pixel on that image has a value that depends on the flag bits raised during the estimation of upper limits. The possible flag values are shown in Table 2. Black corresponds to non-flagged pixels (flag value 0). Red is for non-exposed pixels. CCD gaps and the outline of the EPIC-PN field of view are therefore coloured red on this flag image. Yellow corresponds to a flag value of 8 (see Table 2) and marks the positions of sources. Comparison with the image on the left demonstrates the correspondence between yellow regions and green circles on the 0.2­12 keV EPIC-PN image. The boundaries of the image are also flagged (values between 1 and 3 depending on the bits raised). The positions of bad pixels on the exposure map in the middle can also be seen as non-exposed areas (red regions) on the Quality Flag image. The panel on the right shows the image of the 3 count-rate upper limits in the 0.2­2 keV band. X-ray detected sources are highlighted with red colour. Dark colour corresponds to lower count-rate values. The observed gradient from the middle to the edges is the result of the vignetting. The apparent granularity of the upper limits across the field of view is because of the Poisson nature of the XMM-Newton background, i.e. the fact that the number of photons included within the extraction aperture takes only integer values.

masks). The exposure map is used to identify pixels with positive exposure time and generate "Observation" masks. These are 2dimensional integer images with pixels that take value of either one in exposed areas or zero otherwise. The latter case corresponds to pixels in CCD gaps, outside XMM-Newton's Field-of-View (FoV), or known to be hot/bad. There is one Observation mask for each exposure or patch of an Obs.ID. These masks are used to estimate the fraction of non-exposed pixels in an aperture at the count-extraction stage of the calculations. They are also employed to flag upper-limits on pixels that lie close to CCD edges. "Source" masks are integer images with pixel values of unity in the vicinity of X-ray detected sources and zero everywhere else. Areas close to X-ray detections are identified using the source positions and source radii provided by the PPS products in the form of DS9 regions files. These files are created by the slconv SAS task,6 using a circular shape at the positions of the sources detected by emldetect in the observation, and with radius given by the sum of the source count rates for each narrow energy band (1­5) and detector. The source radius describes the extent of the area within which the observed photons are dominated by that source. The Slew observation PPS products do not include information on the radii of any detected sources. In this case a fixed radius of 45 arcsec is used to define source-contaminated areas. Source masks are used to flag upper-limits in the vicinity of X-ray detections, for which contamination from nearby sources may be an issue. The observation and source masks are further combined to define "background" masks. These are defined to be the observa-
6 http://xmm-tools.cosmos.esa.int/external/sas/current/ doc/slconv/slconv.html

tion masks with additional pixels set to zero in source-dominated regions. The background masks are used to exclude potentially contaminating source photons from the calculation of the background expectation value at a given position in the case of the Slew Survey observations, for which no PPS background maps are provided.
The mask construction is followed by the count-extraction stage. The science images of a given Obs.ID at a given energy band are convolved with a circular kernel of radius  (15 arcsec for pointed observations, 30 arcsec for Slews; see Table 1). Pixels with zero value on the observation mask are also set to zero (i.e. the science image is multiplied by the observation mask) and hence, are effectively ignored by the convolution operation. The convolution of the same kernel with the observation mask yields an estimate of the area, , of the extraction aperture excluding non-exposed pixels. The same convolution operation is also applied to the exposure maps. In these case however, the integrated exposure time within the aperture (i.e. the result of the convolution) is divided by the area  of the extraction kernel to calculate averages.
The next step is the estimation of the background level within the aperture with area . Two different approaches are followed in the case of Pointed and Slew observations. For the former the PPSgenerated background maps are used to measure the expected number of background counts within the aperture of radius . The PPS background maps are convolved with a circular kernel of 60 arcsec radius. The convolution of the observation mask with the same kernel yields the kernel's area, , at each position corrected for non-exposed pixels. Scaling this convolved image by the area ratio /, yields an estimate of the background expectation in the aperture of radius  and area . The PPS products of Slew obser-
MNRAS 000, 1­20 (2021)

vations do not include background maps. In this case the background

level is determined from the science images after multiplying them

with the source mask to effectively nullify pixels in the vicinity of

detected sources, CCD gaps etc. The same approach as above is

adopted with the exception that the convolution kernel is an annulus

with inner and outer radii of 60 and 180 arcsec respectively. The

area of the kernel is measured using the background mask and this

is then used to scale the extracted counts to the area of the aperture

with radius .

The result of count-extraction stage are images of integrated

counts, background count expectations and mean exposure times

within an aperture of radius . These are fed to Eq. 6 to determine

images of upper limit count rates for the each of the confidence level

probabilities 84.13% (1), 97.72% (2) and 99.87% (3). Table

1 presents the adopted Encircled Energy Fraction (EEF) for each

EPIC camera and observation type (pointed or slew). These EEFs

are the same as those used in the

task of XMM-Newton's

SAS (Science Analysis System) and correspond to the Point Spread

Function (PSF) size at 1.5 keV. Ideally energy and off-axis angle dependent EEFs should be used. The XMM-Newton EPIC cameras

however, have been designed to minimise the variation of the PSF,

and hence the EEF, across the field of view and across the range

of observed photon energies. The adopted EEFs therefore provide

an adequate (within 5%) representation of the fraction of source

photons outside the extraction radius.

4.3 Quality flags
RapidXMM estimates quality flags that characterise the upper limit at a given pixel and identify potential issues, e.g. proximity of the pixel in question to the edge of the field-of-view or X-ray sources. These flags are stored as bit values. There are a total of four flags which are defined in Table 2 and described in detail below:
· The first bit (number 0) is raised if the fraction of good pixels (i.e. positive exposure time based on the observation mask) within the count-extraction aperture falls below 75%. This may occur for example, close to CCD edges or in regions with bad pixels. The choice of threshold is empirically determined to allow this flag to trace in a satisfactory manner CCD edges (see Fig. 3).
· The second bit (number 1) is raised if the fraction of good pixels within the background-extraction region falls below a threshold. For Pointed observations the observation masks is used to define good pixels (positive exposure time). For this type of observation the threshold below which the flags is raised is set to 70%. In the case of Slew observations the background is estimated from the image itself after masking out detections and the background extraction area is much larger (annulus with inner/outer radii 60 and 120 arcsec) than that of Pointed observations. As a result in this case the background mask is used to define good pixels (positive exposure and not in the vicinity of detections). The threshold above which the flag is raised is also different from that of the Pointed observations and is set to 50%. The threshold values are determined empirically so that they trace the edge of the Field-Of-View of a given observation (see Fig. 3).
· The third bit (number 2) is raised if the background region contains zero counts. This occurs often in the soft band (0.2­2keV) of the Slew Survey observations, i.e.about 40­50% of the pixels in these data fall under this category. It should be emphasized that a zero value for the background is not a problem for the determination of upper limits. For that reason it was decided to switch this flag off and not raise it in the case of Slew Survey observations. This
MNRAS 000, 1­20 (2021)

The RapidXMM Upper Limit Server 7
flag remains nevertheless useful in the case of Pointed observations, since a zero background in this case may indicate potential issues.
· The fourth bit (number 3) is raised if the pixel lies close to a detected source. The proximity of a pixel to an X-ray detection is determined using the source mask. If for a given pixel there is overlap between the source extraction aperture of radius  and the source mask then the flag is raised. Some XMM Slew observations do not contain a PPS source list. No source flagging is done in this case.
Before passing the generated data to the next stage of the RapidXMM pipeline two sanity checks are carried out. It is first tested if any of the upper limits associated with exposed pixels on an image has a value of zero, infinity or NaN (Not-a-Number). Such values should not occur and indicate potentially problematic observations or non-anticipated problems during the calculation. The second test checks if all the upper limits on image have a flagged raised. This test catches instances of problematic observations in the context of upper limit calculation. This may happen for example, in the case of small window-mode observations, in which only the central CCD window is exposed. The available area in this case is small and it may happen that all pixels are flagged because of insufficient source-free regions for the background estimation. If any of these tests is positive, the process is interrupted and the data corresponding to this image are rejected. Additionally there are Obs.IDs, for which the PPS, for various technical reasons, cannot produce images, exposure maps and/or background maps (relevant to Pointed observations only) for some or all the exposures within the observation. If any of these products is missing no upper limits can be calculated for the relevant exposure.

4.4 HEALPix projection

A key motivation of the RapidXMM project is to develop a method-

ology that enables the fast retrieval of upper limits at an arbitrary

set of input sky coordinates. The first step to achieve this is to pre-calculate the upper limits within the XMM-Newton footprint

and store them in a database. This eliminates overheads associated

with the real-time calculation of upper limits and enables nearest-

neighbor queries to the database given a set of input positions. Such

positional searches however, are cumbersome and therefore further

optimisations are needed to facilitate the fast retrieval of the stored

upper limits. The Hierarchical Equal Area isoLatitude Pixelisation

(HEALPix, Górski et al. 2005) of the sky is used to address this

issue. The HEALPix scheme splits the 2-dimensional surface of

the sphere into equal area cells that are uniquely identifiable via an integer number.7 There is a one-to-one correspondence between

the (sky) position of the cell on the sphere and its integer number

and therefore, nearest-neighbor searches using sky coordinates are

reduced to an integer matching exercise. This approach requires that

the estimated upper limits are resampled to the HEALPix grid of

cells. An important parameter in this exercise is the spatial resolu-

tion of the HEALPix tessellation that defines the size of cells. The

decision on the HEALPix resolution is a trade-off between accu-

rately describing spatial variations across the sky and size of the final

database. The HEALPix

parameter controls the resolution of

the grid. A value of

=16 is adopted for Pointed observations

and 15 for the Slew survey. These correspond to cell sizes of about

3.2 and 6.4 arcsec respectively and are comparable to the pixel size

7 RapidXMM uses the HEALPix nested numbering scheme.

8 Ruiz et al.

Table 2. Upper limit quality flag bits. The first column lists the bit number and the second column is the corresponding flag value. The third column provides a short description of the flag-raising condition.

Bit Number Flag Value Description

0

1

Fraction of exposed pixels within the count extraction aperture is lower than 0.75

1

2

Fraction of good pixels within the background extraction aperture is lower than 0.7 (Pointed) or 0.5 (Slew)

2

4

Total counts in the background extraction region is zero (Pointed only)

3

8

Pixels lies in the vicinity of a source

of the XMM-Newton PPS images (4.4 arcsec). We adopt a lower resolution for the Slew survey because of the low background of this dataset, which results into a more homogeneous spatial distribution of upper limits compared to Pointed observations.
Next we describe how the data products generated in Sect. 4.2 are projected onto the HEALPix grid. The output of the upperlimit calculation stage are 2-dimensional images of upper limits and associated products (integrated counts, background expectations levels, mean exposure times, quality masks) in different energy bands and for each exposure or patch within an Obs.ID. Each of these images has the same pixel scale as the input PPS products (typically 4.4 arcsec). Each HEALPix cell is assigned the upper limits (1, 2, 3) and associated products (source counts, background counts, average exposure time, area ratio and flags) of the imagepixel that lies nearest to each centre. Cells assigned to non-exposed pixels are discarded. In the case of Slew survey, there is significant overlap between patches in a slew and therefore duplicates have to be removed to produce a unique list of HEALPix cells. Among each group of repeating cells in overlap regions the one with the best quality flag or those with the highest background counts are kept.
The final product of the HEALPix projection stage is a list of unique HEALPIx cells for each exposure in an Obs.ID. Each of these cells is associated with upper limits and the products generated during the calculation stage (e.g. extracted counts, background expectation levels, mean exposure times, flags) at different energy bands. The list of quantities assigned to each cell are listed in Appendix A. Meta-data associated with the exposure or patch, such as Obs.ID number, XMM-Newton observation mode, EPIC detector and filter, observation date, are also generated.

4.5 The RapidXMM database

The final products of Sect. 4.4, i.e. list of HEALPix cells with their

corresponding upper limits and ancillary data, are stored in the

RapidXMM database implemented in a PostgreSQL 12.0 server.

The Pointed and Slew survey data are stored in distinct tables with

identical structure. The Schema of these tables is presented in detail

in Appendix A. By using this simple database structure we mini-

mize the use of joint queries and reduce the search response time.

As explained in Sect. 4.4 above, the use of the HEALPix technol-

ogy converts nearest-neighbor searches by sky-cooordinate into an

integer-matching exercise of the corresponding HEALPix cell num-

bers. The fields containing these integer cell numbers (

) are

indexed (i.e. an specific look-up table is generated for the field).

This is a common technique in database design to speed-up queries

using a selected field when the table has a very large number of en-

tries. The RapiXMM database is accessible from the XMM-Newton

Science Archive. More details can be found in Section 8.

4.6 Comparison with the

task of SAS

The RapidXMM methodology for estimating upper limits based on

aperture photometry is similar to the functionality offered by the

task of SAS, which is currently used by HILIGT (Saxton

et al. 2021; König et al. 2021). Nevertheless, the RapidXMM analy-

sis differs from that of

in a number of important ways. Non-

exposed areas of the XMM-Newton field of view (e.g. CCD gaps,

field edges) are accounted for in the RapidXMM analysis pipeline by

measuring the fractional aperture area with positive exposure time.

RapidXMM assumes Poisson statistics for the estimation of upper

limits (e.g. Equation 7) independent of the number of counts in the

extraction aperture. The current implementation of

(SAS

version

_20201028_0905-19.0.0) switches to a Gaussian

approximation if the total counts in the extraction aperture exceed

the value of 80. RapidXMM uses one-sided probabilities to define

the 1, 2 and 3 confidence intervals as opposed to two-sided

for the

task. For input positions in the vicinity of X-ray de-

tections RapidXMM does not return upper limits, only photometry

products,e.g. total counts, backgrouns, exposure time.

5 QUALITY ASSESSMENT AND UPPER-LIMIT STATISTICAL PROPERTIES
This section presents the quality assessment and the statistical properties of the products stored in the RapidXMM database, such as upper limits, extracted image counts, estimated background levels and exposure times.
First we test the X-ray photometry capabilities of RapidXMM. The count-rates of known X-ray sources are estimated using the RapidXMM products and then compared with those determined from external X-ray catalogues. This exercise does not directly assess the quality of the RapidXMM upper limits, but tests the consistency of the components that enter into the upper limit calculation (e.g. extracted counts, background levels, mean exposure times) with independent estimates. In the case of Pointed Observations the adopted external catalogue is the 4XMM-DR9 (Webb et al. 2020). For the Slew survey we use the 2nd XMM Slew Survey Catalogue (XMMSL2),8 which is produced following the methods described in Saxton et al. (2008). The second set of tests explores the overall statistical properties of the RapidXMM upper limits. This provides an overview of the dependence of the estimated upper limits on the background level, the exposure time and the XMM-Newton detector.
Because of differences in the analysis of Pointed and Slew Survey Observations, the quality assessment results for these two sets of data are presented separately.
8 https://www.cosmos.esa.int/web/XMM-Newton/xmmsl2-ug
MNRAS 000, 1­20 (2021)

log10 (RATERapidXMM)

log10 RATE

1

PN 0.2-2keV

0

PN 2-12keV PN 0.2-12keV

1

2

3

4

5 1 0 1

5

4

3 log10 (RA2TE4XMM) 1

0

1

PN, 0.2-2keV

PN, 2-12keV

PN, 0.2-12keV

0.2-2keV

2-12keV

0.2-12keV

4.0

4.0

4

3.5

3.5

3.0

3.0

3

2.5

2.5

2.0

2.0

2

1.5

1.5

1.0

1.0

1

0.5

0.5

0.0

0.0

0

0.4 0.2 0.0 0.2 0.4 (RATER0A.P4ID 0.R2A0T.E04XM0.M2)/R0A.4TE4XMM 0.4 0.2 0.0 0.2 0.4

relative fraction

Figure 4. Comparison between the 4XMM-DR9 and RapidXMM count rates for the PN detector. Top set of panels: the large window plots the 4XMM-DR9 count-rate vs the RapidXMM one. The smaller window underneath the main one shows the count-rate fractional difference between the 4XMM-DR9 and RapidXMM as a function of the 4XMM-DR9 countrate. Each datapoint corresponds to a unique X-ray detection selected from the 4XMM-DR9 catalogue. The different colours are for each of the three RapidXMM energy bands, 0.2­2 keV (blue), 2­12 keV (red) and 0.2­12 keV (green). The red and green set of points have been offset by 1 dex and ­1 dex in the vertical axis for clarity. The dotted lines show the one-to-one relation. Bottom set of panels: distribution of the fractional difference between the 4XMM-DR9 and RapidXMM count rates. Different energy bands are shown in separate panels.

5.1 Pointed Observations

In the case of Pointed Observations the photometry of the X-ray sources in the 4XMM-DR9 catalogue (Webb et al. 2020) is compared to that determined independently by querying the RapidXMM database at the corresponding source positions. Each of the three EPIC cameras (PN, M1, M2) and each of the three RapidXMM energy bands (0.2­2, 2­12 and 0.2­12 keV) are independently analysed. The RapidXMM count rate at fixed energy band and for a given EPIC detector is

RATERapidXMM = ( - )//EEF,

(10)

where  is the total number of counts within the RapidXMM extraction aperture (15 arcsec for Pointed),  is the expected background level,  is the exposure time and EEF is the encircled energy fraction. Equation 10 provides an estimate of the sources' count rates in the energy intervals 0.2­2, 2­12 and 0.2­12 keV. These should be compared to the 4XMM-DR9 photometry. The 0.2­12 keV band is one of the standard photometry bands of the 4XMM-DR9 catalogue and therefore for this energy interval the 4XMM-DR9 and RapidXMM count-rates can be directly compared. This is not the case how-

MNRAS 000, 1­20 (2021)

The RapidXMM Upper Limit Server 9
ever, for the RapidXMM bands 0.2­2 and 2­12 keV, for which no photometry is available in the 4XMM-DR9 catalogue. The 4XMMDR9 count rates in these broad energy bands are instead synthesised by summing up the count rates in the 4XMM-DR9 narrow bands 1 (0.2­0.5 keV), 2 (0.5­1.0 keV), 3 (1.0­2.0 keV), 4 (2.0­4.5 keV) and 5 (4.5­12 keV). For a given EPIC camera the rate in the 0.2­2 keV energy interval is the sum of the 4XMM-DR9 rates in the narrow bands 1, 2 and 3. The 2­12 keV rate is determined by summing the rates of the 4XMM-DR9 bands 4 and 5. Ideally the 4XMM-DR9 counts, background values and exposure times in each of the narrow bands above should be added/averaged to yield an estimate of the 4XMM-DR9 count rate of each source via Eq. 10. However, these quantities are not among those listed in the 4XMM-DR9 catalogue.
The photometry comparison between the RapidXMM and 4XMM-DR9 is limited to secure 4XMM-DR9 sources using the detection likelihood parameters listed in that catalogue. For the 2­ 12 keV band, we apply a lower limit of 15 to the 4XMM-DR9 band 4 (2.0­4.5keV) detection likelihood parameter ({$ca}_4_DET_ML > 15, where {$ca} takes values PN, M1, M2 for each of the EPIC cameras) to select secure hard-band sources. In the case of the 0.2­2 and 0.2­12 keV bands, the 4XMM-DR9 sources with band 8 (0.2­12 keV) detection likelihood > 15 are selected, i.e. {$ca}_8_DET_ML > 15, where {$ca} is one of PN, M1, M2. We further limit the count-rate comparison to 4XMM-DR9 source that (i) are not X-ray extended by requiring that the 4XMM parameter EP_EXTENT_ML = 0, (ii) lie at off-axis angles smaller than 13 arcmin to avoid edge effects by thresholding the 4XMMDR9 parameter {$ca}_OFFAXIS, where {$ca} is one of PN, M1, M2, (iii) are not flagged by the PPS detection chain by requiring that the 4XMM-DR9 parameter SUM_FLAG is zero, (iv) avoid sources with low detector coverage (i.e. with significant overlap with masked pixels) by requiring that the 4XMM-DR9 parameter is {$ca}_MASKFRAC > 0.8, {$ca} is one of PN, M1, M2 (PSF weighted mean of the coverage of a detection as derived from the detection mask).
In practice a total of 10,000 4XMM-DR9 sources that fulfill the above criteria are randomly selected from the catalogue. The RapidXMM database is queried at these 10,000 positions and the returned values are used to determine the count rates for each EPIC camera and each of the three RapidXMM energy bands using Eq. 10. A unique 4XMM-DR9 source may be detected in more than one XMM-Newton observations, in which case the query to the RapidXMM database returns multiple products for each Obs.ID. The comparison with the 4XMM-DR9 count rates is limited to the same Obs.ID to avoid source variability issues.
The results of the photometry comparison between RapidXMM and 4XMM-DR9 are presented in Figs. 4, 5, 6 for the detectors PN, M1 and M2 respectively. The top-panel of these figures plots the 4XMM-DR9 against the RapidXMM Count Rates in the 3 energy bands 0.2­2keV (blue), 2­12keV (red) and 0.2­12keV (green). The bottom panels show the distribution of fractional difference of the two count-rates for each energy band. Overall there is good agreement between the two independent estimates. There are small systematic offsets of about 5% of less. The effect is more pronounced in the 0.2­2 and 2­12keV bands. This is primarily related to the way these count-rates are estimated. The 4XMM fluxes are the sum of the count-rates in the narrow PPS energy bands, whereas the RapidXMM ones are the sum of the counts in these bands divided by the mean exposure time. Differences in the adopted EEFs and the overall flux estimation strategy (e.g. EMLDET vs aperture photometry) also contribute to this systematic offset. The increased scatter in the CR vs CR plot for the 0.2­2keV band (blue) is be-

10 Ruiz et al.

log10 (RATERapidXMM)

log10 RATE

1

M1 0.2-2keV

0

M1 2-12keV M1 0.2-12keV

1

2

3

4

5 1 0 1

5

4

3 log10 (RA2TE4XMM) 1

0

1

M1, 0.2-2keV

M1, 2-12keV

M1, 0.2-12keV

4.0

0.2-2keV 3.5

2-12keV 4.0

0.2-12keV

3.5

3.0

3.5

3.0

2.5

3.0

2.5

2.0

2.5

2.0

2.0

1.5

1.5

1.5

1.0

1.0

1.0

0.5

0.5

0.5

0.0

0.0

0.0

0.4 0.2 0.0 0.2 0.4 (RATER0A.P4ID 0.R2A0T.E04XM0.M2)/R0A.4TE4XMM 0.4 0.2 0.0 0.2 0.4

Figure 5. Same as Fig. 4 for the EPIC-MOS1 camera.

relative fraction

log10 RATE

log10 (RATERapidXMM)

1

M2 0.2-2keV

0

M2 2-12keV M2 0.2-12keV

1

2

3

4

5 1 0 1

5

4

3 log10 (RA2TE4XMM) 1

0

1

4.0

M2, 0.2-2keV
0.2-2keV

4.0

M2, 2-12keV 2-12keV 4.0

M2, 0.2-12keV
0.2-12keV

3.5

3.5

3.5

3.0

3.0

3.0

2.5

2.5

2.5

2.0

2.0

2.0

1.5

1.5

1.5

1.0

1.0

1.0

0.5

0.5

0.5

0.0

0.0

0.0

0.4 0.2 0.0 0.2 0.4 (RATER0A.P4ID 0.R2A0T.E04XM0.M2)/R0A.4TE4XMM 0.4 0.2 0.0 0.2 0.4

Figure 6. Same as Fig. 4 for the EPIC-MOS2 camera.

relative fraction

cause of the sample selection, which uses a detection likelihood threshold in the total 0.2­12 keV band, {$ca}_8_DET_ML > 15, where {$ca} is one of PN, M1, M2. This allows the inclusion in the sample of sources with lower significance in the 0.2­2 keV band and hence higher Poisson uncertainties. Overall Figs. 4, 5, 6 show that the aperture-extracted counts, backgrounds and exposure times are consistent with the 4XMM-DR9 catalogue and provide a strong sanity check of the RapidXMM products.
Next we explore the statistical properties of the upper limits estimated by the RapidXMM machinery. The 4XMM-DR9 Multi-Order-Coverage (MOC9) map is used to randomly select a total of 10,000 positions within the sky footprint of the XMMNewton pointed observations used in the 4XMM-DR9 catalogue. The RapidXMM database is then queried at these positions and the returned products are analysed. The plots that follow are based on a total of 42,647 query results. There are multiple products returned at each position because of multiple overlapping exposures (typically PN, M1, M2) and Obs.IDs for a given input position.
Figure 7 shows the distribution of the 3 upper-limits for each energy band and EPIC detector. The width of these distributions is related to the range of exposure times of individual XMM-Newton observations in the archive and the spread in the background level among them. We further explore the dependence of the upper limits on the background level in Figure 8. This is constructed by first factoring out the impact of the exposure time on the inferred upper limits. This is achieved by multiplying the count-rate upper limits of Fig. 7 with the corresponding exposure time to convert them to upper limits in units of counts. These are then plotted as a function
9 http://xmmssc.irap.omp.eu/Catalogue/4XMM-DR9/dr4moc. fits

of background level in Fig. 8. As expected the higher the background the less sensitive the (count) upper limits. This figure also shows the diversity of background levels in the XMM-Newton archive. Finally, Fig. 9 shows the distribution of RapidXMM quality flags at the 10,000 positions for each of the EPIC detectors. As a reminder flag values in the range 1­3 identify pixels close to CCD gaps or the edge of the field-of-view. Flags  8 identify overlap with detected sources.
5.2 Slew Survey Observations
In the case of Slew Survey observations the count rates of X-ray sources in the XMMSL2 catalogue are compared against those determined independently by querying the RapidXMM database at the corresponding source positions. The RapidXMM photometry in the energy intervals 0.2­2, 2­12 and 0.2­12 keV is estimated via Eq. 10. The XMMSL2 catalogue provides count rates in the same spectral bands. The corresponding catalogue parameters are RATE_B6 (0.2­2 keV), RATE_B7 (2­12 keV) and RATE_B8 (0.2­ 12 keV).
We limit the comparison to XMMSL2 sources (i) with detection likelihood (catalogue columns DET_ML_BAND{$EN}, {$EN} = 6, 7, 8) > 20 in the energy band of interest, (ii) are not extended (catalogue columns EXT_B{$EN}==0, {$EN} = 6, 7, 8) and (iii) are not flagged by the detection chain by requiring that the logical columns VER_HALO, VER_HIBGND, VER_PSUSP and VER_FALSE are all set to false. A total of 14,588 XMMSL2 sources fulfill the above criteria. The RapidXMM database is queried at the sources' positions and the returned values (total of 72,332) are used to determine the count rates for each energy band using Eq. 10. A unique source may overlap with more than one Obs.IDs in which
MNRAS 000, 1­20 (2021)

1.0

PN, 0.2-2 keV

1500

1000

500.08

0 10 3 10 2 10 1

2000

M1, 0.2-2 keV

0.6

1500

1000

500 0.4
0 10 3 10 2 10 1 M2, 0.2-2 keV
2000 1500.02 1000 500
0.00.0 10 3 10 2 100.21

The RapidXMM Upper Limit Server 11

PN, 2-12 keV

PN, 0.2-12 keV

1500

1500

1000

1000

500

500

100 0 10 3 10 2 10 1 100 0 10 3 10 2 10 1 100

M1, 2-12 keV

2000

M1, 0.2-12 keV

1500

1500

1000

1000

500

500

100 0 10 3 10 2 10 1 100 0 10 3 10 2 10 1 100

M2, 2-12 keV 2000 1500 1000

M2, 0.2-12 keV
2000 1500 1000

500

500

100

0 co01u.04nt3-rate1032 up1p0er1 l0i.m6 1it00

0 10 30.8 10 2 10 1 110.00

Figure 7. Distribution of count-rate 3 upper-limits for the EPIC-PN (top row), EPIC-MOS1 (middle row) and EPIC-MOS2 (bottom row) detectors. The left column shows the 0.2­2 keV energy band, the middle column corresponds to the 2­12 keV band and the right column is for the 0.2­12 keV band. These histograms are based on the upper limits returned by the RapidXMM database for a total of 10 000 random sky positions within the 4XMM-DR9 footprint.

case multiple count-rates are estimated. The comparison with the XMMSL2 is limited to the same Obs.ID to avoid source variability.
The results of this comparison are presented in Figure 10. The top-panel plots the XMMSL2 against the RapidXMM count rates in the three energy bands 0.2­2 keV (blue), 2­12 keV (red) and 0.2­12 keV (green). The bottom panel shows the distribution of the fractional difference of the two count-rates for each energy band. Overall there is acceptable agreement between the two independent estimates although there is evidence in Fig. 10 that the RapidXMM count rates lie systematically below the XMMSL2 ones. This is manifested by a systematic offset of about 5­7% of the peaks of the distributions in that figure toward negative values and the stronger tails at negative count-rate fractional difference. We checked that this discrepancy is not related to differences in the background or exposure time estimation between the XMMSL2 and RapidXMM. Instead sources in the tails of the distributions of Figure 10 show a systematic offset in the total net counts determined by RapidXMM and the XMMSL2 analysis pipeline. Visual inspection of a sample of sources with discrepant photometry indicates that the differences
MNRAS 000, 1­20 (2021)

are because of (i) residual artifacts on the Slew images, such as cosmic-ray hits, (ii) proximity to X-ray extended sources, (iii) the different methods of measuring count rates adopted by RapidXMM and the XMMSL2, i.e. aperture photometry versus PSF fitting.
Next we explore the statistical properties of the Slew upper limits estimated by the RapidXMM machinery. A total of 10,000 random positions on the sky are generated. The RapidXMM database is then queried at these positions and the returned products are analysed. The plots that follow are based on a total of 25,693 query results. There are multiple products returned at each position because of overlapping Obs.ID footprints at a given input position. Figure 12 shows the count-rate 3 upper limits at the queried positions at different bands. Because of the relatively homogeneous exposure time of the Slew observations and the very low background values the width of these distributions is primarily related to the number of extracted counts within the RapidXMM aperture. This is demonstrated in Fig. 12 which shows the 3 count upperlimit (i.e. count-rate upper-limit multiplied by the corresponding exposure time) as a function of the background level. The stripes in

count upper limit

12 Ruiz et al.

1.0

PN, 0.2-2 keV

103

102 0.8
101 100 101 102 103 M1, 0.2-2 keV
100.63

PN, 2-12 keV 103

102

101 100

101 102 M2, 2-12 keV

PN, 0.2-12 keV 103

102

101

103

100

103

101 102 103 M1, 0.2-12 keV

102

102

102

100.41

101

100 101 102 103

M2, 0.2-2 keV

103

103

0.2

102

102

100 101 102 M2, 2-12 keV

101 100 101 102 103 M2, 0.2-12 keV
103
102

100.010.0 100

101

01.022

101 103

0.b14a00ckgro1u0n1d cou1n02t0s.6

101 100 0.8101 102 1031.0

Figure 8. 3 count upper-limit as a function of the background level. The count upper-limits are estimated by multiplying the count-rate upper-limits returned by the RapidXMM database with the corresponding exposure time. The panels are as in Fig. 7.

110.04

PN

100.83 0.6 100.42

100.21

M1 104 103 102 101

M2 104 103 102 101

100.000.00 1 2 3 4 5 6 7 8 9 01.0211 12 13 14 15 100 0 1 02.43Ra4pi5dX6M7M 8fla9g1v0a1lu1e1201.63 14 15 100 0 1 2 3 4 05.8 6 7 8 9 10 11 12 13 14 115.0

Figure 9. Distribution of upper-limit quality flags for HEALPix cells on the EPIC-PN (left panel), EPIC-MOS1 (middle panel) and EPIC-MOS2 (right panel) detectors. These histograms have been constructed using the quality flags returned by the RapidXMM database for a total of 10 000 random positions selected within the 4XMM-DR9 footprint.

MNRAS 000, 1­20 (2021)

The RapidXMM Upper Limit Server 13
Table 3. Selection criteria to identify 4XMM-DR9 sources that overlap with the XMM-XXL field and show large level of variability between observation epochs.

4XMM-DR9 parameter description

Number of sources

30 <RA< 39 deg -7.5 <DEC< -2.5 deg
PN_8_DET_ML>20 EP_EXTENT_ML=0
PN_OFFAX<13 arcmin

Right Ascension Declination EPIC PN detection likelihood EPIC extension likelihood EPIC-PN off-axis angle

15101
11440 10124 8759

Figure 10. Comparison between the XMMSL2 and RapidXMM count rates. Top set of panels: XMMSL2 source count-rate vs RapidXMM count-rate at the sources' positions. Each datapoint corresponds to a unique X-ray detection in the XMMSL2 catalogue. The different colours correspond to the energy bands, 0.2­2 keV (blue), 2­12 keV (red) and 0.2­12 keV (green). The red and green set of points have been offset by 1 dex and ­1 dex in the vertical axis for clarity. The dotted lines show the 1­1 relation. Bottom set of panels: distribution of the fractional difference between the XMMSL2 and RapidXMM count rates. Different energy bands are shown in separate panels.
this plot correspond to different integer number of extracted counts within the aperture. The lower stripe corresponds to zero counts. Figure 13 shows the distribution of the RapidXMM quality flags in the case of the Slew survey observations. The density of sources in the Slew survey is low and that reflects on the small number of positions with flag values of 8 or greater. The vast majority of positive flags is related to the edge of field of view of the slew observations.
6 SCIENCE APPLICATIONS
This section presents two simple show-case examples of scientific applications using the RapidXMM database. In Sect. 6.1 we show how RapidXMM can be employed for the identification of extreme X-ray variability. In Sect. 6.2 we use RapidXMM to perform stacking analysis of astrophysical populations that are not individually detected at X-rays.
6.1 Vanishing X-ray sources
The goal is to identify sources that disappear between different XMM-Newton observation epochs because of large-amplitude variations of their flux. We focus in particular on examples of flux suppressions that make a given source disappear into the noise and
MNRAS 000, 1­20 (2021)

below the formal detection limit of an observation. The choice of searches of such sources is that they provide an excellent demonstration of the transient X-ray sky that missions like eROSITA (Merloni et al. 2012) will systematically explore.
The RapidXMM database is queried at the positions of 4XMMDR9 sources. Each input position may overlap with more than one XMM-Newton pointings. In at least one of these pointings the sources are detected by the XMM-Newton Processing Pipeline Subsystem (PPS) and are registered in the 4XMM-DR9 catalogue. A source however, may not be formally detected in all the observations it overlaps with. This may happen if the effective exposure time at the source position is low (e.g. shallow observations or large off-axis angles), if there are large variations in the background level of the overlapping XMM-Newton pointings or if the source's flux varies substantially between observations. The latter is the focus of this section. It is possible to identify such cases by comparing the count-rate of unique sources in 4XMM-DR9 with the countrate upper limits at the various epochs that the source positions under consideration have been observed by XMM-Newton. If the upper limit of a given source lies significantly below the catalogued source count-rate then this is a candidate vanishing source.
The RapidXMM infrastructure is well suited for this type of searches. The database contains integrated counts, mean exposure times and expected background levels within 15 arcsec apertures in a grid of positions separated by about approximately 3 arcsec. Quality flags are included to indicate if a position in the database overlaps with an X-ray source detected by the PPS detection chain, or if it lies close to the edge of the field of view of an XMM-Newton pointing. In these cases no upper limits are determined. Overlapping observations are analysed independently thereby enabling access to multi-epoch information. It is therefore straightforward to carry out X-ray photometry at 4XMM-DR9 source positions and query upper limits, if available, in all the multi-epoch observations for a given sky position.
For this demonstration we choose to use the equatorial field of the XMM-XXL survey (Pierre et al. 2016; Liu et al. 2016), because of the rich set of multi-epoch observations over an 18year baseline. They include some of the largest extragalactic survey programmes carried out by XMM-Newton, such as the XMM Large Scale Structure survey (XMM-LSS; Pierre et al. 2007), the Subaru/XMM-Newton Deep Survey (SXDS; Ueda et al. 2008), the XMM-XXL survey (Pierre et al. 2016) and the XMM-SERVS (Spitzer Extragalactic Representative Volume Survey Chen et al. 2018). Additionally, this field benefits from deep photometric observations and extensive follow-up spectroscopic programmes (e.g. see Georgakakis et al. 2017), some of which have targeted specifically X-ray sources (e.g. Stalin et al. 2010; Menzel et al. 2016). These

14 Ruiz et al.

1.00

PN, 0.2-2 keV

400.0705

2000..025050

0.000.0

100

0.2 101

PN, 2-12 keV

4000

4000

2000

2000

0 co0u.4nt-ra1t0e0 3 upper1l0i.1m6 it

0

PN, 0.2-12 keV

0.1800

101 1.0

Figure 11. Distribution of count-rate 3 upper limits for the Slew Survey. The left column shows the 0.2­2 keV energy band, the middle column shows the 2­12 keV band and the right column show the 0.2­12 keV band. The histograms are constructed using the upper limits returned by the RapidXMM database for a total of 10 000 random positions distributed across the sky.

13.0

PN, 0.2-2 keV

30

PN, 2-12 keV

30

PN, 0.2-12 keV

02.58

25

25

02.06

20

20

01.54

15

15

01.02

10

10

0.050.0 10 1

100.02

5 0.1b40ac1kgroun1d00count0s.6101 5

10 10.8 100

101 1.0

Figure 12. 3 count upper limit as a function of the background level. The count upper limit is estimated by multiplying the count-rate upper limit returned by the RapidXMM database with the corresponding exposure time. The data points correspond to the upper limits returned by the RapidXMM database for a total of 10 000 random positions distributed across the sky. The panels are as in Fig. 11.

count upper limit

Table 4. List of XMM-XXL variable sources selected to have ratio between 4XMM-DR9 count rate and RapidXMM 3 upper limit > 4. The columns are (1) 4XMM-DR9 identification number, (2) Obs.ID on which the source is detected, (3) Right Ascension in J2000 of the detected X-ray source, (4) Declination in J2000 of the detected source, (5) Modified Julian Date of the XMM-Newton observation, (6) logarithm base 10 of the 4XMM-DR9 count rate in the 0.2­2 keV band of the source estimated by summing the count-rates in 4XMM-DR9 bands 1 (0.2­0.5 keV), 2 (0.5­1 keV) and 3 (1­2 keV), (7) XMM-Newton Obs.ID on which the source is not detected and an upper limit is estimated, (8) logarithm base 10 of the count rate 3 upper limit in the 0.2­2 keV band stored in the RapidXMM database, (9) Modified Julian Date of the XMM-Newton observation to which the upper limit corresponds, (10) ratio between 4XMM-DR9 count rate and RapidXMM 3 upper limit in the 0.2­2 keV band.

4XMM ID (1)

Det. Obs.ID (2)

RA (J2000)
(3)

DEC (J2000)
(4)

Det. MJD (5)

207471901320005 206776901400003 207851023010096 207935812010004 2078045070100091 2011268010100132

0747190132 0677690140 0780451201 0793581201 0780450701 0112680101

2:02:00.223 2:02:18.952 2:25:41.988 2:22:03.158 2:25:41.672 2:27:07.275

-7:06:48.016 -7:04:50.703 -5:11:17.468 -5:03:11.168 -4:34:16.748 -4:04:36.667

56687 55775 57763 57754 57614 52302

1 Source with 4XMM ID 207804507010009 is associated with a  = 0.601 AGN 2 Source with 4XMM ID 201126801010013 is associated with a  = 0.492 AGN

log10 (Cnt Rate) (cnt/s; 0.2­2 keV)
(6)
-1.70 -1.61 -2.15 -1.59 -1.63 -2.04

UL Obs.ID
(7)
0677690140 0747190132 0111110301 0111110501 0112681001 0780451701

log10 (Upper Limit) (cnt/s; 0.2­2 keV)
(8)
< -2.52 < -2.43 < -2.77 < -2.64 < -2.83 < -2.64

UL MJD
(9)
55776 56687 52093.3 52094.3 52304.7 57763.8

ratio
(10)
> 6.53 > 6.44 > 4.16 > 11.18 > 15.70 > 4.00

ancillary data facilitate the multiwavelength characterisation of interesting variable sources. The input positions to the RapidXMM server are selected from the 4XMM-DR9 catalogue after applying spatial filters to isolate sources in the area of the XMM-XXL field, a detection likelihood cut to minimise spurious sources, an X-ray

extension flag to exclude extended emission and an off-axis angle limit to avoid artifacts close to the edge of the field-of-view. These criteria are listed in Table 3. Only EPIC-PN detections are considered because of the higher sensitivity of this camera. We choose the 0.2­2 keV band to compare the 4XMM-DR9 fluxes with the

MNRAS 000, 1­20 (2021)

log10 RATE log10 [RATERapidXMM(0.2 2keV)]

104 103 102 101
100 0 1 2 3 R4ap5idX6M7M 8fla9g v1a0l1u1e12 13 14 15

Figure 13. Distribution of upper-limit quality flags for HEALPix cells in the Slew Survey.

0.4 0.2 0.8 1.4 2.0 2.6 3.2 3.8 11000001........51731593 4.0

Upper Limits Detections

XMM-XXL, 0.2-2keV, EPIC-PN

3.5 3.0 log120.[5RATE24.X0MM(0.12.5 2ke1V.0)] 0.5 0.0

Figure 14. Comparison between the 4XMM-DR9 and multi-epoch RapidXMM photometry for sources in the XMM-XXL that fulfill the criteria listed in Table 3. The top panel plots the 4XMM-DR9 count-rate against the RapidXMM one. The latter is determined at the position of each 4XMM-DR9 source and for all the Obs.IDs with which the source in question overlaps. The blue dots correspond to the same Obs.ID as the one of the 4XMM-DR9 source. In this case the RapidXMM count rate is determined via Eq. 10. The red triangles are 3 upper limits. Each of them is estimated for Obs.IDs on which the corresponding 4XMM-DR9 source is not formally detected. The short-dotted line shows the one-to-one count-rate relation. The blue dots track this line and demonstrate the good agreement between the 4XMM-DR9 and RapidXMM photometry for detected sources (see also Fig. 4). The majority of the upper-limit data points lie above or close to the one-to-one relation. A small fraction however, scatter below this line and therefore the corresponding upper limits are fainter than the count-rate of the catalogued X-ray source. The dot-dashed line lies a factor of 4 below the one-to-one relation. All data points below this line have a ratio between 4XMM-DR9 count rate and RapidXMM upper limit > 4. catalogue. The bottom panel plots the fractional difference between the 4XMM-DR9 and RapidXMM photometry as a function of 4XMM-DR9 count rate. The data point colors/shape and the lines have the same meaning as in the top panel.

MNRAS 000, 1­20 (2021)

The RapidXMM Upper Limit Server 15
RapidXMM upper limits because of the higher effective area of XMM-Newton at these energies, which translates to higher sensitivity. The 4XMM-DR9 photometry in this band is estimated as the sum of the count rates in the 4XMM-DR9 bands 1 (0.2­0.5 keV), 2 (0.5­1 keV) and 3 (1­2 keV).
Figure 14 presents the comparison between the 4XMM-DR9 catalogued count-rates against those determined by querying the RapidXMM database. All the datapoints on this figure are 4XMMDR9 sources in the XMM-XXL field that fulfill the selection criteria of Table 3. The RapidXMM photometry is determined at the position of each 4XMM-DR9 sources and separately for all the multiepoch Obs.IDs that these sources lie on. For Obs.IDs on which a given 4XMM-DR9 source is not formally detected by the PPS, the RapidXMM photometry plotted in Fig. 14 corresponds to the 3 upper limit (red triangles). For the same Obs.ID as the one on which a given 4XMM-DR9 source is detected the RapidXMM count-rate is estimated via Eq. 10 (blue dots). The latter set of points traces the one-to-one count-rate relation and shows the good agreement between the 4XMM-DR9 and RapidXMM photometry for the same Obs.ID. This point has already been demonstrated in Fig. 4 for sources selected in the full 4XMM-DR9 catalogue. The bulk of the upper-limits in Fig. 14 lie above or close to the one-to-one relation. This is the case of multi-epoch observations that overlap with the position of a given 4XMM-DR9 source and are either shallower or have a higher background level than the Obs.ID on which the source in question is actually detected. There is nevertheless a small fraction of upper limits that scatter below the one-to-one relation. These are potentially interesting since they may include strongly variable sources. Spurious 4XMM-DR9 detections however, which inevitably exist in any source catalogue, will also crop up in the same region of the parameter space. Visual inspection is therefore necessary to identify bona-fide vanishing sources. For this demonstration we choose to eyeball the sources with the larger deviation from the one-to-one relation by applying an arbitrary threshold of > 4 to the ratio between the 4XMM-DR9 count rate and the 3 upper limit stored in the RapidXMM database. These are the sources that lie below the dot-dashed line in Fig. 14. Table 4 presents X-ray information on the selected bona-fide vanishing sources with flux ratio > 4 following the visual inspection. The X-ray thumbnails for these sources are shown in Fig. 15. This figure includes two X-ray images for each 4XMM-DR9 source, one from the Obs.ID on which it is detected, and the second from the Obs.ID on which it disappears. Optical spectroscopy from the various SDSS spectroscopic surveys in the XMM-XXL area (see Menzel et al. 2016) is available for two of the sources listed in Table 4, 4XMM ID 207804507010009, 201126801010013. Both of them are AGN at moderate redshifts,  = 0.601 and 0.492 respectively. It is also interesting to note that the first of the two sources varies by more than 1 dex in flux over a period of nearly 14 years.
6.2 Stacking
Stacking techniques are frequently used in X-ray astronomy to explore the mean X-ray properties of an astrophysical population of sources, whose individual members are too X-ray faint to be individually detected. Stacking is the accumulation of X-ray photons at the positions of sources that lie below the detection threshold of a given dataset. Given large enough numbers of input sources, this approach may yield a statistically significant, yet intrinsically weak, astrophysical signal that places constraints on the ensemble X-ray properties of the population, e.g. mean flux. This principle has been applied to both X-ray images that accumulate X-ray photons in fixed

16 Ruiz et al.

Figure 15. X-ray thumbnails of the vanishing X-ray sources listed in Table 4. Each pair of images corresponds to a single 4XMM-DR9 source. The images on the left correspond to the Obs.IDs on which the sources are detected. The images on the right correspond to the Obs.IDs on which the sources disappear. The Obs.ID is also shown on each thumbnail. The unique identification number of each source in the 4XMM-DR9 catalogue is shown on the images on the right. In all panels the circles are 40 arcsec in radius. All images correspond to the 0.2­12 keV band.

energy bands (e.g. Georgakakis et al. 2003; Hickox & Markevitch 2007; Hickox et al. 2007; Georgakakis et al. 2008; Chen et al. 2013) and X-ray spectra (Streblyanska et al. 2005; Corral et al. 2008; Falocco et al. 2014). In this paper we focus on the former. This is equivalent to performing aperture photometry at the sources' positions. Image sections (e.g. apertures) in the vicinity of the sources of interest are extracted and coadded to increase the signal-to-noise ratio (SNR). The resulting stacked image can then be analysed to yield information on the average flux or X-ray hardness of the population. It is emphasised that the X-ray stacking described above is different from the coaddition of overlapping XMM-Newton observations to improve the statistics of individual sources and detect fainter ones (e.g. XMM Stacked catalogue, Traulsen et al. 2019). Our application coadds the X-ray photons at input positions spread across multiple and typically non-overlapping observations.
The RapidXMM database is well suited for stacking analysis because (i) all data needed for X-ray aperture photometry (counts around the positions of interest, background estimations and expo-

sure times) are readily available, and (ii) the data is organised in a regular grid (the HEALPix tessellation) that facilitates the extraction of counts at different sky positions and their coaddition via the translation into a new reference frame with a common centre. We demonstrate these features of the RapidXMM database using a sample of optically selected QSOs identified in the SDSS (Lyke et al. 2020) that lie within the footprint of the XMM-XXL. Only the EPIC-PN camera and Pointed observations are used in the analysis.

There are a total of 3329 QSOs in Lyke et al. (2020) catalogue

that are within the sky region observed by XMM-XXL. These are

split into two samples. The first contains 2917 QSOs that have a

4XMM-DR9 counterpart within 5 arcsec off the optical position.

This is defined as the X-ray detected subsample. The second group consists of 255 objects in regions observed by XMM-Newton but

far from any 4XMM source (> 1 arcmin) to avoid contamination

issues. The latter class of sources is the focus of the stacking analysis,

which proceeds as follows. For each optical QSO we find the unique

HEALpix cell number

( =16 for Pointed observations)

MNRAS 000, 1­20 (2021)

Energy band 6 Energy band 7 Energy band 8

Stack SNR (median) Stack net CR (median)

0.0000 0.0002 0.0004 0.0006 0.0008 0.0010 0.0012 0.0014

0

5

10

15

20

Figure 16. Demonstration of stacking analysis using the RapidXMM database. The images on the top show the coadded net count-rate at the positions of 255 non-X-ray detected SDSS QSOs selected in the XMMXXL field. Each image corresponds to a HEALPix grid with size of 13 × 13 cells. The cells have a linear size of about 3 arcsec. Each panel corresponds to one of the RapidXMM energy bands, 0.2­2keV (left), 2­12keV (middle) and 0.2­12keV (right). The bottom set of images shows the corresponding SNR of the stacked signal in each of the above energy bands.

SNR / pixel net counts / s / pixel

11..50 1e 3Energy band 6
10..08 0.5 0.6

1e 3Energy band 7 1.5 1.0 0.5

1e 3Energy band 8 1.5 1.0 0.5

02.04

20

20

15

15

15

01.02

10

10

5

5

5

0.0
0.0 2 40.2 6 Dista0n0.c4e t2o cen4tra0l.6n6pixel 0 0.82 4 61.0

Figure 17. Radial profiles of the net-count rate (top panels) and SNR (bottom panels) derived from the images shown in Fig. 16. The distance to the central pixel is shown in the horizontal axes and is measured in HEALPix cells.
Energy band 6 Energy band 7 Energy band 8

Stack SNR (median) Stack net CR (median)

0.0000 0.0002 0.0004 0.0006 0.0008 0.0010 0.0012 0.0014

0

5

10

15

20

Figure 18. Same as in Fig. 16, but using random positions in the XXL field, far (> 1 arcmin) from 4XMM sources or SDSS QSO.

MNRAS 000, 1­20 (2021)

SNR / pixel net counts / s / pixel

The RapidXMM Upper Limit Server 17

1.0 1e 4Energy band 6 1.5 02..80 02..65

1.0 1e 4Energy band 7 1.5 2.0 2.5

1.0 1e 4Energy band 8 1.5 2.0 2.5

0.42 3
0.24
5 0.0
00.0.0

2.5 05.2.0

2

2

3

3

4

4

5

5

Dista0n.0c.4e to2.5centr5a.0l.6npixel 0.0 0.8 2.5

5.0 1.0

Figure 19. Radial profiles of the net-count rate (top panels) and SNR (bottom panels) derived from the images shown in Fig. 18. The distance to the central pixel is shown in the horizontal axes and is measured in HEALPix cells.

that overlaps with the source's position. The k-nearest neighbouring HEALPix cells are identified, with k=6. These are the indices of the topological immediate neighbours of the central pixel out to a distance of 6 cells. The result is a 13 × 13 grid of HEALPix cells around the optical QSO position. A graphical representation of this grid is shown in Figure 16. The motivation for this approach is to facilitate the visualisation of the stacking results. The RapidXMM database is then queried at the positions of all the cells in 13×13 grid to retrieve the corresponding counts, background levels and mean exposure times. Each of these quantities are organised in cubes with shape (13, 13, ), where  is the total number of sources in the stack. The optical QSOs may overlap with multiple XMM-Newton observations and therefore  is larger than the original size of the sample selected for stacking. Each of the RapidXMM energy bands, 0.2­2, 2­12 and 0.2­12 keV, are assigned a different set of cubes. These arrays are then used to estimate averages by integrating along the 3rd () dimension. A bootstrapping methodology is adopted to minimise the impact of outliers on the final signal. We randomly draw source samples of size  with replacement. For this application  is set to , the total number of sources in the stacking sample. We then coadd the counts, background levels and exposure times of each randomly drawn sample. These coadded values are used to calculate the count-rate via Eq. 10. This process is repeated 1000 times to estimate the median count-rate and the median absolute deviation (MAD), which serves as a measure of the statistical uncertainty of the stacked signal. The SNR of the stack is estimated as



  = ( - )/ ,

(11)

where  and  represents the sums of the counts and background levels at the positions of stacked QSO respectively. The equation above ignores the contribution of the background level error in the determination of the SNR. This is because for two reasons. Firstly in the case of Pointed observations the background levels stored in the RapidXMM database are determined from the PPS background maps. These represent a model of the background of the EPIC cameras and therefore the Poisson nature and uncertainty of the per pixel background level is smoothed out. Secondly the RapidXMM background values are scaled to the aperture size of 15 arcsec in the case of Pointed observations. The scaling factor that is necessary to propagate uncertainties is not retained. An alternative approach that addresses the issues above is determine the background by querying the RapidXMM database at X-ray source free positions in the vicinity of the optical QSOs. For this demonstration of the

18 Ruiz et al.

1500

1500

1000

1000

500

500

010 4

10 2

100

count rate (0.2-12 keV)

010 3

10 1

101

hard-to-soft count rate ratio

Figure 20. Distribution of count rates in the total energy band (left) and the hard-to-soft count rate ratios (right) for the SDSS QSO with a 4XMM counterpart. The black dashed lines show the median value of the stacking of QSO with no X-ray counterpart.

stacking potential of the RapidXMM database we do not implement this method. The estimated SNRs should therefore be viewed as approximations.
Figure 16 shows the results of this method. Each panel of this figure shows the 13 × 13 array of HEALPix cells in each of the 3 energy bands of RapidXMM. The cells are about 3 arcsec on the side. In the top set of panels the value of each cell corresponds to the median count-rate at that position determined via the bootstrapping approach described above. The panels at the bottom row are the 13 × 13 HEALPix grid of the SNR of each cell. It is emphasised that the values of the cells in Fig. 16 are not independent, since they correspond to the integrated counts at that position within an aperture of 15 arcsec in radius. Nevertheless, the adopted representation using a 13×13 HEALPix grid helps visualise the results. This figure shows that the stacking signal is maximum close to the centre of the grid, i.e. at the QSO positions, and then gradually drops toward the edges. This trend is more evident in the soft (0.2­2 keV) and total (0.2­12 keV) bands and less pronounced in the 2­12 keV energy range. This dependence on energy of the amplitude of the stacked signal has to do with sensitivity of the EPIC-PN camera of XMMNewton as well as the soft X-ray spectral shape of the optical QSO population that is being stacked. The significance of the stacked signal is further explored in Fig. 17, which plots the radial profile of the SNR. This is estimated by averaging the values of HEALPix cells within annuli of increasing size. There is a strong signal in the soft and total bands, with SNR 10. The signal is less significant in the hard band, with SNR  5. For comparison, Figs. 18 and 19 show the stacking results using as input random positions selected in regions of the XXL far (> 1 arcmin) from X-ray sources or optical QSO. The size of this random sample is equal to the number of the XMM-XXL optical QSOs used to derive the stacking results shown in Figure 16. In the case of random positions there is no statistical significant signal or a central concentration of counts as in Figures 16, 17.
Figure 20 shows the count-rate distribution in the 0.2­12 kev band (left) and the hard-to-soft count ratio distribution (right) for QSO detected in X-rays, and the median value calculated for the Xray undetected population using our stacking analysis. As expected, it shows that the median count-rate of the X-ray undetected QSOs are lower, (1.7 ± 0.2) × 10-3 counts per second, than the mode of the X-ray detected population. On the other hand, the median hard-to-soft count ratio is similar in both populations, suggesting that both X-ray detected and undetected SDSS QSO have similar spectral shapes.

7 CONCLUSIONS
We present the development of the infrastructure for a new XMMNewton X-ray upper-limit and X-ray photometry server that is available through the XSA. We describe the pipeline that analyses XMMNewton observations to produce count-rate upper limits and aperture photometry in three energy bands (0.2­2 keV, 2­12 keV and 0.2­12 keV) for both the Pointed and Slew Survey data. The design of the database that stores these products is also discussed. The approach adopted for optimising the database for queries by sky position is based on the HEALPix tessellation of the celestial sphere. The X-ray upper limits and photometry products are projected onto HEALPix grids with spatial resolutions of about 3 arcsec in the case of Pointed observations and 6 arcsec for the Slew Survey. They are then stored into database tables that are indexed by the unique integer number of the HEALPix cells. Queries by sky-position are therefore reduced to an integer matching exercise, thereby enabling fast response times for large numbers of input positions.
We demonstrate science applications enabled by this infrastructure. We show how queries to the database at the positions of 4XMM sources can identify highly variable X-ray populations. It is further demonstrated how to perform X-ray stacking analysis of Xray faint populations. We identify a total of 255 SDSS QSOs within the XMM-XXL footprint without counterparts in the 4XMM catalogue. The photons in the database at the positions of these sources are stacked to yield a statistically significant signal.
8 DATA AND CODE AVAILABILITY
The RapidXMM database is currently accessible through the XSA10 browser interface. In addition to the RapidXMM products presented in Appendix A, the XSA web interface to the database also returns flux upper limits. These are determined by converting the RapidXMM count-rates to fluxes for a power-law X-ray spectrum with slope  = 1.7 absorbed by a Galactic column density  = 3 × 1020 cm2. These conversion factors dependent on both the camera and the filter used for a given observation and can be found at the XSA website.11
The RapidXMM database can also be queried programatically using HTTP GET requests via http://nxsa.esac.esa. int/nxsa-sl/servlet/get-uls. Only ra/dec queries are allowed through this method. The output is in JSON format (Pezoa et al. 2016) following the structure presented in Appendix A. A Python module for querying the database, and the code for the stacking analysis presented in Sect. 6.2 are available in github (https://github.com/ruizca/rapidxmm). The module allows for both positional and npixel queries, returning Astropy tables as outputs. In the future the RapidXMM database will also be accessible via HILIGT.
ACKNOWLEDGEMENTS
The authors acknowledge funding from European Space Agency through the contract 4000127837/19/ES/JD. Based on observations obtained with XMM-Newton, an ESA science mission with instruments and contributions directly funded by
10 http://nxsa.esac.esa.int/nxsa-web/ 11 https://www.cosmos.esa.int/web/xmm-newton/ epic-upper-limits
MNRAS 000, 1­20 (2021)

ESA Member States and NASA. This research has made use of data obtained from the 4XMM XMMNewton serendipitous source catalogue compiled by the 10 institutes of the XMM-Newton Survey Science Centre selected by ESA. This research has made use of data obtained from XMMSL2, the Second XMM-Newton Slew Survey Catalogue, produced by members of the XMM SOC, the EPIC consortium, and using work carried out in the context of the EXTraS project ("Exploring the X-ray Transient and variable Sky", funded from the EU's Seventh Framework Programme under grant agreement no. 607452). This research made use of Astropy,12 a community-developed core Python package for Astronomy (The Astropy Collaboration et al. 2018).
References
Chen C.-T. J., et al., 2013, ApJ, 773, 3 Chen C.-T. J., et al., 2018, MNRAS, 478, 2132 Corral A., et al., 2008, A&A, 492, 71 Esquej P., et al., 2008, A&A, 489, 543 Falocco S., Carrera F. J., Barcons X., Miniutti G., Corral A., 2014, A&A,
568, A15 Gehrels N., et al., 2004, ApJ, 611, 1005 Georgakakis A., Georgantopoulos I., Stewart G. C., Shanks T., Boyle B. J.,
2003, MNRAS, 344, 161 Georgakakis A., et al., 2008, MNRAS, 385, 2049 Georgakakis A., et al., 2017, MNRAS, 469, 3232 Górski K. M., Hivon E., Banday A. J., Wandelt B. D., Hansen F. K., Reinecke
M., Bartelmann M., 2005, ApJ, 622, 759 Harrison F. A., et al., 2013, ApJ, 770, 103 Hickox R. C., Markevitch M., 2007, ApJ, 671, 1523 Hickox R. C., et al., 2007, ApJ, 671, 1365 Jansen F., et al., 2001, A&A, 365, L1 Komossa S., Bade N., 1999, A&A, 343, 775 König O., et al., 2021, A&A, submitted Kraft R. P., Burrows D. N., Nousek J. A., 1991, ApJ, 374, 344 Krivonos R., Tsygankov S., Revnivtsev M., Grebenev S., Churazov E., Sun-
yaev R., 2010, A&A, 523, A61 LaMassa S. M., et al., 2015, ApJ, 800, 144 Liu Z., et al., 2016, MNRAS, 459, 1602 Lyke B. W., et al., 2020, ApJS, 250, 8 Matt G., Guainazzi M., Maiolino R., 2003, MNRAS, 342, 422 Menzel M.-L., et al., 2016, MNRAS, 457, 110 Merloni A., et al., 2012, preprint, (arXiv:1209.3114) Oh K., et al., 2018, ApJS, 235, 4 Pezoa F., Reutter J. L., Suarez F., Ugarte M., Vrgoc D., 2016, in Proceedings
of the 25th International Conference on World Wide Web. pp 263­273 Pierre M., et al., 2007, MNRAS, 382, 279 Pierre M., et al., 2016, A&A, 592, A1 Ricci C., et al., 2016, ApJ, 820, 5 Saxton R. D., Read A. M., Esquej P., Freyberg M. J., Altieri B., Bermejo
D., 2008, A&A, 480, 611 Saxton R. D., et al., 2019, A&A, 630, A98 Saxton R. D., et al., 2021, A&A, submitted Stalin C. S., Petitjean P., Srianand R., Fox A. J., Coppolani F., Schwope A.,
2010, MNRAS, 401, 294 Streblyanska A., Hasinger G., Finoguenov A., Barcons X., Mateos S., Fabian
A. C., 2005, A&A, 432, 395 Strüder L., et al., 2001, A&A, 365, L18 The Astropy Collaboration et al., 2018, AJ, 156, 123 Traulsen I., et al., 2019, A&A, 624, A77 Turner M. J. L., et al., 2001, A&A, 365, L27 Ueda Y., et al., 2008, ApJS, 179, 124
12 http://www.astropy.org
MNRAS 000, 1­20 (2021)

The RapidXMM Upper Limit Server 19
Van Rossum G., Drake F. L., 2009, Python 3 Reference Manual. CreateSpace, Scotts Valley, CA
Virtanen P., et al., 2020, Nature Methods, 17, 261 Webb N. A., et al., 2020, A&A, in press, p. arXiv:2007.02899 Weisskopf M. C., Tananbaum H. D., Van Speybroeck L. P., O'Dell
S. L., 2000, in Truemper J. E., Aschenbach B., eds, Society of Photo-Optical Instrumentation Engineers (SPIE) Conference Series Vol. 4012, X-Ray Optics, Instruments, and Missions III. pp 2­16 (arXiv:astro-ph/0004127), doi:10.1117/12.391545 Winkler C., et al., 2003, A&A, 411, L1

APPENDIX A: RAPIDXMM DATABASE SCHEMA

The RapidXMM database consists of two tables with the same field structure, one storing data for the Pointed observations and the other with the Slew Survey observations. Each table contains 25 fields, as follows:

(big integer): HEALPix cell number using the nested num-

bering scheme. It corresponds to a HEALPix resolution of -

=16 for the Pointed observations and

=15 for the Slew

Survey data.

(big integer): Unique Obs.ID number that the npixel and

corresponding upper limit belongs to. It is emphasised that this is an

integer not a string and therefore the leading zero that characterises

the Obs.ID numbers of Pointed Observations is removed.

_ (integer): the starting date of the observation in Modi-

fied Julian Date.

_ (integer): the end date of the observation in Modified

Julian Date.

(real): Encircled Energy Fraction used for the determination of

the upper limits (see Table 1).

_

(real): Ratio between the number of good pixels in

the source extraction region and the number of good pixels in the

background extraction region.

6_

(real): average exposure time (corrected of vi-

gneting) for the energy band 6 (0.2­2 kev).

6_ _

(integer): image counts for energy band 6 (0.2­

2 keV).

6_ _

(real): background expectation value for en-

ergy band 6 (0.2­2 keV).

6_ _ 1 (real): 1 (one sided, 84.13%) count-rate upper

limit for energy band 6 (0.2­2 keV).

6_ _ 2 (real): 2 (one sided, 97.72%) count-rate upper

limit for energy band 6 (0.2­2 keV).

6_ _ 3 (real): 3 (one sided, 99.87%) count-rate upper

limit for energy band 6 (0.2­2 keV).

7_

(real): average exposure time (corrected of vi-

gneting) for the energy band 7 (2­12 keV).

7_ _

(integer): image counts for energy band 7 (2­

12 keV).

7_ _

(real): background expectation value for en-

ergy band 7 (2­12 keV).

7_ _ 1 (real): 1 (one sided, 84.13%) count-rate upper

limit for energy band 7 (2­12 keV).

7_ _ 2 (real): 2 (one sided, 97.72%) count-rate upper

limit for energy band 7 (2­12 keV).

7_ _ 3 (real): 3 (one sided, 99.87%) count-rate upper

limit for energy band 7 (2­12 keV).

8_

(real): average exposure time (corrected of vi-

gneting) for the energy band 8 (0.2-12 keV).

8_ _

(integer): image counts for energy band 8 (0.2­

12 keV).

20 Ruiz et al.

Table A1. Description of the

bit field.

Bit Numbers Description

0 1 2 3 4 5 6 7 8­15 16­23 24­31

Set to 1 for EMOS1 data Set to 1 for EMOS2 data Set to 1 for EPN data Set to 1 when using no filter Set to 1 when using Thin1 filter Set to 1 when using Thin2 filter Set to 1 when using Medium filter Set to 1 when using Thick filter Quality flags for energy band 6 (see Sect. 4.3) Quality flags for energy band 7 (see Sect. 4.3) Quality flags for energy band 8 (see Sect. 4.3)

8_ _

(real): background expectation value for en-

ergy band 8 (0.2­12 keV).

8_ _ 1 (real): 1 (one sided, 84.13%) count-rate upper

limit for energy band 8 (0.2­12 keV).

8_ _ 2 (real): 2 (one sided, 97.72%) count-rate upper

limit for energy band 8 (0.2­12 keV).

8_ _ 3 (real): 3 (one sided, 99.87%) count-rate upper

limit for energy band 8 (0.2­12 keV).

(integer): 32 bits field containing the quality flags for the

upper limits (Sect. 4.3) and the information about the detector and

filter used in the observation (see Table A1).

This paper has been typeset from a TEX/LATEX file prepared by the author.

MNRAS 000, 1­20 (2021)

