J Braz. Soc. Mech. Sci. Eng. manuscript No. (will be inserted by the editor)
Assessment of a transient homogeneous reactor through in situ adaptive tabulation
Americo Cunha Jr · Lu´is Fernando Figueira da Silva

arXiv:2106.00755v1 [physics.flu-dyn] 27 May 2021

Received: date / Accepted: date

Abstract The development of computational models for the numerical simulation of chemically reacting flows operating in the turbulent regime requires the solution of partial differential equations that represent the balance of mass, linear momentum, chemical species, and energy. The chemical reactions of the model may involve detailed reaction mechanisms for the description of the physicochemical phenomena. One of the biggest challenges is the stiffness of the numerical simulation of these models and the nonlinear nature of species rate of reaction. This work presents a study of in situ adaptive tabulation (ISAT) technique, focusing on the accuracy, efficiency, and memory usage in the simulation of homogeneous stirred reactor models using simple and complex reaction mechanisms. The combustion of carbon monoxide with oxygen and methane with air mixtures are considered, using detailed reaction mechanisms with 4 and 53 species, 3 and 325 reactions respectively. The results of these simulations indicate that the developed implementation of ISAT technique has a absolute global error smaller than 1%. Moreover, ISAT technique provides gains, in terms of computational time, of up to 80% when compared to the direct integration of the full chemical kinetics. However, in terms of memory usage the present implementation of ISAT technique is found to be excessively demanding.
Keywords thermochemistry reduction · in situ adaptive tabulation · stirred reactor simulation · detailed reaction mechanism
A. Cunha Jr (corresponding author) · L. F. Figueira da Silva Department of Mechanical Engineering Pontif´icia Universidade Cat´olica do Rio de Janeiro Rua Marqu^es de S~ao Vicente, 225 - G´avea Rio de Janeiro, 22451-900, Brasil E-mail: americo.cunhajr@gmail.com

1 Introduction
Combustion is a physicochemical phenomena characterized by a sequence of chemical reactions (most of then exothermic) which converts fuel/oxidizer mixtures (fresh gases) into combustion products (burned gases). Due to the large amount of energy released in these exothermic reactions, the combustion process is widely used in the operation of industrial devices such as gas turbines, process furnaces, etc.
Design and optimization of devices which operate based on combustion processes is an important engineering task, which demands the development of computational models as predictive tools. Such computational models may require the solution of partial differential equations that represent the balance of mass, linear momentum, chemical species, and energy. These models may include a detailed kinetic mechanism for the description of physicochemical phenomena involved [28, 6, 22, 35]. Typically, such reaction mechanisms for mixtures of hydrocarbons with air involve tenths of species, hundreds of elementary reactions, and timescales that vary up to nine orders of magnitude [36, 20, 21].
Concerning the numerical simulation of these models, the challenge is related to reaction rate of the chemical species, which is nonlinear and presents a strong dependence with reaction mechanism dimension. Therefore, numerical simulation of a model with a detailed reaction mechanism is computationally demanding, which justifies the development of techniques to reduce the associated computational cost.
Several techniques to reduce the computational cost of these models are available in the literature. Essentially, they may be split into two classes. The first class includes techniques that seek to reduce the dimension of reaction mechanisms, such as Quasi-Steady State Ap-

2

Americo Cunha Jr, Lu´is Fernando Figueira da Silva

proximation [8], Rate-Controlled Constrained Equilibrium [13], Computational Singular Perturbation [15], the reduction to Skeleton Mechanisms [16], Intrinsic Low-Dimensional Manifold [19], Proper Orthogonal Decomposition [11], and Invariant Constrained Equilibrium Edge Pre-image Curve [26]. The second class includes techniques that seek efficient algorithms to solve complex models, such as Look-Up Table [3], ReproModeling [32], Piece-Wise Reusable Implementation of Solution Mapping [31], Artificial Neural Network [12], and In Situ Adaptive Tabulation (ISAT) [24, 29, 17, 18].
A characterization of one type of transient homogeneous reactor, using simple and complex thermochemistry, is presented in this this work. The analysis explores the effects of mixing to residence time scale ratios as reactor controlling parameter. The ISAT technique is employed to reduce the computational time spent to approximate the solution of the equations that governs the evolution of reactive mixture in this transient reactor. This work also investigates accuracy, performance, and memory usage of the present ISAT technique implementation. The accuracy analysis uses local and global metrics to quantify the error incurred by ISAT compared with a reference solution and investigates the statistical seed influence on the results. The performance is investigated by comparing the computational time gain obtained by ISAT with respect to a standard numerical integration procedure. The memory usage analysis quantifies the amount of memory used by ISAT implementation.
This work is organized as follows: the transient reactor of interest, its governing equation as well the numerical scheme used are presented in the second section. The third section presents the basic theory of ISAT technique. The fourth section discusses about the reactor configurations studied and ISAT implementation issues. Finally, in the fifth section, the main conclusions are summarized and a path for a future work is suggested.
2 Transient homogeneous reactor model
2.1 The geometry of reactive systems
In the framework of the transported probability density function (PDF) models [23], a reactive flow may be described by an ensemble of stochastic particles, which mimic the behavior of the fluid system.
Consider a transient spatially homogeneous reactive mixture evolving adiabatically and at constant pressure in a continuous flow reactor. The thermodynamical state of a fluid particle in this reactor may be completely determined by the mass fraction Yi, where

i = 1, · · · , ns, of the ns chemical species and the specific enthalpy h, which can be lumped in the composition vector defined as

 = (h, Y1, · · · , Yns )T ,

(1)

where the superscript T denotes the transposition operation. One should note that, due to the invariance of the system number of atoms, which ensures the total conservation of the mass, the components of vector  are not linearly independent.
The composition vector of each particle in this flow reactor evolves according to

d dt

=

- (,

t)

+

S(, t),

(2)

where t denotes the time,  is the rate of change due to mixing, and S is the rate of change associated with the chemical reactions. Integrating Eq.(2) from an initial time t0 to a time t one obtain the reaction mapping

t

t

R(0, t) = 0 -  (, t )dt + S(, t )dt , (3)

t0

t0

which is the solution of Eq.(2) starting from the initial composition (t0) = 0. The reaction mapping corresponds to a trajectory in composition space, which, for large values of t, tends to the equilibrium composition for the given enthalpy and mass fractions on 0. The composition space is the (ns+1)­dimensional Euclidean space where the first direction is associated with the enthalpy and the remaining ns are related to the chemical species.

2.2 Pairwise mixing stirred reactor
The classical Partially Stirred Reactor (PaSR), used in [4, 27], describes  by the interaction by exchange with the mean (IEM) micromixing model [7], but, for the purpose of testing a thermochemistry reduction technique, it is desirable to employ a mixing model that leads to a composition region accessed during the solution process which is "wider" than that provided by the IEM model. A modified version of PaSR model called Pairwise Mixing Stirred Reactor (PMSR), [24], is designed to yield a much larger accessed region, and, hence, should provide a stringent test on the ability of ISAT technique to yield a reduction in computational time.
In the PMSR model the reactor consists of an even number np of particles, initially arranged in pairs (j1, j2)

Assessment of a transient homogeneous reactor through in situ adaptive tabulation

3

such that the particles (1, 2), (3, 4), · · · , (np - 1, np) are partners. Given a time step, t, for each discrete time

kt, where k is an integer, the model is characterized

by three types of events: inflow, outflow, and pairing.

The inflow and outflow events consist of randomly se-

lecting nin = ceil

1 2

np(t/r

)

pairs of particles, being

r the residence time within the reactor, and exchang-

ing their thermodynamical properties by the proper-

ties of a prescribed inflow. The pairing event consists

of randomly selecting for pairing a number of pairs of

particles, different from the inflow particles, equal to

npair = ceil

1 2

np(t/p)

,

being

p

the

pairwise

time.

Then the chosen particles (inflow/outflow and paring)

are randomly shuffled. Between these discrete times, the

pairs of particles (j1, j2) evolve according to

d (j1) = - (j1) - (j2) + S((j1), t),

(4)

dt

m

d (j2) = - (j2) - (j1) + S((j2), t).

(5)

dt

m

where m is the mixing time.

2.3 Numerical Integration
An operator splitting technique [37] is employed to numerically integrate Eq.(2). The overall process of integration via operator splitting technique can be represented as

3 In situ adaptive tabulation
3.1 Linearized reaction mapping
Consider a composition  and an initial composition 0, so that Taylor expansion of the reaction mapping of  around 0 is

R(, t) = R(0, t) + A(0, t) + O(  2),

(9)

where  =  - 0, A(0, t) is a n × n matrix, called mapping gradient matrix, with components given by

Aij (0, t)

=

 Ri  0j

(0, t),

(10)

· denotes the Euclidean norm of a vector, and O(  2) denotes terms that have order  2.
The linear approximation Rl(, t), obtained by neglecting the high order terms of Eq.(9), is second-order accurate at a connected region of composition space centered at 0. The shape of this region is unknown before the calculations, but ISAT algorithm approximates this region by a hyper-ellipsoid, as will be shown in section 3.2. The local error of this linear approximation is defined as the Euclidean norm of the difference between the reaction mapping at  and the linear approximation for it around 0,

 = R(, t) - Rl(, t) .

(11)

(t) m-ixing mix(t + t) re-action (t + t),

(6)

where given an initial composition 0 and a time step t, the first fractional step integrates the pure mixing system,

d dt

=

- (,

t),

(7)

to obtain (mj)ix(t + t). Then, the pure chemical reaction system,

d dt

=

S(,

t).

(8)

is integrated from an initial composition mix(t + t) over a time step t and gives (t + t).
The operator splitting technique allows to solve each term in the evolution equation, Eq.(2), separately, using specific efficient numerical methods to treat the particular features inherent to the physical phenomenon modeled by each term [7].

3.2 Ellipsoid of accuracy
The accuracy of the linear approximation at 0 is controlled only if the local error is smaller than a positive error tolerance tol, which is heuristically chosen. The region of accuracy is defined as the connected region of the composition space centered at 0 where local error is not greater than tol. As shown in [24], this region is approximated by a hyper-ellipsoid centered at 0 which is dubbed ellipsoid of accuracy (EOA), and is mathematically represented by the following inequation

TLLT  2tol,

(12)

where the EOA Cholesky matrix, denoted by L, is lower triangular [10].
The adaptive step of ISAT algorithm involves the solution of the following geometric problem: given a hyper-ellipsoid centered at 0 and a query composition, q, outside it, determine a new hyper-ellipsoid of

4
minimum hyper-volume, centered at 0, which encloses both the original hyper-ellipsoid and the point q. The solution of this problem is presented by [25] and is not shown here for sake of brevity.

Americo Cunha Jr, Lu´is Fernando Figueira da Silva
0

3.3 Tabulation procedure
Initially ISAT algorithm receives the time step t and the tolerance tol. Then, in every time step, ISAT algorithm receives a query composition q and returns an approximation for the corresponding reaction mapping R(q, t). This approximation is obtained via numerical integration of Eq.(8) or by the linear approximation Rl(q, t).
During the reactive flow calculation, the computed values are sequentially stored in a table for future use. This process is known as in situ tabulation. The ISAT table, which is created by the tabulation process, includes the initial composition 0, the reaction mapping R(0, t), and the mapping gradient matrix A(0, t). Using these elements it is possible to construct the linear approximation. As the calculation proceeds, a new query composition, q, is received by ISAT and the table is transversed until a 0 is found that is close to q. Depending on the accuracy, the linear approximation around 0 is returned or the reaction mapping of q is obtained by direct integration of Eq.(8).
The ISAT table is a binary search tree, since this data structure allows for searching an information in O(log2 ntab) operations, where ntab is the total number entries in the tree, if the tree is balanced [14]. The binary search tree is basically formed by two types of elements, nodes, and leaves. Each leaf of the tree stores the following data:
­ 0: initial composition; ­ R(0, t): reaction mapping at 0; ­ A(0, t): mapping gradient matrix at 0; ­ L: EOA Cholesky matrix.
Each node of the binary search tree has an associated cutting plane. This plane is defined by a normal vector

v = q - 0,

(13)

and a scalar

a = vT

q + 0 2

,

(14)

such that all compositions  with vT  > a are located to the "right" of the cutting plane, as sketched in Figure 1. The cutting plane construction defines a search criterion in the binary search tree.

vT  <a

v q

vT  >a

vT  = a
Figure 1 Cutting plane in relation to EOA position.

If during the calculation a query point q is encountered within the region of accuracy, i.e.,   tol, but outside the estimate of EOA, then the EOA growth proceeds as detailed in [25]. The first three items stored in the binary search tree leaf 0, R(0, t) and A(0, t) are computed once, whereas L changes whenever the EOA is grown.
Once a query composition q is received by ISAT table, the binary search tree is initialized as a single leaf and the exact value of the reaction mapping is returned.
The subsequent steps are:
1. Given a query composition the tree is transversed until a leaf (0) is found.
2. Equation (12) is used to determine if q is inside EOA or not.
3. If q is inside EOA, the reaction mapping is given by the linear approximation. This is the first of four outcomes, called retrieve.
4. If q is outside EOA, direct integration is used to compute the reaction mapping, and the local error is measured by Eq.(11).
5. If the local error is smaller than tolerance, tol, the EOA is grown according to the procedure presented in [25] and the reaction mapping is returned. This outcome is called growth.
6. If local error is greater than the tolerance tol and the maximum number of entries in the binary search tree is not reached, a new record is stored in the binary search tree based on q and the reaction mapping is returned. The original leaf is replaced by a node with the left leaf representing the old composition 0 and the right leaf the new one q as shown in Figure 2. This outcome is an addition.
7. If the local error is greater than the tolerance tol and the maximum number of entries in the binary search tree is reacted, the reaction mapping is returned. This outcome is called direct evaluation.

Assessment of a transient homogeneous reactor through in situ adaptive tabulation

5

0

v, a

0

q

Figure 2 Binary search tree before and after the addition of a new node.

4 Results and discussion
This section presents the results of numerical simulations performed in order to assess characteristics of PMSR reactor. This study investigates three configurations of a PMSR reactor, two mixtures of CO/O2, and one mixture of CH4/air, using different time scales to define their behavior. Accuracy, performance, and memory usage of ISAT technique implementation are also investigated. For this purpose, the approximation for solution of the model equation, Eq.(2), obtained by ISAT technique are compared with a reference solution from direct integration (DI) procedure, described in section 2.3.

4.1 CO/O2 mixture
The first two cases studied consider a 1024 particles PMSR, initially filled with a fuel-lean mixture of CO/O2 at 2948.5 K and 1 atm. At every time step, a fuel-lean mixture of CO/O2 enters the reactor at Tin = 300 K and pin = 1 atm. Both fuel-leam mixtures have equivalence ratio equal to 0.7. The constant pressure and enthalpy equilibrium state associated to the inflow mixture is reached at Teq = 2948.5 K. The reaction mechanism used to describe CO with O2 kinetics involves 4 species and 3 reactions, [9]. For the first case a time scales configuration with m/r = p/r = 1/2 is used, so that the pairwise/mixing time scales are of the same order of magnitude as the residence time. In this situation, partially stirred reactor (PaSR) conditions result within the reactor. For the second case, time scales configuration adopted is m/r = p/r = 1/10, so that the pairwise/mixing time scales are small when compared to the residence time. Thus, the reactor should behave almost as a perfect stirred reactor (PSR), where the processes of mixing and pairing occur instantaneously. These cases use a binary search tree with a maximum of 50, 000 entries, t = 10 µs, and tol = 10-3.

4.2 CH4/air mixture
The third case studied consists of a PMSR, with 1024 particles, initially filled with the combustion products

of a stoichiometric mixture of CH4/air at 2100 K and 1 atm. At every time step, a stoichiometric mixture of CH4/air enters the reactor at Tin = 300 K and pin = 1 atm. The constant pressure and enthalpy equilibrium state associated to this mixture is reached at Teq = 2225.5 K. The reaction of CH4 with air kinetics is described by GRI mechanism version 3.0 [30], with 53 species and 325 reactions. For this PMSR one have m/r = p/r = 1/4, so that it is expected to behave like a PaSR. This simulation uses a binary search tree with a maximum of 60,000 entries, t = 0.1 ms and tol = 10-3.

4.3 Analysis of reactor behavior
Figures 3 and 4 show the comparison between DI and ISAT calculations, as function of the dimensionless time sem=blet/varr, iafonrcetheT e2nsemofblteheavreerdaugceedTtemapnedratthuereeninthe cases 1 and 2, where the reduced temperature is defined as

T

=

T - Tin Teq - Tin

,

(15)

and the ensemble average and the ensemble variance operators are respectively defined as



=

1 np

np
(j)
j=1

and

 2 = 2 -  2 , (16)

being  a generic property of the reactive system. For case 1 results, which span over a range of 500
residence times, one can observe an excellent qualitative agreement for T  and T 2 . The ensemble average value rapidly drops from the initial value to reach the statistically steady-state regime around T  = 0.3. The ensemble variance rapidly grows, then decreases until it reaches the statistically steady-state value around T 2  = 0.13. The analysis of the two figures shows that the statistically steady-state regime is reached after   = 10.
In case 2, where a range of 250 residence times have been computed, one can also observe an excellent qualitative agreement for T  and T 2 . Again, the overall history of the PMSR is the same for DI and ISAT. Similar results, not shown here for sake of brevity, have been obtained for the other thermochemical properties of the reactors.
The difference among both cases is due to the behavior of each reactor at the statistically steady state

6

Americo Cunha Jr, Lu´is Fernando Figueira da Silva

1.2

1.2

DI

DI

ISAT

ISAT

1

1

0.8

0.8

T 

T 

0.6

0.6

0.4

0.4

0.2

0.2

0

0

100 200 300 400 500



(a) Evolution of T  for case 1.

0

0

50 100 150 200 250



(b) Evolution of T  for case 2.

Figure 3 Comparison between DI (--) and ISAT (- - -) calculations of the ensemble average of the reduced temperature.

0.2

0.2

DI

DI

ISAT

ISAT

0.15

0.15

T2 

T2 

0.1

0.1

0.05

0.05

0

0

100 200 300 400 500



(a) Evolution of T 2  for case 1.

0

0

50 100 150 200 250



(b) Evolution of T 2  for case 2.

Figure 4 Comparison between DI (--) and ISAT (- - -) calculations of the ensemble variance of the reduced temperature.

regime. Indeed, the case 2 reactor behavior is governed by a competition between the chemical and residence times mostly. Therefore, the thermodynamical properties steady-state PDF is concentrated over a smaller range than in case 1, where the mixing and pairing time scales are large when compared to the residence time. This behavior is illustrated in Figures 5 and 6, which present the comparison between DI and ISAT computations of mean histograms, averaged over the last 50 residence times, of T  and YO for cases 1 and 2. These figures underscore the influence of PMSR controlling parameters, i.e., the time scales ratios m/r and p/r, on the thermochemical conditions prevailing within each reactor. Indeed, the temperature within the case 2 reactor is such that almost only burned gases are found. On the other hand, case 1 reactor is characterized by a bimodal temperature distribution with a large probability of finding T  = 0.04 and a broader temperature distribution leaning toward the burned gases. Such a distribution, as it could be expected, is reflected on YO histogram, which also exhibits a bimodal distribution.
The comparison between DI and ISAT results for the first two statistical moments of T  and YOH , for

case 3, are presented in Figures 7 and 8. One can note reasonable and good agreements for the T  and the YOH statistics, respectively. The results of case 3 show a large discrepancy for the T  than that obtained in case 1. The reaction mechanism of methane is much more complex than the mechanism used to model the carbon monoxide chemical kinetics in case 1, which would in principle lead to the PMSR with methane to assume a wider range of possible thermodynamic states. Thus, it could be expected that the present binary search tree, with 60k entries (almost similar to that used in case 1), would yield comparatively lower accuracy.
Finally, Figure 9 presents the comparison between DI and ISAT computations of the mean histograms, averaged over the last 50 residence times, of the T  and YHCO for case 3. The temperature histogram presents a bimodal distribution with large probability of finding T   0.9 and a broader temperature distribution leaning to the fresh gases. On the other hand, YHCO histogram shows a distribution essentially concentrated in the fresh gases region, and nearly homogeneous elsewhere. This behavior illustrates the fact that HCO, an

Assessment of a transient homogeneous reactor through in situ adaptive tabulation

7

Relative Frequency

Relative Frequency

0.8

DI

0.8

DI

I S AT

I S AT

0.6

0.6

0.4

0.4

0.2

0.2

0

0

0.2

0.4 T0.6

0.8

1

1.2

(a) Histogram of T  for case 1.

0

0

0.2 0.4 T0.6 0.8

1

1.2

(b) Histogram of T  for case 2.

Figure 5 Comparison between DI and ISAT calculations of the mean histograms (averaged over the last 50 residence times) of the reduced temperature.

Relative Frequency

Relative Frequency

0.8

DI

0.8

DI

I S AT

I S AT

0.6

0.6

0.4

0.4

0.2

0.2

0 0 0.01 0.02 0.03 0.04 0.05 0.06
YO
(a) Histogram of YO for case 1.

0 0 0.01 0.02 0.03 0.04 0.05 0.06
YO
(b) Histogram of YO for case 2.

Figure 6 Comparison between DI and ISAT calculations of the mean histograms (averaged over the last 50 residence times) of the O mass fraction.

1.2

DI

0.02

DI

ISAT

ISAT

1

0.015 0.8

YO H

T 

0.6

0.01

0.4 0.005
0.2

0

0

50

100

150



(a) Evolution of T  for case 3.

0

0

50

100

150



(b) Evolution of YOH for case 3.

Figure 7 Comparison between DI (--) and ISAT (- - -) calculations of the ensemble average of the reduced temperature and OH mass fraction.

intermediate species, appears in low concentration in the burned gases.

4.4 Analysis of ISAT accuracy
The relative local error of , which is a time dependent function, is defined as

r,(t) =

DI (t) - ISAT (t) DI (t)

,

(17)

8

Americo Cunha Jr, Lu´is Fernando Figueira da Silva

0.2 0.15
0.1

DI ISAT

-5
x 10 4 3 2

DI ISAT

YOH 2

0.05 1

T2 

0

0

50

100

150



(a) Evolution of T 2  for case 3.

0

0

50

100

150



(b) Evolution of YO2H for case 3.

Figure 8 Comparison between DI (--) and ISAT (- - -) calculations of the ensemble variance of the reduced temperature and OH mass fraction.

Probability Density Function

Probability Density Function

0.8

0.8 DI ISAT

DI ISAT

0.6

0.6

0.4

0.4

0.2

0.2

0
0 0.2 0.4 0.6 0.8 1 1.2
T
(a) Histogram of T  for case 3.

0

0

1

2

3

YHCO

-4
x 10

(b) Histogram of YHCO for case 3.

Figure 9 Comparison between DI and ISAT computations of the mean histograms (averaged over the last 50 residence times) of the reduced temperature and HCO mass fraction.

where subscripts DI and ISAT denote DI and ISAT cal-

The analysis of the graphs in Figure 12 indicates

culations of , respectively. This metric represents a that 1024 particles are not sufficient to guarantee the

local measure of error incurred by ISAT.

statistical independence of the computed results. This

The evolution of the relative local errors of T  and hypothesis is also confirmed if one considers Figure 13,

YO statistical moments are presented in Figures 10 and 11. Concerning case 1 errors, one can observe a large statis-

where it is possible to see discrepancies in DI and ISAT mean histograms of T  for both cases, even if, quali-

tical variation due to the stochastic nature of the PMSR tatively these histograms are not much different than

model, with amplitudes reaching 13%. In case 2, rela- those shown in Figure 5. Thus, one can conclude that

tive errors of the order of 1% only can be observed.

although the results not exhibit the statistical indepen-

dence with a sample of 1024 particles, they do not vary

All realizations of the stochastic processes in DI and much with a sample of this size. Possibly a sample of

ISAT calculations shown above use the same statisti- 4096 particles is sufficient to ensure the independence

cal seed for pseudorandom number generator. However, of the results.

since the mixing model is statistical in nature, it could

The mean relative error of  over an interval  ,

be expected that the seed value may influence the ISAT defined as

behavior. Therefore, if the DI calculation seed is kept

fixed and ISAT seed is changed, the results for T  and
r, T  are expected to be modified. This can be seen in Figure 12, where one may observe, by comparison with

r ,

M

=

1 

t+
r,(t )dt ,
t

(18)

Figures 3 and 10, an increase in the r, T  for both is a metric that gives a global measure of the error in-

cases.

curred by ISAT.

Assessment of a transient homogeneous reactor through in situ adaptive tabulation

9

0.2

0.2

0.15

0.15

r, T 

r, T 

0.1

0.1

0.05

0.05

0

0

100 200 300 400 500



(a) Evolution of r, T  for case 1

0.2

0

0

50 100 150 200 250



(b) Evolution of r, T  for case 2

0.2

0.15

0.15

r, YO

r, YO

0.1

0.1

0.05

0.05

0

0

100 200 300 400 500



(c) Evolution of r, YO for case 1

0

0

50 100 150 200 250



(d) Evolution of r, YO for case 2

Figure 10 Evolution of the relative local error for the ensemble average of the reduced temperature and of the O mass fraction, using the same statistical seeds in both cases.

The mean relative errors associated to the statistical moments of the T  and the YO are presented in Table 1. One can observe that, when the same seed is used for
ISAT and DI, the mean error of the average properties
is smaller than 1.2% in case 1, and of 0.1% in case 2 only. For T  and YO ensemble variances, the mean error is large in case 1. Concerning the simulations where the
used seeds are different, the mean error of the proper-
ties average/variance are an order of magnitude greater
than the previous one.

Table 1 Mean relative error of  for cases 1 and 2.


T YO T2  YO2

Equal Seeds

Case 1 Case 2

1.0 % 1.2 % 1.0 % 0.9 %

0.0 % 0.1 % 0.5 % 0.5 %

Different Seeds

Case 1 Case 2

8.1 % 11.7 %
6.6 % 7.0 %

5.3 % 1.3 % 10.1 % 6.1 %

In the early development of ISAT technique [24] it was noted that the choice of the tolerance could affect the accuracy of the problem solution. In order to investigate the effect of the tolerance on the present results,

Figure 14 presents the absolute global error, g, as a function of ISAT error tolerance for cases 1 and 2. The absolute global error is defined, over a time interval  , as

g

=

1 

t+ t

 (t )DI -  (t )ISAT

dt ,

(19)

where  denotes a vector which the components are
the ensemble averages of  components.
As may be seen in Figure 14, when the same statisti-
cal seed is used, g decreases linearly as tol is reduced, for both studied cases. However, if different statistical
seeds are used, one can note a limit behavior where g does not decrease if tol is reduced. This saturation in g value ( 10-2) indicates that a decrease in tol value below 10-3 is not effective in cases where the statistical
seeds are different.
The evolution of the relative local error of the statistical moments of T  and YOH , for case 3, are presented in Figure 15. Compared with the results of case 1, the
errors of case 3 present more oscillations. Furthermore, for this case, g = 2.4 × 10-3 is an order of magnitude larger than the values obtained in cases 1 and 2, also using tol = 10-3. Since different seeds are used for

10

Americo Cunha Jr, Lu´is Fernando Figueira da Silva

0.2

0.2

0.15

0.15

r, T 2 

r, T 2 

0.1

0.1

0.05

0.05

0

0

100 200 300 400 500



(a)

Evolution

of

 r

,

T

2



for

case

1

0.2

0

0

50 100 150 200 250



(b)

Evolution

of

 r

,

T

2



for

case

2

0.2

0.15

0.15

r, YO 2

r, YO 2

0.1

0.1

0.05

0.05

0

0

100 200 300 400 500



(c)

Evolution

of


r,

YO2

for case 1

0

0

50 100 150 200 250



(d)

Evolution

of


r,

YO2

for case 2

Figure 11 Evolution of the relative local error for the ensemble variance of the reduced temperature and of the O mass fraction, using the same statistical seeds in both cases.

DI and ISAT calculations in case 3, large errors in the results are to be expected.
4.5 Analysis of ISAT performance
The comparison of time evolution of ISAT outputs (number of additions, growths, retrieves, and direct evaluations) and of binary search tree height, as well as the corresponding rates of change, for cases 1 and 2, are presented in Figures 16 and 17. A first important observation is that the number of additions in both cases reaches the maximum prescribed value in the binary search tree of 50k. As a consequence of binary search tree saturation, the additions curve reaches a steady state after 5.4 and 1.2 residence times (r), in the first and second cases, respectively. This indicates that ISAT table is saturated earlier when mixing is faster (m/r small).
Figures 16 and 17 also show the evolution of binary tree height, which reaches steady state 1.8 r in the first case and 0.4 r in the second case. It is also noteworthy that, in both cases, the tree height is an order of magnitude smaller than the total number of entries in the tree ( 17k in case 1 and  7k in case 2). This difference

between height and total entries in data table ensures the efficiency of search process for a new query, which could be performed up to three and seven times faster in cases 1 and 2, respectively, than a vector search.
In the first case, Figures 16 and 17 show that the number of growths presents a sharp rate of change around r, whereas, in the second case, this occurs around 5 r. In both cases, growth steady state occurs after 10 r. During both simulations the number of growths is always smaller than additions. This indicates that the desirable massive increase of the ellipsoids of accuracy, to improve the estimate of the region of accuracy, is not observed. This behavior might circumstantial to the reaction system of the carbon monoxide considered, since, due to its simplicity (only three reactions), a small part of the realizable region should be assessed during the course of the calculation.
The Figure 16 shows that, after tree saturation occurs, the number of retrieves, and direct evaluations exceed the number of additions in both cases. In case 1 there is a higher occurrence of retrieve events, whereas in case 2 direct evaluations prevail. The number of retrieves exhibits a linear limit behavior in both cases. The ISAT behavior for the second case reflects the fact

Assessment of a transient homogeneous reactor through in situ adaptive tabulation

11

T 

1.2 DI ISAT
1

0.8

0.6

0.4

0.2

0

0

100 200 300 400 500



(a) Evolution of T  for case 1.

T 

1.2 DI ISAT
1

0.8

0.6

0.4

0.2

0

0

50 100 150 200 250



(b) Evolution of T  for case 2.

0.4

0.4

0.3

0.3

0.2

0.2

r, T 

r, T 

0.1

0.1

0

0

100 200 300 400 500



(c) Evolution of r, T  for case 1

0

0

50 100 150 200 250



(d) Evolution of r, T  for case 2

Figure 12 Comparison between DI (--) and ISAT (- - -) calculations, using different statistical seeds, of the ensemble average of the reduced temperature and the corresponding relative local errors.

Relative Frequency

Relative Frequency

0.8

DI

0.8

DI

I S AT

I S AT

0.6

0.6

0.4

0.4

0.2

0.2

0

0

0.2

0.4 T0.6

0.8

1

1.2

(a) Histogram of T  for case 1.

0

0

0.2 0.4 T0.6 0.8

1

1.2

(b) Histogram of T  for case 2.

Figure 13 Comparison between DI and ISAT calculations, using different statistical seeds, of the mean histograms (averaged over the last 50 residence times) of the reduced temperature.

that the binary tree of this case is poor, i.e., contains too few compositions in the region accessed by the calculation. As a consequence, the number of direct evaluations vastly outnumbers ISAT operations. This explains the error behavior observed in section 4.4.
When ISAT technique is more efficient than DI procedure, the computational time spent by ISAT is smaller than computational time spent by DI. The computational time spent by ISAT is the sum of the computa-

tional time spent at each of its possible outputs. Therefore, the efficiency condition can be stated as

nAA + nGG + nRR + nDE DE < nDI DI ,

(20)

where nA, nG, nR, nDE, nDI are the number of additions, growths, retrieves, direct evaluations, and direct integrations, respectively, whereas A, G, R, DE, and

12

Americo Cunha Jr, Lu´is Fernando Figueira da Silva

0

0

10

10

-2
10

-2
10

g

-4
10

g

-4
10

-6
10

-8
10
-8
10

dif. seed same seed

-6

-4

-2

0

10

10

10

10

tol

(a) g vs tol for case 1.

-6
10

-8
10
-8
10

dif. seed same seed

-6

-4

-2

0

10

10

10

10

tol

(b) g vs tol for case 2.

Figure 14 Absolute global errors as function of the error tolerance, using a binary search tree with 50k entries.

0.4

0.4

0.3

0.3

r, YOH

r, T 

0.2

0.2

0.1

0.1

0

0

50

100

150



(a) Evolution of r, T  for case 3.

0.4

0

0

50

100

150



(b) Evolution of r, YOH for case 3.

0.4

0.3

0.3

r, YOH 2

r, T 2 

0.2

0.2

0.1

0.1

0

0

50

100

150



(c)

Evolution

of

 r

,

T

2



for

case

3.

0

0

50

100

150



(d)

Evolution

of


r,

YO2H

for case 3.

Figure 15 Evolution of the relative local error of the ensemble average mean and the ensemble average variance of the reduced temperature and OH mass fraction.

DI are the corresponding average duration at each operation.
Assuming that

G DI

 1,

DE DI

 1,

and

R DI

1.

(21)

it is possible to show [5] that a necessary (but not sufficient) condition for a calculation using ISAT to be faster than the same calculation using DI is

nR nA

>

A DI

- 1.

(22)

For CO/O2 mixtures estimates lead to A/DI  10, [5]. It is possible to see in Figure 16 that, for case 1, nR approximately exceeds nA by a factor of 130, whereas in

Assessment of a transient homogeneous reactor through in situ adaptive tabulation

13

8

10

Addition

Growth

Retrieve

6

D.Eval.

10

Height

8

10

Addition

Growth

Retrieve

6

D.Eval.

10

Height

ISAT outputs

ISAT outputs

4

4

10

10

2

2

10

10

0

0

10

10

-2

0

2

4

-2

0

2

4

10

10

10

10

10

10

10

10





(a) Case 1.

(b) Case 2.

Figure 16 Evolution of ISAT algorithm outputs and of the height of ISAT binary search tree.

ISAT outputs rate of change

ISAT outputs rate of change

4

x 10

2

Addition

Growth

Retrieve

D.Eval.

1.5

Height

1

0.5

4

x 10

2.5

Addition

Growth

Retrieve

2

D.Eval.

Height

1.5

1

0.5

0

0

-2

0

2

4

-2

0

2

4

10

10

10

10

10

10

10

10





(a) Case 1.

(b) Case 2.

Figure 17 Evolution of the rates of change of each ISAT algorithm outputs and of the height of ISAT binary search tree.

case 2 this factor is only 6. Therefore, as A/DI < 10 in case 2, ISAT calculations are not expected to be faster than DI procedure.
As can be seen in Table 2, where a comparison of computational time is shown, cases 1 and 2, for tol = 10-3 are computed using DI in 4.0 ks and 2.0 ks respectively, whereas with the use of ISAT, the same cases spent 2.3 ks and 2.1 ks, respectively. Speed-up factors of 1.7 (case 1) and 1.0 (case 2) are obtained, where the speed-up factor is defined as the ratio between the computational time spent by DI and the computational time spent by ISAT. This table also allows to compare the computational time spent by DI and ISAT for different values of error tolerance. An increase in processing time is obtained as ISAT error tolerance is reduced, which is to be expected, given the fact that lower values of tol correspond to a smaller region of accuracy. Indeed, as tol is decreased, it is less likely that ISAT returns a retrieve, which is ISAT output with lower computational cost. In case 1, for all values of tol, ISAT technique offers an advantage, in terms of computational time, when compared to the process of di-

rect integration, reducing on average the computational time in 42%. On the other hand, in case 2, no reduction in computational time is seen. As discussed above, this behavior is natural, once the necessary condition for efficiency of the algorithm is not reached.
Aiming to analyze the asymptotic behavior of ISAT speed-up, case 1 has also been simulated for 50,000 time steps. This computation with ISAT spends 204.7 ks, whereas if DI were to be used the same calculation would spend  1024.0 ks (speed-up factor of 5.0). Therefore, in this asymptotic case, ISAT spends approximately 80% less time than DI. The pioneer work of Pope (1997) [24] reports an asymptotic speed-up factor of 1000, but this impressive factor has not been observed in the study developed here.
The evolution of ISAT algorithm outputs, ISAT binary search tree height, and the corresponding rates of change, for case 3, are presented in Figure 18. As in cases 1 and 2 the number of additions reaches the maximum allowed value in the binary search tree, 60k for this case. The additions curve reaches a steady state after   = 3.2. The binary search tree maximum height

14

Americo Cunha Jr, Lu´is Fernando Figueira da Silva

Table 2 Comparison between the computational time spent by DI and ISAT and the corresponding speed-up factors.

tol
DI 10-2 10-3 10-4 10-5 10-6

Case 1

time spent (ks) speed-up

 4.0  1.9  2.3  2.4  2.5  2.6

 2.1  1.7  1.7  1.6  1.5

Case 2

time spent (ks) speed-up

 2.0  2.1  2.1  2.2  2.2  2.2

 1.0  1.0  0.9  0.9  0.9

for case 3 is  7k as in case 2. Here the steady state of the tree height is observed at   = 1.28, as can be seen in Figure 18. The behavior of the number of growths is quite similar to that of case 1, where the greater rate of change occurs near   = 2 but, now, the steady state is reached before   = 10.
For case 3, nevertheless, the number of growths is not always smaller than the number of additions. Initially the growths exceed additions by nearly an order of magnitude. After   = 0.2 the additions exceeded the number of growths, only to be overcome again once steady state is reached. This behavior indicates that the ellipsoids of accuracy show a considerable period of adaptation, which allows to access, with precision, a larger portion of the realizable region.
As in the previous cases, after tree saturation, the number of retrieves and direct evaluations exceed the number of additions. The number of direct evaluations overcomes total number of retrieves in approximately 60%, which is not negligible, but less than that observed in case 2. This indicates that the binary search tree covers a significant portion of the realizable region in the composition space. From Figure 18 one can estimate A/DI  50 in order that ISAT technique be more efficient than DI.
For case 3, the computational time spent by DI and ISAT are 689 ks and 455 ks, respectively. Therefore, a speed-up of 1.5 is observed. In this case, the effect of other values of ISAT error tolerance has not been investigated. This PMSR has 1024 particles and its evolution is computed during   = 150. Thus, the system of governing equations defined by Eq.(8) is solved 7, 680, 000 times. In this case ISAT technique allows to save 34%, in terms of computational time. For problems that require solving Eq.(8) several times, one could speculate that ISAT technique would provide an even better performance improvement, since more retrieves are expected when compared with the more costly direct integration.

4.6 Analysis of ISAT memory usage
The studied cases 1 and 2 are both modeled by a reaction mechanism with 4 species and use a binary search tree with 50,000 entries for ISAT simulations. These parameters lead to a memory consumption by ISAT algorithm of approximately 40 Mbytes, which is very small when compared with the available memory in the workstation used.
On the other hand, case 3 is modeled by a reaction mechanism with 53 species and use a binary search tree with 60,000 entries. This case uses approximately 3.3 Gbytes of memory. It is noteworthy that this value of memory usage is not negligible, when compared to the total memory available on the workstation. Thus, for practical purposes, this tree is the largest one that may be used to simulate a PMSR with this methane reaction mechanism and 1024 particles. This underscores what is perhaps the greatest shortcoming of ISAT technique, its huge expense of memory.
5 Concluding remarks
This work assessed characteristics of a PMSR reactor through the numerical simulation of reactor configurations with simple (CO/O2) and complex (CH4/air) reaction mechanisms and also investigated ISAT technique as an option to evaluate a computational model with detailed thermochemistry. For this purpose, the accuracy, performance, and memory usage of the corresponding technique were analyzed through the comparison of ISAT results with a reference result, obtained from direct integration of PMSR model equation. The studied cases analysis showed that ISAT technique has a good accuracy from a global point of view. Also, it was possible to identify the statistical seed effect on the control of absolute global error, which decreases monotonically as ISAT error tolerance was reduced, when the same seed is used for ISAT and DI calculations. On the other hand, when different seeds were used, a limit value for ISAT error tolerance was observed. In terms of performance, ISAT technique allows to reduce the com-

Assessment of a transient homogeneous reactor through in situ adaptive tabulation

15

ISAT outputs ISAT outputs rate of change

8

10

Addition

Growth

Retrieve

6

D.Eval.

10

Height

4
10

4

x 10

6

Addition

Growth

5

Retrieve D.Eval.

Height

4

3

2
10

0
10
-2
10

0

2

10

10



(a) Outputs for case 3.

2

1

0

4

-2

0

2

4

10

10

10

10

10



(b) Outputs rates of change for case 3.

Figure 18 Evolution of ISAT algorithm outputs, height of ISAT binary search tree, and the corresponding rates of change.

putational time of the simulations in all cases studied. 3. Chen JY, Chang WC, Koszykowski M (1995) Nu-

For CO/O2 cases, a speed-up of up to 5.0 was achieved, whereas for CH4/air, the algorithm allowed to save 34% in terms of computational time. Moreover, ISAT tech-

merical simulation and scaling of N O× emissions from turbulent hydrogen jet flames with various amounts of helium dilution. Combustion Science

nique presented the desired feature of speed-up factor

and Technology 110-111(1):505­529, DOI 10.1080/

increase with the complexity of analyzed system. Re-

00102209508951938

garding the memory usage, ISAT technique showed to 4. Correa SM (1993) Turbulence-chemistry interac-

be very demanding. This work will be extended by cou-

tions in the intermediate regime of premixed com-

pling ISAT technique to the hybrid LES/PDF model

bustion. Combustion and Flame 93(1-2):41­60,

by [2, 34, 1, 33] for description of turbulent combus-

DOI 10.1016/0010-2180(93)90083-F

tion, when a detailed reaction mechanism would allow a 5. Cunha Jr AB (2010) Reduction of Complexity in

better description of combustion. In this context, ISAT

Combustion Thermochemistry. M.Sc. Dissertation,

could be a viable option that may be able to decrease,

Rio de Janeiro

to an acceptable level, the simulation time.

6. Figueira da Silva LF, Deshaies B (2000) Stabiliza-

tion of an oblique detonation wave by a wedge:

Acknowledgements The authors acknowledge the support awarded to this research from CNPq, FAPERJ, ANP and Brazilian

a parametric numerical study. Combustion and Flame 121:152­166, DOI 10.1016/S0010-2180(99)

Combustion Network. The authors are indebted to Professor Guenther Carlos Krieger Filho from Universidade de S~ao Paulo (USP), for providing the code that served as example to the code developed in this work, and for his hospitality during the authors' visit to USP. This work was performed while the second author was on leave from Institut Pprime, CNRS, France.

00141-8 7. Fox RO (2003) Cambridge University Press, Cam-
bridge 8. Frank-Kamenetskii DA (1940) Conditions for the
applicability of the Bodenstein method in chemical kinetics. Zhurnal Fizicheskoy Himii 14:695­700, (in

Russian)

9. Gardiner WC (2000) Springer, Ney York

References

10. Golub GH, Van Loan CF (1996) 3rd edn. John Hopkins University Press, Baltimore

1. Andrade FO (2009) Contribuition to the large eddy simulation of a turbulent premixed flame stabilized in a high speed flow. D.Sc. Thesis, Rio de Janeiro, (in Portuguese)
2. Andrade FO, Figueira da Silva LF, Mura A (2011) Large eddy simulation of turbulent premixed combustion at moderate Damk¨ohler numbers stabilized in a high-speed flow. Combustion Science and Technology 183:645­664, DOI 10.1080/00102202.2010. 536600

11. Holmes P, Lumley JL, Berkooz G (1998) Cambridge University Press, Cambridge
12. Ihme M, Schmitt C, Pitsch H (2009) Optimal artificial neural networks and tabulation methods for chemistry representation in LES of a bluff-body swirl-stabilized flame. Proceedings of the Combustion Institute 32(1):1527­1535, DOI 10.1016/j. proci.2008.06.100
13. Keck J (1990) Rate-controlled constrainedequilibrium theory of chemical reactions in

16

Americo Cunha Jr, Lu´is Fernando Figueira da Silva

complex systems. Progress in Energy and Combustion Science 16(2):125­154, DOI 10.1016/0360-1285(90)90046-6 14. Knuth DE (1998) 2nd edn. Addison-Wesley Professional, Boston 15. Lam SH, Goussis DA (1994) The CSP method for simplifying kinetics. International Journal of Chemical Kinetics 26(4):461­486, DOI 10.1002/ kin.550260408 16. Law CK (2006) Cambridge University Press, New York 17. Liu BJD, Pope SB (2005) The performance of in situ adaptive tabulation in computations of turbulent flames. Combustion Theory Modelling 9(4):549­568, DOI 10.1080/13647830500307436 18. Lu L, Pope SB (2009) An improved algorithm for in situ adaptive tabulation. Journal of Computational Physics 228(2):361­386, DOI 10.1016/j.jcp. 2008.09.015 19. Maas U, Pope SB (1992) Simplifying chemical kinetics: intrinsic low-dimensional manifolds in composition space. Combustion and Flame 88(34):239­264, DOI 10.1016/0010-2180(92)90034-M 20. Orbegoso EM, Romeiro C, Ferreira S, Figueira da Silva LF (2011) Emissions and thermodynamic performance simulation of an industrial gas turbine. Journal of Propulsion and Power 27:78­93, DOI 10.2514/1.47656 21. Orbegoso EMM, Figueira da Silva LF, Novgorodcev Jr AR (2011) On the predictability of chemical kinetics for the description of the combustion of simple fuels. Journal of the Brazilian Society of Mechanical Sciences and Engineering 33:492­505, DOI 10.1590/S1678-58782011000400013 22. Pimentel CAR, Azevedo JLF, Figueira da Silva LF, Deshaies B (2002) Numerical study of wedge supported oblique shock wave-oblique detonation wave transitions. Journal of the Brazilian Society of Mechanical Sciences and Engineering 24:149­157, DOI 10.1590/S0100-73862002000300002 23. Pope SB (1985) PDF methods for turbulent reactive flows. Progress in Energy and Combustion Science 11(2):119­192, DOI 10.1016/0360-1285(85) 90002-4 24. Pope SB (1997) Computationally efficient implementation of combustion chemistry using in situ adaptive tabulation. Combustion Theory and Modelling 1(1):41­63, DOI 10.1080/713665229 25. Pope SB (2008) Algorithms for Ellipsoids. Tech. Rep. FDA-08-01, Cornell University, Ithaca 26. Ren Z, Pope SB, Vladimirsky A, Guckenheimer JM (2006) The invariant constrained equilibrium edge preimage curve method for the dimension reduc-

tion of chemical kinetics. The Journal of Chemical Physics 124(11):114,111, DOI 10.1063/1.2177243 27. Sabel'nikov V, Figueira da Silva LF (2002) Partially stirred reactor: study of the sensitivity of the Monte-Carlo simulation to the number of stochastic particles with the use of a semi-analytic, steady-state, solution to the PDF equation. Combustion and Flame 129:164­178, DOI 10.1016/ S0010-2180(02)00336-X 28. Sabel'nikov V, Deshaies B, Figueira da Silva LF (1998) Revisited flamelet model for nonpremixed combustion in supersonic turbulent flows. Combustion and Flame 114:577­584, DOI 10.1016/ S0010-2180(97)00296-4 29. Singer MA, Pope SB (2004) Exploiting ISAT to solve the reaction-diffusion equation. Combustion Theory Modelling 8(2):361­383, DOI 10.1088/ 1364-7830/8/2/009 30. Smith GP, Golden DM, Frenklach M, Moriarty NW, Eiteneer B, Goldenberg M, Bowman CT, Hanson RK, Song S, Gardiner WC, Lissianski VV, Qin Z (????) GRI mechanism. http://www.me.
berkeley.edu/gri_mech/ 31. Tonse SR, Moriarty NW, Brown NJ, Frenklach
M (1999) PRISM: piece-wise reusable implementation of solution mapping. an economical strategy for chemical kinetics. Israel Journal of Chemistry 39(1):97­106 32. Tur´anyi T (1994) Application of repro-modeling for the reduction of combustion mechanisms. Symposium (International) on Combustion 25(1):949­955, DOI 10.1016/S0082-0784(06)80731-9 33. Vedovoto JM (2011) Mathematical and numerical modeling of turbulent reactive flows using a hybrid LES / PDF methodology. D.Sc. Thesis, Uberl^andia 34. Vedovoto JM, Silveira Neto A, Mura A, Figueira da Silva LF (2011) Application of the method of manufactured solutions to the verification of a pressurebased finite-volume numerical scheme. Computers & Fluids 51:85­99, DOI 10.1016/j.compfluid.2011. 07.014 35. Walter MAT, Figueira da Silva LF (2006) Numerical study of oblique detonation wave stabilization by finite length wedges. AIAA Journal 44:353­361, DOI 10.2514/1.12417 36. Williams FA (1985) 2nd edn. Wesley, Cambridge 37. Yang B, Pope SB (1998) An investigation of the accuracy of manifold methods and splitting schemes in the computational implementation of combustion chemistry. Combustion and Flame 112(12):16­32, DOI 10.1016/S0010-2180(97)81754-3

