arXiv:2106.01348v1 [astro-ph.IM] 1 Jun 2021

Simulating Photometric Images of Moving Targets with Photon-mapping
Junju Du, Shaoming Hu, Xu Chen, Hai Cao and Yuchen Jiang
Shandong Key Laboratory of Optical Astronomy and Solar-Terrestrial Environment, School of Space Science and Physics, Institute of Space Sciences, Shandong University, Weihai, Shandong, 264209, China. E-mail: husm@sdu.edu.cn
3 June 2021
Abstract. We present a novel, easy-to-use method based on the photon-mapping technique to simulate photometric images of moving targets. Realistic images can be created in two passes: photon tracing and image rendering. The nature of light sources, tracking mode of the telescope, point spread function (PSF), and specifications of the CCD are taken into account in the imaging process. Photometric images in a variety of observation scenarios can be generated flexibly. We compared the simulated images with the observed ones. The residuals between them are negligible, and the correlation coefficients between them are high, with a median of 0.9379+-00..00122051 for 1020 pairs of images, which means a high fidelity and similarity. The method is versatile and can be used to plan future photometry of moving targets, interpret existing observations, and provide test images for image processing algorithms.
Unified Astronomy Thesaurus concepts: Astronomical simulations (1857); Astronomy data modeling (1859); Artificial satellites (68), Space debris (1542); Near-Earth objects (1092)
Submitted to: Publications of the Astronomical Society of the Pacific
1. Introduction
In the optical survey of moving targets, such as satellites, space debris, and near-Earth objects (NEOs), the photometric images have different characteristics depending on the different observation strategies. Kouprianov (2010) divided all images into four types according to the shape of the source images:
(1) point-like field stars and point-like targets; (2) point-like field stars and streak-like targets; (3) streak-like field stars and point-like targets;

Simulating Photometric Images of Moving Targets with Photon-mapping

2

(4) streak-like field stars and streak-like targets. The four types of photometric images are illustrated in Figure 1. The first type of image has the obvious advantage that it does not require any specialized image processing techniques. However, its practical use is limited to moving targets with an apparent motion similar to stars. A short exposure time option is another way to obtain the first type of images, but only for very bright stars and targets. Streak-like images are difficult to avoid in the observation of moving targets. Three factors complicate the image processing of streak-like images. First, the signal-to-noise ratio (SNR) is lost, and the boundary is blurred since the stars or targets become trailed (Veres et al. 2012). Second, as shown in Figure 2, the shapes of streak-like images change unpredictably from frame to frame and cannot be expressed in an analytic form accurately. Third, streak-like images are more likely to overlap each other or cross image boundaries, which can be seen in Figure 1 (c) and (d)

(a)

(b)

(c)

(d)

Figure 1. Schematic diagrams of four types of photometric images. Images are simulated with the presented method in different strategies. (a) sidereal tracking mode and 0.5 seconds exposure. (b) sidereal tracking mode and 4.0 seconds exposure. (c) target tracking mode and 4.0 seconds exposure. (d) parking tracking mode and 4.0 seconds exposure. The moving target is indicated by the intersecting dashed lines.
Streak-like images can be handled appropriately by choosing the most suitable tracking mode of the telescope, setting the optimal exposure time, and developing more efficient image processing technology. However, many problems deserve further study in each aspect. The tracking mode is limited by the telescope's tracking mechanism and should be appropriate to the research target. Generally, the target tracking mode is used for follow-up observation, while the sidereal tracking mode is used for searching for new targets. Some new tracking strategies have been proposed, but their actual effects need to be verified in various observation scenarios. Setting the optimal exposure time is not easy either. As the telescope direction changes, some sources enter the field of view, and some run out. The exposure time needs to be set dynamically according to the sources within the field of view. The position and flux extraction of streak-like images is the fundamental problem. Various extraction algorithms have been proposed, such as thresholding segmentation (Devyatkin et al. 2010), profile fitting (Veres et al. 2012; Fraser et al. 2016), and new ones periodically appear. These methods need to be tested under an identical and complete test image set to provide a basis for their applicable conditions and development direction.

Simulating Photometric Images of Moving Targets with Photon-mapping

3

80

A1

A2

A3

A4

A5

60

40

20

Y (pixel)

80

B1

B2

B3

B4

B5

60

40

20

80

C1

C2

C3

C4

C5

60

40

20

20 40 20 40 20 40 20 40 20 40
X (pixel)

Figure 2. Screenshots of three streak-like field stars (A, B, C) in five consecutive frames (1, 2, 3, 4, 5). The exposure times are 2 seconds, and the interval between adjacent images is about 6 seconds. All images were obtained with the one-meter telescope at Weihai Observatory of Shandong University.

Realistic image simulation is an effective means to deal with streak-like images in all three aspects mentioned above. By constructing a high-fidelity imaging model, we can obtain a moving target's virtual image in any given scene in advance. These images may help us to make appropriate decisions on tracking mode and exposure time. Moreover, they can act as data samples for image processing because their parameters are known and adjusted flexibly. Image simulation is not a novel subject. Massey et al. (2004) presented a method to simulate deep sky images with shapelets, including realistic galaxy morphologies and telescope characteristics. Bertin (2009) developed an astronomical image simulation software package called SkyMaker, which started as a testing tool for the SExtractor source extraction software and has since been used in various studies. Unfortunately, none of them deals with moving targets and streak-like images. Peterson et al. (2015) presented a comprehensive methodology PhoSim, which uses a photon Monte Carlo approach to calculate the ab initio physics of the atmosphere and a telescope & camera to simulate realistic astronomical images. However, Phosim is not flexible in generating images with given parameters. Some models to generate test images are proposed in the literature, e.g., 1D stretched Gaussian (Kouprianov 2008) or moving 2D Gaussian (Veres et al. 2012). However, these analytic models can not characterize the discrete distribution of photons and the distortion of streak-like images very well, especially when the light sources are faint and the telescope is jitter.
In this paper, we adopted the strategy of photon-mapping to synthesize the

Simulating Photometric Images of Moving Targets with Photon-mapping

4

optical images of moving targets. Photon-mapping is an efficient and versatile global illumination technique for realistic image synthesis. It has been developed in computer graphics in the last few years (Jensen 2001). In general, photon-mapping involves two passes: photon tracing and image rendering. In the first pass, photons are traced from the light sources into the scene. These photons, which carry flux information, are cached in a data structure called the photon map. In the second pass, an image is rendered by evaluating each pixel's value using the information stored in the photon map and the property of the detector (Dutr´e et al. 2006). This method simulates the propagation and transformation of photons from the perspective of probability theory. It is closer to the actual imaging process, which we will prove in subsequent sections.
To adapt to the specific problems in moving targets observation, we made some adaptive changes to the usual photon-mapping technique in global illumination. The whole image simulation framework is described in Section 2. The validity of the framework is verified by comparing the simulated images with the observed ones in Section 3. The framework is practical, flexible, and efficient, but some subtle effects need to be considered in the future. Conclusions and discussion are given in Section 4.

2. Formation of the photometric image
We will analyze how a moving target and field stars are imaged on the telescope's CCD in this section. Relative to a ground station, a moving target travels among filed stars with an apparent angular velocity. During a given exposure time, photons emitted by the moving target and filed stars pass through the atmosphere, the telescope's lens set, and then arrive at the image plane. The photons captured by CCD are converted into analog-to-digital units (ADU) and read out as fits or other format images. The final image is determined by the nature of sources, the telescope's tracking mode, atmospheric conditions, and CCD characteristics. We will describe the process of image formation from the perspective of photon-mapping below.

2.1. Observation geometry
The observation geometry describes the spatial relationships between the moving target, the field stars, the ground station, and the telescope. The relationships change over time due to the Earth's rotation, the target's orbital motion, and the telescope's pointing adjustment. The analysis of observational geometry is essential because it determines the mapping relationship between the celestial coordinates (, ) and the image coordinates (x, y). These two coordinates are connected by a local transitional coordinate called standard coordinates (, ). As shown in Figure 3, the origin of standard coordinates is the intersection of the optical axis and the celestial sphere and the tangent of the plane o to the celestial sphere. The  is directed towards the North pole, tangent to the local celestial meridian, and  is perpendicular and directed eastward, parallel to the celestial equator. The transformation from (, ) to (, ) is

Simulating Photometric Images of Moving Targets with Photon-mapping

5

called gnomonic or central projection (Kovalevsky and Seidelmann 2004). There are

cos  sin( - A)

(, , A, D) =

(1)

sin  sin D + cos  cos D cos( - A)

(, , A, D)

=

sin 

cos D

-

cos i

sin D

cos(

-

A) ,

(2)

sin  sin D + cos  cos D cos( - A)

where (A, D) are right ascension and declination of bore-sight of the telescope, (,

) are those of field stars or the moving target in the vicinity of (A, D). The plane

of CCD (or image plane) does not coincide exactly with the focal plane due to the

CCD installation's inaccuracy. The image coordinate is defined on the image plane,

with the center of CCD as the origin and the directions parallel to the two edges of

CCD as the x and y directions. The (, ) and (x, y) are linked by photographic plate

models (Kovalevsky and Seidelmann 2004)

(x, y, P) = + p1x + p2y + p3 + p5x + p6y

(3)

+ p7x2 + p8xy + p9x(x2 + y2)

(4)

(x, y, P) = - p2x + p1y + p4 + p6x - p5y

(5)

+ p7xy + p8y2 + p9y(x2 + y2),

(6)

where P = {pi|i = 1, 2, · · · , 9} are plate constants, which can be estimated in astrometry process. Parameters p1 · · · p4 represent an orthogonal model allowing for a zero point, scale and rotation between (x, y) and (, ). Adding parameters p5 and p6 gives a full linear model. Parameters p7 and p8 represent a tilt of the focal plane with respect to the ideal tangent plane, and p9 is the third-order optical distortion term. In general,  and  are in radians while x and y are in pixels or microns. For a telescope with small field of view, the nonlinear terms represented by Equations (4) and (6) are very small and can be ignored. Equations (3) and (5) are one-value and have one-valued inverses

x = -1(, , P)

(7)

y = -1(, , P).

(8)

The (, ) in Equations (1) and (2) may be the coordinates of field stars or a moving target. For field stars, the (, ) can be obtained by correcting their catalog positions at the epoch to the time of observation. For a moving target, the (, ) change rapidly and should be calculated with orbit prediction. At each instance of time t, the position vector of a moving target in Geocentric Celestial Reference System (GCRS), XGCRS(t), can be predicted by orbit elements and corresponding propagation models, such as the most commonly used two-line element sets (TLEs) and the SDP4/SGP4 models . For a ground station at geodetic coordinates (latitude , longitude , height h), its corresponding coordinates in GCRS can be expressed as

YGCRS(t) = W (t)R(t)M (t)YITRF(t, , , h),

(9)

where YITRF(t, , , h) is the station coordinate in International Terrestrial Reference System (ITRS). The components W (t), R(t) and M (t) are the transformation matrices

 https://www.space-track.org

Simulating Photometric Images of Moving Targets with Photon-mapping

6

Figure 3. The geometry of photometric observation.

arising from the motion of the celestial pole owing to precession and nutation, the rotation of the Earth around the same pole, and polar motion, respectively (Kovalevsky and Seidelmann 2004). More information about the four terms in Equation (9) is available in International Earth Rotation and Reference Systems Service (IERS) §. Therefore, the station-target vector can be written as

(t) = [1, 2, 3]T = XGCRS(t) - YGCRS(t).

(10)

The corresponding right ascension and declination of target respecting to the station can be obtained with

0(t) = arctan(2/1)  [0, 2]

(11)

0(t) = arcsin(3)  [-/2, /2].

(12)

This paper will always use the subscript 0 to indicate the target, thus distinguishing it from the field stars. The above mathematical derivation gives a map from the given orbital elements and site coordinates to the station-target vector and (0, 0). In practical application, there are many off-the-shelf computer programs for the above calculation, such as the software routines from the IAU SOFA Collection or Skyfield (Rhodes 2019).
The (A, D) in Equations (1) and (2) changing over time refers to the tracking movement of telescope. Generally, the main purpose of tracking movement is to keep the light from the sources of interest always on the same spot on the image plane during the exposure (Eichhorn 1963). The A(t) and D(t) can be arbitrary expressions as long as the telescope permits. We focus on three tracking modes from the perspective of

§ https://www.iers.org http://www.iausofa.org

Simulating Photometric Images of Moving Targets with Photon-mapping

7

practical application: (1) target tracking mode, (2) sidereal tracking mode, and (3) parking mode. Target and sidereal tracking modes mean the telescope is fixed on the moving target or a fixed point on the celestial sphere, respectively. Parking mode means the telescope's tracking mechanism shut down, and the telescope changes direction as the Earth rotates. However, during the tracking movement, a telescope is always influenced by wind, gravity, and thermal loads deforming (Andersen and Enmark 2011). There is an additional wobble as the telescope moves according to a given strategy. Andersen and Enmark (2011) listed several servomechanism performance metrics to describe the telescope's tracking accuracy or instability. However, the wobble of a telescope is still hard to describe. In this paper, we focused on the uncorrectable tracking error. We modeled the tracking movement as a 2D Brownian motion in the right ascension and declination direction, similar to the method used by Peterson et al. (2015). Therefore, there are

A(t) = 0(t) + ABA(t) + A

(13)

D(t) = 0(t) + DBD(t) + D

(14)

for target tracking mode,

A(t) = A0 + ABA(t) + A

(15)

D(t) = D0 + DBD(t) + D

(16)

for sidereal tracking mode, and

A(t) = A0 + ABA(t) + (t - t0) + A

(17)

D(t) = D0 + DBD(t) + D

(18)

for parking mode. Where (0(t), 0(t)) is the direction of the moving target, BA(t) and BD(t) are 1D standard Brownian motion in right ascension and declination direction, respectively, A and D are corresponding scaling parameter, (A0, D0) is the initial pointing direction of telescope, A and D are the initial pointing error,  = 15 s-1 is the rotation speed of the Earth. The tracking path of telescope during an exposure is a sample curve of Brownian motion. A simulation of a continuous-time process is always based on a finite sample. Brownian motion is usually simulated on a discrete time grid t0  t1  · · ·  tn, and it is common practice for visualizations to interpolate the simulated values linearly (Schilling and Partzsch 2012). Since a ddimensional Brownian motion has independent 1D Brownian motion as components, we can use the Algorithm (1) to generate the components A(t) = ABA(t) + A and D(t) = DBD(t) + D in Equations (13)-(18) separately.

2.2. Photon tracking
Photon tracing is the process of emitting discrete photons from the light sources and tracing them through the scene. This pass's primary goal is to populate the photon maps used in the rendering pass. The light sources emit photons, and the photons travel through space filled with a variety of media, some are absorbed, and some survive. We

Simulating Photometric Images of Moving Targets with Photon-mapping

8

Algorithm 1: The simulation of 2D Brownian motion. Input: A discrete time grid t0  t1  · · ·  tk  · · ·  tn  t0 + texp. The scale parameters A and D of 1D Brownian motion. Output: A sample curve of Brownian motion.
1 Initialize A(t0)  A and D(t0)  D ; 2 for k  1 to n do 3 Generate dA  N(0, (tk - tk-1)A2 ) ; 4 Generate dD  N(0, (tk - tk-1)D2 ) ; 5 Set A(tk)  A(tk-1) + dA ; 6 Set D(tk)  D(tk-1) + dD ; 7 end
8 Return A(tk) and D(tk) for k = 1, · · · , n.

do not analyze how the photons interact with the atmosphere, telescope, and camera in detail, but only how the surviving photons are distributed on the image plane.
During an exposure from t0 to t0 + texp, the surviving photons strike into the image plane one by one. This process can be described with Poisson Point Processes (PPPs) in the time-space [t0, t0 + texp]. Suppose there are Ns field stars and one target that intersect the field of view during exposure, their celestial coordinates and magnitudes are (i, i) and mi, respectively, with i = 0 for target and i = 1, · · · , Ns for field stars. The parameters of field stars can be obtained from the star catalog, and the parameters of the target can be obtained from the orbital prediction and previous observations. The number of photons arriving at the image plane can be estimated by

Npi = texp10-0.4(mi+K X(z)+ZP ),

(19)

where K is the first-order extinction coefficients of atmosphere, z is the zenith distance, X(z) is the airmass, and ZP is the zero point. The values of K and ZP are determined by the atmosphere, telescope, and filter, which are readily available for a particular set of observing devices. Such parameters as the telescope collecting area, the transmission of atmosphere and instrument, the fractional spectral bandwidth of the filter, and the source flux density are also used in literature to estimate the photon number (Peterson et al. 2015). However, it is not easy to obtain these parameters. For a device-specific simulation, Equation (19) is more convenient. A definite value of Npi can be given by Equation (19) from mi, or directly assigned as we want, which helps to generate an image with given flux information. When we need to consider the fluctuation of the photons number of the same source in different images, we can replace Npi with a random number of events drawn from a Poisson distribution with mean Npi .
The photons hit the image plane one by one. The arrive time tij of the j-th photon from i-th source can be considered as uniformly distributed in [t0, t0 + texp], with i = 0, · · · , Ns and j = 1, · · · , Npi . The coordinates of the photon falling into the image

Simulating Photometric Images of Moving Targets with Photon-mapping

9

plane can be obtained with the following formulas

Aij = A(tij)

(20)

Dij = D(tij)

(21)

ij = i(tij)

(22)

ij = i(tij)

(23)

ij = (ij, ij, Aij, Dij)

(24)

ij = (ij, ij, Aij, Dij) xij = -1(ij, ij, P)

(25) (26)

yij = -1(ij, ij, P)

(27)

x~ij = xij + x

(28)

y~ij = yij + y,

(29)

where ( x, y)  P SF (x, y) are the deviations of the coordinates of the photon caused by PSF effect in x and y direction, respectively. Bertin (2009) assumed the PSF to be the convolution of five components: atmospheric blurring, telescope motion blurring, instrument diffraction and aberrations, optical diffusion effects, and intra-pixel response. However, we use the given PSF to generate x and y. The PSF can be given as an analytical form, such as a 2D Gaussian function, or derived from observational fitting (Anderson and King 2000).
As mentioned before, the information of each photon will be stored in a data structure called a photon map. In global illumination, the data structure of a kdtree or a Voronoi diagram is widely used to improve access speed. But in this paper, the photons are all located in the image plane. A simple 2D array is enough to store the information of photons effectively. In a photon map, each row represents a photon, which contains the following fields: (i, j, tij, Aij, Dij, ij, ij, ij, ij, xij, yij, x~ij, y~ij). The meaning of each field has been introduced in the above.

2.3. Image rendering

The image rendering process evaluates the value of each pixel using the information

stored in the photon map and the parameters of the detector, which includes image

plane sampling, the conversion from photon to ADU, adding bias, dark and flat-field

effect, manufacturing defective pixels. The process is illustrated by Figure 4. For a

CCD with pixel size s in the unit same as x~ and y~, the number of photons from sources

falling into the pixel (u, v) can be obtained by sampling the image coordinates of photons

(x~ij, y~ij). There is

Esource(u, v) = card {(~xij , ~yij )|

~xij s

= u, ~yij s

= v },

(30)

where  means the integer part of a number , and the operator card{} means

the number of elements of the set {}. As illustrated by Figure 4, photons from

the same source may fall on different pixels. A single-pixel may receive photons from

Simulating Photometric Images of Moving Targets with Photon-mapping

10

different sources. A part of photons from a source may fall outside the CCD plane. The discrete shape of the CCD pixels determines that it can record the photon's approximate position.
Strictly speaking, the photons coming from the sky background go through the same imaging process as those from sources. But for a telescope with a small field of view, the sky background can be considered approximately uniform. It can be rendered by adding a constant value Eback(u, v) in photon-electrons to all pixel value. Each pixel value Eback(u, v) should be replaced with a random number of events drawn from a Poisson or Gaussian distribution with mean Eback(u, v) to mimic the noise. Alternatively, the background Eback(u, v) can be estimated from observed image. The sum number of photon-electron

E(u, v) = Esource(u, v) + Eback(u, v)

(31)

It gives a pure photon-electron image not contaminated by the readout process, which is very useful in image processing. Because the various calibrations (gain, bias, dark, flat, charge transfer inefficiency) do not have to be performed. However, if we want to obtain an image containing various effects, just like the real CCD readout image, the whole digitization process can be realized by

E(u, v)

ADU (u, v) =

· F lat(u, v) + Bias(u, v) + Dark(u, v),

(32)

Gain

where Gain, F lat(u, v), Bias(u, v), and Dark(u, v) are the gain of CCD, flat, bias, and

dark, respectively. Their values can be arbitrarily specified or measured using an actual

device.

Some artificial defects can be added to make the images more realistic, such as hot

pixels and dead pixels. Hot pixels can be added to the image by randomly choosing

a fraction of the pixels and placing electrons equal to the full well depth. Similarly, a

fraction of the pixels can be flagged as dead and remove those pixels' electrons. The

same hot pixels and dead pixels should be added to every image for a particular version

of the simulation using the same random number seed for all observations.

2.4. Image attribution
From the photon map and the ADU-based image, we can easily deduce some useful parameters of each source in photon-electron or ADU, such as flux, barycenter, and signal-to-noise ratio. These parameters are essential as standard answers when using the simulated images as test data set for the image processing algorithm.

3. Results
To test the presented method, we compared the simulated images with the observed ones. The observed images were obtained with the one-meter telescope at Weihai Observatory of Shandong University. The telescope has an f/8 classic Cassegrain design with a field of view of 12 × 12 . The photometric system, the CCD camera, and the site

Simulating Photometric Images of Moving Targets with Photon-mapping

11

y

v = 0 x
O u=0
s
s
Figure 4. Image rendering. The coordinates of the pixels are counted from (u, v) = (0, 0).
astro-climate are introduced in detail by Hu et al. (2014). The simulation architecture was implemented based on some off-the-shelf libraries, such as Astropy (Astropy Collaboration et al. 2013, 2018), Skyfield (Rhodes 2019), and Astroquery (Ginsburg et al. 2019). A demo script written in Python code is available on the author's Github ¶. The similarities between the simulated images and the observed ones are measured by residual and Pearson correlation coefficient.
Tracking mode is the first issue to be identified. Three observed images obtained in different tracking modes, the corresponding simulated images, and the residuals between them are shown in Figure 5. Figure 5 (a) is a raw observed image of a GEO space debris in target tracking mode. An arrow indicates a point-like target image. Figure 5 (d) and (g) are raw observed images of BL Lac 3C 66A (02h22m39.61s +4302 07.80 ) in sidereal tracking mode and parking mode, respectively. Limited by the small field of view and our telescope's tracking mechanism, it is not easy to obtain relevant observations of moving targets in sidereal or parking mode. Therefore, images of star fields were used instead to illustrate the latter two tracking modes.
Figure 5 (b)(e)(h) are the simulated images corresponding to (a)(d)(g). The simulation parameters were well tuning or estimated to restored the real observation scenes as far as possible. The parameters of filed stars are from UCAC4 (Zacharias et al. 2012) and Gaia EDR3 (Gaia Collaboration 2020), while the parameters of the moving target are from Space-Track.org and our historical observations. The observation
¶ https://github.com/dujunju

Simulating Photometric Images of Moving Targets with Photon-mapping

12

settings are readily available. Atmospheric and equipment parameters, including seeing, zero-point and extinction coefficient (or the difference between the instrument magnitudes and the standard magnitudes), plate constants, calibration images, and sky background, were estimated from actual observations.
The differences between the simulated images and the observed ones are indistinguishable by naked eyes. The residuals between them are shown in Figure 5 (c)(f)(i), which are almost white noise. Only the images of individual stars show some residual traces, which may be due to the magnitude error in the catalog, the simplified PSF function, or the imperfect plate constants. As shown in Figure 5 (b), the simulated target image is not aligned with the observed one, nor is it in the center of the frame. The former is due to the orbital prediction error, while the latter is due to the telescope pointing deviation. The correlation coefficients between the simulated and observed images in target, sidereal, and parking tracking mode were 0.9512, 0.9648, and 0.8880, respectively. The correlation coefficients of the calibrated images were also calculated to exclude the bias and flat's possible effects--the correlation coefficients became 0.9125, 0.9652, and 0.8968, respectively.
The results presented in Figure 5 are just an random example. To prove this point, we selected a continuous period of observation images to analyze. As mentioned above, our telescope is mainly suitable for follow-up observation in target tracking mode. Therefore, we only compare a large number of simulated images with observed ones in target tracking mode.
We observed a GEO space debris in target tracking mode on 2021 January 29 and obtained thousands of photometric images in the V band. But most of them have few field stars. We did sources extraction using SExtrator (Bertin and Arnouts 1996), and selected 1020 images containing more than five field stars. In response, we generated 1020 simulated images. Correlation coefficients between observed images and corresponding simulated ones are calculated. The histogram of correlation coefficients is shown in Figure 6. The median correlation coefficient is 0.9379+-00..00210215. After calibration, the median correlation coefficient became 0.8804+-00..00259390. These values indicate that our method can generate photometric images with very high fidelity.
The ability to generate distorted source images and provide them for the testing of image processing algorithms is another powerful feature of our method. Distortions of source images are common in practical observations. In our method, the distortion of the source images can be easily adjusted by A and D. For example, images with different degrees of distortion are shown in Figure 7. The shape of streak-like images changes unpredictably from frame to frame and cannot be expressed in an analytic form accurately. But all streak-like images within a single frame share similar shapes, which means the telescope instability affects all field stars in the same way. This phenomenon is consistent with the actual observation shown in Figure 2, which proved that the distortion of the source image was due to the instability of the telescope.

Simulating Photometric Images of Moving Targets with Photon-mapping

13

1100

1300

1500

1700

1100

1300

1500

1700 -150 -100 -50 0 50 100 150 200

Y (pixel)

768

512

256 0
1024

(a)
1150 1200 1250 1300 1350

(b)

(c)

1150 1200 1250 1300 1350

-150 -100 -50

0

50

100 150 200

768

512

256

0 1024

(d)

1150

1200

1250

1300

1350

(e)

(f)

1150

1200

1250

1300

1350

-150 -100 -50 0 50 100 150 200

768

512

256

(g)

(h)

(i)

0

0

256

512

768 1024 0

256

512

768 1024 0

256

512

768 1024

X (pixel)

Figure 5. Images obtained in three tracking modes. The left column shows the observed images obtained in (a) target tracking mode, (d) sidereal tracking mode, and (g) parking mode. The middle column ((b)(e)(h)) presents the corresponding simulated images. The right column ((c)(f)(i)) illustrates the residuals between them. Some bright halo in the middle part of (a) may because the shutter is not entirely closed, and there is some light leakage during the readout process.

4. Conclusions and discussion
In this paper, we provide a new strategy to simulate the photometric images of moving targets. Although many authors have made significant contributions and achievements in this field, such as SkyMaker (Bertin 2009) and PhoSim (Peterson et al. 2015), our

Simulating Photometric Images of Moving Targets with Photon-mapping

14

Y (pixel)

Figure 6. Histogram of the correlation coefficients between 1020 observed images and corresponding simulated ones.

80

A1

A2

A3

A4

A5

A6

A7

A8

A9

60

40

20

80

B1

B2

B3

B4

B5

B6

B7

B8

B9

60

40

20

80

C1

C2

C3

C4

C5

C6

C7

C8

C9

60

40

20

20 40

20 40

20 40

20 40 20 40 20 40
X (pixel)

20 40

20 40

20 40

Figure 7. Screenshots of three streak-like images (A, B, C) in simulated
images (1, 2, 3, 4, 5, 6, 7, 8, 9) generated with different distortion A = D = 0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0 in 10-4 deg · s-0.5 from left to right.

approach still shows extraordinary strength. First, this method's whole implementation process is tracing each photon's journey, which is similar to the actual imaging process, so each step is easy to understand. Second, the propagation path of each photon is determined by the statistical law under various factors, including the distribution of photon arrival time, the random jitter of the telescope, and the point spread function.

REFERENCES

15

Compared to the convolution-based method (Kouprianov 2008; Veres et al. 2012), our method can better represent the discrete distribution of photons. Third, this method is easy to implement and use, and it can easily generate images under different observation scenarios by adjusting parameters. Our method demonstrates high efficiency, accuracy, and flexibility.
An observation scene consisting of hundreds of sources might involve hundreds of millions of photons. Determining the propagation path of a vast amount of photons requires a large amount of computation, restricting the simulation speed. Experiments show that it takes about a minute to produce an image containing 20 million photons. Using parallel computing, optimizing code, or using more efficient programming languages, the speed can be greatly increased. On the other hand, some subtle factors that may influence the simulation have not been considered, such as the PSF changes in different regions of the image, readout noise, blooming of source, and the structure of extended sources. These factors can be added to the framework in the future depending on the research needs.
Image simulation is a useful tool to study the photometry of moving targets, and it will be continually developed. We believe that our method will play a particular role in making observation plans, interpreting observation images, and providing test images to develop and test image processing algorithms.

Acknowledgments
This work is supported by the Natural Science Foundation of China under Grant No. 11873035, the Natural Science Foundation of Shandong province (No. JQ201702), and the Young Scholars Program of Shandong University (No. 20820162003). Thanks, Sofya Alexeeva, for revising this paper.

References
Andersen, T. and Enmark, A. (2011). Integrated Modeling of Telescopes, Vol. 377 of Astrophysics and space science library, Springer, New York, NY. 2.1
Anderson, J. and King, I. R. (2000). Toward high­precision astrometry with wfpc2. i. deriving an accurate point­spread function, Publications of the Astronomical Society of the Pacific 112(776): 1360­1382. 2.2
Astropy Collaboration, Price-Whelan, A. M., Sipocz, B. M., Gu¨nther, H. M., Lim, P. L., Crawford, S. M., Conseil, S., Shupe, D. L., Craig, M. W., Dencheva, N., Ginsburg, A., VanderPlas, J. T., Bradley, L. D., P´erez-Su´arez, D., de Val-Borro, M., Aldcroft, T. L., Cruz, K. L., Robitaille, T. P., Tollerud, E. J., Ardelean, C., Babej, T., Bach, Y. P., Bachetti, M., Bakanov, A. V., Bamford, S. P., Barentsen, G., Barmby, P., Baumbach, A., Berry, K. L., Biscani, F., Boquien, M., Bostroem, K. A., Bouma, L. G., Brammer, G. B., Bray, E. M., Breytenbach, H., Buddelmeijer, H., Burke, D. J., Calderone, G., Cano Rodr´iguez, J. L., Cara, M., Cardoso, J. V. M., Cheedella, S., Copin, Y., Corrales, L., Crichton, D., D'Avella, D., Deil, C., Depagne, E´., Dietrich, J. P., Donath, A., Droettboom, M., Earl, N., Erben, T., Fabbro, S., Ferreira, L. A., Finethy, T., Fox, R. T., Garrison, L. H., Gibbons, S. L. J.,

REFERENCES

16

Goldstein, D. A., Gommers, R., Greco, J. P., Greenfield, P., Groener, A. M., Grollier, F., Hagen, A., Hirst, P., Homeier, D., Horton, A. J., Hosseinzadeh, G., Hu, L., Hunkeler, J. S., Ivezi´c, Z., Jain, A., Jenness, T., Kanarek, G., Kendrew, S., Kern, N. S., Kerzendorf, W. E., Khvalko, A., King, J., Kirkby, D., Kulkarni, A. M., Kumar, A., Lee, A., Lenz, D., Littlefair, S. P., Ma, Z., Macleod, D. M., Mastropietro, M., McCully, C., Montagnac, S., Morris, B. M., Mueller, M., Mumford, S. J., Muna, D., Murphy, N. A., Nelson, S., Nguyen, G. H., Ninan, J. P., N¨othe, M., Ogaz, S., Oh, S., Parejko, J. K., Parley, N., Pascual, S., Patil, R., Patil, A. A., Plunkett, A. L., Prochaska, J. X., Rastogi, T., Reddy Janga, V., Sabater, J., Sakurikar, P., Seifert, M., Sherbert, L. E., Sherwood-Taylor, H., Shih, A. Y., Sick, J., Silbiger, M. T., Singanamalla, S., Singer, L. P., Sladen, P. H., Sooley, K. A., Sornarajah, S., Streicher, O., Teuben, P., Thomas, S. W., Tremblay, G. R., Turner, J. E. H., Terr´on, V., van Kerkwijk, M. H., de la Vega, A., Watkins, L. L., Weaver, B. A., Whitmore, J. B., Woillez, J., Zabalza, V. and Astropy Contributors (2018). The Astropy Project: Building an Open-science Project and Status of the v2.0 Core Package, The Astronomical Journal 156: 123. 3
Astropy Collaboration, Robitaille, T. P., Tollerud, E. J., Greenfield, P., Droettboom, M., Bray, E., Aldcroft, T., Davis, M., Ginsburg, A., Price-Whelan, A. M., Kerzendorf, W. E., Conley, A., Crighton, N., Barbary, K., Muna, D., Ferguson, H., Grollier, F., Parikh, M. M., Nair, P. H., Unther, H. M., Deil, C., Woillez, J., Conseil, S., Kramer, R., Turner, J. E. H., Singer, L., Fox, R., Weaver, B. A., Zabalza, V., Edwards, Z. I., Azalee Bostroem, K., Burke, D. J., Casey, A. R., Crawford, S. M., Dencheva, N., Ely, J., Jenness, T., Labrie, K., Lim, P. L., Pierfederici, F., Pontzen, A., Ptak, A., Refsdal, B., Servillat, M. and Streicher, O. (2013). Astropy: A community python package for astronomy, Astronomy & Astrophysics 558: A33. 3
Bertin, E. (2009). Skymaker: astronomical image simulations made easy, Memorie della Societa Astronomica Italiana 80: 422. 1, 2.2, 4
Bertin, E. and Arnouts, S. (1996). Sextractor: Software for source extraction, Astronomy and Astrophysics Supplement Series 117(2): 393­404. 3
Devyatkin, A. V., Gorshanov, D. L., Kouprianov, V. V. and Verestchagina, I. A. (2010). Apex i and apex ii software packages for the reduction of astronomical ccd observations, Solar System Research 44(1): 68­80. 1
Dutr´e, P., Bala, K. and Bekaert, P. (2006). Advanced global illumination, 2nd ed. edn, A K Peters, Wellesley, MA. 1
Eichhorn, H. (1963). The relationship between standard coordinates of stars and the measured coordinates of their images, Applied Optics 2(1): 17­21. 2.1
Fraser, W., Alexandersen, M., Schwamb, M. E., Marsset, M., Pike, R. E., Kavelaars, J. J., Bannister, M. T., Benecchi, S. and Delsanti, A. (2016). Trippy: Trailed image photometry in python, The Astronomical Journal 151(6): 158. 1
Gaia Collaboration (2020). Vizier online data catalog: Gaia edr3 (gaia collaboration, 2020), VizieR Online Data Catalog p. I/350. 3
Ginsburg, A., Sipocz, B. M., Brasseur, C. E., Cowperthwaite, P. S., Craig, M. W., Deil, C., Guillochon, J., Guzman, G., Liedtke, S., Lian Lim, P., Lockhart, K. E., Mommert, M., Morris, B. M., Norman, H., Parikh, M., Persson, M. V., Robitaille, T. P., Segovia, J.-C., Singer, L. P., Tollerud, E. J., de Val-Borro, M., Valtchanov, I., Woillez, J., Astroquery Collaboration and a subset of astropy Collaboration (2019). astroquery: An Astronomical Web-querying Package in Python, The Astronomical Journal 157(3): 98. 3

REFERENCES

17

Hu, S.-M., Han, S.-H., Guo, D.-F. and Du, J.-J. (2014). The photometric system of the onemeter telescope at weihai observatory of shandong university, Research in Astronomy and Astrophysics 14(6): 719. 3
Jensen, H. W. (2001). Realistic image synthesis using photon mapping, A K Peters, Natick, MA. 1
Kouprianov, V. (2008). Distinguishing features of ccd astrometry of faint geo objects, Advances in Space Research 41(7): 1029­1038. 1, 4
Kouprianov, V. (2010). Advanced image processing techniques for automatic reduction of geo survey data, 8th US-Russian Space Surveillance Workshop At: Maui, HI. 1
Kovalevsky, J. and Seidelmann, P. K. (2004). Fundamentals of astrometry, Cambridge University Press, Cambridge. 2.1, 2.1, 2.1
Massey, R., Refregier, A., Conselice, C. J. and Bacon, D. J. (2004). Image simulation with shapelets, Monthly Notices of the Royal Astronomical Society 348(1): 214­226. 1
Peterson, J. R., Jernigan, J. G., Kahn, S. M., Rasmussen, A. P., Peng, E., Ahmad, Z., Bankert, J., Chang, C., Claver, C., Gilmore, D. K., Grace, E., Hannel, M., Hodge, M., Lorenz, S., Lupu, A., Meert, A., Nagarajan, S., Todd, N., Winans, A. and Young, M. (2015). Simulation of astronomical images from optical survey telescopes using a comprehensive photon monte carlo approach, The Astrophysical Journal Supplement Series 218(1): 14. 1, 2.1, 2.2, 4
Rhodes, B. (2019). Skyfield: High precision research-grade positions for planets and Earth satellites generator. 2.1, 3
Schilling, R. L. and Partzsch, L. (2012). Brownian Motion: An Introduction to Stochastic Processes, De Gruyter, Berlin/Boston. 2.1
Veres, P., Jedicke, R., Denneau, L., Wainscoat, R., Holman, M. J. and Lin, H.-W. (2012). Improved asteroid astrometry and photometry with trail fitting, Publications of the Astronomical Society of the Pacific 124(921): 1197­1207. 1, 1, 4
Zacharias, N., Finch, C. T., Girard, T. M., Henden, A., Bartlett, J. L., Monet, D. G. and Zacharias, M. I. (2012). VizieR Online Data Catalog: UCAC4 Catalogue (Zacharias+, 2012), VizieR Online Data Catalog p. I/322A. 3

