arXiv:2106.01147v1 [physics.optics] 2 Jun 2021

Pixel-integrated thin-film filter simulation and scaling trade-offs
THOMAS GOOSSENS1,2,*
1Stanford University 2 This work was partially performed at imec (Belgium) and Institut Fresnel (France)
*Email: contact@thomasgoossens.be
Abstract: Thin-film optical filters can nowadays be integrated onto pixels of commercial image sensors used for spectral imaging. A drawback of having more filters on an image sensor is a loss in spatial resolution which could be regained by using smaller pixels. However, this work shows that miniaturization causes a reduction in transmittance and requires a trade-off between pixel size and filter bandwidth. This is caused by diffraction and the reduced number of reflections in the filter. Analytical wave and ray optics models are developed and used for fast transmittance prediction and this is validated using a commercial spectral sensor and numerical simulations. The identified trade-off is an intrinsic limitation of pixel-integrated thin-film filter technology and the developed models will be useful tools for exploring new hardware and computational solutions.
1. Introduction
Spectroscopes obtain a spectrum for a single point and use this to identify and analyze different materials [1]. While useful, such devices remain unpractical for analyzing and comparing the spectrum across large areas. In contrast, spectral imaging techniques combine imaging and spectroscopy such that the spectrum at different positions can be compared simultaneously. The applications range from, but are not limited to, monitoring plant health for precision agriculture [2], endoscopy [3], recycling [4], and art preservation [2].
Over the decades, spectral imaging devices have become smaller and lighter to facilitate new applications [5]. A major advance in miniaturization was enabled by the deposition of thin-film spectral filters on 5.5 µm wide pixels of commercial CMOS image sensors (Fig. 1) [6­8]. The monolithic integration of filters on the pixels makes the cameras more mechanically robust, compact, and lightweight. Another recent advancement is the development of short-wave infrared spectral cameras using an InGaAs sensor with 15 µm wide pixels [9]. While the scope of this work is limited to integrated thin-film filters, many alternative technologies are actively being investigated [10­12].
In applications that require high frame rates or video capture, the filters can be deposited in an extended Bayer (mosaic) pattern. Like the Bayer pattern [13], a cell of  by  filters is periodically repeated across the sensor (Fig. 2) [6, 8]. A major drawback of this approach is the loss in spatial resolution by a factor of  in each dimension. While the 5.5 µm resolution might be sufficient for some applications, there is a high demand for snapshot spectral cameras with higher spatial resolution, rather than more spectral bands. One hardware solution would be to deposit filters on smaller pixels.
To design pixel-integrated thin-film filters, good simulation tools are required. However, most commercial thin-film software tools are based on the transfer-matrix method which assumes an infinite filter size [14­17]; An assumption which, as will be shown, produces wrong transmittance predictions at present pixel scales.

As such, this work makes two contributions to the field of pixel-integrated filter design. First, the development of wave- and ray-optics models that include pixel size and that can predict filter transmittance and its angular dependency. Second, the derivation of a fundamental scaling trade-off between pixel size and filter bandwidth to avoid a given reduction in filter transmittance.
These findings are particularly relevant in the context of spectral cameras with pixel-integrated filters. Firstly, because the scaling trade-off constrains the possible filter designs and what optics can be used. And secondly, because the software tools developed in this work could become useful tools to efficiently explore different filter designs.
The manuscript is organized as follows. An overview of related work is presented in Section 2. A wave-optics model is derived in Section 3. An equivalent monolayer model is introduced in Section 4 and used to derive a ray-optics interpretation in Section 5. This leads to the formulation of a trade-off law in Section 6. The results are validated numerically and experimentally in Section 7. Finally, the analysis is concluded with a discussion on trade-off mitigation strategies and future directions.

ns

Pixel

ns

Pixel

ns

Pixel

Fig. 1: Array of pixel-integrated thin-film Fabry-Pérot filters made from two dielectric materials. By changing the cavity thickness, the transmitted wavelengths can be chosen.

(a) Extended Bayer (mosaic) pattern.

(b) The mosaic camera acquires a spectral image in one shot.

Fig. 2: The extended Bayer (mosaic) pattern and its mode of operation. Images at the courtesy of imec.

2. Tiny thin-film filters and related work
In the thin-film filter literature, the term thin is loosely defined as a film which is thin enough for interference effects to be observed [14, p38]. Similarly, the term tiny thin-film filter will be used to indicate that a filter is spatially narrow enough to produce deviations from classical thin-film theory which supposes an infinite filter width. The term narrow was refrained from to avoid confusion with the term narrowband filter, which is already very common.
No discussion on this topic occurs in recent reference works on thin-film filters [14, 18] and commercial software tools like OptiLayer [15], TFCalc [17], or Essential Macleod [16] do not model the effect of finite width. There is remotely related work on modeling the effect of gaps in a mirror of a Fabry-Pérot etalon using a ray model. Except for suggesting the usefulness of ray models, it remains different from studying the finite width of multi-layered filters [19, 20]. Other relevant work includes the study on pixel vignetting by Catrysse et al. [21]. In their appendix it is shown how a finite pixel size causes a loss of rays that lowers the transmittance for increasing angles. This pixel-vignetting model, however, only predicts a scaling of pixel response due to a loss in flux. In contrast, this manuscript deals with changes in spectrum due to changes in the interference pattern in filters deposited onto a pixel.
The wave-optics model that will be introduced is mathematically related to illuminating an infinite film with a light beam of narrow width. This small-spot illumination is briefly discussed in Macleod's handbook using the angular spectrum [14, p. 614]. The formalism is mathematically similar but there are some important differences with this work. First, in this work the finite size of the filter is incorporated by integrating the transmitted flux only across the finite pixel area. Second, the formalism is given a new interpretation using a ray model.

3. Wave-optics approach

This section introduces a wave-optics model used for tiny-filter simulation. The detailed derivivations are documented in Section B of Supplementary Document 1.
To approximate the transmittance of a tiny filter, it is assumed that the finite size can be modeled by having an aperture on an infinitely wide thin-film filter stack (Fig. 3). In the context of imaging we are then interested in the total power transmitted to the pixel (substrate). All flux arriving outside of the pixel area is considered lost with respect to its contribution to the original interference pattern. This lost flux might contribute to cross-talk but this is outside the scope of this work.

The effect of finite filter size is that an incident plane wave will be spatially constrained such that

Ein () = rect  2 sin / ,

(1)



Plane wave

where rect(  ) = 1 for |/| < 1/2. The factor 2 sin / accounts for the phase difference

that arises because the wave front arriving at position  has to travel an additional distance  sin  compared to the wave front arriving at  = 0.
To analyze how this field is transmitted, we can represent it using its angular spectrum [22], also referred to as a wave packet decomposition [18]. This means the incident field can be decomposed in plane waves by means of a spatial Fourier transform such that the plane wave

Ein(x)

Non-transmissive coating

w
x

Lost flux

z Eout(x)
Absorbed flux

Lost flux

Fig. 3: Plane wave incident on an infinite film coated with an aperture. Only the flux across the pixel array is considered to contribute.

amplitudes are

 +

in () =

Ein

()

-


(2





)

d

,

(2a)

-

= sinc   - sin  ,

(2b)



with sinc() = sin()/. The spatial frequencies  correspond to the different incidence angles of the plane waves. For example, for an incident plane wave 2 sin /, we have  = sin  .

Now the transmission coefficient  for plane wave illumination can be used to calculate how each plane wave in the decomposition is transmitted [18, p.126]. The total transmitted field is then reconstructed as the integral over the transmitted plane waves such that

 +

E (, ) =



(,

)

in (,

)




(2

) d,

(3)

-

 =  in

which corresponds to taking the inverse Fourier transform. Using the wave-packet approach, the tiny-filter transmittance twinayve is calculated as the total transmitted power t [W] divided by the total incident power in [W] so that

twinayve (; )

=

t .
in

(4)

A full derivation is presented in Supplementary Document 1 (Section B) and leads to the following

expressions which can be efficiently implemented

in

= in 2



 2

-

 2

Ein ()Ein () d

=

in  ,
2

(5)

t

=1 2




 (

) t (

)( t  )(

)d

,

(6)

with  ( ) = sinc( ),  the convolution operator, and  [-1] the (polarization dependent) characteristic admittance of each layer [18, p.112]. When necessary, the convolution can be computed efficiently using a Fast-Fourier Transform.

4. Equivalent tiny monolayer model

In (3) and (6), only the transmission coefficient  in  =  in contains filter-specific information. Therefore, if  can be approximated in a certain wavelength and angular range of interest, the model gives identical results. This important property will be essential for developing a ray-optics interpretation and deriving a fundamental scaling trade-off.

To find an equivalent transmission coefficient we employ the well-established fact that alldielectric Fabry-Pérot filters can be approximated by an equivalent monolayer model in the neighborhood of the main peak [14, 23]. However, its application to the study of tiny filters is a novel contribution of this work.

The transmission coefficient for an infinitely wide cavity with refractive index eff and mirrors of reflectance  mirrors is derived in [24, p.362] so that



=

(1 -

) ,

1 - 2

(7)

which is

used

to

set



=

 in

in (6).

Here,



=

2 eff eff cos  

is the phase

thickness,



the

angle

of refraction, and  the transmission coefficient between the incident medium and the substrate.

So essentially, only two model parameters are required: the mirror reflectance  and the effective

refractive index eff of the cavity. The central wavelength cwl of the filter at normal incidence

can

be

fixed

by

choosing

a

half-wave

cavity

thickness

eff

=

. cwl
2eff

The reflectance  of the mirrors is directly related to the normalized Full Width at Half Maximum

(FWHM)  of the infinitely wide Fabry-Pérot filter as

FWHM

  1 - ,  =

 0,

(8)

cwl

as derived in Section D of Supplementary Document 1.

The effective refractive index eff fully determines how much the filter shifts towards shorter wavelengths for increasing incidence angles. When the filter design is known, an analytical expression for the effective index can be used [14, p.279]. For a low-index cavity we have

eff = 

1-

 

+

2

2

-

1 2

,

(9)



where  is a high refractive index  a low refractive index. Alternatively, when the filter design is not known, the effective index can also be estimated empirically by measuring the central wavelength at multiple angles [25].

In the next section, the equivalent tiny monolayer model is used to develop a ray-optics interpretation and an analytical expression for the transmittance.

5. Ray optics interpretation of tiny filters
It is already known that ray models give correct results for infinitely wide filters illuminated by plane waves [14]. In contrast, using ray analysis to study tiny filters is proposed as a new approach which offers valuable insights into the effect of finite filter size. We limit ourselves to the analysis of a single-cavity filter which corresponds to the equivalent monolayer model introduced in the previous section.
5.1. Truncated interference
The correct operation of a thin-film interference filter depends on light beams reflecting many times and interfering with each other. When the filter is infinitely wide, there are an infinite number of rays that interfere. In contrast, when the filters are tiny, the supply of rays at oblique incidence is limited but increases with distance from the wall (Fig. 4). This means that the number of interfering rays varies across the substrate.
For example, consider the ray labeled as  = 1 in Fig. 4. Starting from the left wall, this is the first ray that can be transmitted through the filter. This means to the left of this ray, no light arrives and this can be referred to as filter vignetting, by analogy to pixel vignetting [21]. In contrast, the region between between  = 1 and  = 2 only involves direct transmission without interference. In the subsequent regions, gradually more rays start interfering.

 2heff tan n

Mirror

heff

Cavity

Filter vignetting

Mirror

N =0 N =1
w

N =2

N =3

Substrate
x

Fig. 4: In a tiny Fabry-Pérot filter, only a finite number  () of rays can interfere at position  on the substrate. The overlapping rays are drawn next to each other for illustration purposes only.
This interpretation is formalized by calculating the resulting field amplitude at each position on the substrate. For classical thin-film theory, this leads to a converging infinite series [24, p.361]. However, when there are only  () outcoming rays at position , the series has to be truncated

such that

 ()

E (; )

=

2  (-1) 2  (-1)





=1

=

2 ·

 2  - 1 ,
2 - 1

(10a) (10b)

where  is the transmission coefficient of the mirror,  the reflection coefficient,  = , and  the transmission coefficient of the air-substrate interface. The factor



=

2eff eff

cos() ,

(11)



is defined as the phase thickness of the film. It accounts for the relative differences in optical path length that each ray travels [24].

The physical interpretation of the series is that an incident ray of unit amplitude is first partially transmitted (), then traverses through the layer to the lower interface where it is partially reflected (). The ray then traverses the layer to the top interface where it is, again, partially reflected (). This process continues until the ray reaches the position  where it is partially transmitted through the mirror and to the substrate (). The transmission coefficients are outside the summation because each ray that enters the substrate has entered and exited the cavity only once.

The position-dependent number of interfering rays is equal to

() = 1 +



,

(12)

2 2eff tan 

as derived in Supplemental Document 1 (Section C). Here, · is the floor operator which rounds number downwards. This number becomes smaller for increasing incidence angles because the horizontal displacement eff tan  for each traversal becomes larger. Hence, rays reach the boundary with fewer reflections in the cavity.

5.2. Transmittance of a tiny filter

For an infinitely wide filter, there is a position-independent transmitted irradiance. For a tiny filter, in contrast, the irradiance  (; ) [W m-2] is position dependent. As in (4), the transmittance of a
tiny filter is then defined as the total transmitted power divided by the total incident power so that



 (; )d

ray
tiny

()

=

0


.

(13)

in (; )d
0

An analytical approximation for the filter transmittance is derived (Section F of Supplemental Document 1) so that

ray
tiny

()



 in

·  (1 -

)2

·

1+

2 -1 log 2

-

2(log() ( cos(2 )-1)+2  sin(2 )) 4 2+ log()2

1 - 2 cos(2) + 2

,

(14)

with



eff ,

(15)

cwl tan 

being the maximal number of interfering rays in the substrate.

It then follows that the peak transmittance is described by

ray

peak peak

=

1+

(1 - )(3 - ) ,
log 2

(16)

with

peak

=

ray
peak

(





).

This equation can be used to quickly estimate the expected drop in peak transmittance for an
arbitrary Fabry-Pérot filter. The normalization by the peak enables comparison between filters with different peak transmittances, e.g. caused by using different substrate materials.

6. Filter size and bandwidth trade-off
The equivalent monolayer model introduced in Section 4 suggests that any Fabry-Pérot filter design that maps onto the same equivalent model parameters will have the same reduction in transmittance. This, of course, only in the wavelength and angular range where the equivalent model is a valid approximation.
An important corollary is the existence of a fundamental trade-off between filter size and filter bandwidth. That is, that for a given requirement in peak transmittance or bandwidth, one cannot freely choose pixel size and filter bandwidth. Or alternatively, that for further miniaturization, larger filter bandwidths might be required.
The trade-off is imposed by two, mostly independent, effects: truncated interference and diffraction which are discussed in the sections that follow.

6.1. Contribution of truncated interference
Truncated interference was introduced as a ray-optics concept in Section 5. It states that for a tiny filter, a converging infinite series representing interfering rays has to be truncated, causing an increase in bandwidth and decrease in peak transmittance.

For narrowband filters (  0), the peak transmittance can be approximated by

ray
peak peak

1-

(1 - -  ) (3 - -  ) ,
2  

(17)

see Section G of Supplemental Document 1. It follows that the transmittance is fully determined by the factor  which can be rewritten as the following dimensionless trade-off parameter



=



1 · 

=  -1

· -1

·

=



-1 FWHM -1

·

·

tan 

.

(18)

cwl

cwl

eff

Normalized spatial width


Normalized bandwidth


Normalized incidence angle


The factor  is defined as the inverse of  because this makes it proportional to the incidence angle which facilitates interpretability. The third factor can be understood as a normalized incidence angle because of the small-angle approximation tan   /eff. This last approximation is not used in software implementations.

For increasing incidence angles , the peak transmittance will follow the curve given by (17) (Fig. 5). How far is traveled along the curve is fully determined by the system parameters that determine alpha . In any case, the larger , the lower the transmittance of the filter at oblique incidence due to a corresponding truncation of interference.
6.2. Verification with the wave-optics model The nondimensionalization suggests that any Fabry-Pérot filter which maps onto the same  value, will have a identical reduction in transmittance and increase in FWHM. This claim is tested using the wave-optics model, and this for four filters with different material parameters, number of layers, and bandwidth  (See Section H of Supplementary Document 1). The peak transmittance is calculated for unpolarized light incident at angles between 0 and 25 degrees and for pixel sizes of  = 5.5 µm and  = 10 µm. The peak transmittance and change in FWHM are plotted as a function of , calculated using (18) (Figs. 5 and 6). As expected, not each curve travels equally far horizontally because of the nondimensionalization. The peak transmittance for both  = 5.5 µm and  = 10 µm matches well with the predictions from (16). There is, however, a width-dependent transition region for small angles. This is due to diffraction and its contribution is explained in the next section. Similar conclusions appear to hold for the change in FWHM, normalized by the FWHM at normal incidence (Fig. 6). For the 5.5 µm pixel, there is a clear deviation from truncated interference but the trend is similar. For the 10 µm pixel, all curves are almost perfectly aligned.
6.3. Contribution of diffraction The contribution of diffraction dominates when  and  are small (Figs. 5 and 6). As will be numerically validated in the next section, the transmittance-reducing effect of diffraction occurs and is accurately predicted by the wave-optics model. However, further analysis is required to find simple analytical approximations that can predict this peak drop. The intuition is that when  is small, the angular spectrum of the diffracted light beam has a wider support (see (2)). Because the filter transmittance shifts with increasing angle, the effect of diffraction corresponds to taking a weighted average of shifted filter responses. When the bandwidth  is small, the averaging effect is stronger.
Fig. 5: Peak transmittance plotted as a function of the dimensionless trade-off factor. The truncated interference model works best for the 10 µm pixel. The full lines are wave-optics calculations.

Fig. 6: Increase in FWHM plotted as a function of the dimensionless trade-off factor. The truncated interference model works best for the 10 µm pixel. The full lines are wave-optics calculations.

7. Validation
In this section the wave- and ray-optics models are validated numerically and experimentally. First, numerically to validate the model at different pixel scales (Section 7.1). Second, experimentally using the equivalent monolayer model (Section 7.2) and by demonstrating the trade-off law (Section 7.3).

7.1. Numerical validation
To validate the method for multiple pixel sizes, Maxwell's equations are solved using MaxwellFDFD, a finite difference frequency domain (FDFD) Matlab toolbox [26]. The simulations are performed in two dimensions.
The filters are of a typical all-dielectric Fabry-Pérot filter design found in the literature [14]:

Air| () | |( ) |Silicon,

(19)

where each layer is a quarter-wave plate for a chosen wavelength and  indicates a layer of low and then high refractive index. The exponent in () indicates this pattern is repeated  times.
Three filters are placed adjacently similar to Fig. 1. Only the transmittance of the central filter is calculated to ensure realistic boundary conditions. The simulation was run for pixel sizes of 10 µm, 5.5 µm, and 2 µm. More detailed information about the simulations can be found in Section I of Supplementary Document 1.
For all simulated pixel sizes, the infinite-filter prediction , fails to explain the change in filter transmittance. In contrast, for the 10 µm and 5.5 µm wide pixels, the predicted tiny-filter transmittance twinayve corresponds well to the numerical result. For the 2 µm pixel, the model predicts most of the variation but there is is a small shift in central wavelength and some non-negligible resonances are visible near the main peak. Yet, even for the 2 µm pixel, twinayve is much more accurate than the infinite-filter prediction .
The ray model matches the transmittance well for pixel sizes of 5.5 µm and 10 µm. For the 2 µm pixel, the prediction is bad at normal incidence but good at large angles. The reason the ray model fails at normal incidence is that the effect of diffraction is not included.

0.6
0.4
0.2
0 0.68 0.7 0.72

0.68 0.7 0.72

0.68 0.7 0.72

0.68 0.7 0.72

(a) 10 µm pixel

0.6
0.4
0.2
0 0.68 0.7 0.72

0.68 0.7 0.72

0.68 0.7 0.72

0.68 0.7 0.72

(b) 5.5 µm pixel

0.6
0.4
0.2
0 0.68 0.7 0.72

0.68 0.7 0.72

0.68 0.7 0.72

0.68 0.7 0.72

(c) 2 µm pixel
Fig. 7: FDFD simulations of the transmittance for different pixel sizes for s-polarized light. The numerical model simulates a 2D version of Fig. 1 and is compared to predictions of the wave-optics and ray-optics model.

7.2. Experimental validation using the equivalent monolayer model
The models are experimentally validated for a commerical snapshot spectral sensor developed by imec. It consists of pixel-integrated Fabry-Pérot filters deposited on 5.5 µm wide pixels of a CMV2000 image sensor [27, 28]. Direct validation of the model would require imec's proprietary filter stack, which is not publicly available. However, using the equivalent monolayer approach we can still make predictions. Detailed information on the experimental setup and data processing is presented in Section J of Supplemental Document 1.
For imec's sensor, the effective refractive index is taken to be eff = 1.7 as reported in previous studies on the angular dependency [29]. The bandwidth  is estimated by fitting the wave-optics prediction to the measurement at normal incidence. For the first filter located at cwl = 767 nm this gives  = 0.91% and for the second filter at cwl = 921 nm that  = 1.63%.
For the filter at cwl = 767 nm, the peak maximum gradually reduces with incidence angle with a 77% reduction at 20. In addition, the bandwidth (Full-Width at Half Maximum) of the filter more than doubles from 7 nm to 17 nm. Recently, similar result were independently observed by Hann et al. [30].
For both filters, at all angles, the tiny filter prediction twinayve is much better than the infinite filter prediction  (Fig. 8). Although the predicted peak is slightly higher than the measurement, the increase in FWHM is predicted accurately. This suggests that another effect, like cross-talk, further diminishes the pixel response. In support of this hypothesis, we see in Fig. 8b a second peak at 0.85 µm that increases with the angle and corresponds to the wavelength of the neighboring filter. However, further analysis of cross-talk is outside the scope of this work.
Finally, it is remarkable that such a good fit can be obtained without knowing the actual filter design. The impact of this result is reinforced in the next section which validates the trade-off law for imec's sensor.
7.3. Filter size and bandwidth trade-off law
The trade-off relation is validated for all 25 filters on imec's 5x5 snapshot mosaic sensor used in Section 7.2. The filters are distributed across a wavelength range of 665 and 975 nm.
For each filter, at each angle, its trade-off parameter  was calculated using (18). The bandwidth  of each filter was found by fitting the equivalent monolayer wave-optics model to the measurement at normal incidence.
The measured changes in peak transmittance and FWHM follow the expected curve well (Fig. 9). The point cloud for FWHM is wider partly because the filters are not always nicely Lorentzian due to, for example, cross-talk.
8. Discussion
8.1. Mitigation strategies for snapshot spectral imaging
(18) outlines a scaling law for pixel-integrated Fabry-Pérot which constrains which camera optics can be used and what filter transmittance can be designed. However, the impact on spectral imaging always depends on the application requirements. Most impact is expected for applications that depend on the accurate measurement of narrowband spectral features or identification of small spectral differences between multiple samples. This is because a change in filter bandwidth will have a smoothing effect which might obscure the features of interest.
Mitigating the trade-off means designing systems for which  is small enough to make tiny-filter effects irrelevant. In this section this is briefly discussed as a suggestion for future investigations.

600
400
200
0 0.72 0.76

0.72 0.76

0.72 0.76

0.72 0.76

(a) Filter centered at 767 nm. The change in FWHM is predicted well while the peak transmittance is slightly overestimated.

300

200

100

0 0.85 0.9 0.95

0.85 0.9 0.95

0.85 0.9 0.95

0.85 0.9 0.95

(b) Filter centered at 921 nm with a higher FWHM. The change in FWHM is predicted well. A second peak, most likely due to cross-talk, is seen around 0.85 µm.
Fig. 8: Comparison of predicted and measured filter response for two filters on imec's mosaic sensor with two different bandwidth (FWHM). The dashed line is the classical prediction for an infinitely wide filter. In both cases, the tiny filter prediction is much better.

1

4

0.8
3 0.6

0.4 2
0.2

0

1

0

1

2

3

0

1

2

3

Fig. 9: Trade-off visualized for all 25 filters on imec's snapshot mosaic sensor.

In summary, the strategies correspond to minimizing  or maximizing  and  whenever possible.
A first way of mitigating the trade-off is to minimize the incidence angle  by using high f-number telecentric lenses. This is however a tight constraint for applications that require fast lenses with small f-numbers (e.g. in low light conditions) or wide-angle lenses. Furthermore, even at normal incidence there is a width-dependent transmittance reduction (Fig. 5).
A second strategy is to use materials with higher refractive indices to minimize the normalized incidence angle . While this seems an obvious approach, one is often limited by available materials and processing constraints.
A third strategy is to maximize the normalized filter width  by patterning the filters across larger pixel areas. Snapshot cameras with such larger filters exist but require additional lens array to replicate the scene onto each filter tile [7].
A potential fourth strategy is to maximize the bandwidth  and explore different filter designs. This implies using computational approaches to enable the use of broadband filters with, for example, sinusoidal transmittance [31]. Note that the trade-off parameter was derived for narrowband filters. Whether broadband filters would indeed be more robust to tiny-filter effects remains to be explored.
Lastly, an exciting strategy to explore is computational correction. Now that a fast simulation method has been derived, it can perhaps be used to solve the inverse problem and correct spectral measurements in a cost-efficient way. Of course, it remains to be seen whether this inverse problem will have good enough conditioning.
8.2. Model assumptions and extensions
The proposed wave-optics model does not explicitly take into account neighboring filters and the corresponding boundary conditions. Yet, it produces good predictions of the transmittance. It should be better understood when and how the use of the angular spectrum method breaks down. Furthermore, all calculations were done for the absorption-free case and further analysis will be required to verify whether the presented models remain valid.
The proposed ray-optics model intuitively explains the effect of filter size and delivers remarkably accurate and fast predictions. However, the analytical expression for peak transmittance fails to predict the reduced transmittance at normal incidence because diffraction-related effects are not included. It would be valuable to generalize the peak transmittance equation to the wave-optics regime.
Both models ignore flux that arrives outside of the pixel area and which might contribute to cross-talk. Advancing the theoretical understanding of cross-talk in filter arrays is suggested for future investigations and could lead to new filter patterning strategies.
It was shown experimentally that for the tested pixel size, a 2D wave-optics model is effective in estimating the transmittance for 3D filters up to an unknown scalar. To make the analysis maximally relevant for imaging, a three-dimensional generalization is required that models diffraction in both dimensions and can include focused light.
8.3. Efficient toolbox
Although Fabry-Pérot filters were the main focus in this manuscript, the wave-optics model is agnostic about the filter design. Therefore, the time- and memory-efficient wave-optics method could be a useful tool for fast pixel-integrated filter design exploration.

The software implementation is publicly available as a MATLAB toolbox [34]. This will facilitate reproducibility and future experimental validation of the proposed models and trade-off law.
9. Conclusions
It was demonstrated that pixel size impacts the transmittance of pixel-integrated thin-film filters by limiting the number of reflections and by diffraction. The proposed analytical models enable fast transmittance predictions which were validated experimentally and numerically. This enables quick exploration of the effect of filter width; a feature lacking in current commercial thin-film software tools.
The need for higher spatial resolution for snapshot spectral imaging devices requires thin-film filters integrated on smaller pixels. However, further filter miniaturization will require a trade-off between filter bandwidth and filter size.
While the identified trade-off is intrinsic to the technology, it remains open whether it will be the main bottleneck for further miniaturization or whether other constraints will dominate first. Mitigation strategies that could be further explored include using higher refractive index materials, different filter patterning, the use of microlenses, and computational approaches.
10. Acknowledgements
My sincere gratitude goes to Prof. Claude Amra (Institut Fresnel) for teaching me the essentials of thin-film filter wave-optics analysis and for many entertaining discussions which were instrumental to the conception of this work. I also thank Dr. Peter B. Catrysse (Stanford University) for proofreading the manuscript and providing much constructive feedback. Also, this work would not have been possible without my fruitful collaboration with imec (Belgium) during my doctoral studies. Lastly, I would like to thank Brian Wandell and Joyce Farrell (Stanford University) for their support and for facilitating this work.
11. Disclosures
The author was affiliated with imec until October 2020.
12. Supplemental documents
See Supplemental Document 1 for derivations and further details on the numerical simulations and experiments.
See Supplemental Code 1 for the script used for FDFD simulations.
References
1. D. A. Skoog, F. J. Holler, and S. R. Crouch, Principles of instrumental analysis (Cengage learning, 2017). 2. M. J. Khan, H. S. Khan, A. Yousaf, K. Khurshid, and A. Abbas, "Modern Trends in Hyperspectral Image Analysis:
A Review," IEEE Access 6, 14118­14129 (2018). 3. J. Yoon, J. Joseph, D. J. Waterhouse, A. S. Luthman, G. S. Gordon, M. di Pietro, W. Januszewicz, R. C. Fitzgerald,
and S. E. Bohndiek, "A clinically translatable hyperspectral endoscopy (HySE) system for imaging the gastrointestinal tract," Nat. Commun. 10, 1­13 (2019). 4. S. Serranti, R. Palmieri, and G. Bonifazi, "Hyperspectral imaging applied to demolition waste recycling: innovative approach for product quality control," J. Electron. Imaging 24, 043003 (2015). 5. N. Hagen and M. W. Kudenov, "Review of snapshot spectral imaging technologies," Opt. Eng. 52, 090901 (2013). 6. B. Geelen, N. Tack, and A. Lambrechts, "A compact snapshot multispectral imager with a monolithically integrated per-pixel filter mosaic," Proc. SPIE 8974, 89740L (2014). 7. B. Geelen, N. Tack, and A. Lambrechts, "A Snapshot Multispectral Imager with Integrated Tiled Filters and Optical Duplication," Spie Moems-Mems 8613, 89740L---89740L (2014). 8. B. Geelen, C. Blanch, P. Gonzalez, N. Tack, and A. Lambrechts, "A tiny VIS-NIR snapshot multispectral camera," Adv. Fabr. Technol. for Micro/Nano Opt. Photonics VIII - Proc. SPIE 9374, 937414­1 (2015).

9. P. Gonzalez, J. Pichette, B. Vereecke, B. Masschelein, L. Krasovitski, L. Bikov, and A. Lambrechts, "An extremely compact and high-speed line-scan hyperspectral imager covering the SWIR range," in SPIE 10656, Image Sensing Technologies: Materials, Devices, Systems, and Applications V, vol. 10656 (2018), pp. 106560L­10656­9.
10. C. Williams, G. S. Gordon, T. D. Wilkinson, and S. E. Bohndiek, "Grayscale-to-Color: Scalable Fabrication of Custom Multispectral Filter Arrays," ACS Photonics 6, 3132­3141 (2019).
11. A. Shaukat, F. Noble, and K. M. Arif, "Nanostructured color filters: A review of recent developments," Nanomaterials 10, 1­36 (2020).
12. P. Kusar, S. Jessenig, and G. Eilmsteiner, "Single mask step etching of Fabry-Pérot etalons for spectrally resolved imagers," J. Micromechanics Microengineering 30 (2020).
13. B. E. Bayer, "Color Imaging Array," (1976). 14. H. A. Macleod, Thin-Film Optical Filters, Fifth Edition (CRC press, 2017). 15. A. V. Tikhonravov, "OptiLayer thin-film software, http://www.optilayer.com (visited on March 2, 2021)." (2021). 16. A. Macleod, "The Essential Macleod," software by Thin Film Cent. Inc (1997). 17. Software Spectra, Thin Film Design Software for Windows Version 3.5.15 (2009). 18. C. Amra, M. Lequime, and M. Zerrad, Electromagnetic Optics of Thin-Film Coatings: Light Scattering, Giant Field
Enhancement, and Planar Microcavities (Cambridge University Press, 2021). 19. F. E. Geiger, "The effect of finite aperture on the fringe intensity distribution of Fabry Perot Interferometers," J. Opt.
Soc. Am. 39, 249­251 (1949). 20. K. L. Vander Sluis and J. R. McNally, "Fabry-Perot Interferometer with Finite Apertures," J. Opt. Soc. Am. 46, 39
(1956). 21. P. B. Catrysse and B. A. Wandell, "Optical efficiency of image sensor pixels," J. Opt. Soc. Am. A 19, 1610 (2002). 22. J. Goodman, "Introduction to Fourier Optics 3ed," (2005). 23. C. R. Pidgeon and S. D. Smith, "Resolving Power of Multilayer Filters in Nonparallel Light," J. Opt. Soc. Am. 54,
1459 (1964). 24. M. Born and E. Wolf, Principles of Optics: Electromagnetic Theory of Propagation, Interference and Diffraction of
Light (Cambridge University Press, 1999), 7th ed. 25. T. Goossens, K. Vunckx, A. Lambrechts, and C. Van Hoof, "Spectral Shift Correction for Fabry-Perot Based Spectral
Cameras," in Workshop on Hyperspectral Image and Signal Processing, Evolution in Remote Sensing, vol. 2019-Septe (IEEE, 2019). 26. W. Shin, "MaxwellFDFD Matlab toolbox https://www.mit.edu/~wsshin/maxwellfdfd.html (Visited on March 2 2021)." (2015). 27. N. Tack, A. Lambrechts, P. Soussan, and L. Haspeslagh, "A compact, high-speed, and low-cost hyperspectral imager," Proc. SPIE 8266, Silicon Photonics VII 32, 82660Q (2012). 28. CMOSIS, "https://ams.com/cmv2000 (visited on 2021-03-02)." . 29. T. Goossens, B. Geelen, J. Pichette, A. Lambrechts, and C. Van Hoof, "Finite aperture correction for spectral cameras with integrated thin-film Fabry-Perot filters," Appl. Opt. 57, 7539­7549 (2018). 30. R. Hahn, T. Haist, F.-E. Hammerling, D. Fleischle, O. Schwanke, O. Hauler, K. Rebner, M. Brecht, and W. Osten, "Detailed characterization of a hyperspectral snapshot imager for full-field chromatic confocal " 59, 36 (2020). 31. J. Jia, C. Ni, A. Sarangan, and K. Hirakawa, "Fourier multispectral imaging," Opt. Express 23, 22649 (2015). 32. P. Agrawal, K. Tack, B. Geelen, B. Masschelein, P. Mateo, A. Moran, A. Lambrechts, and M. Jayapala, "Characterization of VNIR Hyperspectral Sensors with Monolithically Integrated Optical Filters," Image Sensors Imaging Syst. pp. 1­7 (2016). 33. D. Zwillinger, Table of Integrals, Series, and Products: Eighth Edition (Elsevier, 2014). 34. T. Goossens, "tinythinfilm toolbox, https://github.com/tgoossens/tinythinfilm (visited on March 2, 2021)." .

Supplementary Material

Appendix A Introduction
This document contains supplementary derivations and additional documentation on experiments en simulations.

Appendix B Transmittance of a 2D tiny filter using wave packets
In this section the transmittance of a pixel-integrated (tiny) filter is calculated using the angular spectrum. The derivation in this chapter is original work but inspired on a derivation for the flux transfer of a wave-packet [18, p.70].
The novelty in this supplementary document is to limit the domain of integration to the size of the pixel which requires non-trivial modifications for practical computation. We will concern ourselves only with the tangential components of the field amplitudes as only these components contribute to flux transfer.
But first, for completeness of notation, the thin-film transfer-matrix is briefly introduced in Section A.

B.1 Thin-film transfer-matrix method for plane waves

For the classical case of plane-wave illumination on an infinitely wide filter there exists the well-known transfer-matrix method to calculate the transmittance [14, 18]. As conventional in the thin-film filter literature, we only consider the (complex-valued) electrical and magnetic field components that are parallel (tangential) to the thin-film filter surface, as only these components contribute to flux transfer across the interface [14].

For plane waves we have that the tangential electrical field E and the magnetic field H are related

as

H = E,

(20)

with  [-1], the characteristic admittance of each layer [14]. For the tangential components, by construction, the admittance depends on the polarization and is calculated as

1

 

p-polarized (TM)

  

0 

cos 



=

,

(21)

    

1  cos 

s-polarized (TE)

 0 

with 0 = 0/0 = 2.6544 × 10-3 S defined as the admittance of free space [14] and  the angle of refraction in the film, calculated using Snell's law. For optical frequencies   1 [14]. The polarization-dependent cosines are a direct consequence of mapping the actual field amplitudes onto the axis tangential to the material interface.

Ein

Layer 0: Incident medium
Layer 1
..
Layer N - 1
Layer N : Substrate

Eout

j=0 j=1 j =N -2 j =N -1

Fig. 10: A plane wave arriving at an infinitely wide thin-film filter stack.

Consider a plane wave arriving at a stack of thin layers (Fig. 10). The plane wave will partially reflect and transmit at each material interface. Therefore, in each layer there will be forward and backward propagating waves that interfere and produce standing waves. In the substrate, there is only a forward propagating wave with amplitude Eout.
Because the tangential components of the electrical and magnetic field remain continuous across the material interface, each interface can be assigned a single amplitude for the electrical field E  and the magnetic field H . These are are recursively related by a "transfer matrix" so that



 

E



-1

 



=

 

cos  

- 

sin

 


 

E





  

,

(22)





H

 -1

- 



sin





cos  



H



 











with



=

2   cos(  ) 

the phase

thickness of each

layer.

For

a stack of



+ 1 layers, this notation

implies that the incident field is Ein = E0 and the transmitted field in the substrate is Et = E

(Fig. 10).

One can define an equivalent admittance at each interface , called the complex surface admittance  = H /E  which can be calculated using either (22) or the convenient recurrence relation

-1 =  cos   -   sin   , for  = , . . . , 0,

(23)

cos   -   sin  



with 0 being the surface admittance of the whole filter stack [18, p.123]. As there is no backward propagating wave in the substrate,  -1 =  , which can be used to initiate the recursion.
In [18, p.126] it is then derived that for a thin-film filter stack, the transmission coefficient for the

tangential components becomes

=

1+

, with  = 0 -  ,

(24)

  =1

(

cos





-





sin   )

0 + 

which is constructed so that the transmitted wave in the substrate has an amplitude Eout = Ein.

B.2 Tiny filter transmittance
Calculating the flux corresponds to calculating the irradiance and integrating it across the pixel. For a plane wave, a simple expression exists for the irradiance such that

 = Re() 1 EE.

(25)

2

For a wave packet, which consists of a distribution of plane waves, it is tempting to calculate the flux by summing up the irradiances for each plane wave in the decomposition. However, this approach would ignore the fact that the plane waves interfere.

In contrast, the irradiance of an arbitrary wave is calculated as

 ()

=

Re(EH ) ,

(26)

2

which is the amplitude of the Poynting vector perpendicular to the material interface.

The total flux across the tiny filter is then obtained by integrating over the filter area:

 /2

=

 ()d.

(27)

-  /2

Since the incoming wave is a plane wave, we can substitute (25) such that the incident flux equals

in

=

in  ,
2

(28)

a calculation which is not possible for the transmitted wave-packet.

To solve (27) for a wave packet we make use of two identities. First, for an arbitrary wave packet consisting of plane waves, we can write



E() =



()




(2





)

d,

(29)

-

and



H () =

(

)




(2





)

d

.

(30)

-

Second, for each plane wave, the magnetic field is related by the admittance  to the electrical field as ( ) = ( ) ( ). The admittance is polarization and angle-dependent, and hence

different for each plane wave in the decomposition. Its angle-dependency is encoded by its dependency on the spatial frequency  .

So we have that



H () =

( )(

)




(2





)

d

,

(31)

-

which after substitution in (27) gives

1  =

 /2

dd ()( ) ( )

d2  ( -)  .

(32)

2

-  /2

To speed up numerical integration and reduce required memory, several identities are used to reduce the number of integrals. First, we notice that the inner integral is a Fourier transform and solve it exactly so that

1 

sin(( - ))

=

dd ()( ) ( )

,

2

( - )

1



sin(( - ))

= d ( ) ( ) d()

.

(33)

2



( - )

Second, the new inner integral is in fact a convolution integral such that we can write

 = 1  d ( ) ( )(  )( ),

(34)

2

with

 ( ) = sin( ) ,

(35)



which I refer to as the "pixel kernel" in the software implementations. When necessary, the convolution can be computed efficiently in  ( log ) time using a Fast-Fourier Transform (FFT).

The transmitted flux becomes

1

t

= 2

d  ( ) t( )( t  )( ).


(36)

We can limit the integration domain to the incident wave between ±90 incidence such that the

limits of the domain are

 = ±1.

(37)



Finally, we have that the transmittance of a tiny filter equals

 (; ) =

t .

(38)

in

Appendix C Counting the number of interfering rays
In the ray-optics model a converging series is truncated to model the effect of finite filter width. The index of truncation is equal to the number of interfering rays  (). This sections how this number is calculated.

 2heff tan n

Mirror

heff

Cavity

Filter vignetting
N =0 N =1
w

N =2

Mirror

N =3

Substrate
x

Fig. 11: Schematic illustration of the reflections in a tiny Fabry-Pérot filter on a substrate, with  () the number of interfering rays at position . The overlapping rays are drawn next to each other for illustration purposes only.

To determine the number of interfering rays  () at position , we need to analyze the number of reflections that can occur at oblique incidence. From Fig. 11 it can be deduced that, due to multiple reflections, any outcoming ray must have traversed the film 1 + 2 times, with  a non-negative integer. For example, if there are two outcoming rays ( = 2), at most, a ray had to traverse the film 1+2 times: the ray is first transmitted (+1), then reflected at the bottom (+1), then reflected again at the top (+1). The number of rays  () is limited by the condition that light can reflect only a finite number of times in the film. In other words, the total horizontal displacement of a reflected ray cannot exceed the filter dimensions, i.e.,

Nb. of traversals

 -  · [1 + 2( () - 1)]  0,

(39)

total displacement

with  = eff tan  being the horizontal displacement of a single traversal. Solving to the largest integer value of  () gives

() = 1 +  = 1 + 

.

(40)

2 2 2 2 tan 

which

for

a

half-wave

plate

eff

=

, cwl
2eff

becomes

 () = 1 + eff .

(41)

2 cwl tan 

The angular and spatial dependency of  () is visualized for a filter with eff = 1.7 and  = 5.5 µm in Fig. 12. It is shown for five positions on the pixel: at  = 0.1,  = 0.25,  = 0.5,  = 0.75, and  = .
At normal incidence, by construction, the number of interfering rays is infinite. At oblique incidence, by contrast, the number of interfering transmitted varies across the substrate. Close to the left wall ( = 0), the number of rays is much lower than elsewhere. Furthermore, the number of rays becomes smaller for increasing angles because the horizontal displacement  tan  for each traversal becomes larger. This means that a reflecting ray will reach the boundary of the film with less reflections.
200

150

100

50

0

0

2

4

6

8

10

12

14

16

18

20

Fig. 12: The spatial and angle-dependent number of interfering rays in the substrate.

Appendix D Relationship between normalized FWHM and mirror reflectance

A key property of the ray optics monolayer model is that its response is fully determined by two dimensionless factors, the effective refractive index eff and the reflectance  of the mirrors. In this section it is shown that the mirror reflectance determines the filter bandwidth normalized by its central wavelength. I present my own derivation because I believe it to be more transparent about the assumptions than the derivations I found in reference works like [24, p.365] and [14, p.185].

Let us consider the transmittance for an infinitely wide filter of unit peak value so that

(1 - )2

peak

=

2

-

2 cos(2)

. +1

(42)

The goal is to find the phase thickness for which the peak transmittance is halved (equals 1/2).

Solving to  we obtain

1 1/2 = 2 arccos

1 2- -
2 2

.

(43)

To find the FWHM, we need to derive how a change in phase-thickness translates to a change in wavelength. The phase thickness is non-linearly related to the wavelength as

=

2eff eff

=

cwl ,

(44)





which can be differentiated such that

d

=

-

cwl 2

d

.

(45)

In the neighborhood of the central wavelength  = cwl this gives

 d

d = - .

(46)

cwl

Assuming this equation holds for well for small enough finite ranges, we have that for  = |21/2|,

FWHM

  

= 

(47)

cwl

with

FWHM

 =

.

(48)

cwl

the normalized bandwidth of the corresponding infinitely wide filter at normal incidence.

After substitution, we obtain the expression for the normalized filter bandwidth





1 arccos 2 -  - 1 ,



2 2



1

- 



,

for





1,



 1 -  , for   1, 

which can also be solved to  such that

(49a) (49b) (49c)



=

2

-

cos()

-

 3

-

4

cos()

+

cos2

(  ) ,

(50)

 1 - , for   0.

While this approximation is very good for narrowband filters, the analysis is simpler in the wavenumber domain because the wavenumber and phase thickness are linearly related. Hence no approximation is required to relate the wavenumber-FWHM to the mirror reflectance so that

 =    =   ,

(51)

 cwl

 cwl

and

 = 1 arccos 2 -  - 1 .

(52)

cwl 

2 2

In this work I opted to work in the wavelength domain because it is most familiar to the target audience.

Appendix E Transmitted irradiance using a ray model
This section is an extended discussion and derivation of the ray-optics equations introduced in Section 4 of the main manuscript.
The correct operation of a thin-film interference filter depends on light beams reflecting many times and interfering with each other. When the filter is infinitely wide, there is an infinite number of rays that interfere. In contrast, when the filters are tiny, the supply of rays at oblique incidence is limited but increases with distance from the wall (Fig. 4). This means that the number of interfering rays varies across the substrate.
This interpretation is formalized by calculating the resulting field amplitude at each position. For classical thin-film theory, this leads to a converging infinite series [24, p.361]. However, when there are only  () outcoming rays at position , the series has to be truncated such that

 ()

E (; ) = 2   (-1) 2 (-1) ,

(53)

=1

where  is the transmission coefficient of the mirror,  the reflection coefficient  = 2 and  the transmission coefficient of the air-substrate interface. The coefficients  and  are related as  +  =  +  = 1

This series can be rewritten as a geometric series for which a closed expression exists such that [33]

E (; ) =

2

 ()
 (2),

 

=1



= 2

(  () - 1) ,

(54)



-1

which is equal to

E

(;

)

=

2


·

 2  - 1 2 - 1

.

(55)

The transmitted irradiance is calculated as



=

 2

E

E

(56)

=  2

2 ·

 () 2  - 1 2 - 1

2 ·

 () 2  - 1 2 - 1

(57)

=  2

2


·

  () -2  - 1 -2 - 1

2 ·

 () 2  - 1 2 - 1

(58)

=  2

()2

(  () -2  ) (  () 2  ) () · ( () -2 ) ( () 2 )

(59)

 2=(1-)2 

One can show that




( ) -2



-

1




()

2



-

1

= 2 - 2 cos(2) + 1,

(60)

from which follows that the transmitted irradiance equals

 () =

 2 2

·

2 - 2 cos(2) + 1 2 - 2 cos(2) + 1

(61)

=

 2

·  (1 -

)2

2 () - 2 () cos(2 ()) + 1 2 - 2 cos(2) + 1

(62)

with  = 1 - .

The transmitted irradiance is visualized as a function of  for a filter with eff = 1.7 and  = 5.5 on a substrate with sub = 3.67 (Fig. 13). The more rays, the higher and more narrowband the irradiance becomes.
The total transmitted power to the pixel is obtained by integrating  () across the filter. This corresponds to taking a weighted sum of irradiances visualized in Fig. 13. An analytical approximation for this is given in the next section.

30 20 10
0 0.7 0.8 0.9 0.7 0.8 0.9 0.7 0.8 0.9 0.7 0.8 0.9

600
400
200
0 0.7 0.8 0.9 0.7 0.8 0.9 0.7 0.8 0.9 0.7 0.8 0.9

Fig. 13: The irradiance of a Fabry-Pérot filter for a given number of interfering rays.

Appendix F Analytical approximation of the transmittance

In this section a very accurate approximation for the transmittance of a tiny filter is derived. This equation enables fast computation and the derivation of an expression for peak transmittance.
Consider the transmitted irradiance in terms of the number  () of interfering rays such that

 ( ())

=

 2

·

 (1

-

)2

2 - 2 cos(2) + 1 2 - 2 cos(2) + 1

,

(63)

with.

 () = 1 + eff  .

(64)

2 cwl tan 

The total incident flux is determined by integrating the irradiance over the pixel area so that



 =  ()d.

(65)

0

Given that N is constant for a certain region on the pixel we can decompose the integral as

 -1  

 +1

 =

 ()d,

(66)

 =1 

where  is the maximum number of rays that will interfere (the furthest from the boundary), i.e.  =  (). Consequentially, the irradiance in each region will also be a constant such that we can write

 -1  

 +1

 =

 ()d,

(67)

 =1 

 -1


  +1

=  ()

d,

(68)

 =1



 -1



=  () ( +1 -  ) ,

(69)

 =1

 -1



  (),

(70)

 =1

For a cavity with a thickness much smaller than its width, the horizontal displacement  =

(+1 - ) is small enough to make a continuum approximation. This is the case when

 = cwl 2eff

, or equivalently, cwl

2eff. Under this continuum assumption we have from

(64), that d = eff d and  = eff  such that

cwl tan 

cwl tan 





cwl tan 

 -1
  ().

(71)

eff

 =1

Making the continuum approximation we obtain

  cwl tan  


 ()d,

(72)

eff

0

where we neglected the contributions for  = 0 and  =  to obtain a simpler equation. This is a good approximation as long as  is large.

Equivalently we can now define the incident flux as

in  cwl tan  



ind

=

cwl tan   in


d

(73)

eff

0

eff

0

= cwl tan   in

(74)

eff

So finally we have that the transmittance is



ray
tiny

=

 in

=

0

 ()d 

(75)

=  ·  (1 - )2 in

1

+

2 - 1 log 2

-

2(log() (

cos(2) - 1) + 2 42 +  log()2

sin (2  ) )

2 - 2 cos(2) + 1

.

(76)

Because

of

the

continuum

approximation,

the

function

ray
tiny

is

not

periodic

anymore

but

centered

around  = 0. This is similar, although vice versa, to the periodicity introduced by discretizing a

continuous Fourier transform to perform a discrete Fourier transform. Therefore, when using the original definition of the phase thickness  = cwl/, one has to subtract  before evaluating trianyy.

The high accuracy of this approximation is displayed in Fig. 14.

0.8 0.6 0.4 0.2
0 0.65 0.7 0.75 0.65 0.7 0.75 0.65 0.7 0.75 0.65 0.7 0.75
(a) 10 µm pixel 0.8 0.6 0.4 0.2
0 0.65 0.7 0.75 0.65 0.7 0.75 0.65 0.7 0.75 0.65 0.7 0.75
(b) 5.5 µm pixel 0.8 0.6 0.4 0.2
0 0.65 0.7 0.75 0.65 0.7 0.75 0.65 0.7 0.75 0.65 0.7 0.75
(c) 2 µm pixel Fig. 14: The analytical approximation matches perfectly with the numerical prediction.

Appendix G Peak-transmittance approximation G.1 General approximation To obtain the peak transmittance we evaluate (75) at  = 0 such that

ray
peak

=

 in

· 

(1 - )(3 - )

1+

log 2

,

(77)

which can be normalized as

ray

peak peak

=1+

(1 - )(3 - ) .
log 2

(78)

with

peak

=

ray
peak

(





).

G.2 Narrowband filter approximation To facilitate analysis for narrowband Fabry-Pérot filters we make some additional approximations.

ray
peak peak

=

(1 -  log ) (3 -  log ) 1+
2 log 

(79)

First let us take

  eff

= eff

 ,

(80)

cwl tan  tan  cwl



and

log   log(1 + )  , for  0,

(81)

so that

ray
peak peak



1-

(1 - -  ) (3 - -  ) .
2  

(82)

We can then rewrite the peak-transmittance formula as

ray
peak peak

=1+

(1 - /)(3 - /) 2/

(83)

with



=



1 · 

=  -1

· -1

·

=



-1
·

FWHM

-1
·

tan 

.

(84)

cwl

cwl

eff

Normalized spatial width


Normalized bandwidth


Normalized incidence angle


Appendix H Additional details for the trade-off law verification
The four filter designs used to generate the curves in Figs. 5 and 6 are Fabry-Pérot filters of the form
Air| () |()|( ) |Si,
with  = 2% :  = 4,  = 1.88,  = 1.3, eff = 1.47,  = 1% :  = 5,  = 1.99,  = 1.4, eff = 1.57,  = 0.5% :  = 8,  = 2.02,  = 1.58, eff = 1.73,  = 0.25% :  = 20,  = 2.09,  = 1.9, eff = 1.98.
Some of these designs are not practically useful but used for illustration purposes only.

Appendix I Additional details for the numerical FDFD simulation
The wave-optics method is validated by solving Maxwell's equations using a finite-difference frequency-domain (FDFD) Matlab Toolbox [26]. The frequency domain toolbox, used with a direct solver, is used for two reasons. First, we are only interested in the harmonic regime and hence time steps are not required. Second, the toolbox is very convenient for define rectangular structures like thin-film filters.
Three different Fabry-Pérot filters are placed adjacently as in Fig. 15. The three designs are

Left : Air| ()41 ( )4|Substrate

Central : Air| ()4 ( )4|Substrate

(85)

Right : Air| ()43 ( )4|Substrate

Where  and  are quarter-wave layers for a central wavelength around cwl = 720 nm. By construction, this means that the dielectric mirror has a central wavelength around 720 nm. The material parameters that were used are air = 1,  = 1.5,  = 2.4, and sub = 3.67.
The central wavelength of the filter can be chosen by varying the cavity thickness. By choosing layers 1 and 3 to be 50 nm thinner and thicker than  respectively we obtain central wavelengths for the left, central, and right filter of 664 nm, 720 nm, and 776 nm respectively. These were chosen to be far enough such that there is no spectral overlap and cross-talk can be, supposedly, ignored.
The grid size is 6 nm and the perfectly matched layers (PML) are 100 nm on each border. In addition, an s-polarized plane wave source is placed above the filters. The simulation domain is visualized in Fig. 15.
To ensure realistic boundary conditions only the the transmittance of the central filter is calculated. The incident flux is calculated in the absence of any filter and substrate. The transmitted power is calculated by integrating the the power flux across the width of the filter. Depth-dependent absorption in the pixel is not modeled as this work focuses on calculating how much light is transmitted to the pixel, not modeling its quantum efficiency.
The script for this simulation is available as Supplemental Code 1.

Fig. 15: FDFD simulation domain with three adjacent Fabry-Pérot filters on a single substrate.
Appendix J Additional details about the experimental setup
J.1 Setup The experimental setup consists of a monochromator coupled to a collimating lens which illuminates the sensor. The setup and its operation is described in [32]. Several components of the setup were updated but the operational principle remains unchanged. The image sensor board is placed onto a goniometer to control the incidence angle of the collimated light.
For each angle, this setup measures the spectral response of each pixel in digital numbers. The device under test is imec's snapshot 5x5 mosaic camera [6]. On this sensor, 25 filters are integrated on 5.5 µm wide pixels of a CMV2000 image sensor [28]. The filters are distributed across a wavelength range of 665 and 975 nm.
J.2 Fit at normal incidence To apply the equivalent monolayer model to the measured data it was necessary to estimate the normalized bandwidth . This is the bandwidth of the filter at normal incidence, if it were infinitely wide, which is not known in this case. However, using the wave-optics model one can sweep across multiple bandwidths and use the tiny filter transmittance that best matches the measurement.
The result of this procedure is displayed for several filters in Fig. 16. The fit is not perfect for each filter because not each filter has a perfect Lorentzian shape.

1

0.8

0.6

0.4

0.2

0

600

700

800

900

1000

1

0.8

0.6

0.4

0.2

0

600

700

800

900

1000

1

0.8

0.6

0.4

0.2

0

600

700

800

900

1000

1

0.8

0.6

0.4

0.2

0

600

700

800

900

1000

1

0.8

0.6

0.4

0.2

0

600

700

800

900

1000

1

0.8

0.6

0.4

0.2

0

600

700

800

900

1000

1

0.8

0.6

0.4

0.2

0

600

700

800

900

1000

1

0.8

0.6

0.4

0.2

0

600

700

800

900

1000

1

0.8

0.6

0.4

0.2

0

600

700

800

900

1000

Fig. 16: Fit at normal incidence for several bands on imec's sensor.

J.3 Uniformity
Because each filter is sensitive to different wavelengths, a uniformity map at a single wavelength is not practical. Therefore, the maximal digital number (collected over all wavelengths) is used for each pixel. A 2D median 10 by 10 pixels filter is applied to smooth out the map.
At normal incidence there was a specular reflection between the sensor and the collimator which caused the multiple "flowers" which are an image of the optical fiber bundle (Fig. 17). Care was taken to keep this specular reflection outside the sampling region marked by the red rectangle. At larger angles the specular reflection were not in the scene.
The good fit of the (ray) model predictions to the measurements indicates that, by using the median value in the sampling region, non-uniformity was mitigated to a much smaller magnitude compared to the drop in peak transmittance for tiny filters (Fig. 18). Future investigations on cross-talk will require more control over uniformity to decouple the effects.

400 0
350
200 300

400

250

200 600
150
800 100

1000

50

0

200

400

600

800

1000

1200

1400

1600

1800

2000

Fig. 17: Uniformity map. The red square was used for generating the experimental data .

600 500 400 300 200 100
0

5

10 15 20

400 300 200 100
0

5 10 15 20

600 500 400 300 200 100
0

5 10 15 20

100 80 60 40 0

5

10 15 20

120 100
80 60 40
0

5 10 15 20

100 80 60 40 0

5 10 15 20

140 120 100
80 60 40
0

5

10 15 20

120 100
80 60 40
0

5 10 15 20

120 100
80 60 40
0

5 10 15 20

Fig. 18: Model predictions and uncertainty in measured region.Variations are possibly due to cross-talk or uniformity variations.

