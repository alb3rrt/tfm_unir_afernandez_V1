A normal form for grid forming power grid components.
Raphael Kogler, Anton Plietzsch, Paul Schultz, and Frank Hellmann Potsdam Institute for Climate Impact Research, Telegrafenberg A31, 14473 Potsdam, Germany
Future power grids will be operating a large number of heterogeneous dynamical actors. Many of these will contribute to the fundamental dynamical stability of the system. By taking a complexity theoretic perspective we derive a normal form for grid forming components in power grids. This allows analyzing the grids systemic properties without the need for detailed technical models.
Our approach is based on the physics of the power flow in the grid on the one hand, and on the common symmetry that is inherited from the control objectives grid-forming power grid components are trying to achieve. We provide a first experimental validation that this normal form can capture the behavior of complex grid forming inverters without any knowledge of the underlying technology, and show that it can be used to make technology independent statements on the stability of future grids.

arXiv:2106.00644v1 [nlin.AO] 1 Jun 2021

I. INTRODUCTION
The dynamics of future power grids has become a very active interdisciplinary area of research. The energy transition demands a shift from conventional power plants, with control schemes designed around heavy rotating masses, towards inverter-interfaced renewable energy sources, with their dynamics specified by power electronics.
The design of conventional generators is well established and grounded in the physics of synchronous machines. There is a good understanding in the engineering community what level of model detail is required to study which questions. This is not the case for inverterinterfaced energy sources. Here the correct design of the control is an ongoing topic of research, e.g. [1­4], especially for so called grid-forming inverters, which, unlike grid-following inverters, do not rely on the pre-existence of a stable grid. Consequently there is, as of yet, no clear consensus on the proper dynamical modeling of such future sources of energy.
This situation is especially problematic as we expect the number of dynamical actors in a future power grid to increase by orders of magnitude, as energy generation is going to move more and more from the transmission to the distribution level. Further, we expect a larger heterogeneity in dynamics, as the control is no longer structured around established principles, i.e. principles dictated by the physical components. Consequently, it can not be expected that all the inverters participating in future power grids will use similar control designs. At the same time, the future power grid will face numerous dynamic stability issues such as low inertia [5], (lack of) time scale separation [6] and greater fluctuations of power production [7, 8] and consumption [9, 10]. The increasing number of dynamical actors and, in turn, heterogeneity mean that, in tackling these issues, we need to understand not only the intrinsic dynamics of individual
 hellmann@pik-potsdam.de

actors, but more importantly their interactions in large complex networks.
This paper addresses these challenges by providing a complexity theoretic approach towards the modeling of future power grids. This means that rather than starting with detailed models of the individual actors and subsequently simplifying them, we focus on those features that are crucial for their interaction on the network. Our approach is based on the physical relationship between voltage and current, which provides the coupling on the network, on the one hand, and on the system desiderata and the symmetry implied by them on the other hand. We will find that the most important desiderata are active and reactive power injection, and prescribed voltage levels.
Formulating the dynamics of the nodes in the power grid in terms of the natural invariants associated with their symmetry, we can give an order by order nonlinear approximation of their behavior in terms of the deviations from the local desiderata. The key insight is that, by choosing appropriate variables, the lowest non-trivial order in this approximation is able to capture the most fundamental nonlinearities of the power grid dynamics, while also being capable of expressing all local desiderata. The result is a normal form for the behavior of gridforming actors that resembles controlled Stuart-Landau oscillators, analogous to the form that appears in bifurcation theory [11], parametrized by a latent linear inputoutput system. From a dynamical systems perspective the crucial point here is that we fix not only the dynamics of the oscillators to be of Stuart-Landau type, but also provide a specific form for their coupling.
We show by means of comparison to experimental measurements from a sophisticated inverter implemented in the lab, as well as more broadly through numerical simulations, that our normal form indeed captures the quantitative and qualitative properties of a wide range of actors. We also find that it captures important features of the nonlinear interaction that occurs in highly heterogeneous power grids containing both conventional generators and grid-forming inverters.
This normal form provides a starting point for studying realistic models of future power grids from a truly

2

interdisciplinary perspective. By providing a form that closely resembles the Stuart-Landau oscillator it enables the application of a large range of dynamical systems results in the context of power grids. The fact that the normal form is parametrized by a latent linear input-output system enables the use of tools like model reduction and system identification. As opposed to the phase models (e.g. the Swing equation) used in much of the control theoretic and complex systems literature on power grids, the normal form here is based on the instantaneous, physically relevant variables, and provides, order by order, all relevant dynamical aspects of the dynamical actors described.
II. MODELING POWER GRIDS
We start by introducing our approach to the basic modeling of power grids as complex dynamical networks. This section serves a dual purpose. To make the paper self-contained to researchers without a strong background in power system modeling we briefly introduce the most salient physical properties of power grids. We then use this introduction to spell out a sequence of fairly general assumptions we make on our nodes in order to arrive at a highly generic model of power grid components. For a more extensive background on overall power-grid and inverter modeling we refer the reader to [12, 13] (and the references therein), which we largely follow in this regard.
Our overall approach is to consider nodes as specifying a voltage which in turn causes a current to flow on the power lines. In electrical engineering terms we thus think of nodes as capacitive elements, and consider our dynamical components as controlled voltage sources. While many of the concrete assumptions below are highly general and apply to all types of power grid components, the assumption of capacitive behavior is most natural for grid forming voltage source inverters.
Notational aside: In accordance with mathematical and dynamical systems literature, we use i = -1 to denote the imaginary unit and use j for the current (this is the opposite convention to the electrical engineering literature).
A. Node model
Most AC power grids in operation today are threephase, i.e. at every node in the network there are three alternating voltages, Va(t), Vb(t), Vc(t) : R  R, which cause three separate alternating currents on each transmission element. The sum of the currents flowing from a node into the grid is then denoted Ia(t), Ib(t), Ic(t) : R  R. Our first assumption is that the three phases of both voltage and current are balanced (symmetrical) at all times. That is, we assume Va(t) + Vb(t) + Vc(t) = 0 and Ia(t) + Ib(t) + Ic(t) = 0 for all t. This allows us

to represent them each by a complex variable with the aid of what is called the Clarke or  transformation[14]. We denote the complex nodal voltage by u(t) : R  C, with Va = 2/3 (u), Vb,c = 2/3 (u exp(±2i/3)), and the complex nodal current by j(t) : R  C, with Ia = 2/3 (j), Ib,c = 2/3 (j exp(±2i/3)).
Assumption 1 (Balanced phases). The nodal voltage and current are balanced at all times and can thus be described in terms of the complex variables u and j respectively.
The main objective of AC power grid control is to reach and maintain an operating state where all nodal voltages and currents rotate at a uniform frequency s (usually 50 or 60 Hz), i.e. a quasi-steady-state described by a limit cycle where at each node we have a nodal voltage us(t)  exp(ist) and current js(t)  exp(ist). This operating state is further determined by specifying certain set-points, i.e. desired values for the amplitude of the nodal voltage, s := |us|, and active as well as reactive power input, ps := (usjs) and qs := (usjs) respectively. These set-points must be provided by some higher-level control in accordance with the desired power flow in the grid. Since we are primarily interested in the dynamics of the fast acting primary control that takes place at the sub-second scale, we assume that the control dynamics can be described as fully decentralized, i.e. we assume that the set-points are given constants and, furthermore, we preclude any additional communication between the individual nodes such that information about the state of the power grid can only be inferred from local measurements. Since we consider controllable voltage sources, this means that the dynamical coupling between the nodes of the network can only be realized by measurements of the local nodal current.
Assumption 2 (Decentralized control). a) The setpoints specifying the desired operating state are given constants and b) the dynamics at a node depend on the other nodes only via the currents on the transmission lines.
While the collective network dynamics with this form of coupling can thus be described in terms of the nodal voltages and currents, an individual node may also have any number of internal dynamic variables. We assume that these are either balanced three-phase quantities (internal three-phase voltages and currents) or scalar quantities (e.g. frequency, DC voltages and currents, or auxiliary variables). For a particular component featuring L of the former and K of the latter, we denote them by z(t) : R  CL and x(t) : R  RK with their respective operating states zs(t)  exp(ist) and constant xs. This distinction is similar to that between AC and DC variables in [13] with the difference that we do not explicitly model phase variables.
Assumption 3 (Internal variables). The node dynamics may feature any number of internal variables comprising either balanced three-phase variables denoted by z or scalar variables denoted by x.

3

Next, we assume that the nodal voltage as well as the internal variables react smoothly on a given nodal current and can be formulated as a system of ordinary differential equations with input j(t).

Assumption 4 (Smooth dynamics). The node dynamics is smooth and can be formulated as a system of ordinary differential equations in terms of u, z, and x, with an input given by j.

Putting all of these assumptions together, the general form of the node dynamics that we are considering here is given by the system

u = f u(x, z, z, u, u, j, j) ,

z = f z(x, z, z, u, u, j, j) ,

(1)

x = f x(x, z, z, u, u, j, j) ,

where f u : RK × CL+2  C, f z : RK × CL+2  CL, and f x : RK × CL+2  RK are some smooth functions in the sense that their real and imaginary parts are differentiable functions of the real and imaginary parts of u and j. From this it follows that they can be written as holomorphic functions of u, u, j and j, e.g. [15]. The equations (1) admit solutions congruent with the required operating state, i.e. for some operating state given by us and js there exist zs and xs for which

f u(xs, zs, zs, us, us, js, js) = isus ,

f z(xs, zs, zs, us, us, js, js) = iszs ,

(2)

f x(xs, zs, zs, us, us, js, js) = 0 .

Our final assumption is regarding the symmetry of the node dynamics (1). We assume that the node dynamics are homogeneous with respect to phase angles, i.e. there are no distinguished phase angles of u and z such that the dynamics can only depend on relative phase angles between the three-phase variables. This degree of freedom with respect to absolute phase angles translates to a symmetry under global phase shifts, extending the natural symmetry of the desired operating state (2) to the whole phase space. As a global phase shift is equivalent to a time shift for the uniformly rotating operating state, this last assumption is essentially the requirement that in a quasi-steady state it doesn't matter when a perturbation hits of time invariance with respect to perturbations of the operating state, a highly desired property of control systems. Note, however, that this assumption is only valid when the transistor switching may be modeled as ideal, i.e. when the three-phase signals do not feature higher harmonics but are purely sinusoidal. This implies that the dynamics must be on a time scale where the switching may safely be neglected by averaging [16, 17], which is a standard assumption in power grid control design considering the switching frequencies are typically in the range of 2-20 kHz [12].

Assumption 5 (Symmetry). The node dynamics is homogeneous with respect to phase angles, i.e. it possesses

a U(1) symmetry defined by
f u,z(x, eiz, e-iz, eiu, e-iu, eij, e-ij) = eif u,z(x, z, z, u, u, j, j) , (3)
f x(x, eiz, e-iz, eiu, e-iu, eij, e-ij) = f x(x, z, z, u, u, j, j) ,
for any   [0, 2).

B. Networked model

When the general form (1) is combined with a model for the transmission lines providing the dynamics of the nodal currents, we obtain a connected model for the power grid. While the subsequent derivation of the normal form does not assume a particular model for the transmission lines, for the discussion we will make use of the very simple model of static currents, which we briefly want to introduce here. A more detailed discussion of dynamical current models is given in the appendix A.
We define the network as a graph G = (V, E) with the set of vertices V = {1, . . . , N }, the set of edges E = {1, . . . , M }, and its complex structure given by the incidence matrix B  {-1, 0, 1}N×M . Additionally, for each edge we have its resistance rm  R0 and its inductance m  R0.
Assuming that the line dynamics evolve much faster than the node dynamics, and that we are in the vicinity of the desired operating state with uniform frequency s, the nodal currents may be approximated by its quasisteady-state equations. In terms of the admittance matrix Y := B diag (rm + is m)-1 BT , these are simply given by

N

jn =

Ynmum .

(4)

m=1

It follows that we have the active and reactive power inputs/outputs, pn + iqn := unjn, given by

N

pn + iqn =

Ynmunum .

(5)

m=1

Note that these equations, as well as the full dynamics from which they arise, are consistent with the symmetry of assumption 5. This means that the full network model is invariant under global phase shifts. Quasi-steady states are again given by an orbit of the symmetry. However a quasi-steady state of the coupled model is not guaranteed to exist, unless the set points of the nodes are chosen in a manner compatible with (5). If this is not the case, for example, if there is a power imbalance in the system, the network's quasi-steady state will deviate from the orbit specified by the set points, i.e. the desired operating state.

4

III. NORMAL FORM OF THE NODE DYNAMICS
The system (1) is highly general and captures most models for grid-forming components, as long as they do not explicitly feature higher level control layers, asymmetric phases, non-smooth features (like current limitation, as in [18] for example), algebraic equations without a closed-form solution, or model-free control (e.g. databased approaches [19]). The central insight is that by exploiting the symmetry we can cast the model in a form that is given by an explicit dependence on the voltage u that is tightly constraint by the symmetry, and a set of meaningful quadratic invariants. The latter uniquely specify different orbits of the symmetry (3). An orbit of the symmetry is a set of states related by phase shifts. Thus the quasi-steady states correspond to such orbits. Therefore, the invariants provide us with a sensible notion of the distance to the desired operating state (or any other specified quasi-steady state). We can then develop the dynamics order by order in these quadratic invariants. This provides us with a normal form for grid components with dynamics of the form of eqns. (1) that is valid in the vicinity of the desired operating state.

A. Derivation

To derive the normal form we will make a temporary

change of variables based on quadratic invariants of the

symmetry (3). Recall the equations for the node dynam-

ics

u = f u(x, z, z, u, u, j, j) ,

z = f z(x, z, z, u, u, j, j) ,

(1)

x = f x(x, z, z, u, u, j, j) .

Since the symmetry is defined by a 1-dimensional U (1) action on a 2L + 4 dimensional space (disregarding the scalar variables x for that matter), there are 2L + 3 functionally independent invariants associated with it (see e.g. [20, Theorem 2.17]). These invariants are sufficient to specify the orbits of the group action for an individual node and thus also its desired operating state. Therefore, we want to choose physically meaningful invariants, including, in particular, the quantities that are typically used to define the operation point of the power grid. While there is a certain freedom of choice involved, we propose the set of invariants comprising uu =: 2, the voltage amplitude squared, (uj +uj)/2 =: p and (uj - uj)/(2i) =: q, active and reactive power input/output, as well as (uz + uz)/2 =:  and (uz - uz)/(2i) =: , which may be interpreted as internal active and reactive power flows with respect to the terminal voltage. As the remaining variable that is needed to fully describe the node dynamics, we choose to keep the complex voltage u.
In this combination all invariants are real-valued, polynomial, and, together with the complex voltage u, do not

require division by the current or any of the internal vari-
ables when used to express the original set of variables,
i.e. the coordinate transformation is never singular away from the origin u = u = 0. Employing this new set of variables and defining  := (xT , T , T )T  RK+2L yields the system

u = f~u(u, , 2, p, q) , (6)
 = f~(u, , 2, p, q) .

The explicit transformation is spelled out in Appendix D. Note that instead of depending on u and u we have u and 2 = uu. Effectively we have expressed a nonholomorphic function of one complex variable through a function of one complex and one real variable that is holomorphic in the former. Also, note that we did not explicitly write down the remaining dynamical equations for 2, p and q, as we are ultimately interested in a normal form expressed in terms of u and j directly and will not thus need these equations in the end.
Now the symmetry conditions (3) can be stated in terms of the infinitesimal generator of the group action [20] as

f~u u

=

f~u

,

f~ =0.

(7)

u

u

These equations can be readily integrated and yield the node dynamics

u = ugu(, 2, p, q) ,  = g(, 2, p, q) ,

with some continuous nonlinear functions gu : RK+2L+3  C and g : RK+2L+3  RK+2L. What we have thus achieved is a unified description of all possible node dynamics congruent with our modeling assumptions, that is based on the common symmetry of its quasi-steady state and preserves the physical relationship between current, voltage and power. As it turns out, we may describe the node dynamics as a complex oscillator that is augmented by some internal dynamics and is coupled to the other nodes in the network via active and reactive power. Expressing the system in this way now allows for the aforementioned Taylor expansion with a well-defined notion of closeness to some desired operating state.
For notational convenience we define the vector of instantaneous invariants y(t) := ((t)T , (t)2, p(t), q(t))T : R  RK+2L+3 and a given constant vector y0 := (0T , 20, p0, q0)T  RK+2L+3 with 0 > 0 denoting the point around which we want to expand the node dynamics. While the latter can in principle be chosen arbitrarily, of most practical interest are the cases when y0 represents either (i) a valid operating state considering the entire network, that is, the active and reactive power and the voltage amplitude are consistent with a power flow solution, or (ii) the set-points (or also educated guesses thereof if not explicitly available), which may or may not

5

be consistent with a power flow solution. However, in both cases we would have gu(y0) = is and g(y0) = 0.
Denoting the deviation of y from y0 by y := y - y0, up to first order we have

u u

= gu(y0) + (y · )gu(y0) + O(

y

2)

Au + Bu + Cu2 + Gup + Huq ,

(8)

 = g(y0) + (y · )g(y0) + O( y 2)

A + B + C2 + Gp + Hq ,

with the respective coefficients Cu, Gu, Hu  C, Bu  C1×(K+2L), C, G, H  RK+2L, B  R(K+2L)×(K+2L), and Au, := gu,(y0).

Normal form of the node dynamics
Having carried out the expansion, we may now return to using the dynamical variables u, u and j, j so that our model may be easily connected by providing equations for the currents flowing through the network according to some model for the transmission lines. We thus arrive at the normal form
p + iq = uj - (p0 + iq0) 2 = uu - 20 , u Au + Bu + Cu2 + Gup + Huq , (9) u
 A + B + C2 + Gp + Hq .
Note that the back-transformation does not change the quality of the approximation, this normal form is still accurate up to terms of order y 2. Moreover, since we are dealing with asymptotically stable systems, we expect the error to be bounded and, in most practical cases, quickly decrease over time as long as the trajectories remain within the basins of attraction of both the original system and its normal form.
The rest of this paper will explore the implications and properties of this normal form.

B. Interpretation

To connect the equations (9) to more familiar models for power grids it is insightful to consider them from the point of view of phase-amplitude coupling in power grids. To this end, consider the complex voltage in terms of phase and the logarithm of the amplitude , i.e. u = e+i and

u =  + i .

(10)

u

As , 2, p and q are all real-valued, the real and imaginary part of Au, Bu, Cu, Gu, and Hu respectively

control the influence of the corresponding terms on amplitude and phase dynamics. For example, in the absence of internal variables the explicit impact of amplitude deviations on phase dynamics can be read off immediately from the imaginary part of Cu. However, internal dynamics can mix phase and amplitude reactions in more subtle ways.
The form (9) expands the internal dynamics to linear order in the quadratic invariants. The approximate internal dynamics is a linear multi-input-multi-output system (MIMO) with two outputs, given by the real and imaginary part of the right hand side of u /u, and three nonconstant inputs, given by 2, p and q. The explicit form is given in Appendix E.
This opens the door to introducing methods from the analysis of linear time invariant systems, such as model order reduction, to the study of power grid models in a systematic fashion. One way in which we will already touch upon this possibility later in the paper is by using system identification techniques to fit a model of a fixed complexity to measurement data of a real inverter. This provides semi-black box models for components (see section VI A).
We also want to remark that, while we chose to work with the complex voltages (as it makes the expression for active and reactive power particularly simple, is in line with the recently developed concepts of virtual oscillator control [4, 21, 22], and bears resemblance to an already established dynamics as discussed in section IV C), it is not mandatory to work with these coordinates. If desired, it is also possible to carry out our approach in terms of u := (u) and u := (u) or amplitude and phase directly, i.e. u =: ei.
IV. RELATION TO OTHER MODELS
By approximating the fully nonlinear system (1) with our normal form (9), we have, in principle, reduced all qualitative differences between various concrete models to quantitative differences in their respective coefficients. Thereby, we can distinguish certain classes of models by the coefficients being non-zero. In this section, we introduce a few simple examples of different classes of power-grid models and their corresponding normal form, provide working parameter values, and discuss how the normal form relates to the well-known Stuart-Landau oscillator.
A. Examples
To understand the relationship of the normal form to established low-dimensional models of grid-forming power grid components we will provide the normal form approximation of a variety of them, and demonstrate which coefficients occur in various classes of models.

6

These examples will also be used in the numerical experiments for a heterogeneous network in Section VI C.
We begin by giving a concrete implementation of the abstract derivation of the preceding section for the droop-controlled inverter model introduced in [12] (to be self contained we give the equations in the appendix, eqns. (G2)). In this model the dynamical equation for the frequency, the only internal variable, is already linear with respect to the invariants. As the dynamical equations for the voltage are formulated in terms of amplitude and phase, i.e.  = |u| and  = arg u, we can make use of the relationship

u =  + i u , 

to translate them into the complex form. This yields

u 1 =
u p

- + d - kq(q - qd)

+ i

= i + d - 1 - kq (q - qd) . p p p

Now carrying out the expansion for y0 = (d, (d)2, pd, qd)T , as prescribed by eqns. (8), we
arrive at

u u

i

-

1 2p20

2

-

kq p0

q

,

(11)

 = - 1  - kp p .

p

p

The table of normal form coefficients in terms of the original parameters is given by the following:

AB C G H

u is

i

-1
2p 20

0

- kq
p 0



0

-

1 p

0

-

kp p

0

In a similar fashion, we can consider other classes that result from well-known models.

Example 1 (Pure phase oscillators). Pure phase oscillators are oscillators without any amplitude or internal dynamics. As discussed above in light of equation (10), the imaginary part of the coefficients provides the phase dynamics, the real part the amplitude dynamics. Pure phase oscillators thus yield the normal form

u Au + Gup + Huq u
with Au, Gu, Hu  iR. The canonical example from this class is the well-known Kuramoto model [23, 24], which further has Hu = 0 and assumes the nodes are coupled by purely inductive transmission lines, i.e. (Y ) = 0.

Example 2 (Phase-frequency oscillators). The ubiquitous swing equation [25] (or its nonlinear variant [26]) falls into the class of phase-frequency oscillators. We

still have no amplitude dynamics, but now allow for an internal variable: the frequency of the oscillator. The normal form of this type of oscillator is given by

u = Au + i , u  A + B + Gp + Hq ,

with Au  iR. As for the Kuramoto model, the standard swing equation further has H = 0 and typically assumes
coupling with (Y ) = 0.

Example 3 (Phase-amplitude oscillators). The quite recent development of virtual oscillator control [4, 21, 22] represents phase-amplitude oscillators, i.e. there is now amplitude dynamics but no internal dynamics. The corresponding normal form is given by

u Au + Cu2 + Gup + Huq .

(12)

u

Example 4 (Phase-amplitude-frequency oscillators). Synchronous machines can also be cast into normal form. There are both phase and amplitude dynamics as well as internal dynamics. Considering third order models [27], there is only the frequency as internal variable, and the normal form for this type of model reads as

u Au + Bu + Cu2 + Gup + Huq ,

u

(13)

 A + B + C2 + Gp + Hq ,

with Cu, Gu, Hu  R if  should be the true frequency of the nodal voltage. As we see from eqns. (11), the droopcontrolled inverter of [3, 22] also falls into this class.

B. Normalized parameters values
If one wants to work with our normal form, eqns. (9), as an abstract model for grid-forming components detached from any concrete models, there is the question of reasonable parameter values from which to start exploring the parameter space and its dynamic features. To spare the reader the tedious work of trial and error, we thus want to give a starting point here. As the dynamics of the system will depend highly on the given network structure and node types, we here consider the simple case of two identical grid-forming components connected by an RL transmission line. We work in dimensionless units such that |r + is | = 1 and define tan  := s /r to account for the ratio of inductivity and resistivity of the transmission line (more details on this in section V). Prescribing an operating state with 0,1 = 0,2 = 1 (in dimensionless units) and a relative phase angle of |0| < cos-1(1/2), the following sets of parameters yield convergence to the operating state on a time scale of 5-10 seconds:
· Phase-amplitude oscillators (eqn. (12))

7

AC

G

H

u is -1.5 -0.8(cos  + i sin ) -0.8(sin  - i cos )

· Phase-amplitude-frequency oscillators (eqns. (13))

AB C

G

H

u is i -1.5 -0.8 cos  -0.8 sin 

 0 -1.5 0 0.8 cos  -0.8 sin 

For more realistic sets of parameters we refer to the simulations of section VI, where we numerically compare the normal form to concrete models. The parameters used there are of similar order of magnitude however.

C. Connection to the Stuart-Landau oscillator

The normal form derived above is closely related to the classical model known as the Stuart-Landau oscillator [28]. Key to this connection is that the invariants we chose to represent the deviation from the limit cycle, in particular the voltage amplitude squared, are polynomial with respect to u and u.
Using the quasi-steady state approximation for the current eqn. (4), and the normal form for amplitude-phase dynamics, eqns. (9), yields the networked system

u n

A~n + Cn|un|2 un

N

(14)

+

Kn+Ynmu2num + Kn-Ynm|un|2um ,

m=1

where we have absorbed the expansion points into the coefficients, i.e.

A~n := Aun - Cnu20,n - Gunp0,n - Hnuq0,n ,

Kn±

:=

1 2

(Gun

±

iHnu)

.

It can be seen that the dynamics of the complex voltages un is that of Stuart-Landau oscillators with a particular non-linear coupling. Since the admittance matrix Y is given as a linear combination of Laplacian matrices, the coupling between the individual oscillators may be interpreted as diffusive, albeit with a state-dependent diffusion matrix and also involving the complex conjugate voltages of the connected nodes.
This resemblance is of course no coincidence as the Hopf bifurcation (from which the Stuart-Landau oscillator results as the corresponding normal form [11]) prescribes the same U(1) symmetry for the emerging limit cycle in the vicinity of the bifurcation point. Furthermore, the nonlinearity of the amplitude squared arises naturally in the context of a Taylor expansion. This close relationship opens the door to applying methods from the study of coupled Stuart-Landau oscillators, as for example [29­31], to the dynamics the power grids.

V. LINEAR STABILITY (INFINITE BUSBAR)

A crucial aspect of obtaining a normal form is that it allows us to make highly general analytic statements that apply directly (if approximately) to a wide range of potential power grid components. To demonstrate this point with a proof of concept, and to further improve our understanding of the coefficients in eqns. (9), we will consider the linear stability when connected to an infinite bus (or slack node) via eqns. (5). We will limit ourselves to the normal form with a single internal frequency variable, i.e. eqns. (13).
We work in the reference frame co-rotating with the infinite bus and fix its phase angle at zero such that the nodal voltage at the infinite bus is given by a constant Vs  R>0. Our goal is to derive conditions for the parameters that ensure local asymptotic stability for some valid equilibrium point with synchronized frequency, i.e. some y0 = (0, 20, p0, q0)T for which Au(y0) = A(y0) = 0, and such that   [0, 2) : p0 + iq0 = Y (20 - 0Vsei). Note that, with slight abuse of notation, Y denotes the admittance of the single transmission line here. For convenience we make the change of coordinates R + iI := ln u, with the subscripts R, I denoting real and imaginary part in the following, and set BIu = 1 without loss of generality. The system we are considering here is thus given by

p + iq = Y (e2R - eR+iI Vs) ,  R + i I = Bu + Cu2 + Gup + Huq , (15)
 = B + C2 + Gp + Hq ,

with the Jacobian

2Cu20 + Gup+0 + Huq0- Hup-0 - Guq0+ BRu 

J (y0) = 

0

0

1,

2C20 + Gp+0 + Hq0- Hp-0 - Gq0+ B

(16)

and the constants p±0 , q0± defined as

p±0 := p0 ± YR20 ,

q0± := q0 ± YI 20 .

Invoking the Routh-Hurwitz criterion [32] we can ensure all three eigenvalues to lie in the left complex half-plane if the inequalities

trJ(y0) < 0 ,

det J(y0) < 0 ,

(17)

trJ (y0) trJ (y0)2 - tr2J (y0) < 2 det J (y0) ,

are satisfied (see appendix (F1) for these inequalities in terms of the parameters). While these conditions are necessary and sufficient, they are too intricate to yield any qualitative insights, so we consider the special case in which the response of the node to active and reactive power is adapted to the behavior of the power line:

Gu = -ku cos  , Hu = -ku sin  ,

G = -k sin  , H = k cos  ,

(18)

8

Rm u in

R
Ru (Ru )2 + (R )2

Rm  ax





cos( - ) (Ru)2 + (R)2

RV
Figure 1: Geometric representation of inequalities (19) and (20) for sign() = sign(R), with Rm u in := RV cos 
and Rm  ax := RV |sin |

for some ku > 0, k > 0 and tan  := -YI /YR. This makes the coupling behave like conventional droop control [3] for a purely inductive network (YR = 0) even when YR  0 (an idea which has been used e.g. for dispatchable virtual oscillator control [4]). To state the sufficient stability conditions, we first define the shorthands

Ru

:=

1

-

Cu ku|Y

|

,

R

:=

C k |Y

|

,

RV := Vs , 20

encoding the ratios between the coefficients specifying the system's reaction on voltage amplitude and power deviations, as well as the ratio between the infinite bus voltage and the desired voltage amplitude at the node (although in practical cases we usually have RV  1/2). Additionally, we define the angle

 := tan-1

R Ru

.

With these definitions and the assumption (18), we can state that the system (15) is asymptotically stable if the following conditions are satisfied:

 ||  ,
2

B < 0 ,

sign()BRu  0 ,

Ru > RV cos  ,

sign()R  RV |sin | ,

(19)

cos( - ) (Ru)2 + (R)2 > RV .

(20)

The derivation of these inequalities can be found in appendix F. The conditions show that the chief determinants for the stability of a certain equilibrium (with relative phase angle  and voltage amplitude 0) are the

ratios between the coefficients specifying the system's reaction on voltage amplitude and power deviations. A geometric representation of the inequalities (19) and (20) is depicted in fig. 1. Assuming Vs  0 (as is usually the case for power grids), it can be seen that for relative angles || < /3, it is enough to ensure the correct sign for the coefficients Cu and C, i.e. Cu < 0 and sign()C  0, while respecting the bound on R. R parametrizes the impact of the amplitude on the frequency of the system, relative to the power droop. Thus we find that in a moderately loaded scenario, the crucial factor for the linear stability of the system is the amplitude-phase coupling.
If a greater load, and thus a greater relative phase angle needs to be guaranteed stable, we must further ensure that the influence of voltage amplitude deviations dominates that of power deviations, as given by inequality (20). Lastly, we note that the inequality (20) is actually a necessary bound under the assumption of eqns. (18). The inequalities (19) are only sufficient, i.e. they may be relaxed by invoking stricter bounds on B and BRu , which are rather technical however (see eqn. F4).
Now, given a concrete model from the class of amplitude-frequency oscillators, we only have to substitute the coefficients with the corresponding partial derivatives as given by eqns. (8) in order to translate the stability conditions to the specific model parameters.
VI. VALIDATION AND PROBABILISTIC STABILITY
While the normal form is guaranteed to be a valid approximation in a small neighborhood of the desired operating state, it is not a priori clear whether it can successfully approximate the behavior of real systems under realistic perturbation. Further, if the quasi-steady state of the network starts to deviate from the desired operating state of the individual units we might be stretching the validity of the normal form even further. This section will show first evidence that real systems (section VI A) and large perturbations (sections VI B) can be accurately captured by the normal form. Further we show that for an adapted standard IEEE test network, the normal form approximation correctly captures both, persistent deviations from the desired operating state as well as probabilistic stability properties in section VI C.
All code is available and open source in an accompanying github repository/zeonodo archive.
A. Lab experiment
We begin with an empirical test of our model using measurement data of a grid-forming inverter with an elaborate control scheme, devised and built at TECNALIA labs [33]. The data has originally been gathered to validate numerical simulation tools [34].

9

Figure 2: Left: Model fit to data, one internal variable. Right, validation of the fitted parameters against different test run. Blue: measurement data. Orange: output of the normal form.

The inverter control design basically consists of conventional droop control with a low pass filter for the measured power output which emulates inertia. This basic design is similar to eqns. (G2), but further includes additional filters for voltage and frequency measurements, as well as a virtual impedance [33]. Besides the inverter, the lab setup contains an AC power source and an Ohmic load. The load is connected to the power source by an emulated line containing a series of inductances and resistances. The inverter is connected to the load by a transformer. In this particular test case, we varied the frequency at the power source and measured the voltages and currents for two of the three phases directly at the inverter. More details on the setup and the parameterization can be found in the technical report [35]. Assuming the three phases to be balanced, we can thus directly calculate the complex nodal voltage and current (u and j), and further the active and reactive power output (p and q), as well as the nodal voltage amplitude . The frequency has to be determined by numerical differentiation.
We now can use the normal form as a semi-black box model that we fit to this data. Note that while a detailed model of the inverter may include many inner control loops, all of which need to be modeled correctly to reproduce the measurements, the semi-black box model can be chosen to be much simpler. In fact, we will use a single internal variable, thus obtaining an effective model of reduced order (dimensionality) for the inverter.
To reliably fit such models it will be necessary to properly adapt system identification techniques to this setting. To obtain a first proof of concept, we instead opted

for a straightforward two step approach with generic tools. First, we performed a linear regression for obtaining rough parameter estimates, then we fine tuned these using scientific machine learning tools. For the linear regression, we numerically calculate the derivative of the complex voltage and the frequency to obtain an estimate for the parameters in (13) using the method of least squares. For the fine tuning, we simulate the system using DifferentialEquations.jl [36] and optimize the least square fit of the trajectories using DiffEqFlux.jl package [37].
Figure 2 depicts the results of this procedure. On the left, we see the measurement data against the trajectories of the optimized normal form with the input that has been used for the optimization. On the right, we show the trajectories for an input from a different measurement while using the same set of parameters. We see that the normal form is able to capture most of the dynamical behavior of the grid-forming inverter very accurately, only showing overshoots during the sudden shifts in frequency. This is to be expected, however, as we have used a model of quite low dimensionality.
B. Simulations - infinite bus
We now turn to simulation studies of the normal form approximation in an infinite bus bar setting, as already considered in section V. We will consider droopcontrolled inverters of Schiffer et al. [3] (see eqns. (G2)) and third order models of synchronous machines as used by Schmietendorf et al. [27] (see eqns. (G1)).

10

(a)

(b)

(c)

(d)

(e)

(f )

Figure 3: Results for the infinite bus scenario. Trajectories for (a) inverter, (d) synchronous machine (the vertical bars signify the beginning and end of the perturbation at t = 10s and t = 12s). Basin cross-sections for (b, c) inverter, (e, f) synchronous machine with four possible cases for each state: points inside the basins of both the
original model and its normal form (orange), only inside the original model's basin (yellow), only inside the normal form's basin (red), and outside both basins (white). The crosses depict the actual operating state (o, o, o) of the
full models.

Figures 3a and 3d show the resulting trajectories for a large power perturbation during which the desired power input at the node is doubled for two seconds. We see that the qualitative agreement of the trajectories is excellent in both cases. In fact the trajectories almost completely match for the droop-controlled inverter. For the synchronous machine, for which the trajectory drops to extremely low voltage levels, deviations are more noticeable.
To explore the reaction to a large perturbation more systematically, we consider various slices of the systems phase space. That is, given the operating state specified in amplitude-angle coordinates by (o, o, o), we consider trajectories starting from coordinates of the form (, , o) and (o, , ). We then ask whether the system returns to the operating state from these initial conditions, i.e. we consider slices of its basin of attraction. The model's basin is depicted in yellow, the basin for the

normal form in red, and their overlap in orange.
Figure 3b shows that for the droop-controlled inverter the basins show full agreement. In figure 3c we see some deviations at low voltage amplitudes very far from the operating state. This is to be expected as the normal form approximation involved expanding the voltage dynamics around the desired operating state. In this case the normal form underestimates the stability region of the system. In the Appendix VI C we see that this is not always the case.
For the third order model we have similar results in Figures 3e and 3f, with a slight overestimation of stability in some areas. The qualitative features of the original model are fully reproduced by the normal form though.
The details of the numerical set up are given in Appendix C.

11

C. IEEE-14 Bus system

VII. CONCLUSION AND OUTLOOK

To address the question whether the normal form can also capture the complex interactions between different components, as well as persistent deviations in a realistic power grids, we turn to the IEEE 14-bus test system [38]. We adapt this test system by placing various grid-forming component at the nodes, using synchronous machines, different types of droop control, and dVOCs. A detailed set up of the simulation is given in the appendix C
We then consider the normal form for all of them given their design set-points, ignoring deviations that result in the actual networks operating state due to imbalances and losses. We study the system at a range of power flows by scaling the active and reactive power at the inverter nodes by a common factor fs between 0 and 2. This leads to a variety of operating states which include some deviation from the desired operating points of the inverters. Figure 4 shows in red the minimal voltage amplitude that occurs in the network for these operating states, for both the original and the normal form model. We see that the normal form is capable of describing this behavior very accurately. In black we show the singlenode basin stability [39, 40] of node 1, i.e. the probability that a random large perturbation at node 1 destabilizes the system. Again, the results for the normal form and the full model agree within the uncertainty bounds.
This demonstrates that the normal form, by taking a "network first" approach to modeling and keeping the power flow equations fully accurate, is capable of capturing sophisticated properties of complex highly heterogeneous power grids.
Figure 4: IEEE 14-bus test system [38]: The system is studied for a range of power demands, all active and reactive power set points at the inverter nodes are scaled by a common factor fs between 0 and 2. In red we plot the minimal voltage amplitude min = minn on in the resulting operating state, the solid line is the original model, the dashed line the normal form. In black we give the single node basin stability of node 1.

This paper introduces a normal form for grid forming power grid components. This form is arrived at by using symmetry arguments to restrict the functional form and expanding order by order in physically meaningful quadratic non-linearities, concretely the power and voltage mismatch at the nodes. At lowest order the normal form is parametrized by a linear time invariant system with three time varying inputs and two outputs. The main factor in the complexity of the normal form is the number of internal states of this linear system.
The normal form can be derived from more detailed analytic models, for which we gave detailed examples, but it is also possible to directly infer it from experimental measurements. In the latter case, we can fix the number of internal states a priori to obtain an empirically best model of the system at a given complexity. We give a first proof of concept of this approach by fitting the data of a grid forming inverter built at TECNALIA to a low complexity normal form with one internal variable.
A more systematic exploration of this approach will require adapting tools from system identification to this context, especially for dealing with noise in the measurements.
We saw in numerical experiments that the normal form is capable of describing the non-linear behavior of the power grid in the vicinity of the desired operating states. This was explored for both, single machines at an infinite bus and a highly challenging heterogeneous network of diverse grid forming actors. While the quality of the lowest order approximation for a single node is relatively clear from the derivation and the numerical experiments, a more thorough understanding of the limits of the approximation when we consider a whole network of oscillators will require more work.
Besides being of interest in itself, the normal form presented here also provides a starting point for the interdisciplinary study of realistic models of future power grids.
The form closely resembles Stuart-Landau oscillators, thus opening the door to adapting a large body of dynamical systems research to the study of future power grids. As it is based on very general principles and physically meaningful variables all relevant dynamical aspects of the dynamical actors can be described by it. This opens up the possibility to transport results from the theoretical research on control and complex systems aspects of power grids, often based on highly conceptual phase models [41], to models that are accurate with regard to the real power grid.
The normal form also opens up further novel research avenues. For example, it can serve not just as a model for concrete systems but as a specification for the behavior of future designs. The study of the linear stability of the normal form can be considered a first proof of concept in this direction.
While this work focuses on grid forming nodes, we expect the approach to be fruitful more broadly. By choos-

12

ing different invariants, and different variables, it is possible to arrive at normal forms that will be suited to other classes of grid actors. Non-smooth behavior might also be modeled as switching between different normal forms.
Finally, the mathematical approach taken is highly general. Whereas ordinary phase reduction approaches require a small coupling assumption, here we were able to work from the assumption that coupling and oscillation are well adapted to each other. It is rare for oscillating systems to exist and develop in isolation, and we posit that such an approach is likely to be fruitful in other fields of complex systems science, synchronization and oscillator networks.
VIII. CODE AVAILABILITY
All code to reproduce the results and figures of this paper is available at the DOI https://doi.org/10.5281/

zenodo.4881898 or at the github repository https:// github.com/PIK-ICoN/NormalFormPaper.
ACKNOWLEDGMENTS
We would like to thank Meng Zhan and Sebastian Liemann for detailed comments on a draft of this manuscript.
The authors acknowledge the support of BMBF, CoNDyNet2 FK. 03EK3055A. This work was funded by the Deutsche Forschungsgemeinschaft (DFG, German Research Foundation) ­ KU 837/39-1 / RA 516/13-1 & HE 6698/4-1. All authors gratefully acknowledge the European Regional Development Fund (ERDF), the German Federal Ministry of Education and Research and the Land Brandenburg for supporting this project by providing resources on the high performance computer system at the Potsdam Institute for Climate Impact Research.

[1] Y. Chen, R. Hesse, D. Turschner, and H.-P. Beck, in 2011 International Conference on Power Engineering, Energy and Electrical Drives (IEEE, 2011) pp. 1­6.
[2] Y. Chen, R. Hesse, D. Turschner, and H.-P. Beck, in International conference on renewable energies and power quality, Vol. 1 (2012) pp. 414­424.
[3] J. Schiffer, R. Ortega, A. Astolfi, J. Raisch, and T. Sezi, Automatica 50, 2457 (2014).
[4] G. Seo, M. Colombino, I. Subotic, B. Johnson, D. Groß, and F. D¨orfler, in 2019 IEEE Applied Power Electronics Conference and Exposition (APEC) (2019) pp. 561­566.
[5] F. Milano, F. Do¨rfler, G. Hug, D. J. Hill, and G. Verbic, in 2018 Power Systems Computation Conference (PSCC) (2018) pp. 1­25.
[6] D. Groß, M. Colombino, J. Brouillon, and F. Do¨rfler, IEEE Transactions on Control of Network Systems 6, 1148 (2019).
[7] H. Haehne, J. Schottler, M. Waechter, J. Peinke, and O. Kamps, EPL (Europhysics Letters) 121, 30001 (2018).
[8] H. Haehne, K. Schmietendorf, S. Tamrakar, J. Peinke, and S. Kettemann, Phys. Rev. E 99, 050301 (2019).
[9] M. Muratori, Nature Energy 3, 10.1038/s41560-0170074-z (2018).
[10] M. Anvari, E. Proedrou, B. Schaefer, C. Beck, H. Kantz, and M. Timme, Data-driven load profiles and the dynamics of residential electric power consumption (2020), arXiv:2009.09287 [physics.app-ph].
[11] Y. A. Kuznetsov, Elements of Applied Bifurcation Theory (2nd Ed.) (Springer-Verlag, Berlin, Heidelberg, 1998).
[12] J. Schiffer, D. Zonetti, R. Ortega, A. M. Stankovi´c, T. Sezi, and J. Raisch, Automatica 74, 135 (2016).
[13] S. Curi, D. Groß, and F. Do¨rfler, in 2017 IEEE 56th Annual Conference on Decision and Control (CDC) (2017) pp. 5708­5713.
[14] W. Duesterhoeft, M. W. Schulz, and E. Clarke, Transactions of the American Institute of Electrical Engineers 70, 1248 (1951).
[15] R. Remmert, Theory of complex functions, Vol. 122 (Springer Science & Business Media, 1991).

[16] R. W. Erickson and D. Maksimovic, Fundamentals of Power Electronics, 2nd ed. (Springer US, 2001).
[17] S. Chiniforoosh, J. Jatskevich, A. Yazdani, V. Sood, V. Dinavahi, J. A. Martinez, and A. Ramirez, IEEE Transactions on Power Delivery 25, 2655 (2010).
[18] D. Groß and F. Do¨rfler, in 2019 57th Annual Allerton Conference on Communication, Control, and Computing (Allerton) (2019) pp. 326­333.
[19] J. Coulson, J. Lygeros, and F. Do¨rfler, in 2019 18th European Control Conference (ECC) (IEEE, 2019) pp. 307­ 312.
[20] P. Olver, Applications of Lie Groups to Differential Equations, 2nd ed. (Springer New York, 1993).
[21] B. B. Johnson, M. Sinha, N. G. Ainsworth, F. D¨orfler, and S. V. Dhople, IEEE Transactions on Power Electronics 31, 6002 (2016).
[22] B. Johnson, M. Rodriguez, M. Sinha, and S. Dhople, in 2017 IEEE 18th Workshop on Control and Modeling for Power Electronics (COMPEL) (2017) pp. 1­6.
[23] F. Rodrigues, T. Peron, P. Ji, and J. Kurths, Physics Reports 610, 1 (2016).
[24] J. W. Simpson-Porco, F. Do¨rfler, and F. Bullo, Automatica 49, 2603 (2013).
[25] J. Machowskiand Z. Lubo´sny, J. Bialek, and J. Bumby, Power System Dynamics. Stability and Control., 3rd ed. (WILEY, 2020).
[26] P. Monshizadeh, C. De Persis, N. Monshizadeh, and A. J. van der Schaft, in 2016 IEEE 55th Conference on Decision and Control (CDC) (2016) pp. 4116­4121.
[27] K. Schmietendorf, J. Peinke, R. Friedrich, and O. Kamps, The European Physical Journal Special Topics 223, 10.1140/epjst/e2014-02209-8 (2013).
[28] Y. Kuramoto, Chemical Oscillations, Waves, and Turbulence (Springer-Verlag Berlin Heidelberg, 1984).
[29] E. Panteley, A. Loria, and A. E. Ati, IFAC-PapersOnLine 48, 645 (2015).
[30] M. Maghenem, E. Panteley, and A. Lor´ia, in 2016 IEEE 55th Conference on Decision and Control (CDC) (2016) pp. 2581­2586.

13

[31] A. Ro¨hm, K. Lu¨dge, and I. Schneider, Chaos (Woodbury, N.Y.) 28, 063114 (2018).
[32] W. Hahn, Stability of Motion, Grundlehren der mathematischen Wissenschaften (Springer Berlin Heidelberg, 1967).
[33] E. Planas, A. Gil-de Muro, J. Andreu, I. Kortabarria, and I. M. de Alegr´ia, IET Renewable Power Generation 7, 458 (2013).
[34] A. Plietzsch, R. Kogler, S. Auer, J. Merino, A. Gil-de Muro, J. Liße, C. Vogel, and F. Hellmann, arXiv preprint arXiv:2101.02103 (2021).
[35] C. Vogel, S. Auer, T. Deß, A. Plietzsch, and R. Kogler, Validation of low-voltage energy and renewables integration analysis (VALERIA), Tech. Rep. (European Research Infrastructure supporting Smart Grid (ERIGrid), 2020) https://erigrid.eu/wp-content/uploads/2020/ 06/ERIGrid_TA_VALERIA_Technical-Report_v01.pdf.
[36] C. Rackauckas and Q. Nie, Journal of Open Research Software 5 (2017).
[37] C. Rackauckas, M. Innes, Y. Ma, J. Bettencourt, L. White, and V. Dixit, arXiv preprint arXiv:1902.02376 (2019).
[38] C. Canizares and S. Kodsi, Technical Report 2003-3 (2003).
[39] P. J. Menck, J. Heitzig, N. Marwan, and J. Kurths, Nature physics 9, 89 (2013).
[40] P. J. Menck, J. Heitzig, J. Kurths, and H. J. Schellnhuber, Nature communications 5, 1 (2014).
[41] S. Auer, K. Kleis, P. Schultz, J. Kurths, and F. Hellmann, The European Physical Journal Special Topics 225, 609 (2016).

Appendix A: Line dynamics

As an addendum to section II we want to briefly discuss the applicable line models for our normal form. As we take nodes to be a voltage that reacts to a current, that is, it behaves like a capacitor, our lines need to be modeled as providing a current in reaction to the terminal voltages, thus behaving like inductances.
Using the same notation as in the main section, we only need to include further dynamical variables corresponding to the currents flowing on each transmission line denoted by je,m(t) : R  C. From the standard laws of electrical circuit elements a line modeled as a resistor and an inductance in series has the equation

d

N

m dt je,m = -rmje,m +

Bnmun ,

n=1

M

jn =

Bnmje,m ,

m=1

(A1)

which would replace the algebraic relationship between voltage and current, eqn. (4), that we used in the main section. The latter is actually derived by considering the quasi-steady state where je,m(t)  exp ist, i.e. setting

d dt

jes,m

=

isjes,m.

More sophisticated models of lines, which include line capacitances, can be naturally coupled to our nodal ODEs as long as they provide ODEs for the terminal currents. This is the case, for example for  -models and iterated  -models of transmission lines. Models such as the -model which have ODEs for the terminal voltages lead to algebraic constraints on the system.
We also want to note that in the special case of a uniform ratio between resistance and inductance across the whole network, i.e. m/rm =:  m  E, the current dynamics may be directly expressed in terms of the admittance matrix Y and also greatly simplified with respect to dimensionality by eliminating the line currents and writing the nodal current dynamics as

d

1

dt jn = -  jn +

1 + is 

N
Ynmum .

m=1

Appendix B: Fitted parameters

We get the following parameters by fitting the model as described in section VI A:

A

B

C

G

H

(u) 3.9426 -0.0064 -4.3700 -0.1561 -0.0022

(u) -0.4919 0.8614 -0.0672 -0.3988 0.6019

 -1.9899 -0.9445 -2.0393 -2.8718 4.5051

All parameters have the units 1/s in the per unit system with Pbase = 10kW and Vbase = 393.4V .

14

p = 2.5 and droop gains kp = 5, kq = 0.1, and expand around 0 = V d = 1, 0 = d = 0, p0 = pd = 0.5 and q0 = qd = 0.2. For the synchronous machine model (G1)
we choose the damping constant  = 0.2, time constant
 = 2 and internal reactance X = 1, and expand around 0 = Ef = 1, 0 = 0 (the model is given in the corotating reference frame), p0 = pm = 0.5 and q0 = 0
as no explicit set-point for reactive power is given in the
model.

Figure 5: TECNALIA inverter measurement: These are the measured time series for current and voltage at the grid forming inverter described in [33]. The oscillations
correspond to shifts in the frequency of the power source in the lab setup.

Appendix C: Numerical simulations

2. Network

This appendix describes the model and simulation setup for section VI, as well as some further results for the networked case. All simulations were performed using DifferentialEquations.jl [36]. The network model was built with PowerDynamics.jl [34]. The simulations were performed with a RADAU solver (CITE) with relative tolerances set to 10-6 for more details we refer to the code accompanying the paper.
Figure 6: IEEE 14-bus test system [38]: light green is the slack bus, red are synchronous machines (G1), dark green are inverters (G2), blue is a passive node, purple
are inverters (G4), pink are inverters (G3).
1. Infinite busbar
In the inifinite bus simulations of section VI B we consider a model of a droop-controlled inverter, eqns. (G2), and a third-order approximation of a synchronous machine, eqns. (G1), connected to an infinite bus. We use pu units with voltages 1 at the nodes and a per unit power chosen such that the admittance of the line, which we take to be purely inductive, is Y = -1i. The line model also includes shunt capacitance of Y s = 0.2i. For the inverter model (G2) we choose the time constant

The network model is based on the IEEE-14 bus dynamical test system, augmented with grid forming components. The distribution of components is shown in Figure 6. We use are synchronous machines at nodes 1, 3, 6 and 8 (eqns. (G1)) and inverters with different types of control at most other nodes, namely at 4, 5, 9, and 12 we use the droop controlled inverter (G2), at nodes 11 and 14 we attach the inverter model (G3) (which adds inertia to the amplitude dynamics), and at buses 10 and 13 we place inverters with dispatchable virtual oscillator control (G4). For the detailed parameter choices we refer the reader to the code.
To stress the system we scale the active and reactive power demand at all inverter controlled nodes by a common factor fs varying between 0 and 2. Note that the set points do not provide a solution of the power flow, and we have persistent deviations from the desired operating points.
The main part of the paper discusses the single node basin stability for a variety of fs values. Here we also briefly present more phase space slices in the style of Figure 3. Each location in the slice corresponds to an initial condition for two variables of the system. All other variables in the system are intialized at the quasi-steady operating state of the network. Thus the plots show very large, instantaneous perturbations affecting only a single node. The results are shown in fig. 7.
We see that in this highly challenging scenario with large perturbations, the agreement with respect to the shape of the stability region becomes significantly worse the further we stray from the operating state. Most problematic appear large deviations in voltage amplitude. This should be kept in mind, when analyzing fault scenarios that feature such deviations. However, many important qualitative features are still captured by the normal form.

15

Figure 7: Various basin slices for the IEEE 14-bus test case. Color code as in Fig. 3. First row: bus 1 (left), bus 4 (middle), bus 6 (right). Second row: bus 8 (left), bus 9 (middle), bus 12 (right)

Appendix D: Coordinate transformation

Here we write out the steps that lead from eqns. (1) to eqns. (6). First we define

f~u,z,x(u, , 2, p, q) :=

f u,z,x

u( - i)  + i 2 u(p - iq) p + iq

x,

2

,

, u, ,

u

u

2

, u

.

Then we have
 + i = u z + uz =
f~u  + i + u(f~z) =: f~ + if~ , u
and define
f~x  f~ := f~ .
f~

Appendix E: Linear time invariant input-output form of the internal dyanmics

We can write (9) in terms of real variables x, xi and xo, and real matrices AM , BM , CM , DM :

p + iq = uj - (p0 + iq0)

2 = uu - 20 ,

u u

=

xo1

+

ixo2

,

xi = [2, p, q, 1]

x = AM x + BM xi

xo = CM x + DM xi

(E1)

This form is the most suitable for using tools from the study of LTI systems for power grid models.

Appendix F: Local asymptotic stability

The full inequalities (17) in terms of the normal form coefficients and the expansion point are given by the rather lengthy expressions

0 > 220Cu + Gup+0 + Huq0- + B ,

0 < 220 (Hp-0 - Gq0+)Cu - (Hup-0 - Guq0+)C - (p+0 p-0 + q0+q0-)(HuG - GuH) ,

0 < - (220Cu + Gup+0 + Huq0-)2B - (220Cu + Gup+0 + Huq0-)(B)2 + (Hp-0 - Gq0+)B + BRu (220Cu + Gup+0 + Huq0- + B)× × (220C + Gp+0 + Hq0-) + (2C20 + Gp+0 + Hq0-)(Hup-0 - Guq0+) . (F1)
Employing the additional assumptions of eqns. (18) and the definitions of Ru, R, and RV , yields the more compact inequalities

0 > W1 + B ,

(F2)

0 > -Ru cos  - R sin  + RV ,

(F3)

0 > 220|Y |(ku)2BW12 + ku(B)2W1 - kBRu W2 220|Y |kuW1 + B + kBRV cos  + 220|Y |kukRV W2 sin 

(F4)

16

with

W1 := RV cos  - Ru , W2 := R - RV sin  .

From these inequalities we can immediately deduce the conditions given in section V. By requiring B < 0, in-
equality (F2) is satisfied if W1 < 0, which yields the first of inequalities (19). By further requiring ||  /2, in-
equality (F4) is satisfied if

0  W2 sin  , 0  BRu W2 ,
which is equivalent to sign()BRu  0 and the second of inequalities (19). For inequality (F3) we make use of the trigonometric identity

a cos  + b sin  = c cos( + ) ,

with

c := sign(a) a2 + b2 ,

 := tan-1

b -

.

a

Since W1 < 0 implies Ru > 0, this yields inequality (20).

Appendix G: Models used in section VI

For completeness we give the models we base the heterogeneous network in section VI on. Here the parameters are kept in line with the notation used in the original papers that they were taken from. We also provide the normal form coefficients when expanded around the design set-points.

Third-order approximation of synchronous machines [27]:

¨n = -nn + pm n - pn

nE n

=

Enf

-

En

-

Xn

qn En

(G1)

AB

C

GH

u0

i

- 0 - 1
2n(Enf )2

Xn n(Enf )2

 0 -n

0

-1 0

Droop-controlled inverter [3]:
n = n pn  n = -n + d - kpn (pn - pdn) pn Vn = -Vn + Vnd - kqn (qn - qnd )

(G2)

AB u id i



0

-

1 pn

C -1
2pn (Vnd)2
0

G 0 - kpn
pn

H - kqn
pn Vnd
0

Droop-controlled inverter [3] without the assumption of near instantaneous voltage measurement:

n = n
Pn  n = -n + d - kPn (Pn - Pnd)
Pn Vn V¨n = -(Pn + Vn )Vn - Vn + Vnd - kQn (Qn - Qdn) (G3)
Writing  for 1,  for 2, B× for B1×, and B× for B2× we have

A B u id i



0

-

1 pn

0 0

B 1
0
Pn +Vn Pn Vn

C

G

0 0 -1
2Pn Vn (Vnd)2

0 - kpn
pn
0

H 0 0 - kqn
Pn Vn Vnd

Dispatchable virtual oscillator control [6]:

ei

u n =  + i0 + (vn)2 (pn - iqn) un

-

 (vn)2

un|un|2

-

eijn

(G4)

A

C

GH

u

i0

-

 (vn )2

+

ei (vn )4

(pn

-

iqn)

- ei
(vn )2

iei (vn )2

