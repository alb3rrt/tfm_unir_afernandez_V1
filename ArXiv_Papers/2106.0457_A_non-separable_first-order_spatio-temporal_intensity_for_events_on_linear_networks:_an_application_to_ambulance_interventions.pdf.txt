arXiv:2106.00457v1 [stat.AP] 1 Jun 2021

A non-separable first-order spatio-temporal intensity for events on linear networks: an application to ambulance
interventions
Andrea Gilardi1, Riccardo Borgoni1, and Jorge Mateu2
1Università di Milano-Bicocca, Department of Economics, Management and Statistics 2Universitat Jaume I, Department of Mathematics
Abstract The algorithms used for optimal management of ambulances require accurate description and prediction of the spatio-temporal evolution of emergency interventions. In the last years, several authors have proposed sophisticated statistical approaches to forecast the ambulance dispatches, typically modelling the events as a point pattern occurring on a planar region. Nevertheless, ambulance interventions can be more appropriately modelled as a realisation of a point process occurring along a network of lines, such as a road network. The constrained spatial domain raises specific challenges and unique methodological problems that cannot be ignored when developing a proper statistical model. Hence, this paper proposes a spatiotemporal model to analyse the ambulance interventions that occurred in the road network of Milan (Italy) from 2015 to 2017. We adopt a non-separable first-order intensity function with spatial and temporal terms. The temporal component is estimated semi-parametrically using a Poisson regression model, while the spatial dimension is estimated nonparametrically using a network kernel function. A set of weights is included in the spatial term to capture space-time interactions, inducing non-separability in the intensity function. A series of maps and graphical tests show that our approach successfully models the ambulance interventions and captures the space-time patterns.
1 Introduction
A proper management of an ambulance fleet is of vital importance for timely assistance of medical emergencies. This is an extremely challenging task considering the complex spatial and temporal dynamics that govern the emergency interventions, especially for large and highly populated metropolitan areas. Local agencies are usually required to develop plans in order to minimise the response times, given limited human and instrumental resources. For this reason, advanced operation research algorithms have been developed in the last years to manage the fleet size and locate the ambulance dispatch centres (Blackwell and Kaufman 2002; Henderson 2010). However, these algorithms depend upon ad-hoc inputs regarding the distribution of the emergency events and the adoption of inaccurate predictions can lead to low performances. Hence, several authors (e.g. Zhou, David S Matteson, et al. 2015; Zhou and David S. Matteson 2015; Bayisa et al. 2020) proposed complex spatio-temporal models to carefully forecast the future distribution of the interventions.
Typically, in these mentioned papers, the ambulance dispatches are modelled as point processes occurring on a planar surface (e.g. a polygon delimiting a city). Nevertheless, we believe
1

that ambulance interventions can be more appropriately considered as a realisation of a point process occurring along a network of lines, such as a road network, typically represented as a graph object with geolocated nodes, corresponding to road junctions, and edges, corresponding to road segments (Barthélemy 2011). The analysis of network data raises geometrical, computational, and statistical complexities (Okabe and Sugihara 2012). First, ignoring the network constraint may lead to spurious results and false positive detections (Yamada and Thill 2004; Lu and Chen 2007). Second, the readaptations of the classical planar techniques for point pattern analysis (such as the K-function or the kernel density estimator) to network data present unique methodological problems and the non-homogeneous nature of the spatial domain must be taken into account. Third, the length and volume of the geographical networks typically create additional computational problems (Rakshit, Baddeley, and Nair 2019; Rakshit, Davies, et al. 2019). We refer to Baddeley, Nair, et al. (2020) and the references therein for more details.
The goal of this paper is to analyse all ambulance interventions that occurred in Milan (Italy) from 2015 to 2017 using a spatio-temporal point pattern model developed at the road network level. Starting from the assumption that the emergency events can be modelled by a non-homogeneous Poisson Process, we propose a non-separable structure for the first-order intensity function with spatial and temporal terms. The temporal component is modelled semiparametrically using a Poisson regression with deterministic covariates, while the spatial dimension is modelled using a non-parametric kernel estimator. The non-separability in the intensity function is induced by a set of weights that are included in the spatial component to capture the space-time interactions.
The rest of the paper is organised as follows. Section 2 examines the ambulance interventions data and presents the procedures used to build the computational representation of the street network. We introduce the spatio-temporal framework and the first-order non-separable intensity function in Section 3, providing an overview of the spatial and temporal statistical models. The main results are presented in Section 4, while, in Section 5, we validate the performances of the proposed methodology. Section 6 concludes the article summarising the most important findings and main contributions.
2 Data: Ambulance interventions
In this section we describe the spatio-temporal characteristics of the dataset, the problem that motivated our approach, and the procedures used to transform the raw data into a computational structure suitable for fitting our proposed model, detailed in Section 3.
The dataset was provided by the official regional Emergency Medical System (EMS) and included all ambulance dispatches in the city of Milan from 2015-01-01 to 2017-12-31. Milan is the largest city in Italy after Rome, with a total population of 1,259,339 people in 2011 and an area of about 183 km2. It represents one of the most important Italian metropolitan areas, where hundreds of thousands of people pass through every day. For this reason, the ambulances management in Milan requires ad-hoc modelling and planning.
The dataset is composed by four fields recording the day, the hour, and the GPS coordinates of the ambulance interventions (stored using an official Italian coordinate reference system named Gauss-Boaga projection). They provided the necessary information for the spatio-temporal model introduced below. Approximately 50,000 observations with missing spatio-temporal coordinates were removed, and we included only the first ambulance intervention in case of multiple dispatches for the same, typically life-threatening, events (e.g. heart failures or severe car crashes). We did not consider the interventions occurred during EXPO 2015, the World Expo hosted in Milan from May 1 to October 31 dedicated to food and life themes. This event attracted about
2

(a) Year: 2015

(b) Year: 2016

(c) Year: 2017

(d) Road Network

Figure 1: Figures (a) to (c): locations of ambulance interventions that occurred in Milan from 2015-01-01 to 2017-12-31. Each map represents one year. Figure (d): the road network. The blue dot denotes Stazione Centrale (i.e. the main train station), the black dot denotes an important retirement house, the green dot denotes Duomo, while the red dot denotes an important square.

2.15 million visitors from all around the world, altering the regular spatio-temporal dynamics of the area where EXPO took place. The final sample included 496053 interventions, 163510 occurred in 2015, 165404 in 2016 and 167139 in 2017.
The spatial distribution of the EMS events is depicted by Figure 1a-1c. The spatial pattern looks stable among the three years, and the interventions seem to highlight the skeleton of a road network (see Figure 1d) corresponding to the city ring road and some of the most important arterial thoroughfares. The white areas in the maps mostly represent non-urban places, mainly located in the southern and western part of the municipality. It is also possible to distinguish the shapes of some of the most iconic locations in Milan. Given the spatial distribution of the emergency interventions, we believe that a network-approach is more appropriate than a planarapproach since it takes into account the nature of the data and the particular constrains of their geo-locations.
We also explored the temporal dimension of the data, examining the daily and weekly dynamics that govern the total number of emergency interventions. Figure 2 shows the daily number of ambulance dispatches. The data exhibit a clear trend, with a global minimum registered in August, the typical period for summer holidays. Other local peaks and minima could be linked with the most important religious holidays (such as Christmas or Easter), national celebrations (New year's eve) or other occasional events (such as the heatwave in July 2015 or the ice storms

3

Daily number of interventions

600
500
400
300
Mar-2015 Jul-2015 Nov-2015 Mar-2016 Jul-2016 Nov-2016 Mar-2017 Jul-2017 Nov-2017
Figure 2: Time series of the daily number of ambulance interventions that occurred in Milan from 2015-01-01 to 2017-12-31.
in January 2017). Similar temporal patterns are present in all the three years considered. We analysed the temporal dynamics of the emergency interventions within a day. Figure 3
summarises the average number of hourly ambulance interventions splitted by the hour of the day and the day of the week. In all cases, we can recognise a distinct shape: after rapidly increasing in the early morning, the time series peaks around 10:00, falls until 15:00, stabilises until 20:00, and then sinks until the next day. The hourly seasonalities are different between weekends and weekdays. In fact, possibly due to the city's nightlife, the regional EMS registers, on average, more interventions during the first hours of the day in the weekend with respect to the rest of the week. Instead, lower frequencies are detected in the rest of the day. We found a similar pattern in the three years considered.
We completed the temporal exploratory analysis examining the AutoCorrelation function (ACF) of the hourly number of EMS interventions. A graphical output considering two weeks of lagged counts is reported in Figure 4. This plot clearly highlights hourly, daily, and weekly seasonalities. We can also notice that the ACF is negative when considering lags that are multiple of twelve, pointing out a different behaviour amongst mornings, afternoons, and nights. The statistical models proposed in Section 3 take into account the temporal patterns detected on the data.
A road network, typically denoted by L, is defined as the union of a finite set of segments, say li, lying in a planar region S (Ang, Baddeley, and Nair 2012; Baddeley, Nair, et al. 2020)
li = [ui, vi] = {s : s = tui + (1 - t)vi; 0  t  1}, where ui and vi denote the endpoints of li stored using an appropriate projected coordinate reference system. The computational representation of Milan's road network was created using data downloaded from Open Street Map (OSM) servers, and, in particular, we used the open-
4

Average number of hourly ambulance interventions

2015

2016

2017

30

30

30

25

25

25

20

20

20

15

15

15

10

10

10

00:00 05:00 10:00 15:00 20:00

00:00 05:00 10:00 15:00 20:00
Hour

00:00 05:00 10:00 15:00 20:00

Monday Tuesday

Wednesday Thursday

Friday Saturday

Sunday

Figure 3: Time series representing the average number of hourly ambulance interventions that occurred in Milan from 2015 to 2017, divided by the day of the week.

streetmap.fr 1 provider via the R package osmextract (R Core Team 2020; Gilardi and Lovelace 2021).
OSM is a project that aims to build an open and editable map of the World (Barrington-Leigh and Millard-Ball 2017). The basic components of OSM data are called elements, and they are divided into nodes, which represent points on the earth's surface, ways, which are ordered lists of nodes typically corresponding to road segments, and relations, which are lists of nodes, ways and other relations.
We downloaded OSM road data for Italy, and, using a spatial operation, we retained only the ways that lied inside the polygonal boundary defining the city of Milan. Then, we selected those segments that correspond to the most important streets of Milan, focusing on the following classes2 (listed in descending order of importance): motorways, trunks, primary, secondary, tertiary, unclassified, and residential.
We created a road network that longs approximately 1900km, including the majority of the most important streets in Milan. The road network is depicted in Figure 1d. After creating the road network, we excluded all emergency calls whose GPS locations were found farther than 50 meters from the closest segment of the network3, since they probably occurred on other minor streets not included in the considered network. Approximately 12000 events were discarded, and the remaining interventions were projected to their nearest point of the network.
Finally, we explored the spatio-temporal dynamics, testing the existence of space-time interactions. First, we classified all EMS interventions using twelve two-hours classes according to their occurrence times. Then, we calculated (independently for each class) a smoothed intensity
1See http://download.openstreetmap.fr/. Last access: 2020-12-09. 2We refer to https://wiki.openstreetmap.org/wiki/Highways for a comprehensive description of road network data in Open Street Map and guidelines for its classification system. 3The distance between a point and a segment was measured using the shortest euclidean perpendicular distance.

5

ACF -0.2 0.0 0.2 0.4 0.6 0.8 1.0

0 24 48 72 96

144

192

240

288

336

Lag
Figure 4: Hourly autocorrelation function of EMS interventions that clearly displays hourly, daily, and weekly seasonalities.

surface using the convolution kernel estimator detailed in Rakshit, Davies, et al. (2019). The result is reported in Figure 5. We notice that from 10 am to 06 pm the areas close to Duomo and the city centre are highlighted. On the other hand, during the night hours, the smoothed intensity peaks in proximity of nightlife areas. In both scenarios, we can clearly distinguish the main train station (i.e. Milano Centrale) and several nursing homes. The spatial model detailed in Section 3 also includes these potential space-time interactions.
3 Statistical model
We consider a continuous one-dimensional spatial region L and a discrete temporal dimension T = {1, 2, . . . , T } divided into intervals of one hour. As mentioned before, in this paper L represents the street network of Milan, while T is equal to 26304, i.e. the number of hours from 2015-01-01 00:00 to 2018-01-01 00:00.
Let yt denote the number of ambulance interventions that occurred in the network L at time t  T , and let st,i  L, i = 1, . . . , yt denote the location of the ith event at time t. We assume that, independently for each t  T , {st,i : i = 1, . . . , yt} is a realisation of a non-homogeneous Poisson Process (NHPP) with intensity function t(s) (P. J. Diggle 2013; Baddeley, Nair, et al. 2020). The NHPP on a linear network satisfies the following two properties:
1. the number of events occurring in L  L, which is denoted by N (L ), follows a Poisson distribution with parameter µt(L ) = L t(s) d1s. The object L represents a finite por-
6

00:00 - 02:00

02:00 - 04:00

04:00 - 06:00

06:00 - 08:00

0.005 0.02

0.005 0.02

0.005 0.02

0.005 0.025

08:00 - 10:00

10:00 - 12:00

12:00 - 14:00

14:00 - 16:00

0.01 0.04

0.01 0.04

0.01 0.04 0.07

0.01 0.04

0.01 0.03 0.05

16:00 - 18:00

18-00 - 20:00

20:00 - 22:00

22:00 - 24:00

0.01 0.04

0.01 0.04

0.01 0.04

Figure 5: Smoothed intensity functions of EMS interventions in Milan estimated after classifying the events into two-hours classes.

tion of the network L, while d1s denotes the integration with respect to arc-length on the network; 2. let N (L ) = yt, then the yt events represent a random sample from a distribution whose probability density function is proportional to t(s).

We assume that the intensity function of the process can be decomposed as

t(s) = µtgt(s) for s  L.

(1)

Equation (1), despite being similar to the classical separability assumption for spatio-temporal point processes (Moller and Waagepetersen 2003; P. J. Diggle 2013), implies that the function gt(s), which represents the spatial component, also depends on time t. This functional form for t(s) is motivated by the space-time interactions observed in the hourly evolution of the ambulance interventions that were displayed in Section 2. The space-time dependencies are modelled using an appropriate set of weights, as explained in Section 3.2.
The function gt(s) represents the spatial dimension at time t. It satisfies the following two conditions:

1. gt(s) > 0 t  T and s  L; 2. L gt(s) ds = 1 t  T .
Hence, µt represents a spatial aggregation of the intensity function at time t. In fact, considering the NHPP hypothesis and the assumptions on gt(s), we obtain that µt = L t(s) ds. Therefore, yt|t  Poisson(µt) t  T , which implies that µt represents the total volume of

7

ambulance dispatches at time t. The NHPP hypothesis also implies that st,i|t, yt iid gt(s) for i = 1, . . . , yt. Therefore, we can interpret gt(s) as the spatial density of ambulance interventions at time t.
Hereafter, we introduce two statistical models for µt and gt(s), respectively. The temporal component is modelled using a semi-parametric Poisson regression with smoothed deterministic calendar covariates, such as the hour of the day or the day of the week. The spatial dimension is modelled non-parametrically using a network-readaptation of a weighted kernel density estimator (KDE). Below, we present a procedure to calculate the weights.

3.1 The temporal model

As mentioned above, the term µt represents the expected number of interventions that occurred over the network L at time t  T . Following the suggestions in P. Diggle, Rowlingson, and Su (2005) and Bayisa et al. (2020), we model yt using a Poisson regression approach considering the hour of the day, the day of the week, and the week of the year as predictors. To incorporate smoothness into the model, Generalized Additive Models (GAMs) are used in the estimation of µt (S. N. Wood 2011). GAMs extend Generalized Linear Models allowing for not-linear relationships between the response variable and the covariates.
Being yt the observed number of emergency interventions in the linear network L at time t, under a Poisson distribution assumption one has µt = E(yt), and the log-linear Poisson additive regression model is given by

log µt = 0 + s1(hourt) + s2(weekt).

The term hourt represents the hour of the day (taking values from 0 to 23) while weekt represents

the week of the year (taking values from 1 to 53). The terms sj(x), j = 1, 2, represent spline

transformations, i.e. sj(x) =

kj r=1

bjr

jr

(x),

where

jr(x), r

=

1, . . . , kj

are

the

basis

functions

and bjr the unknown coefficients. In particular, a cyclic cubic regression spline is adopted since

in our context it is appropriate to assume a smooth transition between the last hour of one day

and the first hour of the next day as well as between the last week of one year and the first week

of the next year (see Figures 2 and 3).

To account for potential different impacts among the days of the week (see Figure 3), an

interaction term was also included in the linear predictor. Hence, the final model fitted to the

data writes as follows

log µt = 0 + dowt + dowt × s1(hourt) + s2(weekt).

(2)

The term dowt is a factor variable that represents the day of the week.

3.2 The spatial model

As mentioned before, the spatial component of the intensity function, previously denoted by gt(s), is modelled non-parametrically using a network-version of a Jones-Diggle corrected weighted kernel density estimator (Jones 1993; Rakshit, Davies, et al. 2019). The weight function, which takes into account the space-time interactions described in Section 2, is based on the work of Zhou and David S. Matteson (2015) and Zhou (2016).
More precisely, given a set of observed time periods T , an hour u, and a location s on the network, the weighted kernel estimator can be written as

g^u(s) =

tT

yt i=1
tT

w(t, u)KN (s,

yt i=1

w(t,

u)

st,i

,

h)

,

(3)

8

where w(t, u) represents the weight associated to the st,i ambulance intervention and KN (s, st,i, h) denotes the Jones-Diggle corrected network kernel function, firstly adapted to the network structure by Rakshit, Davies, et al. (2019). In particular, the kernel function is defined as

KN (s, st,i, h)

=

K(s - st,i, h) cL(si,t)

(4)

where K(s - st,i, h) denotes a planar Gaussian kernel with bandwidth h and cL(si,t) = L K(s - si,t, h) d1s represents the convolution of kernel K with arc-length measure. Despite a slightly suboptimal statistical efficiency, the KDE estimator in Equation (4) can be computed rapidly
using the Fast Fourier transform, an essential characteristic considering the length of the network
and the volume of EMS data. We refer to Rakshit, Davies, et al. (2019) for an extensive discussion
on its statistical properties and alternative approaches.

3.2.1 Defining the weight function

As introduced before, the weights w(t, u) are used to incorporate space-time interactions into the weighted kernel estimator, creating a non-separable structure in the spatio-temporal intensity t(s). In particular, we assumed that w(t, u) can be modelled as a function of the temporal lag between u and t, say m = u - t. The following functional form, proposed by Zhou and David S. Matteson (2015), was adopted

w(t,

u)

=

w(u

-

t)

=

w(m)

=

(1m)

+

(2m)

sin2
3

(

m 24

)

sin2
4

(

m 168

).

(5)

Equation (5) includes a separate coefficient for each seasonal pattern displayed in Figure 4: 1 captures the short-term dependence while 3 and 4 measure the daily and weekly seasonalities with periodicity equal to 24 and 24 × 7 = 168 hours, respectively. The four parameters are bounded between 0 and 1 to avoid negative weights and exponential growths, and, for this reason, the coefficient 2 represents a discount factor added to fade-out the product of daily and seasonal terms. The term  denotes the constant value 3.1415. . .
The coefficients 1, . . . , 4 are estimated implementing an algorithm suggested in Zhou and David S. Matteson (2015). As mentioned above, the weight function aims to grasp time regularities of EMS interventions, hence should reflect the temporal dependency depicted by the ACF in Figure 4. For this reason, after calculating the empirical hourly ACF of EMS counts up to lag M and taking its positive part, denoted by ACF+, the parameters 1, . . . , 4 were estimated by minimising the following loss function

M

ACF+(m) - 0w(m) 2 s.t. 0 < j < 1 j = 0, . . . , 4.

(6)

m=1

The coefficient 0 represents a further discount factor without any practical interpretation. It is used to scale w(·) between 0 and 1, in order to make it consistent with the ordinate range of ACF+. In this paper, we choose M = 672, which represents four weeks of historical temporal data, whereas the minimisation problem was solved using the box-constrained method implemented in the optim() function, initialising all parameters at 0.5 (Byrd et al. 1995).

4 Results
In this section, we present the results obtained when estimating the spatial and temporal models described in Sections 3.1 and 3.2. All procedures were implemented using the software R (R Core

9

Table 1: Estimates of the linear effects obtained after fitting the model described in Equation (2). The reference category for the daily seasonal term is Sunday.

(Intercept) Monday Tuesday Wednesday Thursday Friday Saturday

Estimate
2.8533 0.0190 -0.0251 -0.0189 -0.0142 0.0019 -0.0056

Standard Error
0.0040 0.0057 0.0058 0.0057 0.0057 0.0057 0.0056

z-value
719.8791 3.3522 -4.3675 -3.2981 -2.4760 0.3259 -0.9952

pvalue
<0.001 <0.001 <0.001 <0.001
0.013 0.744 0.320

Team 2020) and several contributed packages. More precisely, the smooth temporal components were estimated using the package mgcv (S. Wood 2017), while the network-version of the Gaussian weighted kernel is implemented in spatstat (Baddeley, Rubak, and Turner 2015). We fitted the temporal model, the weight function, and the spatial kernel using a virtual machine with an Intel Xeon E5-2690 v3 processor with six cores and 32GB of RAM.
4.1 The temporal component
As detailed in Section 3.1, the temporal component was estimated using a GAM with deterministic predictors representing hourly, daily and weekly seasonal components. The cyclic cubic spline terms are included to capture the smooth intra-day dynamics and the weekly temporal trends. The daily effects are taken into account considering an interaction term and a set of dummy variables. The observed counts originally presented five missing values from 2015-04-01 at 00:00 to 2015-04-01 04:00:00. These values were imputed using a GAM as in Equation (2) that was trained using the interventions until 2015-03-31 at 23:00.
The estimates of 0 and dowt coefficients are summarised in Table 1. The intercept is the (logarithm of) the mean number of interventions, while the other coefficients represent the deviation from the reference level, i.e. Sunday. These estimates suggest that the behaviour during the weekend is quite different from the first days of the week (e.g. Monday to Thursday), with Monday being the day when most interventions take place, whereas Friday and Saturday are found to be not significantly different from Sunday.
The smooth seasonal terms are depicted in Figure 6. In particular, Figure 6a reports the (smoothed) daily effects for each day of the week. The seven curves mirror the shapes displayed in Figure 3 and a clear distinction exists between weekends and weekdays. In all cases, we found a peak around 10 am. Figure 6b shows the smoothed weekly effects, which look similar to the patterns displayed in Figure 2. We observe a drop in the expected number of ambulance dispatches around August. In both cases, the cyclic cubic regression spline were fitted using K = 10 knots evenly placed throughout the values of the covariates.
Finally, we explored the predictive accuracy of the GAM using the following strategy. First, we trained the model considering all ambulance interventions up to 2017-10-01 at 00:00, and then we forecasted the EMS counts until the end of the year. We compared the observed counts with the out-of-sample fitted values and the result is displayed in Figure 7. We can notice a good agreement between the two time series.

10

s1(x)

0.5

Day of Week

0.0

0.0

Monday

Tuesday

s2(x)

Wednesday

Thursday

Friday

-0.5

Saturday

-0.1

Sunday

00:00

05:00

10:00

15:00

Hour

20:00

(a) Intra-day effects

Jan

Apr

Jul

Oct

Jan

Day

(b) Weekly seasonality

Figure 6: Estimates of the smooth seasonal terms obtained after fitting the model described in Equation (2). Figure (a) represents the intra-day effects divided by the day of the week. Figure (b) displays the weekly temporal trends

40

Number of hourly interventions

30

20

10

0

Oct

Nov

Dec

Jan

Year: 2017

Figure 7: Graphical comparison between observed counts and out-of-sample fitted values considering EMS data from 2017-10-01 to 2017-12-31.

11

0.8

0.8

0.6

0.6

0.4

my_positive_acf

0.4

my_positive_acf

0.2

0.2

0.0

0.0

0

50

100

150

Time difference in hours
(a) One week of lagged counts

0

100

200

300

400

500

600

Time difference in hours
(b) Four weeks of lagged counts

Figure 8: The observed positive part of the ACF (grey) and the estimated weight function (orange) considering lagged counts for (a) one week and (b) four weeks.

4.2 The spatial component
As introduced in Section 3.2, the spatial component was estimated combining a network-readapted Gaussian smoothing kernel with a weight function that measures the predictive importance of each EMS intervention. The weights are used to mimic the interactions between two ambulance dispatches separated by l temporal lags, replicating the hourly, daily, and weekly seasonalities in the ACF, displayed in Figure 4.

4.2.1 Estimating the weight function

As reported in Equation (5), the weight function depends on four parameters that represent the

three seasonal components plus a discount factor. They were estimated solving the minimisation

problem detailed in Equation (6). We found 1 as big as 0.219, pointing out a mildly strong

short-term correlation in the EMS counts. The second seasonal parameter, i.e. 3, was found

equal to 0.002, which means that the effects related to the daily component range between 0.002

and

1.

Given

the

periodic

behaviour

of

sin

function,

the

maximum

value

of

sin2
^3

(

l 24

)

is

obtained

when the lag l is approximately a multiple of 24, while the minimum is reached when the time

difference is close to 12 or its multiples. The value of ^4 was found equal to 0.737, pointing out that the weekly effects are smoother and oscillate between 0.744 and 1. Finally, the fitted values

of 0 and 2, i.e. the two discount factors, were found equal to 0.743 and 0.9999, respectively, meaning that daily and weekly seasonalities vanish slowly.

We display in Figure 8 a graphical comparison between the observed positive part of the

hourly ACF and the estimates of the weight function. Figure 8a shows one week of lagged

counts, while Figure 8b shows the complete set of lags up to four weeks. In both cases, the

weight function successfully fits the ACF.

4.2.2 Spatial and spatio-temporal component
After estimating the weight function, we applied Equation (3) to obtain the predicted spatial density g^u(s) for a time period u. In particular, considering that the data at hand included the EMS interventions from 2015-01-01 at 00:00 to 2017-12-31 at 23:59, we decided to forecast g^u(s) considering two randomly selected future time periods: 2018-01-03 at 03:00 and 2018-01-03 at

12

0.0000005 0.000001 0.0000015 0.000002 0.0000005 0.000001 0.0000015 0.000002

(a) 2018-01-01 03:00

(b) 2018-01-01 15:00

Figure 9: Estimates of spatial intensity function g^u(s) considering two future time periods: 2018-01-03 at 03:00 (a) and 2018-01-03 at 15:00 (b).

15:00. The first one falls at night, while the other one falls in the first hours of the afternoon. In both cases, the value of the bandwidth h was chosen using a rule of thumb suggested in Rakshit, Davies, et al. (2019, Section 8).
The results are reported in Figure 9. Figure 9a shows that during the night the EMS interventions are spread in several parts of the municipality and highlights some roads of the network nearby nightlife areas. Figure 9b underlines that ambulance dispatches are concentrated in the areas close to Duomo and other relevant working places during daytime, whereas nightlife areas are no longer highlighted by the model. In both cases, the main train station (Stazione Centrale), a popular square (Piazzale Corvetto), and several retirement houses (such as Pio Albergo Trivulzio) are pointed out.
The values of g^u(s) displayed in Figure 9 represent only the spatial dimension of the data. Hence, to compare and visualise the spatio-temporal evolution of u(s), we estimated the expected number of interventions at time u and calculated u(s) by multiplying the spatial and the temporal components. The result are reported in Figure 10. Although the two maps highlight areas similar to those displayed in Figure 9, they now account for the temporal patterns of EMS interventions. In particular, considering that the majority of ambulance dispatches occur between 8AM and 6PM, the intensity function at 15:00 was found higher than in the other scenario.
5 Spatial validation
Section 4 presents the results obtained when fitting the spatial and temporal components of t(s) and omits any consideration on the spatial predictive accuracy. Nevertheless, as mentioned in the Introduction, the algorithms used to minimise the ambulance response times require a model that can produce reliable forecasts of the spatial distribution of the EMS events at the road network level. In this section, we discuss the procedure adopted to validate our proposal.
The predictive accuracy of g^t(s) was inspected graphically comparing observed and predicted EMS interventions at different levels of temporal aggregation via a network-readaptation of the relative-risk function (McSwiggan, Baddeley, and Nair 2020). More precisely, given two network point patterns A and B and a location s  L, the (normalised) relative-risk function (also named

13

0 0.00001 0.00002 0.00003 0.00004 0.00005 0 0.00001 0.00002 0.00003 0.00004 0.00005

(a) 2018-01-01 03:00

(b) 2018-01-01 15:00

Figure 10: Estimates of the intensity function u(s) considering two future time periods: 201801-03 at 03:00 (a) and 2018-01-03 at 15:00 (b). The two maps highlight the temporal patterns in spatial locations of emergency interventions.

probability distribution of one type, see Baddeley, Rubak, and Turner (2015, Chapter 14)) can

be written as

(s) =

gA(s) ,

gA(s) + gB(s)

where gA(s) and gB(s) denote the spatial densities of A and B, respectively.

estimator of (s) is given by

^(s) =

g^A(s) ,

g^A(s) + g^B(s)

The plug-in (7)

where g^A(s) and g^B(s) are kernel estimates of gA(s) and gB(s), respectively. The value of ^(s) represents the probability that a point s  L belongs to A instead of B. We refer to McSwiggan, Baddeley, and Nair (2020) for more details and extensive theoretical and computational considerations.
As mentioned before, the forecasting accuracy of g^t(s) was tested by means of the relativerisk function ^(s) comparing observed points and (out of sample) predictions. More precisely, we first selected the EMS interventions that occurred before the end of September 2017 and trained the weight function to estimate 0, . . . , 4. Then, we derived the spatial KDE for each hour of a given (out-of-sample) time period U, and, finally, we obtained an out-of-sample prediction of the emergency events sampling from g^u(s), u  U. Considering the temporal evolution of the weights, we sampled yu points independently for each u  U and aggregated the predictions over U. The pseudo-code that summarises this procedure is reported in Algorithm 1.
Below we test the spatial accuracy considering four days placed farther and farther in time from the end of the training period, namely 2017-10-01, 2017-10-08, 2017-10-15, and 2017-10-22. We decided to focus on several days spread over a month next to the end of the training set since that represents a realistic scenario to organise the ambulance shifts.
At the end, after simulating the ambulance interventions for each time period and extracting the corresponding observed EMS events, the relative risk function was computed as in (McSwiggan, Baddeley, and Nair 2020). The same bandwidth h was used when applying Equation (3) to the two types of points and its value was estimated using a readaptation of Scott's rule of thumb for one-dimensional coordinates data, as suggested in (McSwiggan, Baddeley, and Nair 2020, pp. 5). We did not explore the other techniques for bandwidth selection due to their prohibitive

14

Algorithm 1: Pseudo code describing the procedure used to simulate future events.

Input: Ambulance interventions data, denoted by ems_data, and a future time period

U. Output: An estimate of the normalised relative risk function.

/* 1. subset EMS data that occurred before 2017-10-01 at 00:00.

*/

ems_train  subset(ems_data, DateTime < 2017-10-01 00:00);

/* 2. estimate 0, . . . , 4 using the methods described in Section 3.2.1 */ {^0, . . . , ^4}  estimate_weight_coefs(ems_train); for u  U do

/* 3. Estimate the weights w(t, u) given the coefficients ^0, . . . , ^4.

See Equation (5).

*/

w  estimate_weights(u, ^0, . . . , ^4);

/* 4. Estimate g^u(s) using Equation (3).

*/

g^u  estimate_KDE(ems_train, w);

/* 5. Simulate yu events from a probability density function on a

linear network equal to gu

*/

pred_events_u  simulate_points(g^u, yu)

end

/* 6. Aggregate the predicted events and extract the corresponding

observed events

*/

pred_events  aggregate(pred_events_u) for u  U;

obs_events  subset(ems_data) for DateT ime  U;

events  list(pred_events, obs_events);

computational costs when applied to large road networks and time-consuming out-of-sample simulations.
The relative risk functions ^(s) for the four days are depicted in Figure 11. Following the notation as in Equation (7), the object A denotes the observed EMS events, while B represents the predicted points. A spatio-temporal EMS model successfully predicts the future emergency events when ^(s) is close to 0.5 since that implies the relative risk function cannot distinguish between observed and predicted cases. Figure 11 shows that the relative risk function is always concentrated around 0.5, but for a few parts in the suburb areas. In all cases, the value of ^(s) lies between 0.4 and 0.6 for approximately 80% of all road segments.
To conclude, given the intrinsic randomness of the simulations, we repeated the procedure listed in Algorithm 1 twenty times obtaining, for each pixel composing the road network, several estimates of the relative risk function. The smoothed curves displayed in Figure 12 represent the distribution of ^(s) for each time period and for each simulation. In all cases, these curves are concentrated around 0.5.
The supplementary material reports the results obtained when testing the spatial accuracy for distinct time periods and different training sets. In particular, the procedure detailed above was replicated considering two alternative time intervals of six and twelve hours, respectively. Moreover, we tested the sensitivity of our results shifting the training and test sets ahead of one and two months, respectively. We found that, in all scenarios, the suggested approach successfully predicts the future events.

15

Oct. 1st 00:00-24:00

Oct. 8th 00:00-24:00

0.8

0.6

Oct. 15th 00:00-24:00

Oct. 22nd 00:00-24:00

0.4

0.2

Figure 11: Spatial representations of the (normalised) relative risk function considering four different days.
6 Conclusions
In this paper, we investigated the spatio-temporal distribution of 484053 ambulance interventions that occurred in the city of Milan from 2015-01-01 to 2017-21-31. Unlike several previous approaches, we assumed that the emergency events represent a realisation of a spatio-temporal point process occurring on a road network, i.e. a geolocated graph structure representing road segments and street junctions.
A preliminary exploratory analysis, summarised in Section 2, revealed that the temporal evolution of the events presents several types of seasonalities, due to hourly, daily and weekly patterns. We also observed the presence of space-time interactions in the hourly distribution of the events, and this suggested the adoption of a non-separable statistical model. More precisely, after dividing the interventions into one-hour intervals, we assumed, for each time period, that the ambulance dispatches represented a realisation of a NHPP on a linear network with a non-separable first-order intensity function. The temporal component was modelled via a semiparametric Poisson regression with deterministic temporal covariates. Considering the results of the exploratory analysis, the hourly and weekly trends were smoothed using cyclic cubic regression splines, whereas the daily effects are included using dummy variables. The spatio-temporal component was estimated by a network readaptation of a Jones-Diggle corrected weighted kernel
16

Oct. 1st 00:00-24:00
10.0 7.5 5.0 2.5

Oct. 8th 00:00-24:00
7.5 5.0 2.5

0.0

0.0

0.00

0.25

0.50

0.75

1.00

0.00

0.25

0.50

0.75

1.00

Oct. 15th 00:00-24:00

Oct. 22th 00:00-24:00

7.5

7.5

5.0

5.0

2.5

2.5

0.0

0.0

0.00

0.25

0.50

0.75

1.00

0.00

0.25

0.50

0.75

1.00

Figure 12: Density curves representing twenty simulations of the (normalised) relative risk function considering four days.

density estimator. The weights, which induce the non-separability into the spatio-temporal intensity, were used to model the space-time interactions of EMS data, trying to grasp the temporal regularities in the emergency interventions.
We found that the temporal Poisson model fits the EMS counts well and the deterministic temporal components successfully approximate the hourly, daily, and weekly patterns. Moreover, the weight function adequately mirrors the temporal seasonalities displayed by the ACF of EMS counts. The spatial and spatio-temporal dynamics were exemplified considering two future time periods: 2018-01-03 at 03:00 and 2018-01-03 at 15:00. Our results highlight that ambulance interventions are more spread in the municipality during the night, whereas they cluster in the city centre during the working hours. In both cases, the main train station, a few popular squares, and a retirement house stand out. The graphical representations of the spatio-temporal intensity functions showed the importance of the weight function for a proper estimation of ambulance interventions dynamics.
The predictive accuracy of our proposal was tested by means of the relative risk function. We compared observed and predicted ambulance interventions for four different days, and, in all cases, the relative risk is concentrated around 0.5, implying that the model successfully predicts the future events. Further analysis are summarised in the supplementary material.
We finally remark that the main challenges in this paper stem from the spatio-temporal nature of the considered dataset and the specific spatial support. First, the exploratory analysis suggested an interaction in the spatial and temporal dynamics, requiring a non-separable structure when modelling the ambulance intervention process. Second, the spatial nature of the data also suggested that linear networks are the most appropriate spatial domain for modelling EMS data. Third, the geographic region represents a large metropolitan area and the huge number

17

of interventions required the adoption of fast statistical techniques. This may also implies that the spatial and temporal variability can be impacted by secondary variables at the areal level (e.g. population density) and at the network level (e.g. road types, traffic flows, commuting patterns or other variables representing specific anthropic activities at a given point of the network). In future work, it might be desirable to develop parametric models that allow the introduction of such explanatory spatial covariates in the intensity function.
A further idea is to move towards models that account for data clustering following different routes, for instance a double stochastic process, such as the Cox process, where a stochastic component is included in the intensity function to deal with the unexplained space-time variation. A natural solution in this case would be to adopt an inhomogeneous log-Gaussian Cox processes (Møller, Syversveen, and Waagepetersen 1998), already proposed for modelling ambulance interventions by Bayisa et al. (2020). However, moving to the latter approach requires a substantial amount of methodological development since defining a proper covariance function for the stochastic component of the intensity function on a linear network spatial support is not straightforward.
Acknowledgements
Map data copyrighted OpenStreetMap contributors and available from https://www.openstreetmap. org. We greatly acknowledge Doct. Andrea Pagliosa and Doct. Rodolfo Bonora, the regional experts of ambulance interventions working for the local EMS named AREU (Azienda Regionale Emergenza Urgenza). They provided the EMS data used in the paper and valuable assistance in defining and understanding properly the motivating problem and the dataset's peculiarities. We also greatly acknowledge the DEMS Data Science Lab for supporting this work by providing computational resources. J. Mateu is partially supported by grant PID2019-107392RB-I00 from the Spanish Ministry of Science.
References
[1] Qi Wei Ang, Adrian Baddeley, and Gopalan Nair. "Geometrically corrected second order analysis of events on a linear network, with applications to ecology and criminology". In: Scandinavian Journal of Statistics 39.4 (2012), pp. 591­617.
[2] Adrian Baddeley, Gopalan Nair, et al. "Analysing point patterns on networks--A review". In: Spatial Statistics (2020), p. 100435.
[3] Adrian Baddeley, Ege Rubak, and Rolf Turner. Spatial point patterns: methodology and applications with R. CRC press, 2015.
[4] Christopher Barrington-Leigh and Adam Millard-Ball. "The world's user-generated road map is more than 80% complete". In: PloS one 12.8 (2017), e0180698.
[5] Marc Barthélemy. "Spatial networks". In: Physics Reports 499.1-3 (2011), pp. 1­101. [6] Fekadu L Bayisa et al. "Large-scale modelling and forecasting of ambulance calls in northern
Sweden using spatio-temporal log-Gaussian Cox processes". In: Spatial Statistics 39 (2020), p. 100471. [7] Thomas H Blackwell and Jay S Kaufman. "Response time effectiveness: comparison of response time and survival in an urban emergency medical services system". In: Academic Emergency Medicine 9.4 (2002), pp. 288­295.
18

[8] Richard H Byrd et al. "A limited memory algorithm for bound constrained optimization". In: SIAM Journal on scientific computing 16.5 (1995), pp. 1190­1208.
[9] Peter Diggle, Barry Rowlingson, and Ting-li Su. "Point process methodology for on-line spatio-temporal disease surveillance". In: Environmetrics: The official journal of the International Environmetrics Society 16.5 (2005), pp. 423­434.
[10] Peter J Diggle. Statistical analysis of spatial and spatio-temporal point patterns. CRC press, 2013.
[11] Andrea Gilardi and Robin Lovelace. osmextract: Download and Read OpenStreetMap Data Extracts. https://docs.ropensci.org/osmextract/ (website) https://github.com/ropensci/osmextract. 2021.
[12] Shane G Henderson. "Operations research tools for addressing current challenges in emergency medical services". In: Wiley Encyclopedia of Operations Research and Management Science (2010).
[13] M Chris Jones. "Simple boundary correction for kernel density estimation". In: Statistics and computing 3.3 (1993), pp. 135­146.
[14] Yongmei Lu and Xuwei Chen. "On the false alarm of planar K-function when analyzing urban crime distributed along streets". In: Social science research 36.2 (2007), pp. 611­632.
[15] Greg McSwiggan, Adrian Baddeley, and Gopalan Nair. "Estimation of relative risk for events on a linear network". In: Statistics and Computing 30.2 (2020), pp. 469­484.
[16] Jesper Møller, Anne Randi Syversveen, and Rasmus Plenge Waagepetersen. "Log gaussian cox processes". In: Scandinavian journal of statistics 25.3 (1998), pp. 451­482.
[17] Jesper Moller and Rasmus Plenge Waagepetersen. Statistical inference and simulation for spatial point processes. CRC Press, 2003.
[18] Atsuyuki Okabe and Kokichi Sugihara. Spatial analysis along networks: statistical and computational methods. John Wiley & Sons, 2012.
[19] R Core Team. R: A Language and Environment for Statistical Computing. R Foundation for Statistical Computing. Vienna, Austria, 2020. url: https://www.R-project.org/.
[20] Suman Rakshit, Adrian Baddeley, and Gopalan Nair. "Efficient Code for Second Order Analysis of Events on a Linear Network". In: Journal of Statistical Software 90.1 (2019), pp. 1­37.
[21] Suman Rakshit, Tilman Davies, et al. "Fast Kernel Smoothing of Point Patterns on a Large Network using Two-dimensional Convolution". In: International Statistical Review 87.3 (2019), pp. 531­556.
[22] S. N. Wood. "Fast stable restricted maximum likelihood and marginal likelihood estimation of semiparametric generalized linear models". In: Journal of the Royal Statistical Society (B) 73.1 (2011), pp. 3­36.
[23] S.N Wood. Generalized Additive Models: An Introduction with R. 2nd ed. Chapman and Hall/CRC, 2017.
[24] Ikuho Yamada and Jean-Claude Thill. "Comparison of planar and network K-functions in traffic accident analysis". In: Journal of Transport Geography 12.2 (2004), pp. 149­158.
[25] Zhengyi Zhou. "Predicting ambulance demand: Challenges and methods". In: arXiv preprint arXiv:1606.05363 (2016).
19

[26] Zhengyi Zhou, David S Matteson, et al. "A spatio-temporal point process model for ambulance demand". In: Journal of the American Statistical Association 110.509 (2015), pp. 6­ 15.
[27] Zhengyi Zhou and David S. Matteson. "Predicting Ambulance Demand: A Spatio-Temporal Kernel Approach". In: Proceedings of the 21th ACM SIGKDD International Conference on Knowledge Discovery and Data Mining. KDD '15. Sydney, NSW, Australia: Association for Computing Machinery, 2015, pp. 2297­2303. isbn: 9781450336642.
20

