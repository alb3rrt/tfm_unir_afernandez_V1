arXiv:2106.00888v1 [stat.AP] 2 Jun 2021

Quantifying out-of-station waiting time in oversaturated urban metro systems
Kangli Zhua,b,, Zhanhong Chengb,, Jianjun Wua, Fuya Yuana, Lijun Sunb,
aState Key Laboratory of Rail Traffic Control and Safety, Beijing Jiaotong University, Beijing, 100044, China bDepartment of Civil Engineering, McGill University, Montreal, Quebec H3A 0C3, Canada
Abstract
Metro systems in megacities such as Beijing, Shenzhen and Guangzhou are under great passenger demand pressure. During peak hours, it is common to see oversaturated conditions (i.e., passenger demand exceeds network capacity), which bring significant operational risks and safety issues. A popular control intervention is to restrict the entering rate during peak hours by setting up out-of-station queueing with crowd control barriers. The out-of-station waiting can make up a substantial proportion of total travel time but is not well-studied in the literature. Accurate quantification of out-of-station waiting time is important to evaluating the social benefit and cost of service scheduling/optimization plans; however, out-of-station waiting time is difficult to estimate because it is not a part of smart card transactions. In this study, we propose an innovative method to estimate the out-of-station waiting time by leveraging the information from a small group of transfer passengers--those who transfer from nearby bus routes to the metro station. Based on the estimated transfer time for this small group, we first infer the outof-station waiting time for all passengers by developing a Gaussian Process regression with a Student-t likelihood and then use the estimated out-of-station waiting time to build queueing diagrams. We apply our method to the Tiantongyuan North station of Beijing metro as a case study; our results show that the maximum out-of-station waiting time can reach 15 minutes, and the maximum queue length can be over 3000 passengers. Our results suggest that out-of-station waiting can cause significant travel costs and thus should be considered in analyzing transit performance, mode choice, and social benefits. To the best of our knowledge, this paper is the first quantitative study for out-of-station waiting time.
Keywords: Metro waiting time, Smart card data, Public transport, Crowd management, Gaussian processes
1. Introduction
As the backbone of transportation systems in megacities, metro systems play a critical role in meeting the increasing demand of urban mobility. For example, the Beijing metro--a network consists of 22 lines and 391 stations--has an average daily ridership of more than 10 million by the end of 2019 (Wikipedia contributors, 2019a). To better satisfy the massive passenger demand, numerous measures have been taken to maximize the operational capacity, such as reducing peak-hour headway, increasing train speed, and removing seats for more standing space. In addition to these engineering practices, recent research also shows increasing interest in developing optimization strategies for the operation of large-scale metro systems, such as designing better timetables and schedules (Niu and Zhou, 2013; Sun et al., 2014; Yin et al., 2016), synchronizing different lines to reduce transfer time (Kang et al., 2015), and integrating the metro network with the bus network to minimize the impact of service disruptions (Jin et al., 2014, 2015).
Contributed equally. Corresponding author.
Email addresses: zhukangli@bjtu.edu.cn (Kangli Zhu), zhanhong.cheng@mail.mcgill.ca (Zhanhong Cheng), jjwu1@bjtu.edu.cn (Jianjun Wu), 16114200@bjtu.edu.cn (Fuya Yuan), lijun.sun@mcgill.ca (Lijun Sun)

Despite the tremendous efforts in increasing operational capacity, some metro systems are still operated in an oversaturated condition (Shi et al., 2019), which is purely due to the fact that even the optimized capacity cannot satisfy the burst of passenger demand. As a result, it is common to see overcrowded platforms with left-behind passengers who have to wait for more than one train to get on board during peak hours (Zhu et al., 2018). In these extreme scenarios, safety measures need to be taken to prevent overcrowdedness on the platform and operational risks and ensure the smooth operation of the system (Xu et al., 2019). A common flow-control measure is out-of-station queueing--passengers are compelled to queue outside of a metro station before entering the metro station. It is reported that the out-of-station waiting time of a few metro stations in Beijing, Guangzhou, and Shenzhen can be up to more than ten minutes at peak hours (Lin, 2021; Li, 2015).
Quantifying passenger waiting time in metro systems is crucial for evaluating service quality/performance and understanding passengers' choice behavior. In terms of the economic evaluation of public transport services, waiting time is also a critical component in assessing the social benefit/cost of different planning and operation strategies. In the literature, many methods have been developed to estimate the in-station waiting time or transfer time of metro systems using individual-based smart card transactions (Sun et al., 2012; Sun and Xu, 2012; Sun et al., 2015b; Zhu et al., 2018; Qu et al., 2020). However, despite that out-of-station waiting may cover a substantial proportion of overall travel time and the experience is much more unpleasant than waiting inside the train station (e.g., under bad weather (Zhang et al., 2021)), it has received little attention in the research. This is primarily due to that out-of-station waiting time cannot be inferred directly from smart card transactions, since out-of-station waiting happens before a passenger taps into a metro station. Although one can conduct field surveys to measure out-of-station waiting, the survey approach is very time-consuming and it cannot collect data continuously for long-term monitoring.
The goal of this research is to develop a data-driven method for quantifying out-of-station waiting time using smart card data. To address the aforementioned challenges, we propose an accessible and accurate method by combining the smart card data from both bus and metro systems. Our key idea is to consider those passengers who transferred from a nearby bus stop to the metro station as a proxy, whose transfer time can be estimated as the time interval from the first tapping-out on the bus to the next tapping-in at the metro station. In detail, we first identify these transfer passengers using multi-source data. Next, the time interval between the bus tap-out and the metro tap-in is used to estimate the out-of-station queueing time. To handle the noise in the data and to extend the estimation to all passengers, we assume the latent true out-of-station waiting time is a continuous function of time and estimate it with a Gaussian Process regression with a Student-t likelihood. Moreover, the estimated out-of-station waiting time is used to build queueing diagrams for further analysis. We present a case study for the Tiantongyuan North station of Beijing metro. We find the maximum out-of-station waiting time is around 15 minutes, and the maximum queue length can reach 3000 passengers.
To the best of our knowledge, this is the first quantitative study for out-of-station waiting time estimation. The contribution of this paper is three-fold. First, we propose an innovative approach that uses multi-source data and Gaussian Process regression to estimate the metro out-of-station waiting time. Our method is well-founded and can be used for long-term monitoring. Second, we show by real-world data that the out-of-station waiting is a non-negligible part of the total travel time for over-saturated metro stations; more attention should be paid on this underestimated phenomenon.
The rest of the paper is organized as follows. Section 2 reviews relevant works and presents the research gap. Section 3 introduces the background and the problem. Section 4 presents the modeling framework of out-of-station waiting time estimation. In Section 5, we present a case study of the Tiantongyuan metro stations in Beijing. Next, we discuss potential solutions for the out-of-station waiting in Section 6. Finally, Section 7 summarizes the paper and provides future research directions.
2. Literature review
Most modern metro systems adopt a fare gantry-based smart card system, which generates a continuous flow of transactions registering when and where passengers start their trips (Pelletier et al., 2011). Given
2

the rich information collected, smart card data has been widely used in understanding individual travel behavior and enhancing the planning and operation of metro systems (e.g., Niu and Zhou, 2013; Sun et al., 2014; Jin et al., 2014; Kang et al., 2015; Jin et al., 2015; Yin et al., 2016). In the following, we review the application of smart card data in estimating waiting time and inferring route choices in metro systems.
The waiting time of a metro system is a crucial indicator for transit service quality, and it is also a key determinant for passenger route choice behavior (Wardman, 2004). Many methods have been developed to estimating waiting times from smart card data. Typically, these methods decompose the time interval between tapping-in (at origin) and tapping-out (at destination) into waiting time, onboard time, and transfer time using certain regression techniques and side information (e.g., timetables of trains). In the meanwhile, these methods usually also output the route choice of each trip. For example, Kusakabe et al. (2010) combined smart card data with train timetables to estimate which train is boarded by each individual traveler. Sun et al. (2012) proposed a linear regression model to decompose travel time and applied this model to estimate the spatiotemporal loading profile of trains. Sun and Xu (2012) used smart card data to study travel time reliability and proposed a probabilistic mixture model to infer passenger route choice. Sun et al. (2015b) developed a probabilistic generative model of trip time observations characterizing both the randomness of link travel time and route choice behavior. This model can be used as a passenger flow assignment framework for service planning and operation. Zhao et al. (2016) proposed a probabilistic model to assign each passenger to specific trains. Krishnakumari et al. (2020) developed a linear regression method that estimates the delay at each metro station, link, and transfer.
The waiting time and route choice in an oversaturated metro system are more complex. For instance, passengers may travel backward to an uncrowded station to find a seat and then travel forward. Tirachini et al. (2016) investigated this interesting backward traveling phenomenon and estimated the disutility of sitting and standing (and also level of crowdedness) in metro trains. Besides, passengers often have to wait for multiple trains to get on board. Zhu et al. (2018); Ma et al. (2019) developed data-driven methods to estimate the number of left-behind passengers in metro systems. Qu et al. (2020) also studied the waiting time of left-behind passengers; they found passengers' waiting time in peak hours is much longer than the metro headway. Mo et al. (2020) proposed a performance monitoring framework that incorporates the number of left-behind passengers.
The aforementioned studies have proposed various methods to estimate the waiting time, transfer time, or route choice from smart card data. However, as mentioned, all these methods assume that a trip starts when a passenger taps in and finishes when he/she taps out; thus, we can see that out-of-station waiting actually leaves no traces in metro smart card data. As a result, these methods cannot quantify out-ofstation waiting time, which could be a substantial component of total travel time in oversaturated stations with flow-control measures. In this paper, we combine the smart card data from bus and metro systems to infer the out-of-station waiting time in the metro system. This study is closely related to the work of Sun et al. (2015a), which models passenger transfer time using smart card transactions from both bus and metro services.
3. Background
Beijing Metro is one of the busiest metro systems in the world. During rush hours, the ridership at a few stations is extremely high that passengers have to queue for quite a long time outside the station before entering the metro station (see Fig. 1). For example, the Tiantongyuan area of Beijing is one of the largest residential hubs in China; it has a total population of 700,000 in 2019 (Wikipedia contributors, 2019b). There are three metro stations, Tiantongyuan North (TTY-N), Tiantongyuan (TTY), and Tiantongyuan South (TTY-S), in this area. Due to the large number of commuting passengers, all three stations are oversaturated during morning peak hours on weekdays. In this paper, we use the TTY-N station as an example to demonstrate our proposed solution to quantify out-of-station waiting time. The location of the TTY-N station is shown in Fig. 2. Because the TTY-N station is the northern terminus of Metro Line 5, the boarding rate in the morning peak is controlled to alleviate the overcrowdedness on the platform
3

and to prevent the service at downstream stations be overwhelmed; this is also one of the reasons for the out-of-station queueing. Without this flow-control intervention, the trains will be fully loaded at departure, leaving no capacity for passengers waiting at the subsequent/downstream stations.

Figure 1: The queue outside the Tiantongyuan metro station. Photo taken at 8:14 on Thursday, October 31, 2019.

D

E

720HWUR6WDWLRQ

)520%XV6WRS
Figure 2: The location of the Tiantongyuan North metro station and a nearby bus stop.
The public transit system in Beijing uses a distance-based fare scheme. Therefore, passengers need to tap their smart cards or tickets when getting on and off a bus and when entering and leaving a metro station. Useful information in smart card data includes anonymous IDs, origin/destination, and timestamps of tapping-in/-out. For bus trips, the transactions also record the ID of the bus. Note that user IDs are consistent in both metro and bus systems, so that we can link trips from both systems for a particular user. Next we show how to estimate the out-of-station waiting time by combining the smart card data from both bus and metro systems.
As illustrated in Fig. 3, we separate all the incoming passengers at a metro station into two groups: (G1) direct passengers who do not have a previous bus transfer and (G2) transfer passengers that coming
4

from a nearby bus stop. For a direct passenger i, we only know the tap-in time tin,i at the metro fare gantry, but we have no information about the out-of-station queueing. For a transfer passenger i, we can know the metro tap-in time tin,i, the bus tap-out time tout,i, and the transfer duration dtransfer,i = tin,i - tout,i (we use t for a timestamp and d for a time duration/interval). In addition, we can estimate the out-of-station waiting duration for a passenger in G2 by subtracting the walking time dwalk,i between the bus stop and the metro station from the transfer duration.

Bus 07:23:18
07:23:15 07:23:14

07:10:23

07:10:17 07:22:10 07:22:12
07:22:14 07:22:18 07:22:22
Metro fare gantry

G1: without a bus tap-out G2: with a bus tap-out Red left: bus tap-out time Blue right: metro tap-in time

07:15:54

07:10:35 07:10:40

07:14:28

... Queue ...

Figure 3: An illustration of out-of-station queueing of a metro station. G1 means direct passengers without a previous bus trip. G2 represents transfer passengers coming from a previous bus trip. Red numbers to the left side give the bus tap-out time tout, and blue numbers to the right side give the tap-in time tin of the metro station. We estimate the out-of-station queueing time for both G1 and G2 based on the tin and tout of G2.
Typically, G2 only accounts for a small percentage of the total boarding passengers. Therefore, we regard G2 as a small sample set drawn from total passengers and use it to estimate the out-of-station waiting profile for all boarding passengers. In doing so, we need to (1) accurately estimate the out-ofstation waiting time for all boarding passengers and (2) develop a method to analyze queueing profile. We introduce the methodologies for these tasks in Section 4.
4. Modeling framework
This section elaborates the methods for profiling the out-of-station waiting time using smart card data. First, in Section 4.1, we illustrate the impact of noise in the data and propose a Gaussian Process regression for the out-of-station waiting time estimation. Then, in Section 4.2, we introduce the idea of using a queueing diagram to analyze the out-of-station waiting.
4.1. Gaussian Process for waiting time estimation The out-of-station waiting time of a passenger i in G2 can be roughly estimated by dtransfer,i - dwalk,i,
and we refer it as the observed waiting time for simplicity. Fig. 4 shows the observed waiting time at different metro tap-in times, where we regard the walking time dwalk as a constant and determine it by the median value of all dtransfer during 12:00-4:00 pm (assuming no out-of-station waiting at off-peak hours). We can see the observed waiting time is much higher in the morning peak. However, there is substantial noise in the observed waiting time. Even in a short period of time, there are significant discrepancies between different observations. Sources of noise include different walking speeds, unsynchronized clocks between smart card readers, intermediate activities, and some passengers may "tap-out" before the bus arrives at the bus stop to speed up the alighting. Because of the noise, a well-founded method is required for out-of-station waiting time estimation.
We use a Gaussian Process (GP) regression (Williams and Rasmussen, 2006) to estimate the out-ofstation waiting time. A GP is a non-parametric Bayesian model that defines a distribution over functions.
5

30

Observed waiting time (min)

20

10

0 6:00

8:00

10:00

12:00

14:00

16:00

18:00

20:00

Metro tap-in time (tin)

Figure 4: The observed out-of-station waiting time (i.e., dtransfer - dwalk) at different metro tap-in times in a workday.

Gaussian processes are very flexible and can approximate complex functions using various kinds of kernels and likelihoods. Most importantly, a GP is a probabilistic approach that also gives confidence intervals for the estimated values. We refer readers to Williams and Rasmussen (2006) for more information about Gaussian Processes.
Let y (t) be the observed waiting time for a passenger with metro tap-in time t. For ease of description, the time t in here and after means the metro tap-in time if not otherwise specified. The observed waiting time can be decomposed into a latent "true" waiting time f (t) and a noise term :

y (t) = f (t) + .

(1)

We assume the "true" out-of-station waiting time f (t) is a continuous function of time. We need to infer the latent "true" waiting time given the observed waiting time. In doing so, we impose a GP prior to f (t), meaning the function's values f (t) = [f (t1) , f (t2) , · · · , f (tn)] for any finite collection of inputs t = [t1, t2, · · · , tn] have a joint multivariate Gaussian distribution. We will write

f (t)  GP µ (t) , k t, t ,

(2)

where µ (t) is the mean function and k (t, t ) is the covariance/kernel function. By convention, the mean

function is set to zero, i.e., µ (t) = 0. For the covariance function, we choose the commonly used squared-

exponential kernel

k t, t | , 2 = 2 exp

(t - t )2 - 22

,

(3)

where the length scale and the variance 2 are two hyperparameters that should be calibrated by data. The covariance in Eq. (3) is larger for two closer t and t , indicating passengers that enter the metro station at a closer time are more likely to have more similar waiting time. We can see a GP is fully specified by the mean and covariance functions and does not impose any assumption on the form of the function f (t).
When using an i.i.d. Gaussian distribution for the noise term , the posterior of the latent variable f (t) can be solved analytically. However, this convenient approach is very sensitive to outliers and is not appropriate for our data. To make a robust estimation for the "true" waiting time, we assume the noise is a zero-mean i.i.d. Student-t distribution with a long-tail probability density function (Jyl¨anki et al., 2011):

p (

|

, )

=





 2

+1
2 

2 1 + 2

-



+1 2

,

(4)

where  is the degrees of freedom and  the scale parameter (Gelman et al., 2013).
Eq. (1)­(4) describe the GP regression with a Student-t likelihood. Given a set of observed waiting times y at metro tap-in time t, the four hyperparameters  = { , 2, , } can be optimized by maximizing

6

the log marginal likelihood

log p(y|t, ) = log p(y | f )p(f | t, )df .

(5)

The log marginal likelihood cannot be explicitly obtained when the noise is a Student-t distribution. Therefore, approximate inference methods (Neal, 1997; Vanhatalo et al., 2009; Jyl¨anki et al., 2011) were developed to fit hyperparameters. We use the Laplace appropriation (Vanhatalo et al., 2009) as implemented in GPy (GPy, since 2012) for the appropriate inference. Next, for new passengers with metro tap-in times t, we can calculate the posterior distribution p (f | y, t, t) of their "true" out-of-station waiting time. The posterior distribution is a Gaussian but is also approximately solved (Jyl¨anki et al., 2011). We use the posterior mean as a point estimation f^(t) for the out-of-station waiting time, referred to as the estimated waiting time in the following.

4.2. Queueing diagram
The out-of-station waiting phenomenon at a metro station is a queueing process with varying arrival rate and service rate. To better analyze the reason and the impact of the out-of-station queue, we further establish a queueing diagram based on the estimated waiting time, as illustrated in the virtual example of Fig. 5.

(a)

== =

(b)

Estimated waiting time (min)

Metro tap-in time
Figure 5: Establishing a queueing diagram by the estimated out-of-station waiting time ­ a virtual example. (a) The queueing diagram. (b) The estimated out-of-station waiting time (only shows 10% of passengers for clarity).
We used the virtual example in Fig. 5 to illustrate how to establish a queueing diagram from the estimated out-of-station waiting time. Fig. 5 (a) shows the queueing diagram, where the departure curve indicates the service rate at the metro gantries. Because the smart card data in Beijing contain passengers' tap-in times, the departure curve is directly reconstructed from passengers' metro tap-in records. The passenger arrival curve is not directly available from the data but can be inferred from the metro tap-in time and the out-of-station waiting duration. For example, the point B in Fig. 5 represents a passenger that tapped in the metro station at tB; we can estimate his/her out-of-station waiting duration f^(tB) by the GP model described in Section 4.1, as shown in Fig. 5 (b). The segment |AB| in the queueing diagram means the out-of-station waiting duration, we can thus calculate the arrival time for this passenger (point
7

A) by tB - f^(tB). The arrival curve can thus be obtained by connecting the estimated arrival times of all passengers. Note we use the estimated waiting time instead of the observed waiting time for both G1 and G2 to avoid the impact of noise in the data.
The queueing diagram provides important information much more than just a visualization. For example, the slope of the departure curve represents the service rate at the metro entrance, the slope of the arrival curve means the arrival rate. The horizontal distance (e.g., |AB|) and vertical distance (e.g., |AC|) between the two curves represent the waiting time and the queueing length, respectively. Moreover, the area between the two curves represents the total waiting time of all passengers. Next, we will build queueing diagrams to analyze the out-of-station queueing at the TTY-N station.

5. Results
In this section, we present the results for the out-of-station queueing at the TTY-N metro station. Firstly, the data and the demand pattern at the TTY-N station are introduced in Section 5.1. Next, Section 5.2 exhibits the out-of-station waiting time estimated by GP regressions. Finally, we analyze the queueing process in the morning peak and discuss possible solutions in Section 5.3.

5.1. Data description
Based on the available data, we select a five-day period from August 3rd to 8th, 2015, to analyze the out-of-station queueing at the TTY-N metro station. This five-day period reflects a typical weekday demand pattern. We have full smart card data for the TTY-N station in this period. The tap-in/out information for all metro passengers, including those who use tickets, is registered in the data. Besides, we also have smart card data from three different bus routes that pass through the TTY-N bus stop (next to the TTY-N subway station). The walking time from the bus stop to the metro station is the same for the three bus routes. The whole analysis is based on the tap-out at the TTY-N bus stop and the tap-in at the TTY-N metro station.

1XPEHURI3DVVHQJHUVSHUKRXU

D ×

E ×

*



*



*






 

               

7DSLQ7LPH

7DSLQ7LPH

Figure 6: The number of boarding passengers per hour at the TTY-N station (Monday, August 3rd, 2015).

If we detect the same smart card ID has an immediate metro trip after a bus trip, and the interval between the bus tap-out and the metro tap-in is within 30 minutes, we regard this ID as a passenger in G2. After separating passengers into G1 and G2, the boarding demand of G1 and G2 at the TTY-N station on a typical weekday is shown in Fig. 6. we can see the TTY-N station services more than ten thousand passengers per hour in the morning peak (7-8 am), and the demand is very low in the afternoon and evening, showing TTY-N is a typical residential-type station. On the other hand, the number of passengers in G2 is much smaller than that in G1. This is because only a small portion of passengers are transferred from the bus stop. We use G2 as a small sample drawn from all passengers to recover the out-of-station waiting profile at the TTY-N station.

8

20 Monday 10
0

GP mean Observed waiting GP conficence

20 Tuesday 10
0

Out-of-station waiting time (min)

20 Wednesday 10
0

20 Thursday 10
0

20 Friday 10
0 6:00

8:00

10:00

12:00

14:00

16:00

18:00

20:00

Metro tap-in time

Figure 7: The observed waiting time, the GP posterior mean, and the 95% confidence interval of the GP posterior mean.

5.2. Estimated out-of-station waiting
Because the TTY-N station has a low boarding demand in off-peak hours, we can safely assume there is no out-of-station waiting at off-peak hours. Therefore, we regard the walking time as a constant and determine it by the median value of all dtransfer during 12:00-4:00 pm. Next, we can calculate the observed waiting time, as shown in the black points in Fig. 7. We can see the noise is very high for the observed waiting time.
Next, we fit a GP for each day. Fig. 7 shows the posterior mean and confidence interval of the estimated out-of-station waiting time. We can see the GP with a Student-t likelihood is robust to the noise, and the estimated waiting time makes intuitive sense. Despite the presence of outliers, the estimated waiting time in general wiggles around zero from 5:00 to 7:00 am and after 9:00 am, which is consistent with the real-life situation. We also see the confidence interval is larger in the period with fewer observations. The estimated waiting time on Friday night is unusually high, this could be caused by too few G2 passengers during that period. We expect the estimated waiting time for morning peaks to be more reliable because of the larger number of observations. All five weekdays have significant out-of-station waiting from around 7:00 to 9:00 am. The maximum waiting time is around 15 minutes for Monday to Thursday, and the waiting time on Friday is relatively shorter. The quantitative results for the waiting time is shown in the Tab. 1.

9

Cumulative passengers

25000 Monday 20000

Tuesday

Wednesday

Thursday

Friday

15000

10000

5000 0
300

Arrival Departure Waiting

200

100

0 7:00 8:00 9:00 7:00 8:00 9:00 7:00 8:00 9:00 7:00 8:00 9:00 7:00 8:00 9:00 Metro tap-in time

Figure 8: The queueing process in the morning peak.

Arrival or service rate (people/min)

5.3. Queueing analysis
This section analyzes the out-of-station waiting by queueing diagrams. We first set negative values in the estimated waiting time to zero. Following the illustration in Fig. 5, we next establish queueing diagrams for the five weekdays, as shown in Fig. 8.
The upper half of Fig. 8 shows the cumulative arrival curve and departure curve at the TTY-N metro station. Note that the "departure" means entering the metro gantry rather than boarding a train. The arrival/service rate at time t is estimated by the average arrival/service rate in [t - 5min, t + 5min], as shown in the lower half of Fig. 8. For all five days, we can see the arrival rates are larger than the service rates from around 7:00 to 7:50 am, and queues are therefore formed. The maximum arrival rate is often more than 300 people/min, while the maximum service rate is only around 200 people/min. The queue lengths start to decrease after around 7:50 am and the queue dissipates at around 9:00 am.
Table 1: Quantifying the out-of-station queueing from 7:00 to 9:00 am.

Monday Tuesday Wednesday Thursday Friday Average

Total number of passengers Maximum waiting time (min) Total waiting time (hour) Average out-of-station waiting time (min) Maximum queue length (people) Maximum arrival rate (people/min) Maximum service rate (people/min) The time with the longest queue

22740 15.1 3665 9.7 3191 295 212 7:48

23193 15.0 2984 7.7 3188 384 220 7:43

22964 15.3 3240 8.5 3251 319 219 7:44

23241 13.5 3006 7.8 2893 302 220 7:52

22524 11.1 2194 5.8 2310 280 215 7:49

22932 14.0 3018 7.9 2967 316 217 7:47

Tab. 1 summarizes major indices for the out-of-station queueing. We can see the out-of-station waiting greatly impact passengers' travel. The maximum arrival rate is 50% larger than the maximum service rate. When the queue has a maximum length, over three thousand passengers are waiting in the queue, and it takes around fifteen minutes for a passenger to enter the station. On average, every passenger waits eight minutes outside of the station in the morning peak. Considering the number of passengers, the total

10

out-of-station waiting time exceeds three thousand hours per day at the TTY-N station; the queueing is a big waste of time and efficiency.
6. Potential solutions for out-of-station queueing
Queueing outside of metro stations has a substantial negative impact on passenger travel experience. In this section, we discuss existing and potential solutions to this problem. The fundamental reason for the out-of-station waiting is the mismatch between demand and supply. The commuting demand is rooted in the urban structure and can hardly be changed. Many traffic congestion problems should be avoided in the initial urban planning stage. However, we can still manage the demand from a temporal aspect (Halvorsen et al., 2019). For example, providing reduced-rate fares to off-peak trips can flatten the peakhour demand (e.g., shift peak-hour trips to pre-peak and after-peak hours). The temporally differentiated fare scheme has been studied in many research (Yang and Tang, 2018; Lu et al., 2020; Li et al., 2018; Adnan et al., 2020). A few real-world practices show that properly designed off-peak discounts can help reduce metro crowding (Halvorsen et al., 2016; Greene-Roesel et al., 2018). Based on the queueing analysis of Section 5.3, a potential solution is to design a fare scheme for the TTY-N metro station to reduce the boarding demand from 7:00 to 8:00 am. Overall, using a temporally differentiated fare scheme is a potential solution, although the effect is hard to evaluate in advance.
Beijing metro has made a lot of efforts from the supply side. In fact, the minimum headway of most metro lines of Beijing has been reduced to less than two minutes to increase network capacity. Moreover, the original TTY-N metro station has been integrated into Tiantongyuan North Transportation Hub since October 13, 2019. The TTY-N Transportation Hub integrates metro line 5, coaches, buses, and a P+R parking lot. There is a large-scale waiting lobby in the hub, and passengers no longer need to queue in the open air, which is helpful under bad weather conditions. New transportation facilities are also under construction or planning. For example, the Beijing metro line 13A, which is expected to complete in 2023 (National Development and Reform Comission, 2019), can significantly relieve the commuting pressure of the Tiantongyuan area.
Reducing perceived waiting time can also improve the level of service. For example, improving the waiting environment by providing shelters (Fan et al., 2016) and improving the thermal environment (Zhang et al., 2021) can significantly reduce the perceived waiting time. Besides, it has been shown that providing real-time information can reduce the anxiety for uncertainty and the perceived waiting time (Watkins et al., 2011; Brakewood et al., 2014). Therefore, providing real-time queueing information has the potential to improve transit services (Brakewood et al., 2015).
Finally, using other transportation modes to share the metro's demand is also a solution. Normally, the bicycle is not an ideal substitution for the metro considering its short travel distance. However, there are always special cases. In 2019, a 6.5 km elevated bicycle-only path was built in Beijing to share the extremely high commuting demand between Huilongguan and Shangdi, where Huilongguan is another high-density residential area suffering from out-of-station queueing. It is reported that cycling between Huilongguan and Shangdi takes around 30 minutes, while it could take more than 40 minutes to commute by metro in the rush hour (China Daily, 2021).
7. Concluding Remarks
This paper proposes a data-driven method to estimate the waiting time outside of an oversaturated metro station due to flow control measures. To the best of our knowledge, this paper presents the first quantitative study to measure passengers' out-of-station waiting time. By combining smart card data from the metro and bus system, we use transfer passengers as a proxy to quantify the queueing time outside of a metro station. A probabilistic approach by Gaussian Process regression is developed to infer the out-of-station waiting time for all passengers. Besides, we propose to analyze the queueing process by a queueing diagram. In the TTY-N metro station case study, results show our method is robust to the
11

noise in data and provides a reliable estimation for out-of-station waiting time. We find the out-of-station waiting can be a big burden--more than 15 minutes waiting time--for passengers in oversaturated metro stations. Our results could help transit agencies better understand service performance. In addition, the accurate estimation of out-of-station waiting can also be used to evaluate user utility and social cost, which could be further used to support decision making, such as design better flow-control strategies.
A limitation of this work is the lack of validation by a field survey. Because we can only access the smart card data of 2015, but the boarding demand at the TTY-N station has drastically changed since the completion of the TTY-N Transportation Hub and the outbreak of COVID-19. Nevertheless, the GP regression produces reasonable confident intervals, and we believe that our estimation should be a solid reference.
There are several directions for future research. First, the performance of metro systems can be reevaluated by taking the out-of-station waiting into account, especially for megacities like Beijing. Our case study shows that passengers at Tiantongyuan North suffer while downstream passengers benefit from the flow-control measures. A critical research question is to balance the trade-off and design optimized flowcontrol strategies based on passenger flow assignment when demand exceeds network capacity. Second, because waiting in an open-air is more vulnerable to extreme weather, it is important to quantify the disutility of out-of-station waiting time (Tirachini et al., 2016; Zhang et al., 2021). Furthermore, how the waiting time affects mode choice is also worthy of investigation (Sun and Xu, 2012). Finally, an interesting and important research direction is to develop time- and station-dependent transit fare schemes to flatten peak hour demand and thus reduce the mismatch between demand and supply (Yang and Tang, 2018; Lu et al., 2020; Li et al., 2018; Adnan et al., 2020).
Acknowledgement
This research is supported by the Fonds de Recherche du Qu´ebec - Soci´et´e et Culture (FRQSC) under the NSFC-FRQSC Research Program on Smart Cities and Big Data and the Canada Foundation for Innovation (CFI) John R. Evans Leaders Fund.
References
Adnan, M., Biran, B.h.N., Baburajan, V., Basak, K., Ben-Akiva, M., 2020. Examining impacts of timebased pricing strategies in public transportation: A study of singapore. Transportation Research Part A: Policy and Practice 140, 127­141.
Brakewood, C., Barbeau, S., Watkins, K., 2014. An experiment evaluating the impacts of real-time transit information on bus riders in tampa, florida. Transportation Research Part A: Policy and Practice 69, 409­422.
Brakewood, C., Macfarlane, G.S., Watkins, K., 2015. The impact of real-time information on bus ridership in new york city. Transportation Research Part C: Emerging Technologies 53, 59­75.
China Daily, 2021. Bike-only roadway connects Beijing communities. URL: https://www.chinadaily.com. cn/a/201905/31/WS5cf0765ea3104842260beca3.html. Accessed May 19, 2021.
Fan, Y., Guthrie, A., Levinson, D., 2016. Waiting time perceptions at transit stops and stations: Effects of basic amenities, gender, and security. Transportation Research Part A: Policy and Practice 88, 251­264.
Gelman, A., Carlin, J.B., Stern, H.S., Dunson, D.B., Vehtari, A., Rubin, D.B., 2013. Bayesian data analysis. CRC press.
GPy, since 2012. GPy: A gaussian process framework in python. http://github.com/SheffieldML/GPy.
12

Greene-Roesel, R., Castiglione, J., Guiriba, C., Bradley, M., 2018. Bart perks: using incentives to manage transit demand. Transportation Research Record 2672, 557­565.
Halvorsen, A., Koutsopoulos, H.N., Lau, S., Au, T., Zhao, J., 2016. Reducing subway crowding: analysis of an off-peak discount experiment in hong kong. Transportation Research Record 2544, 38­46.
Halvorsen, A., Koutsopoulos, H.N., Ma, Z., Zhao, J., 2019. Demand management of congested public transport systems: a conceptual framework and application using smart card data. Transportation , 1­29.
Jin, J.G., Tang, L.C., Sun, L., Lee, D.H., 2014. Enhancing metro network resilience via localized integration with bus services. Transportation Research Part E: Logistics and Transportation Review 63, 17­30.
Jin, J.G., Teo, K.M., Odoni, A.R., 2015. Optimizing bus bridging services in response to disruptions of urban transit rail networks. Transportation Science 50, 790­804.
Jyl¨anki, P., Vanhatalo, J., Vehtari, A., 2011. Robust gaussian process regression with a student-t likelihood. Journal of Machine Learning Research 12.
Kang, L., Wu, J., Sun, H., Zhu, X., Gao, Z., 2015. A case study on the coordination of last trains for the beijing subway network. Transportation Research Part B: Methodological 72, 112­127.
Krishnakumari, P., Cats, O., van Lint, H., 2020. Estimation of metro network passenger delay from individual trajectories. Transportation Research Part C: Emerging Technologies 117, 102704.
Kusakabe, T., Iryo, T., Asakura, Y., 2010. Estimation method for railway passengers' train choice behavior with smart card transaction data. Transportation 37, 731­749.
Li, H., Li, X., Xu, X., Liu, J., Ran, B., 2018. Modeling departure time choice of metro passengers with a smart corrected mixed logit model-a case study in beijing. Transport Policy 69, 106­121.
Li, P., 2015. Six more subway stations to limit rush hour crowds. URL: https://www.thebeijinger.com/ blog/2015/01/12/five-more-subway-stations-limit-rush-hour-crowds. The Beijinger, Accessed May 25, 2021.
Lin, W., 2021. After experiencing the morning peak of nanshan science and technology park, my mentality collapsed. URL: https://min.news/en/news/06f5d575e0557c7b52fa3ad7bbdabb85.html. MINEWS, Accessed May 25, 2021.
Lu, X.S., Zhang, X., Long, J., Li, Y., 2020. Managing rail transit peak-hour congestion with step fare schemes. Transportmetrica A: Transport Science 16, 1490­1511.
Ma, Z., Koutsopoulos, H.N., Chen, Y., Wilson, N.H., 2019. Estimation of denied boarding in urban rail systems: alternative formulations and comparative analysis. Transportation Research Record 2673, 771­778.
Mo, B., Ma, Z., Koutsopoulos, H.N., Zhao, J., 2020. Capacity-constrained network performance model for urban rail systems. Transportation Research Record 2674, 59­69.
National Development and Reform Comission, 2019. Reply on adjusting the planning scheme for the second phase of beijing urban rail transit (No. 1904). URL: https://www.ndrc.gov.cn/xxgk/zcfb/tz/201912/ t20191223 1216003.html. Accessed May 19, 2021.
Neal, R.M., 1997. Monte carlo implementation of gaussian process models for bayesian regression and classification. Technical Report 9702, Dept. of statistics and Dept. of Computer Science, University of Toronto .
13

Niu, H., Zhou, X., 2013. Optimizing urban rail timetable under time-dependent demand and oversaturated conditions. Transportation Research Part C: Emerging Technologies 36, 212­230.
Pelletier, M.P., Tr´epanier, M., Morency, C., 2011. Smart card data use in public transit: A literature review. Transportation Research Part C: Emerging Technologies 19, 557­568.
Qu, H., Xu, X., Chien, S., 2020. Estimating wait time and passenger load in a saturated metro network: A data-driven approach. Journal of Advanced Transportation 2020.
Shi, J., Yang, L., Yang, J., Zhou, F., Gao, Z., 2019. Cooperative passenger flow control in an oversaturated metro network with operational risk thresholds. Transportation Research Part C: Emerging Technologies 107, 301­336.
Sun, L., Jin, J.G., Lee, D.H., Axhausen, K.W., 2015a. Characterizing multimodal transfer time using smart card data: the effect of time, passenger age, crowdedness, and collective pressure, in: Proceedings of Transportation Research Board 94th Annual Meeting, Washington DC, United States.
Sun, L., Jin, J.G., Lee, D.H., Axhausen, K.W., Erath, A., 2014. Demand-driven timetable design for metro services. Transportation Research Part C: Emerging Technologies 46, 284­299.
Sun, L., Lee, D.H., Erath, A., Huang, X., 2012. Using smart card data to extract passenger's spatio-temporal density and train's trajectory of mrt system, in: Proceedings of the ACM SIGKDD international workshop on urban computing, ACM. pp. 142­148.
Sun, L., Lu, Y., Jin, J.G., Lee, D.H., Axhausen, K.W., 2015b. An integrated bayesian approach for passenger flow assignment in metro networks. Transportation Research Part C: Emerging Technologies 52, 116­131.
Sun, Y., Xu, R., 2012. Rail transit travel time reliability and estimation of passenger route choice behavior: Analysis using automatic fare collection data. Transportation Research Record 2275, 58­67.
Tirachini, A., Sun, L., Erath, A., Chakirov, A., 2016. Valuation of sitting and standing in metro trains using revealed preferences. Transport Policy 47, 94­104.
Vanhatalo, J., Jyl¨anki, P., Vehtari, A., 2009. Gaussian process regression with student-t likelihood. Advances in neural information processing systems 22, 1910­1918.
Wardman, M., 2004. Public transport values of time. Transport Policy 11, 363­377.
Watkins, K.E., Ferris, B., Borning, A., Rutherford, G.S., Layton, D., 2011. Where is my bus? impact of mobile real-time information on the perceived and actual wait time of transit riders. Transportation Research Part A: Policy and Practice 45, 839­848.
Wikipedia contributors, 2019a. Beijing subway. URL: https://en.wikipedia.org/wiki/Beijing Subway. Accessed July 18, 2019.
Wikipedia contributors, 2019b. Tiantongyuan. URL: https://en.wikipedia.org/wiki/Tiantongyuan. Accessed July 18, 2019.
Williams, C.K., Rasmussen, C.E., 2006. Gaussian Processes for Machine Learning. The MIT Press.
Xu, X., Li, H., Liu, J., Ran, B., Qin, L., 2019. Passenger flow control with multi-station coordination in subway networks: algorithm development and real-world case study. Transportmetrica B: Transport Dynamics 7, 446­472.
Yang, H., Tang, Y., 2018. Managing rail transit peak-hour congestion with a fare-reward scheme. Transportation Research Part B: Methodological 110, 122­136.
14

Yin, J., Tang, T., Yang, L., Gao, Z., Ran, B., 2016. Energy-efficient metro train rescheduling with uncertain time-variant passenger demands: An approximate dynamic programming approach. Transportation Research Part B: Methodological 91, 178­210.
Zhang, M., Xu, C., Meng, L., Meng, X., 2021. Outdoor comfort level improvement in the traffic waiting areas by using a mist spray system: An experiment and questionnaire study. Sustainable Cities and Society , 102973.
Zhao, J., Zhang, F., Tu, L., Xu, C., Shen, D., Tian, C., Li, X.Y., Li, Z., 2016. Estimation of passenger route choice pattern using smart card data for complex metro systems. IEEE Transactions on Intelligent Transportation Systems 18, 790­801.
Zhu, Y., Koutsopoulos, H.N., Wilson, N.H., 2018. Inferring left behind passengers in congested metro systems from automated data. Transportation Research Part C: Emerging Technologies 94, 323­337.
15

