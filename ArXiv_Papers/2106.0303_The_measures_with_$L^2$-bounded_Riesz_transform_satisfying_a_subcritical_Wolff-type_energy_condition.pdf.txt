arXiv:2106.00303v1 [math.CA] 1 Jun 2021

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM SATISFYING A SUBCRITICAL WOLFF-TYPE ENERGY CONDITION

DAMIAN DBROWSKI AND XAVIER TOLSA

Abstract. In this work we obtain a geometric characterization of the measures µ in

Rn`1 form

Rwiµtphxpq o"lyn o|xm´xiy´a|lny`u1ppdeµrpygqrobwetlhonogfsdteogrLee2

n such that the n-dimensional Riesz transpµq, under the assumption that µ satisfies

the following Wolff energy estimate, for any ball B  Rn`1:

  8 ^ µpBpx, rqq 2

B0

rn´

3 8

dr r

dµpxq



M

^ µp2Bq

r

pB

qn´

3 8

2

µp2Bq

.

More precisely, we show that µ satisfies the following estimate:

}Rµ}2L2 pµq

` }µ}

«

 8 µ,2px, rq2
0

µpBpx, rqq rn

dr r

dµpxq ` }µ},

where

µ,2px, rq2

"

inf L

1 rn


Bpx,rq

´ distpy,Lq ¯2
r

dµpyq,

with

the

infimum

taken

over

all

affine n-planes L  Rn`1. In a companion paper which relies on the results obtained in

this work it is shown that the same result holds without the above assumption regarding

the Wolff energy of µ. This result has important consequences for the Painlevé problem

for Lipschitz harmonic functions.

Contents

1. Introduction

2

2. The modified dyadic lattice of David and Mattila

7

3. P-doubling cubes, the Main Theorem, the corona decomposition, and the Main

Lemma

17

3.1. P-doubling cubes and the family hdkpQq

17

3.2. The Main Theorem

21

3.3. The corona decomposition and the Main Lemma

22

4. The cubes with moderate decrement of Wolff energy and the associated

tractable trees

23

4.1. The family MDW

23

4.2. The enlarged cubes

25

4.3. Generalized trees and negligible cubes

27

4.4. Tractable trees

29

5. The layers Fhj and Lhj , and the tractable trees

32

2020 Mathematics Subject Classification. 42B20, 28A75, 49Q15. Both authors were supported by 2017-SGR-0395 (Catalonia) and MTM-2016-77635-P (MINECO, Spain). D.D. was supported by the Academy of Finland via the project Incidences on Fractals, grant No. 321896. X.T. was supported by the European Research Council (ERC) under the European Union's Horizon 2020 research and innovation programme (grant agreement 101018680).
1

2

D. DBROWSKI AND X. TOLSA

6. The Riesz transform on the tractable trees: the approximating measures , ,

and the variational argument

40

6.1. The suppressed Riesz transform and a Cotlar type inequality

40

6.2. The family Regpe1pRqq and the approximating measure 

42

6.3. The auxiliary family H

44

6.4. Some technical lemmas

45

6.5. The variational argument

53

6.6. Lower estimates for R

60

7. The Riesz transform on the tractable trees: transference estimates

61

7.1. The operators RTReg , RTr , and Tr R

61

7.2. Estimates for the P and QReg coefficients

66

7.3. Transference of the lower estimates for R to Tr Rµ

75

8. The proof of Main Lemma 3.5

80

8.1. Estimate of T1

81

8.2. Estimate of T2

83

8.3. Estimate of T3

83

8.4. Proof of Lemma 8.1

84

9. The proof of the Main Theorem 3.4

87

9.1. The approximating measure  on a subtree Tz ree0pRq

88

9.2. Estimating the  numbers on Tz reepRq

97

9.3. The corona decompostion and the proof of Lemma 9.1

106

Appendix A. A list of parameters

108

Appendix B. A list of cube families and related objects

109

References

110

1. Introduction

Given a Radon measure µ in Rn`1, its n-dimensional Riesz transform at x P Rn`1 is

defined by

 Rµpxq "

x´y |x ´ y|n`1

dµpyq,

whenever the integral makes sense. For f P L1locpµq, we write Rµf pxq " Rpf µqpxq. Given

  0, the -truncated Riesz transform of µ equals

Rµpxq

"


|x´y|

|x

x´y ´ y|n`1

dµpyq,

and we also write Rµ,f pxq " Rpf µqpxq. We say that Rµ is bounded in L2pµq if the operators Rµ, are bounded on L2pµq uniformly in , and then we denote

}Rµ}L2pµqÑL2pµq " sup }Rµ,}L2pµqÑL2pµq.
0

We also write

R°µpxq " sup |Rµpxq|,
0

pv

Rµpxq

"

lim
0

Rµpxq,

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

3

in case that the latter limit exists. Remark that, sometimes, abusing notation we will write Rµ instead of pv Rµ.
This is the first of a series of two papers where we obtain a geometric characterization of the measures µ in Rn`1 such that the Riesz operator Rµ is bounded in L2pµq. One of the main motivations for such characterization is the application to the Painlevé problem for Lipschitz harmonic functions (i.e., the geometric description of the removable singularities for Lipschitz harmonic functions). Also, there may be other applications regarding questions on the approximation by Lipschitz or C1-harmonic functions, as well as to the study of harmonic measure, which is a field where the Riesz transform has played an important role in recent advances, such as [AHM+] and [AMTV], for example.
To state our results in detail we need to introduce additional notation. For a ball B with radius rpBq, we consider the density

µpBq

"

µpBq rpBqn

.

Also we define

µ,2pBq

"

~ inf
L

1 rpBqn


B

^ distpy, r

Lq 2

¸1{2 dµpyq

,

where the infimum is taken over all affine n-planes L  Rn`1. For B " Bpx, rq we may

also write µpx, rq and µ,2px, rq instead of µpBq and µ,2pBq.

We consider the following Wolff type energy

(1.1)

Epµq

"

 8
0

^

µpBpx, rqq

rn´

3 8

2

dr

dµpxq

"



8

r

3 4

r

0

µpx, rq2

dr r

dµpxq.

In this paper we prove the following result.

Theorem 1.1. Let µ be a Radon measure in Rn`1 satisfying the polynomial growth condition

(1.2)

µpBpx, rqq  0 rn for all x P supp µ and all r  0.

Suppose that there exists some constant M such that

(1.3)

EpµtB q



M

3
rpBq 4

µp2Bq2

µp2Bq

for any ball B  Rn`1.

Suppose (1.4)

also

that8R°µpxq
µ,2px,
0

 8 µ-a.e. rq2 µpx, rq

Then

dr r

dµpxq



C

` }

pv

Rµ}2L2pµq

`

02

 }µ} ,

with C depending on M .

Remark that, in this theorem, since µ has polynomial growth of degree n and R°µpxq  8 µ-a.e., then pv Rµpxq exists µ-a.e. by [NToV2].

A converse to the inequality (1.4) also holds: if µ satisfies the growth condition (1.2),

then (1.5)

} pv Rµ}2L2pµq



C

 8
0

µ,2px, rq2

µpx, rq

dr r

dµpxq

`

C

02 }µ},

where C is an absolute constant. This was proved in [AT] in the case n " 1, and in [Gi] in

full generality.

4

D. DBROWSKI AND X. TOLSA

From (1.5), Theorem 1.1, and a direct application of the T 1 theorem for non-doubling measures ([NTrV1], [NTrV2]) we obtain the following.

Theorem 1.2. Let µ be a Radon measure in Rn`1 such that

(1.6)

EpµtB q



M

3
rpBq 4

µp2Bq2

µp2Bq

for any ball B  Rn`1

for some fixed constant M . Then Rµ is bounded in L2pµq if and only if it satisfies the polynomial growth condition

(1.7)

µpBpx, rqq  C rn for all x P supp µ and all r  0

and (1.8)


B

 rpBq
0

µ,2px,

rq2

µpx,

rq

dr r

dµpxq



C2

µpBq

for any ball B  Rn`1.

Further, }Rµ}L2pµqÑL2pµq is bounded above by some constant depending just on C and M .

Some remarks are in order.

Remark 1.3. The same results (Theorems 1.1 and 1.2) are valid if one replaces the

constants 3{8 and 3{4 in the definition of Epµq and in (1.3), (1.6) by {2 and , with

 P p0, 1q. We have chosen 3{8 and 3{4 for simplicity.

On the other hand, in the case  " 0, Theorem 1.1 and the "if" direction of Theorem

1.2 hold trivially because

 8
0

µ,2px,

rq2

µpx,

rq

dr r

dµpxq



 8
0

^

µpBpx, rn

rqq

2

dr r

dµpxq ": E0pµq,

so that the analog of (1.3), namely

(1.9)

E0pµtBq  M µp2Bq2 µp2Bq for any ball B  Rn`1,

and the polynomial growth condition (1.6) yield (1.4). The estimate (1.8) follows by the
same argument. However, the condition (1.9) is much stronger than (1.3). In fact, this
does not hold even in the case when µ is AD-regular (see also Remark 1.5 below). One should think of E0pµq as the critical Wolff energy in connection with the L2pµq
boundedness of Rµ, while the energy Epµq in (1.1) should be considered as a subcrtical energy.

Remark 1.4. In a sense, the condition (1.3) ensures that the density of the balls Bpx, rq

centered in B does not grow too fast as the radius r becomes smaller than rpBq. One can

check easily that the condition

(1.10)

µpx,

rq



C

^

R r

3{8

µpx,

Rq

for 0  r  R,

implies (1.3) (with a suitable M ). As noted in Remark 1.3, the exponent 3{8 could be replaced by any parameter strictly smaller than 1{2, and the results of the paper would still hold for such measures.
We point out that for domains satisfying the so called capacity density condition (see [AH]) the associated harmonic measure satisfies a similar condition, namely (1.10) with exponent 3{8 replaced by 1 ´ , for some small . Since this exponent is larger than 1{2,

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

5

and increasing the exponent makes the condition (1.10) weaker, one cannot conclude that this class of measures is covered by our assumption (1.3).

Remark 1.5. It is easy to check that the polynomial growth condition on µ implies that EpµtBq À 02 rpBq3{4 µp2Bq.
In particular, if µ is an AD-regular measure, i.e. µpBpx, rqq « rn for all x P supp µ and 0  r  diampsupp µq,

then (1.3) holds for a suitable M . Further, in this case the statement (1.8) is equivalent to saying that µ is uniformly rectifiable, by [DS1]. So in the AD-regular case Theorem 1.2 reduces to the solution of the David-Semmes problem in [NToV1].

In fact, we will prove a result more general than Theorem 1.1 which does not require

the condition (1.3), and instead asserts that, under the condition (1.2) and the assumption

that

R°

µpxq   8

8

µ-a.e.,

(1.11)

µ,2px, rq2

0

µpx,

rq

dr r

dµpxq



C

`}Rµ}2L2pµq

`

02

}µ}

`

ÿ
QPDµP XHE

 Ep4Qq ,

where DµP X HE is a family of "P-doubling cubes" Q from a suitable lattice Dµ with a large Wolff type energy Ep4Qq. See Theorem 3.4 for more details. In the companion paper [To4]

it is shown that the last sum on right hand side of (1.11) can be estimated in terms of

} pv Rµ}L2pµq. More precisely, ÿ
(1.12)

Ep4Qq À } pv Rµ}2L2pµq ` 02 }µ},

QPDµP XHE

so that combining the results of both papers, one gets:

Theorem. Let µ be a Radon measure in Rn`1 satisfying the polynomial growth condition

µpBpx, rqq  0 rn for all x P supp µ and all r  0

and

such

that R°08µpxµq,2px8, rqµ2-aµ.pex. ,Trqhedrnr

dµpxq



C

p>> pv Rµ}2L2pµq

`

02

 }µ} ,

where C is an absolute constant.

Combining also the estimate (1.12) with Theorem 1.2, it turns out that the assumption (1.6) can be eliminated in that theorem and then one gets a complete geometric characterization of the measures µ such that Rµ is bounded in L2pµq.
Theorem. Let µ be a Radon measure in Rn`1. Then Rµ is bounded in L2pµq if and only if it satisfies the polynomial growth condition
µpBpx, rqq  C rn for all x P supp µ and all r  0

and


B

 rpBq
0

µ,2px,

rq2

µpx,

rq

dr r

dµpxq



C2

µpBq

for any ball B  Rn`1.

Further, the optimal constant C is comparable to }Rµ}L2pµqÑL2pµq.

6

D. DBROWSKI AND X. TOLSA

The preceding result has some important applications. For example, it implies that the class of measures µ such that Rµ is bounded in L2pµq is invariant by bilipschitz maps. That is, given a bilipschitz T : Rn Ñ Rn, if Rµ is bounded in L2pµq, then RT #µ is bounded in L2pT #µq, where T #µ is the image measure of µ by T . As another corollary, one obtains a description of the removable singularities for Lipschitz harmonic functions in terms a metric-geometric potential involving the µ,2 coefficients, and one deduces that the class of sets which are removable is invariant by bilipschitz mappings. These results can be considered the extension to higher dimensions of the results from [To1] in connection with analytic capacity. See [To4] for more details.
Next we will describe the main ideas involved in the proof of Theorem 1.1, as well as the main difficulties and innovations. The strategy consists in performing a corona decomposition of the dyadic lattice Dµ into trees of cubes where the density of the cubes does not oscillate too much. Then, roughly speaking, in each tree the measure µ behaves as if it were AD-regular, and from the L2pµq boundedness of Rµ and [NToV1], one should expect that µ is close to some uniformly rectifiable measure at the locations and scales of the cubes in the tree, so that one can obtain a good packing condition for the µ,2 coefficients of the cubes in the tree. For this strategy to work, we need to show that the roots of the trees where the density does not oscillate too much satisfy a suitable packing condition. This is the content of the Main Lemma 3.5, whose proof takes most of the paper (Sections 4-8).
To prove the desired packing condition, we reduce matters to obtaining good lower estimates for the Haar coefficients of Rµ for the cubes of some suitable trees (the socalled tractable trees) where, in a sense the density of many cubes in some intermediate generations increases (with respect to the density of the root), and later in many stopping cubes the density decreases. These lower estimates are obtained by a variational argument applied to some measure  that approximates µ at the locations and scales of the cubes in the tractable tree. By that variational argument one obtains some lower bounds for }R}L2pq that later are transferred to Rµ (i.e., to the Haar coefficients of Rµ for the cubes in the tree). The idea of applying a variational argument like this originates from the work [ENV] by Eiderman, Nazarov, and Volberg and the reduction to the tractable trees comes from the work [RT] by Reguera and the second author of this paper. The article [JNRT] includes an improved version of that variational argument. Unlike the present paper, [JNRT] makes an extensive use of compactness arguments, which do not work so well in our situation, where the geometry plays a more important role.
The implementation of the variational argument and the transference of the estimates from the approximating measure  to µ is more difficult in the present paper than in [RT] or in other related works such as [JNRT]. Some of the difficulties arise from the fact that, for technical reasons (essentially, we need that many cubes of the intermediate generations with high density are located far from the boundary of the root of the tree), we have to consider trees of "enlarged cubes". This causes an overlapping between different trees that has to be quantified carefully (this is done in Section 5). On the other hand, the transference of the lower estimate for }R}L2pq to the Haar coefficients of Rµ for the cubes in the tree originates many error terms. Roughly speaking, in order to be able to transfer that lower bound for }R}L2pq to µ we need the error terms to be smaller than the lower bound of }R}L2pq. Some of these error terms are difficult to handle and we only

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

7

can show that they are small under the condition (1.3). If this condition is not assumed, then we can bound them in terms of the energies Ep4Qq that appear in (1.12). For this to work, we need an enhanced version of the dyadic lattice of David and Mattila that is obtained in Section 2. This is an essential tool for our arguments.
As explained above, the last stage of the proof of Theorem 1.1 consists of estimating the µ,2 coefficients in each tree where the density does not oscillate too much. This step, which requires a delicate approximation by an AD-regular measure which has its own interest, is performed in Section 9.
Throughout the proof a large number of parameters and families of cubes is defined. To help the reader navigate the paper and keep track of different objects, we list most of them in Appendices A and B.
In the whole paper we denote by C or c some constants that may depend on the dimension and perhaps other fixed parameters. Their value may change at different occurrences. On the contrary, constants with subscripts, like C0, retain their values. For a, b  0, we write a À b if there is C  0 such that a  Cb. We write a « b to mean a À b À a.

2. The modified dyadic lattice of David and Mattila

Next we will introduce the dyadic lattice of cubes with small boundaries of David-Mattila [DM] associated with a Radon measure µ. The properties of the lattice are summarized in the next lemma. Later on we will show how its construction can be modified in order to obtain addtional properties relevant for our arguments.

Lemma 2.1 (David, Mattila). Let µ be a compactly supported Radon measure in Rd.
Consider two constants C0  1 and A0  5000 C0 and denote E " supp µ. Then there exists a sequence of partitions of E into Borel subsets Q, Q P Dµ,k, with the following properties:

, For each integer k  0, E is the disjoint union of the "cubes" Q, Q P Dµ,k, and if k  l, Q P Dµ,l, and R P Dµ,k, then either Q X R "  or else Q  R.

, The general position of the cubes Q can be described as follows. For each k  0 and each cube Q P Dµ,k, there is a ball BpQq " BpxQ, rpQqq such that

xQ P E,

A´0 k  rpQq  C0 A´0 k,

E X BpQq  Q  E X 28 BpQq " E X BpxQ, 28rpQqq,

and the balls 5BpQq, Q P Dµ,k, are disjoint.

, The cubes Q P Dµ,k have small boundaries. That is, for each Q P Dµ,k and each integer l  0, set
NlextpQq " tx P EzQ : distpx, Qq  A0´k´lu,
NlintpQq " tx P Q : distpx, EzQq  A0´k´lu, and
NlpQq " NlextpQq Y NlintpQq.

8
Then (2.1)

D. DBROWSKI AND X. TOLSA
µpNlpQqq  pC´1C0´3d´1A0q´l µp90BpQqq.

, Denote by Dµdb,k the family of cubes Q P Dµ,k for which

(2.2)

µp100BpQqq  C0 µpBpQqq.

We have that rpQq " A´0 k when Q P Dµ,kzDµdb,k and (2.3)
µp100BpQqq  C0´l µp100l`1BpQqq for all l  1 with 100l  C0 and Q P Dµ,kzDµdb,k.

Remark 2.2. The constants C0 and A0 are chosen so that

A0 " C0Cpdq,

where Cpdq depends just on d and C0 is big enough.
 We use the notation Dµ " k0 Dµ,k. Observe that the families Dµ,k are only defined for k  0. So the diameter of the cubes from Dµ are uniformly bounded from above. We set pQq " 56 C0 A´0 k and we call it the side length of Q. Notice that

C0´1pQq  diamp28BpQqq  pQq.

Observe that rpQq « diampQq « pQq. Also we call xQ the center of Q, and the cube Q1 P Dµ,k´1 such that Q1  Q the parent of Q. We denote the family of cubes from Dµ,k`1 which are contained in Q by ChpQq, and we call their elements children or sons of Q. We
set BQ " 28BpQq " BpxQ, 28 rpQqq, so that

E

X

1 28

BQ



Q



BQ



BpxQ,

pQq{2q.

For a given  P p0, 1q, let A0 be big enough so that the constant C´1C0´3d´1A0 in (2.1) satisfies

C´1C0´3d´1A0  A0  10.

Then we deduce that, for all 0    1,

`

`



(2.4) µ tx P Q : distpx, EzQq   pQqu ` µ x P 3.5BQzQ : distpx, Qq   pQqu

 c  µp3.5BQq.

We

denote

Dµdb

"


k0

Dµdb,k

.

Note

that,

in

particular,

from

(2.2)

it

follows

that

(2.5)

µp3BQq  µp100BpQqq  C0 µpQq if Q P Dµdb.

For this reason we will call the cubes from Dµdb doubling. Given Q P Dµ, we denote by DµpQq the family of cubes from Dµ which are contained in Q. Analogously, we write DµdbpQq " Dµdb X DpQq.
As shown in [DM, Lemma 5.28], every cube R P Dµ can be covered µ-a.e. by a family
of doubling cubes:

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

9

Lemma 2.3. Let R P Dµ. Suppose that the constants A0 and C0 in Lemma 2.1 are chosen as in Remark 2.2. Then there exists a family of doubling cubes tQiuiPI  Dµdb, with Qi  R for all i, such that their union covers µ-almost all R.
The following result is proved in [DM, Lemma 5.31].

Lemma 2.4. Let R P Dµ and let Q  R be a cube such that all the intermediate cubes S, Q  S  R are non-doubling (i.e. belong to DµzDµdb). Suppose that the constants A0 and C0 in Lemma 2.1 are chosen as in Remark 2.2. Then

(2.6)

µp100BpQqq  A´0 10dpJpQq´JpRq´1qµp100BpRqq.

From this lemma we deduce:

Lemma 2.5. Let Q, R P Dµ be as in Lemma 2.4. Then

µp100BpQqq  pC0A0qn`1 A0´9dpJpQq´JpRq´1q µp100BpRqq

and

ÿ

µp100BpSqq  c µp100BpRqq,

SPDµ:QSR

with c depending on C0 and A0.

For the easy proof, see [To2, Lemma 4.4], for example.

For

f

P

L2pµq

and

Q

P

Dµ

we

define ÿ

(2.7)

Qf "

mµ,Spf qS ´ mµ,Qpf qQ,

SPChpQq

where mµ,Spf q stands for the average of f on S with respect to µ. Then we have the

orthogonal expansion, for any cube R P Dµ,

`



ÿ

R f ´ mµ,Rpf q "

Qf,

QPDµpRq

in the L2pµq-sense, so that

` }R f

´

mµ,Rpf q}2L2pµq

"

ÿ

}Qf }2L2pµq.

QPDµpRq

In this paper we will have to estimate terms such as }RpQµq}L2pµt2BQzQq, which leads

to deal with integrals of the form



^

1

2

2BQzQ Q |x ´ y|n dµpyq dµpxq.

Our next objective is to show that integrals such as this one can be estimated in terms of the Wolff type energy Ep2Qq, to be defined soon.
We need some additional notation. Given Q P Dµ and   1, we denote by Q the union of cubes P from the same generation as Q such that distpxQ, P q   pQq. Notice that

(2.8)

Q



BpxQ,

p

`

1 2

qpQqq.

10

D. DBROWSKI AND X. TOLSA

Also, we let

DµpQq " tP P Dµ : P  Q, pP q  pQqu,

and, for k  0, Dµ,kpQq " tP P Dµ : P  Q, pP q " A´0 kpQqu,

 DµkpQq " Dµ,j pQq.
jk

Lemma 2.6. Let µ be a compactly supported Radon measure in Rd. Assume that µ has

polynomial growth of degree n and let  P p0, 1q. The lattice Dµ from Lemma 2.1 can be constructed so that the following holds for all all Q P Dµ:



^

1

2

 ~

1

¸2

2BQ zQ

Q |x ´ y|n dµpyq

dµpxq`

Q


C

2BQzQ |x ÿ
pq
P PDµ:P

´y
2Q

|n ^

dµpyq
pP q  pQq

dµpxq µp2BP

q2µpP

q.

Remark that the polynomial growth assumption is just necessary to ensure that some of

the integrals above are finite. In fact, the constant Cpq does not depend on the polynomial

growth constant.

To prove the lemma, we denote

(2.9)

DrµintpQq "

( P P DµpQq : 2BP X psupp µzQq  

and (2.10)

DrµextpQq "

P

P

Dµ

:

pP q



pQq, P



Rn`1zQ,

2BP

XQ



( .

Also,

(2.11)

DrµpQq " DrµintpQq Y DrµextpQq,

and, for k  0, Drµ,kpQq " tP P Drµ : pP q " A´0 kpQqu.
We need some auxiliary results. The first one is the following.

Lemma 2.7. Let µ be a compactly supported Radon measure in Rd and Q P Dµ. For any  P p0, 1q, we have

(2.12)


2BQ zQ

^
Q

|x

1 ´ y|n

2 dµpyq

dµpxq `

 ~
Q 2BQzQ
ÿ À,A0

¸2

|x

1 ´

y|n

dµpyq

dµpxq

^

pQq pP q



µp2BP

q2

µpP

q.

P PDrµpQq

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

11

Proof.

Observe 

that,

for

x

P~2BQzQ,



¸

Q

|x

1 ´ y|n

dµpyq

"

`
yPQ:|x´y|rpBQq{2 yPQ:|x´y|rpBQq{2

|x

1 ´ y|n

dµpyq

ÀA0

µpQq rpBQqn

ÿ

`

µp2BP q.

P PDrµextpQq:xPP

Thus,



^

1

2

2BQ zQ

Q |x ´ y|n dµpyq dµpxq

ÀA0

^ µpQq 2 rpBQqn

µp2BQq


`
2BQ zQ

^

ÿ

P PDrµextpQq:xPP

2 µp2BP q dµpxq.

By Hölder's inequality, for any   0,

^

ÿ

2

µp2BP q

P PDrµextpQq:xPP



^

ÿ

P PDrµextpQq:xPP

^

pQq pP q



µ

p2BP

 q2

¨

^

P

ÿ
PDrµextpQq:xPP

^ pP q   .
pQq

The last sum above is bounded above by

ÿ
P PDµ:xPP,P 2Q

^ pP q  pQq



C pq.

Therefore,



^

1

2

2BQ zQ

Q |x ´ y|n dµpyq

À,A0

µpQq2 µp2BQq rpBQq2n

À µp2BQq2 µpQq `

dµpxq

 `
2BQ
ÿ

ÿ

^ pQq 

zQ^PppPQPDrµeqqxtpQ q:xµPpP2BPqp2PµqpP

µ q.

p2BP

q2

dµpxq

P PDrµextpQq

The estimate of the second integral on the left hand side of (2.12) is analogous.

Lemma 2.8. Let µ be a compactly supported Radon measure in Rd and let  P p0, 1q.

Assume that µ has polynomial growth of degree n and let  P p0, 1q. The lattice Dµ from

Lemma 2.1 can be constructed so that the following holds for all all Q P Dµ:

(2.13) ÿ
SPDrµ,1pQq

P

ÿ
PDµp2Sq

^

pP q pQq



µp2BP

q2

µpP

q

À

C06d`1A´0 1
P

ÿ
PDµ1 p2Qq

^ pP q pQq



µp2BP

q2

µpP

q.

12

D. DBROWSKI AND X. TOLSA

Proof. We will describe the relevant changes required in the arguments in [DM, Theorem
3.2] in order to get the estimate (2.13). We will use the same notation as in that theorem,
with the exception of the constant A in [DM, Theorem 3.2], which here we denote by A0. Denote E " supp µ. For each generation k  0, the starting point to construct Dµ,k
consists of choosing, for each x P E, a suitable radius rkpxq such that

(2.14)

A´0 k  rkpxq  C0A´0 k

depending on the doubling properties of the ball Bpx, rkpxqq (see [DM, (3.17)-(3.20)]). Next, one chooses two auxiliary radii r1kpxq and r2kpxq such that

11 10

rkpxq



r1kpxq



12 10

rkpxq,

25 rkpxq  r2kpxq  26 rkpxq, and such that the following small boundary conditions hold:

(2.1`5) µy

P

Rd

:

distpy,

BBpx,

r1k pxqqq





rk

( pxq



C

` µ Bpx,

13 10

rkpxqq

for

0







1 10

,

and

(2.16`) µ

y

P

Rd

:

distpy,

BBpx,

r2k pxqqq





rk

( pxq



C

` µ Bpx,

27rk

 pxqq

for 0    1.

At this point we will require the auxiliary radii r1kpxq and r2kpxq to be chosen so that an additional condition holds. Set Apx, r, Rq " Bpx, RqzBpx, rq. Observe first that

(2.17)



12 10

rk

pxq

11 10

rk

pxq

jÿ0jÿA0´0Ap´0j`p1jq`1Aq pxB, tp´x,3110200Crk0pAx0´q`k´3010, Ct`03A00´0kC´01Aq0´kµ´p1yq

µpy, 112C0A´0 k´j´1q2 dµpyq dt , 112C0A´0 k´j´1q2 L1pIx,y,kq dµpyq,

where we applied Fubini and we denoted by Ix,y,k the interval

Ix,y,k

" "

tt P R : " |x ´ y|

t ´ 300C0A0´k´1  |x ´ y ´ 300C0A0´k´1, |x ´ y| `

|300Ct `0A30´0k0´C10A. 0´k´1u

Obviously, its Lebesgue measure is L1pIx,y,kq " 600C0A0´k´1, and so the left hand side of

(2.17) is bounded above by

600

C0

A0´k´1

ÿ
j0

A´0 

pj


`1q
Bpx,

13 10

rk

pxqq

µpy,

112C0

A´0 k´j

´1q2

dµpyq.

Thujÿ s, 0bAy0´Cphje`b1yq shAepvx,,t´th30e0Cse0tA0´Uk1k´1,t`R300oCf0tAh0´oks´e1qtPµ

r

11 10

py,

rkpxq,

12 10

rk

pxqs

such

that

112C0A´0 k´j´1q2 dµpyq



105 C0 A0´k´1 rkpxq

ÿ
j0

A´0 pj`1q


Bpx,

13 10

rk pxqq

µpy,

112C0

A´0 k´j´1q2

dµpyq

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

13

satisfies

|U1k |



1 100

rkpxq.

By a standard argument involving the boundedness of the maximal Hardy-Littlewood

operator from L1pRq to L1,8pRq, one can deduce that there exists some

r1kpxq

P

r

11 10

rkpxq,

12 10

rk

pxqszU1k

such that (2.15) holds. The fact that r1kpxq R U1k ensures that

(2.18)

ÿ
j0

A0´pj`1q


Apx,r1kpxq´300C0

A0´k´1,r1k pxq`300C0 A0´k´1 q

µpy,

112C0A´0 k´j´1q2

dµpyq



105

C0 A0´k´1 rkpxq

ÿ A´0 pj`1q
j0



Bpx,

13 10

rk

pxqq

µpy, 112C0A´0 k´j´1q2

dµpyq.

An analogous argument shows that r2kpxq can be taken such that, besides (2.16), the

preceding

estimate

also

holds

with

r1kpxq

replaced

by

r2kpxq

and

Bpx,

13 10

rkpxqq

replaced

by

Bpx, 27rkpxqq.

As in [DM, Theorem 3.2], we denote B1kpxq " Bpx, r1kpxqq and B2kpxq " Bpx, r2kpxqq, and by a Vitali type covering lemma we select a family of points x P Ik such that the

balls tBpx, 5rkpxqquxPIk are disjoint, while the balls tBpx, 25rkpxqquxPIk cover E. We also

denote

^



B3kpxq " B2kpxqz

B1kpyq .

yPI k ztxu

For x P Ik, let Jpxq be the family of those y P Ikztxu such that B1kpyq X B2kpxq  . As explained in [DM, Theorem 3.2], using (2.14) it is easy to check #Jpxq  CC0d.
Next we consider an order in Ik such that

y  x in Ik whenever µpBpx, 90rkpxqqq  µpBpy, 90rkpyqqq

and we define

^



B4kpxq " B3kpxqz

B3kpyq .

yPI k :yx

Again, as explained in [DM, Theorem 3.2], using (2.14) it is easy to check that, for each x P Ik, there are at most CC0n`1 sets B3kpyq that intersect B3kpxq, with y P Ik.
The family tB4kpxquxPIk is a first approximation to tQuQPDµk . Indeed, by the arguments
in [DM, Theorem 3.2], for each x P Ik one constructs a set Qkpxq  E such that, denoting
Dµ,k " tQkpxquxPIk , the properties stated in Lemma 2.1 hold, with rpQkpxqq " rkpxq and BpQkpxqq " Bpx, rkpxqq. In particular,

Bpx, rkpxqq X E  Qkpxq  Bpx, 28rkpxqq.

Also, as shown in [DM, (3.61)], it holds

(2.19)

distpy, BB4kpxqq  51C0A0´k´1 for all y P N1pQpxqq.

14

D. DBROWSKI AND X. TOLSA

For a cube Q " Qkpxq P Dµ,k, we write rpQq " rkpxq, BpQq " Bpx, rkpxqq and BipQq " Bikpxq for i " 1, . . . , 4. By an argument quite similar to the one used in [DM, Theorem 3.2] to prove (2.19), we will show now that

(2.20)

2S  U5A´0 1pQqpBB4pQqq for any S P Drµ,1pQq,

where UpAq stands for the -neighborhood of A. This will be needed below to prove (2.13). The condition S P Drµ,1pQq tells us that either S  Q and 2BS X pEzQq  , or S  EzQ and 2BS X Q  . Assume the first option (the arguments for the second one are analogous). So there exists some point z P EzQ such that |xS ´ z|  2rpBSq " 56rpSq. Let x P Ik be such that z P Qkpxq. Then we have distpz, B4kpxqq  50C0A0´k´1 and also distpxS, B4kpxQqq  50C0A0´k´1, by [DM, (3.50)] (see also the first paragraph after [DM, (3.61)]). Since the sets B4kpxQq, B4kpxq are disjoint, we deduce that

distpxS, BB4kpxqq  50C0A0´k´1 ` 56 rpSq  106C0A0´k´1  2A´0 1pQq.

Together

with

the

fact

that

2S



` B xS,

5 2

pS

 q,

this

gives

(2.20).

Notice that, for each j  0,

P

ÿ
PDµ,j p2Sq

^

pP q pQq



µp2BP

q2

µpP

q

À

C02nA´0 pj`1q


2S

µpx,

2A´0 j

pSqq2

dµpxq.

Then we obtain

(2.21) ÿ

ÿ

^

pP q pQq



µp2BP

q2

µpP

q

SPDrµ,1pQq P PDµp2Sq
À C02n

ÿ

ÿ A0´pj`1q  µpx, 2A´0 j pSqq2 dµpxq

À

SPDrµ,1pQq j0
C02n`d ÿ A´0 pj`1q



2S

µpx, 2A0´j´1pQqq2 dµpxq.

j0

U5A´0 1pQqpBB4pQqq

Denote by JrpQq the family of cubes R P Dµ,k such that B2pRq X B4pQq  , so that, by the above construction we have



BB4pQq 

pBB1pRq Y BB2pRqq.

RPJrpQq

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

15

Also, notice that #JrpQq  C C0d. From (2.18) we deduce that, for each R P JrpQq and

i " 1, 2,

(2.22)

ÿ A´0 pj`1q 

µpx, 2A0´j´1pRqq2 dµpxq

j0

U5A´0 1pRqpBBipRqq
 C C0A´0 1 ÿ A´0 pj`1q



µpx, 2A0´j´1pRqq2 dµpxq



C

C0A´0 1

j0

27BpRq

ÿ

^

P PDµk`1:P X27BpRq

pP q pQq



µpxP , 3pP qq2 µpP q,

Notice that for Q, R P Dµ,k as above, the condition B2pRq X B4pQq   implies that 26BpQq X 26BpRq  . Then, if P P Dµk`1 is such that P X 27BpRq  , we derive

distpxQ, P q



|xQ

´

xR|

`

27rpRq



26prpQq

`

rpRqq

`

27rpRq



79C0A´0 k

"

79 56

pQq.

Then, since pP q  A´0 1pQq, we infer that

(2.23)

BpxP , 3pP qq X supp µ  2Q.

Also, we can write

µpxP , 3pP qq2 µpP q À

µpBpxP , 3pP qqq3 pP q2n

À

^ 1 pP q2n

ÿ
P 1PDµ:pP 1q"pP q,

3 µpP 1q

P 1XBpxP ,3pP qq

ÿ À C02d
P 1PDµ:pP 1q"pP q,

µpP 1q3 pP 1q2n

ÿ

À C02d

µp2BP 1 q2 µpP 1q,

P 1PDµ:pP 1q"pP q,

P 1XBpxP ,3pP qq

P 1XBpxP ,3pP qq

where we used the fact that the sums above are only over CC0d terms at most. Together with (2.23), this implies that the right hand side of (2.22) does not exceed

C

C02d`1A´0 1

P

ÿ
PDµk`1:P X27BpRq

^

pP q pQq


P 1PDµ

ÿ
p2Qq:pP

1q"pP

µ
q,

p2BP

1

q2



C

P 1XBpxP ,3pP qq
ÿ C03d`1A´0 1
P 1PDµ1 p2Qq

^ pP 1q  pQq

µpP 1q µp2BP

1

q2

µpP

1q.

By this estimate and (2.21), summing over all R P JrpQq, we get

ÿ

ÿ ^ pP q 

pQq
SPDrµ,1pQq P PDµp2Sq

µp2BP q2 µpP q

À

C06d`1A´0 1
P

ÿ
PDµ1 p2Qq

^

pP q pQq



µp2BP q2 µpP q,

as wished.

By Lemma 2.7, it is clear that to complete the proof of Lemma 2.6 it suffices to show the following result.

16

D. DBROWSKI AND X. TOLSA

Lemma 2.9. Let µ be a compactly supported Radon measure in Rd. Assume that µ has

polynomial growth of degree n and let  P p0, 1q. The lattice Dµ from Lemma 2.1 can be

constructed so that the following holds for all all Q P Dµ:

(2.24)

ÿ
P PDrµpQq

^

 1´

pQq 2

pP q

µp2BP q2

µpP q

ÀA0,

ÿ ^ pP q  P PDµ:P 2Q pQq

µp2BP q2µpP q.

Proof. To prove (2.24) notice that, for each k  1, by Lemma 2.8 we have

ÿ
RPDrµ,k

pQq

P

ÿ
PDµ1 p2Rq

^

pP q pRq



µp2BP

q2

µpP

q

ÿ

ÿ

ÿ



^

pP pS

q q



µp2BP

q2

µpP

q

RPDrµ,k´1pQq SPDrµ,1pRq P PDµp2Sq

" A0

ÿ

ÿ

ÿ

^

pP q pRq



µp2BP

q2

µpP

q



C

RPDrµ,k´1pQq SPDrµ,1pRq P PDµp2Sq

C06d`1A0´1

ÿ

ÿ

RPDrµ,k´1pQq P PDµ1 p2Rq

^

pP q pRq



µp2BP q2 µpP q.

Iterating the preceding estimate, we obtain

ÿ

ÿ

ÿ

µp2BP q2 µpP q 

µp2BP q2 µpP q

P PDrµ,k`1pQq

 

RPDrµ,kpQq P PDµ,1p2Rq

ÿ

ÿ

A0

RPDrµ,kpQq P PDµ1 p2Rq

A0 pCC06d`1A0´1qk

^ pP q pRq
ÿ

 µp2BP q2 µpP q

^ pP q  pQq

µp2BP q2

µpP

q.

P PDµ1 p2Qq

Therefore,

ÿ

^

pQq pP q

p1´q{2

µp2BP

q2

µpP

q

P PDrµpQq
 µp2BQq2

µpQq

`

ÿ

Ap01´qk{2

ÿ

µp2BP q2 µpP q

 µp2BQq2 ÿ
ÀA0,

k1

P PDrµ,kpQq

µpQq ` A0 ÿ Ap01´qk{2pCC06d`1

k1

^ pP q  pQq

µp2BP q2

µpP q,

A0´1

qk´1
P

ÿ^
PDµ1 p2Qq

pP q pQq



µp2BP q2 µpP q

P PDµp2Qq

taking A0 big enough for the last estimate. This yields (2.24).

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

17

3. P-doubling cubes, the Main Theorem, the corona decomposition, and the Main Lemma

In the rest of the paper we assume that µ is a compactly supported Radon measure in Rn`1 with polynomial growth of degree n and that Dµ is a David-Mattila dyadic lattice
satisfying the properties described in the preceding section, in particular, the ones in
Lemmas 2.1 and 2.6, with  " 9{10. By rescaling, we assume that Dµ,k is defined for all k  k0, with A´0 k0 « diampsupp µq, and we also assume that there is a unique cube in Dµ,k0 which coincides with the whole supp µ. Further, from now on, we allow all the constants
C and all implicit constants in the relations "À", "«", to depend on the parameters C0, A0
of the dyadic lattice of David-Mattila.

3.1. P-doubling cubes and the family hdkpQq. We denote

P pQq

"

ÿ
RPDµ :RQ

pQq pRqn`1

µp2BRq.

We say that a cube Q is P-doubling if

P pQq



Cd

µp2BQ pQqn

q

,

for Cd " 4An0 . We write

Q P DµP .

Notice that

P pQq

«C0

ÿ
RPDµ:RQ

pQq pRq

µp2BRq.

and thus saying that Q is P-doubling implies that

ÿ
RPDµ:RQ

pQq pRq

µp2BRq



Cd1

µp2BQq

for some Cd1 depending with another constant

on Cd

Cd. Conversely, the depending on Cd1 .

latter

condition

implies

that

Q

is

P

-doubling

From the properties of the David-Mattila lattice, we deduce the following.

Lemma 3.1. Suppose that C0 and A0 are chosen suitably. If Q is P-doubling, then Q P Dµdb. Also, any cube R P Dµ such that R X 2Q   and pRq " A0pQq belongs to Dµdb.

Proof. Let Q P DµP . Regarding the fist statement of the lemma, if Q R Dµdb, by (2.3) we have

µp2BQq  µp100BpQqq  C0´l µp100l`1BpQqq for all l  1 with 100l  C0. In particular, if Q1 denotes the parent of Q,

µp2BQq  C0´l µp2BQ1 q for all l  1 with 100l  C0.

So,

(3.1)

µp2BQq  C0´c log C0 µp2BQ1 q

18

D. DBROWSKI AND X. TOLSA

for some c  0. Using now that Q is P-doubling, we get

µp2BQq



C0´c

log

C0

Cd

pQ1qn`1 pQqn`1

µp2BQq

"

4C0´c

log

C0

A02n`1µp2BQq.

Recall now that, as explained in Remark 2.2, we assume that A0 " C0Cpnq, for some constant Cpnq depending just on n. Then, clearly, the preceding inequality fails if C0 is big enough, which gives the desired contradiction.

To prove the second statement of the lemma, suppose that Q P DµP,k and let R P Dµ be such that R X 2Q   and pRq " A0pQq. By the definition and the fact that R  BR
we get

|xQ ´ xR|  3pQq ` rpBRq.

Since

rpBRq

"

28 rpRq



28A0´k`1

"

1 2

C0´1A0

pQq



2500 pQq,

we deduce that

2BQ  2BR.
If R1 denotes the parent of R and Q3 the great-grandparent of Q (so that pQ3q " A30pQq " A0pR1q), by an analogous argument we infer that

2BR1  2BQ3 .

Then, using also that Q is P-doubling, we obtain

µp2BR1 q



µp2BQ3 q



Cd

^

pQ3q pQq

n`1 µp2BQq



Cd

A03pn`1q

µp2BRq

"

4A04n`3

µp2BRq.

If R R Dµdb, arguing as in (3.1), we infer that µp2BRq  C0´c log C0 µp2BR1 q,
which contradicts the previous statement if C0 is big enough (recalling that A0 " C0Cpnq).

Notice that, by the preceding lemma, if Q is P-doubling, then

ÿ
RPDµ :RQ

pQqn`1 pRqn`1

µp2BRq

ÀCd

µpQq.

For technical reasons that will be more evident below, it is appropriate to consider a discrete version of the density µ. Given Q P Dµ, we let

pQq " Ak0n

if

µp2BQq pQqn

P

rAk0n, A0pk`1qnq.

Clearly, pQq « µp2BQq. Notice also that if pQq " Ak0 and P is a son of Q, then

µp2BP q pP qn



µp2BQq pP qn

"

An0

µp2BQq pQqn

.

Thus,

(3.2)

pP q  An0 pQq for every son P of Q.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

19

Given Q P Dµ and k  1, we denote by hdkpQq the family of maximal cubes P P Dµ satisfying

(3.3)

pP q  pQq, pP q  Ak0npQq.

Lemma 3.2. Let Q P Dµ be P-doubling. Then, for k  4, every P P hdkpQq X Dµp4Qq is also P-doubling and moreover pP q " Ak0npQq.
Remark that this lemma implies that, under the assumptions in the lemma,
pP q « Ak0n pQq for all k  1.

Proof. First we show that pP q " Ak0npQq. The fact that pP q  Ak0n pQq is clear. To see the converse inequality, denote by Qp the parent of Q. Notice that any cube S  4Q with pSq " pQq satisfies

`

µp2BS q pSqn



µ 2BQp pQqn

"

An0

µp2BQp q pQpqn



A0n`1 PpQq



Cd A0n`1

µp2BQq pQqn



A30n

µp2BQq pQqn

.

Therefore,

pSq  A30n pQq.

As a consequence, if P P hdkpQq X Dµp4Qq with k  4, then its parent Pp satisfies pPpq  Ak0n pQq, which implies that pP q  Ak0n pQq.
To see that P is P-doubling, we split

(3.4)

PpP q

"

ÿ
RPDµ :RP

pP q pRqn`1

µp2BRq

`

ÿ
RPDµ :RP

pP q pRqn`1

µp2BRq.

pRqpQq

pRqpQq

The cubes R in the first sum on the right hand side satisfy pRq  pP q, by the definition of hdkpQq. Thus,

ÿ
RPDµ :RP

pP q pRqn`1

µp2BRq



ÿ An0
RPDµ :RP

pP q pRq

pRq



2An0

pP q



2An0

µp2BP pP qn

q

.

pRqpQq

pRqpQq

Concerning the last sum in (3.4), notice that the cubes R in that sum satisfy pRq  pQq. Using that A0 " 1, it follows easily that 2BR  2BR1 , where R1 is the cube containing Q

20

D. DBROWSKI AND X. TOLSA

such that pR1q " A0 pRq. Consequently, denoting by Qp the parent of Q,

ÿ
RPDµ :RP

pP q pRqn`1

µp2BRq



ÿ
R1 PDµ :R1 Qp

pP q A´0 1pR1q

µp2BR1 q pA´0 1pR1qqn

pRqpQq

"

A0n`1

pP q pQq

ÿ

pQq pR1qn`1

µp2BR1 q

R1 PDµ :R1 Qp



An0

P pQq



An0 Cd

µp2Qq pQqn



A20nCd

pQq



A20nCd A40n

pP q 

Cd A20n

µp2BP q pP qn

,

where in the last two lines we took into account that pP q  A´0 1pQq (because P P hdkpQq for some k  4), that Q is P-doubling, and again that P P hdkpQq for some k  4.

From the estimates above, we infer that

^



PpP q 

2An0

`

Cd A20n

µp2BP q pP qn



Cd

µp2BP pP qn

q

,

since Cd " 4An0 .

Lemma 3.3. Let Q0, Q1, . . . , Qm be a family of cubes from Dµ such that Qj is a child of Qj´1 for 1  j  m. Suppose that Qj is not P-doubling for 1  j  m. Then

(3.5)

µp2BQm q pQmqn



A´0 m{2 PpQ0q.

and

(3.6)

PpQmq  2A´0 m{2 PpQ0q.

Proof.

Let

us

denote

r pRq "

µp2BR pRqn

q

,

so

that

P pQq

"

ÿ
RPDµ:RQ

pQq pRq

r pRq.

For 1  j  m, the fact that Qj is not P-doubling implies that

(3.7)

r pQjq



1 Cd

PpQj q

"

1 ~jÿ´1 Cd k"0

pQj q pQj´kq

r pQj´kq

`

pQj q pQ0q

¸ PpQ0q .

We will prove (3.5) by induction on j. For j " 0 this is in an immediate consequence of the definition of PpQ0q. Suppose that (3.5) holds for 0  h  j, with j  m ´ 1, and let

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

21

us consider the case j ` 1. From (3.7) and the induction hypothesis we get

r pQj`1q



~

1 Cd

r pQj`1q

~

ÿj `
k"1

pQj`1q pQj`1´kq

r pQj`1´kq `

¸

pQj`1q pQ0q

P

pQ0

q

¸

"

1 Cd

r pQj`1q

~

ÿj ` A´0 k
k"1

r pQj`1´kq ` A0´j´1 PpQ0q

¸

1 Cd

r pQj`1q ` ÿj A´0 k Ap0´j´1`kq{2PpQ0q ` A0´j´1 PpQ0q
k"1

Since we obtain

ÿj A´0 k Ap0´j´1`kq{2 " Ap0´j´1q{2 ÿj A0´k{2  A´0 j{2,

k"1

k"1

r pQj`1q



1 Cd

`r pQj

`1q

`

A´0 j{2

P

pQ0q

`

A0´j´1

P

pQ0

 q



1 Cd

`r pQj

`1q

`

2

A´0 j{2

P

 pQ0q

It is straightforward to check that this yields r pQj`1q  A´0 pj`1q{2 PpQ0q. The estimate (3.6) follows easily from (3.5):

P pQm q

"

mÿ´1
k"0

pQmq pQm´k q

r pQm´kq

`

pQmq pQ0q

P pQ0 q

 mÿ´1 A´0 k A0´pm´kq{2 PpQ0q ` A´0 m PpQ0q
k"0

 A´m{2 mÿ´1 A0´k{2 PpQ0q ` A´0 m PpQ0q  2 A´0 m{2 PpQ0q.
k"0

3.2. The Main Theorem. For a given   1 and Q P Dµ, we consider the energy

EpQq "

ÿ

^

pP q pQq

3{4

pP

q2

µpP

q,

P PDµpQq

Given a fixed constant M0 " 1, we write Q P HE (which stands for "high energy") if

Ep4Qq  M02 pQq2 µpQq.

Theorem 3.4 (Main Theorem). Let µ be a Radon measure in Rn`1 such that

µpBpx, rqq  0 rn for all x P supp µ and all r  0.

22

D. DBROWSKI AND X. TOLSA

Then, (3.8)

for

any choice ÿ

of

M0

µ,2 p2BQ q2

 1, pQq µpQq



C

`}Rµ}2L2pµq

`

02

}µ}

`

ÿ

 Ep4Qq ,

QPDµ

QPDµP XHE

with C depending on M0.

Notice that Theorem 1.1 follows from the previous result. Indeed, the assumptions in

Theorem 1.1 imply that there are no P-doubling cubes from HE if M0 is big enough since,

for any Q P DµP,

Ep4Qq "

ÿ

^

pP q pQq

3{4

pP

q2

µpP

q

P PDµp4Qq

À


B pxQ ,20pQqq

8
0

^

µpBpx,

rq

X

BpxQ, rn

20pQqq

2

^ r 3{4 pQq

dr r

dµpxq

"

EpµtBpxQ,20pQqqq pQq3{4

À

M

µpBpxQ, 40pQqqq2

µpBpxQ, 40pQqqq

«

M

pQq2

µpQq.

So the last sum on the right hand side of (3.8) vanishes in this case. Further, it is also easy

to

check

that 8
0

µ,2px, rq2

µpBpx, rqq

dr r

dµpxq

À

ÿ
QPDµ

µ,2p2BQq2

pQq µpQq.

Putting altogether, from (3.8) we get (1.4).

3.3. The corona decomposition and the Main Lemma. In order to prove Theo-
rem 3.4 we have to use a suitable corona decomposition which splits the lattice Dµ into appropriate trees. We need first to introduce some notation.
Given a big integer k  10 to be fixed below and R P DµP , we denote

 " A0k n,

HDpRq " hdkpRq.

Also, we consider a small constant 0 P p0, ´Cpnqq which will be chosen below too, with Cpnq  2. We let LDpRq be the family of cubes Q P Dµ which are maximal and satisfy

pQq  pRq and PpQq  0 pRq.

We denote by StoppRq the family of maximal cubes from HDpRq Y LDpRq which are con-

tained in R. Also, we let EndpRq be the family of maximal P-doubling cubes which

are contained in some cube from StoppRq. Notice that, by Lemma 3.2, the cubes from

HDpRq X Dµp4Rq are P-doubling, and thus any cube from StoppRq X HDpRq belongs to EndpRq. Finally, we let TreepRq denote the subfamily of the cubes from DµpRq which are

not strictly contained in any cube from EndpRq, and we say that R is the root of the tree.

Next we define the family Top inductively. We assume that supp µ coincides with a cube

S0, and then we set Top0 " tS0u. Assuming Topk to be defined, we let

Topk`1 "

EndpRq.

RPTopk

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

23

Then we let

 Top " Topk.

k0

Notice that we have



Dµ "

TreepRq.

RPTop

Two trees TreepRq, TreepR1q, with R, R1 P Top, R  R1 can only intersect if one of the

roots is and ending cube of the other, i.e., R1 P EndpRq or R P EndpR1q.

The main step for the proof of Theorem 3.4 consists of proving the following.

Main Lemma 3.5. Let µ be a Radon measure in Rn`1 such that

µpBpx, rqq  0 rn for all x P supp µ and all r  0.

Then, (3.9)

for

any

cÿhoice of M0  1, pRq2 µpRq 

C

`}Rµ}2L2pµq

`

02

}µ}

`

ÿ

 Ep4Qq ,

RPTop

QPDµP XHE

with C depending on M0.

The next Sections 4-8 are devoted to the proof of this lemma. Later, in Section 9 we will complete the proof of Theorem 3.4.

4. The cubes with moderate decrement of Wolff energy and the associated tractable trees

From now on we assume that we are under the assumptions of Main Lemma 3.5. Further,

for a family I  Dµ, we denote

ÿ

pIq " pP q2 µpP q.

P PI

4.1. The family MDW. For technical reasons, we need to define a kind of variant of the family HDpRq. Given R P DµP , we denote

°

"

1´

1 N

"

Ak0p1´

1 N

qn ,

HD°pRq

"

hdkp1´

1 N

q,

where N is some big integer depending on n that will be fixed below. Regarding the

constant 0 in the definition of LDpRq in Section 3.3, we will choose 0 of the form

0

"

´N0´

1 2N

"

A0´n

k

pN0

`

1 2N

q

for some big integer N0 depending on n, chosen later on. Further we assume that k is a

multiple

of

2N ,

so

that

kpN0

`

1 2N

q

and

kp1

´

1 N

q

are

integers.

We let BadpRq be the family of maximal cubes from LDpRq Y HD°pRq (not necessarily

contained in R) and we denote

Stop°pRq " BadpRq X DµpRq.
We say that a cube R P Dµ has moderate decrement of Wolff energy, and we write R P MDW, if R is P-doubling and

(4.1)

pHD°pRq X Stop°pRqq  B´1 pRq,

24

D. DBROWSKI AND X. TOLSA

where

1
B " °100n .

Lemma 4.1. For R P TopzMDW, we have

(4.2)

pEndpRqq  22{N B´1 pRq.

Proof. We have ÿ
pEndpRqq " pHDpRq X StoppRqq `

ÿ pQq.

QPLDpRqXStoppRq P PEndpRq:P Q

Clearly,

since

any

cube

from

HDpRq

is

contained ÿ

in

some

cube

from

HD°pRÿq,

we

infer

that

pHDpRq X EndpRqq " 2 pRq2

µpQq  2 pRq2

µpQq

QPHDpRqXEndpRq

QPHD°pRqXStop°pRq

"

2 2°

pHD°pRq

X

Stop°pRqq



2{N B´1

pRq.

For P P EndpRqzHDpRq, there exists some Q such that P  Q P LDpRq X StoppRq. By

(3.5) we have

pP q À PpQq  0 pRq,

and thus pEndpRqq  2{N B´1 pRq ` C02 pRq  22{N B´1 pRq,
since 0 ! B´1.

We will take N big enough so that

22{N

B´1



1. 2

Lemma 4.2. We have

pTopq À pTop X MDWq ` 02 }µ}.

Proof.

For

each

R

P

tS0

u

Y

pTop

X

MDWq, we 

denote

I0pRq " tRu,

and

for

k

 0,

Ik`1pRq "

EndpQqzMDW.

QPIk pRq

In this way, we have (4.3)

 Top "

 Ik pRq.

RPtS0uYpTopXMDWq k0

Indeed, for each Q P Top, let R be the minimal cube from Top X MDW that contains Q, and in case this does not exists, let R " S0. Then it follows that
Q P IkpRq.
k0

Given R P tS0uYpTopXMDWq, for each k  1 and Q P IkpRq, since IkpRq  TopzMDW,
by (4.2) we have pEndpQqzMDWq  22{N B´1 pQq  1 pQq. 2

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

25

Then we deduce that

ÿ

1ÿ

1

pIk`1pRqq "

pEndpQqzMDWq  2

pQq " 2 pIkpRqq.

QPIkpRq

QPIkpRq

So 1
pIkpRqq  2k pRq for each k  0.

Then, by (4.3),

ÿ pTopq "

ÿ

ÿ

pIkpRqq 

ÿ

1 2k

pRq

RPtS0uYpTopXMDWq k0

RPtS0uYpTopXMDWq k0

« pS0q ` pTop X MDWq À 02 }µ} ` pTop X MDWq.

4.2. The enlarged cubes. For R P MDW, the fact that the cubes from family HD°pRq X Stop°pRq may be located close to supp µzR may cause problems when trying to obtain estimates involving the Riesz transform. For this reason we need to introduce some "enlarged
cubes".
Given j  0 and R P Dµ,k, we let 
ejpRq " R Y Q,

where the last union runs over the cubes Q P Dµ,k`1 such that

(4.4)

distpxR, Qq



pRq 2

`

2jpQq.

We say that ejpRq is an enlarged cube. Notice that, since diampQq  pQq,

(4.5)

supp

µ

X

` B xR,

1 2

pRq

`

 2jpQq



ej

pRq



` B xR,

1 2

pRq

`

p2j

`

 1qpQq .

Also, we have

(4.6)

ejpRq  2R

for

0



j



3 4

A0,

since, for any Q P Dµ,k`1 satisfying (4.4), its parent satisfies Qp

distpxR, Qpq



pRq 2

`

2jA´0 1pQpq



2pRq.

For R P MDW, we let

Stop°pejpRqq " BadpRq X DµpejpRqq,
where DµpejpRqq stands for the family of cubes from Dµ which are contained in ejpRq and have side length at most pRq. Notice that we are not assuming R P Top.

Lemma 4.3. For any R P MDW there exists some j, with 10  j  A0{4 such that

(4.7)

pHD°pRq X Stop°pejpRqqq  B1{4pHD°pRq X Stop°pej´10pRqqq,

assuming A0 big enough, depending just on n.

26

D. DBROWSKI AND X. TOLSA

Proof. Given R P MDW, suppose that such j does not exist. Let j0 be the largest integer which is multiple of 10 and smaller that A0{4. Then we get

1
pHD°pRq X Stop°pej0 pRqqq  B 4 pHD°pRq X Stop°pej0´10pRqqq



.

.

.



` B

1 4



j0 10

´1

pHD°pRq

X

Stop°pRqq

(4.1)


B

j0 40

´

5 4

pRq.

By (4.6), we have ej0pRq  2R and thus ÿ
pHD°pRq X Stop°pej0pRqqq "

2°pRq2µpQq  2°pRq2µp2Rq.

QPHD°pRqXStop°pej0 pRqq

Since R is P-doubling (and in particular R P Dµdb), denoting by Rp the parent of R, we derive

(4.8)

µp2Rq



µp2BRp q



pRpqn`1 pRq

P pRq



Cd

A0n`1µp2BRq



C0

Cd

A0n`1µpRq.

So we deduce that

B

j0 40

´

5 4

pRq



C0

Cd

A0n`1

2°pRq,

or equivalently, recalling the choice of B and Cd,

´

¯

1
 100n
°

j0 40

´

5 4

´2  4C0 A02n`1.

Since °  An0 and j0 « A0, it is clear that this inequality is violated if A0 is big enough, depending just on n.

Given R P MDW, let j  10 be minimal such that (4.7) holds. We denote hpRq " j ´ 10 and we write

epRq " ehpRqpRq,

e1pRq " ehpRq`1pRq, e2pRq " ehpRq`2pRq, epkqpRq " ehpRq`kpRq,

for k  1. We let

BpepRqq Bpe1pRqq Bpe2pRqq BpepkqpRqq

" " " "

` B`xR, B`xR, B xR,
` B xR,

p

1 2

p

1 2

p

1 2

p

1 2

` ` ` `

2222AAAA´0´0´0´0 1111hppphhhpRpppRRRqqqqq```pR12kqqqqqqq,pppRRRqqq,,.

By construction (see (4.5)) we have

Bpe1pRqq X supp µ  e1pRq,

and analogously replacing e1pRq by epRq or e2pRq. Remark also that

epRq  Bpe1pRqq and distpepRq, BBpe1pRqqq  A´0 1pRq,

and, analogously,

e1pRq  Bpe2pRqq and distpe1pRq, BBpe2pRqqq  A´0 1pRq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

27

Lemma 4.4. For each R P MDW we have

Bpe2pRqq  p1 ` 8A´0 1q BpepRqq  Bpep6qpRqq,

and more generally, for k  2 such that hpRq ` k ´ 2  A0{2,

BpepkqpRqq  p1 ` 8A´0 1q Bpepk´2qpRqq  Bpepk`4qpRqq.

Also,

Bpep10q

pRqq



B

` xR,

3 2

 pRq .

Proof. This follows from straightforward calculations. Indeed,

rpBpepkqpRqqq

"

p

1 2

`

2A´0 1phpRq

`

kqqpRq

p

1 2

`

2A´0 1phpRq

`

k

´

2qqpRq

rpBpepk´2qpRqqq

"

1

`

1

`

8A´0 1 4A´0 1phpRq

`

k

´

2q

rpBpepk´2qpRqqq



p1

`

8A´0 1q

rpBpepk´2qpRqqq.

Also, using that hpRq ` k ´ 2  A0{2,

p1

`

8A´0 1q

rpBpepk´2qpRqqq

" 

p1 `1
2

`

8A´0 1q

`

1 2

`

` 2A´0 1phpRq

2A´0 1phpRq ` k ´ 2q `

 ` k ´ 2q pRq 4A´0 1 ` 8A´0 1

pRq

" rpBpepk`4qpRqqq.

The last statement of the lemma follows from the fact that hpRq ` 10  A0{4  A0{2:

Bpep10qpRqq

"

` B xR,

p

1 2

`

2A´0 1phpRq

`

 10qqpRq



` B xR,

p

1 2

`

 2qpRq

"

` B xR,

3 2

 pRq .

4.3. Generalized trees and negligible cubes. Next we need to define some families
that can be considered as "generalized trees". First, we introduce some additional notation regarding the stopping cubes. For R P DµP we set

HD1pRq " Stop°pRq X HD°pRq.

Assume additionally that R P MDW. We write Stop°pepRqq " Stop°pehpRqpRqq and Stop°pe1pRqq " Stop°pehpRq`1pRqq. Furthermore,

HD1pepRqq " Stop°pepRqq X HD°pRq,

and

HD1pe1pRqq " Stop°pe1pRqq X HD°pRq.

We define HD1pepkqpRqq for 2  k  10 analogously. Also, we set



HD2pe1pRqq "

pStop°pQq X HD°pQqq

QPHD1 pe1 pRqq

and (4.9)

Stop2pe1pRqq " `Stop°pe1pRqqzHD1pe1pRqq Y



Stop°pQq.

QPHD1 pe1 pRqq

28

D. DBROWSKI AND X. TOLSA

We let TStoppe1pRqq be the family of cubes made up of R and all the cubes of the next generations which are contained in e1pRq but are not strictly contained in any cube from Stop2pe1pRqq.
Observe that the defining property of MDW (4.1) can now be rewritten as

(4.10)

pRq  B pHD1pRqq.

Moreover, by (4.7) and the definition of epRq we have

(4.11)

pHD1pep10qpRqqq  B1{4pHD1pepRqqq.

We define now the family of negligible cubes. We say that a cube Q P TStoppe1pRqq is negligible for TStoppe1pRqq, and we write Q P Negpe1pRqq if there does not exist any cube from TStoppe1pRqq that contains Q and is P-doubling.

Lemma 4.5. Let R P MDW. If Q P Negpe1pRqq, then Q  e1pRqzR, Q is not contained in any cube from HD1pe1pRqq, and

(4.12)

pQq Á 02 pRq.

Proof. Let Q P Negpe1pRqq. We have Q  e1pRqzR due to the fact that R is P-doubling. For the same reason, Q is not contained in any cube from HD1pe1pRqq.
To prove (4.12), assume that pQq  A´0 2pRq. Otherwise the inequality is immediate. By Lemma 3.3, since all the ancestors Q1, . . . , Qm of Q that are contained in e1pRq are not
P-doubling, it follows that Q1 (the parent of Q) satisfies

PpQ1q À A´0 m{2´1 PpQmq.

Because Qm  e1pRq  2R and pQmq " A´0 1pRq, it is easy to see that PpQmq À PpRq À

Cd pRq, and so

P pQ1 q

À

A´0 m{2

pRq

«

^ pQq 1{2 pRq

pRq.

By the definition of LDpRq, we know that PpQ1q  0 pRq, which together with the previous estimate yields (4.12).

The cubes from Stop2pe1pRqq need not be P-doubling, which is problematic for some of the estimates involving the Riesz transform localized around the trees TStoppe1pRqq that will be required later. For this reason, we need to consider enlarged versions of them. For R P MDW, we let Endpe1pRqq be the family made up of the following cubes:
, the cubes from Stop2pe1pRqq X Negpe1pRqq, , the cubes that are contained in any cube from Stop2pe1pRqqzNegpe1pRqq which are
P-doubling and, moreover, are maximal.
Notice that all the cubes from Endpe1pRqq are P-doubling, with the exception of the ones from Negpe1pRqq. We let T pe1pRqq be the family of cubes that are contained in e1pRq and are not strictly contained in any cube from Endpe1pRqq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

29

4.4. Tractable trees. Given R P MDW, we say that T pe1pRqq is tractable (or that R is

tractable) if

pHD2pe1pRqqq  B pHD1pepRqqq.

In this case we write R P Trc.

Our next objective consists in showing how we can associate a family of tractable trees

to any R P MDW X Top, so that we can reduce the estimate of pTopq to estimating the

Haar coefficients of Rµ from below on such family of tractable trees. First we need the

following lemma.

Lemma 4.6. Let R P MDW be such that T pe1pRqq is not tractable. Then there exists a family GHpRq  HD1pe1pRqq X MDW satisfying:

(a) The balls Bpe2pQqq, with Q P GHpRq are pairwise disjoint.

(b) For every Q P GHpRq, pHD1pepQqqq  pHD1pQqq  B1{2pQq.

(c)

ÿ

B 1{4

pHD1pepQqqq Á pHD2pe1pRqqq.

QPGHpRq

The name "GH" stands for "good high (density)". Remark that the property (c) and the

fact that R R Trc yield

ÿ

(4.13)

pHD1pepQqqq Á B3{4 pHD1pepRqqq,

QPGHpRq

which is suitable for iteration.

Proof of Lemma 4.6. Let R P MDW be such that T pe1pRqq is not tractable. Notice first

that

pHD1pe1pRqqq

(4.11)


B1{4pHD1pepRqqq



B´3{4pHD2pe1pRqqq.

Let I  HD1pe1pRqq be the subfamily of the cubes Q such that

pHD1pQqq  B1{2pQq.

Then we have

ÿ

ÿ

pHD2pe1pRqq X DµpQqq  B1{2 pQq  B1{2pHD1pe1pRqqq

QPI

QPI



B 1{2 B 3{4

pHD2pe1pRqqq



1 2

pHD2pe1pRqqq.

Therefore,

(4.14) ÿ

ÿ pHD2pe1pRqq X DµpQqq " pHD2pe1pRqqq ´ pHD2pe1pRqq X DµpQqq

QPHD1 pe1 pRqqzI

QPI



1 2

pHD2pe1pRqqq.

Next we will choose a family J  HD1pe1pRqqzI satisfying

(i) The balls Bpe2pQqq, with Q P J, are pairwise disjoint.

30
(ii)

D. DBROWSKI AND X. TOLSA

ÿ

ÿ

B1{4 pHD1pepQqqq Á

pHD2pe1pRqq X DµpQqq.

QPJ

QPHD1pe1pRqqzI

Then, choosing GHpRq " J we will be done. Indeed, the property (a) in the statement of the lemma is the same as (i), and the property (b) is a consequence of the fact that J  Ic and the definition of I. This also implies that GHpRq  MDW. Finally, the property (c) follows from (4.14) and (ii).
Let us see how J can be constructed. By the covering Theorem 9.31 from [To3], there is a family J0  HD1pe1pRqqzI such that
1) The balls Bpe2pQqq, with Q P J0, have finite superposition, that is,
ÿ Bpe2pQqq  C,
QPJ0

and 2)





Bpe2pQqq  p1 ` 8A´0 1q Bpe2pQqq,

QPHD1 pe1 pRqqzI

QPJ0

Actually, in Theorem 9.31 from [To3] the result above is stated for a finite family of

balls. However, it is easy to check that the same arguments work as soon as the family

HD1pe1pRqqzI is countable and can be ordered so that HD1pe1pRqqzI " tQ1, Q2, . . .u, with

pQ1q  pQ2q  . . .. Further, one can check that the constant C in 1) does not exceed some absolute constant times A0n`1.
From the finite superposition property 1), by rather standard arguments which are

analogous to the ones in the proof of Besicovitch's covering theorem in [Ma, Theorem 2.7],

say, one deduces that J0 can be split into m0 subfamilies J1, . . . , Jm0 so that, for each k, the balls tBpe2pQqq : Q P Jku are pairwise disjoint, with m0  CpA0q.

Notice that the condition 2) and Lemma 4.4 applied to Q ensure that

(4.15) 







Q

Bpe2pQqq 

p1 ` 8A´0 1q Bpe2pQqq 

Bpep8qpQqq.

QPHD1 pe1 pRqqzI

QPHD1 pe1 pRqqzI

QPJ0

QPJ0

Next we choose J :" Jk to be the family such that
ÿ pHD1pepQqqq
QPJk

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

31

is maximal among J1, . . . , Jm0 , so that

ÿ pHD1pepQqqq
QPJ



1 m0

ÿ pHD1pepQqqq
QPJ0

(4.11)


1 m0 B1{4

ÿ pHD1pep8qpQqqq
QPJ0

p4.15q 

m0

1 B 1{4

ÿ
QPHD1pe1pRqqzI

pHD1pQqq

"

1 m0 B1{4

ÿ pHD2pe1pRqq X DµpQqq.
QPHD1 pe1 pRqqzI

This proves (ii).

Given R P TopXMDW, we will construct now a subfamily of cubes from MDW generated by R, which we will denote GenpRq, by iterating the construction of Lemma 4.6. The algorithm goes as follows. Given R P Top X MDW, we denote

Gen0pRq " tRu.

If R P Trc, we set Gen1pRq " , and otherwise

Gen1pRq " GHpRq,

where GHpRq is defined in Lemma 4.6. For j  2, we set



GenjpRq "

GHpQq.

QPGenj´1pRqzTrc

For j  0, we also set

TrcjpRq " GenjpRq X Trc,

and





GenpRq " GenjpRq, TrcpRq " TrcjpRq.

j0

j0

Lemma 4.7. For R P Top X MDW, we have





(4.16)

Q

Q  Bpe2pRqq.

QPTrcpRq

QPGenpRq

Also, (4.17)

ÿ

ÿ

pHD1pepRqqq  B´j{2

pHD1pepQqqq.

j0

QPTrcj pRq

Proof. The first inclusion in (4.16) holds because TrcpRq  GenpRq. So we only have to

show the second inclusion.

By construction, for any R1 P MDW, GHpR1q  HD1pe1pR1qq, and thus any Q P GHpR1q

is contained in e1pR1q. This implies that

|xR1

´

xQ|



rpBpe1pR1qqq

`

1 2

pQq



´ 1

`

2A´0 1

`

1 2

¯ A´0 1 pR1q



1.1 pR1q.

32

D. DBROWSKI AND X. TOLSA

Then, given Q P GenjpRq, x P Q, and 0  k  j, if we denote by Rk the cube from GenkpRq such that Q P Genj´kpRkq, we have

jÿ´1 |xR ´ x|  |xR ´ xR1 | ` |xRk ´ xRk`1| ` |xQ ´ x|
k"1



rpBpe1pRqqq

`

1 2

A´0 1

pRq

`

jÿ´1
k"1

1.1

A´0 kpRq

`

1 2

A´0 1

pRq

 rpBpe1pRqqq ` 2 A´0 1 pRq,

which shows that Q  Bpe2pRqq. To prove the second statement in the lemma, observe that, for Q P Genj´1pRqzTrc, by
(4.13) applied to Q we have ÿ pHD1pepP qqq  c B3{4 pHD1pepQqqq  B1{2 pHD1pepQqqq,
P PGHpQq

assuming °, and thus B, big enough. Therefore,

ÿ

ÿ

pHD1pepP qq "

ÿ pHD1pepP qqq

P PGenj pRq

QPGenj´1pRqÿ zTrc P PGHpQq

 B1{2

pHD1pepQqqq

QPGenj´1pRqzTrc

So,

ÿ

ÿ

ÿ

pHD1pepQqqq 

pHD1pepQqqq ` B´1{2

pHD1pepP qqq.

QPGenj´1pRq

QPTrcj´1pRq

P PGenj pRq

Iterating this estimate, and taking into account that, by the polynomial growth of µ, Genj´1pRq "  for some large j, we get (4.17).

5. The layers Fhj and Lhj , and the tractable trees

We denote

Fj "

R

P

Top

X

MDW

:

pRq

"

An0 j

( ,

so that

 Top X MDW " Fj.
jPZ

Next we split Fj into layers Fhj , h  1, which are defined as follows: F1j is the family

of Fj

zmahkx"´im11 Fahjl ´c1u.bSeos

from Fj, and by induction we have the splitting

Fhj

is

the

family

of

maximal

cubes

from



Top X MDW "

Fhj .

jPZ h1

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

33

Our next objective is to choose a suitable subfamily Lhj  Fhj , for each j, h. By the covering Theorem 9.31 from [To3], there is a family J0  Fhj such that1

1) no ball Bpep4qpQqq, with Q P J0, is contained in any other ball Bpep4qpQ1qq, with

Q1 P Fhj , Q1  Q,

2) the balls Bpep4qpQqq, with Q P J0, have finite superposition, and

3) every ball Bpep4qpQqq, with Q P Fhj , is contained in some ball p1`8A´0 1q Bpep4qpRqq,

with

R

P

J0.

Consequently, 



Bpep4qpQqq  p1 ` 8A´0 1q Bpep4qpRqq.

QPFhj

RPJ0

From the finite superposition property 2), as in the proof of Lemma 4.6, the family J0 can

be split into m0 subfamilies J1, . . . , Jm0 so that, for each k, the balls tBpep4qpQqq : Q P Jku

are pairwise disjoint, with m0  CpA0q. The condition 3) and Lemma 4.4 applied to Q

ensure that









(5.1)

Q

Bpep4qpQqq 

p1 ` 8A´0 1q Bpep4qpQqq 

Bpep10qpQqq.

QPFhj

QPFhj

QPJ0

QPJ0

Next we choose Lhj " Jk to be the family such that ÿ pHD1pepQqqq
QPJk

is maximal among J1, . . . , Jm0 , so that

ÿ pHD1pepQqqq 
QPLhj

1 m0

ÿ pHD1pepQqqq
QPJ0

(4.11)


1 m0 B1{4

ÿ
QPJ0

pHD1pep10qpQqqq

p5.1q 1 ÿ  m0 B1{4 QPFhj pHD1pQqq.

So we have:

Lemma 5.1. The family Lhj satisfies:

(i) no ball Bpep4qpQqq, with Q P Lhj , is contained in any other ball Bpep4qpQ1qq, with

Q1 P Fhj , Q1  Q,

(ii) the balls Bpep4qpQqq, with Q P Lhj , are pairwise disjoint, and

(iii)

ÿ

ÿ

pHD1pQqq À B1{4

pHD1pepQqqq.

QPFhj

QPLhj

1Actually the property 1) is not stated in that theorem, however this can be obtained by preselecting a subfamily of maximal balls from Fhj with respect to inclusion and then applying the theorem to the
maximal subfamily.

34

D. DBROWSKI AND X. TOLSA

We denote

 Lj " Lhj ,
h1





L " Lj "

Lhj .

jPZ

jPZ h1

By the property (iii) in the lemma, we have

ÿ

ÿÿ

(5.2)

pHD1pRqq "

pHD1pRqq

RPTopXMDW

jPZ, h0ÿRPFhj ÿ

ÿ

À B1{4

pHD1pepRqqq " B1{4 pHD1pepRqqq.

jPZ, h0 RPLhj

RPL

Lemma 5.2. We have

ÿÿ

ÿ

pTopq À B5{4

B´k{2

pHD1pepQqqq ` 02 }µ}.

RPL k0

QPTrck pRq

Proof. This is an immediate consequence of Lemma 4.2 and our earlier estimates:

pTopq À pTop X MDWq ` 02 }µ}

(4.10)
ÀB

ÿ

pHD1pRqq ` 02 }µ}

RPTopXMDW

p5.2q À

B 5{4

ÿ

pHD1pepRqqq

`

02 }µ}

RPL

(4.17)
À

B 5{4

ÿ

ÿ

B´k{2

ÿ

pHD1pepQqqq ` 02 }µ}.

RPL k0

QPTrck pRq

To be able to apply later the preceding lemma, we need to get an estimate for #LpP, kq,

where P P Dµ, k  0 and

LpP, kq "

R

P

L

:

DQ

P

TrckpRq

such

that

P

P

T

pe1

( pQqq .

For j P Z set also

LjpP, kq "

R

P

Lj

:

DQ

P

Trck pRq

such

that

P

P

T

pe1

( pQqq ,



so that LpP, kq " j LjpP, kq. The following important technical result is the main achieve-

ment in this section.

Lemma 5.3. There exists some constant C1 such that, for all P P Dµ and all k  0,

#LpP, kq  C1 log °.

More precisely, for each P P Dµ and k  0

(5.3)

#tj P Z : LjpP, kq  u À log °,

and for each j P Z, P P Dµ, k  0,

(5.4)

#LjpP, kq  C2.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

35

We prove first (5.3).

Proof of (5.3). Let Pr1 be the smallest P-doubling cube containing P , and let Pr2 be be the smallest P-doubling cube strictly containing Pr1. Suppose that R P LjpP, kq. There are two cases to consider.
Case 1. There exists Q P TrckpRq such that P P T pe1pQqqzNegpe1pQqq. We claim that in this case we have Pri P TStoppe1pQqq for some i P t1, 2u. Indeed, if P P TStoppe1pQqqzNegpe1pQqq, then necessarily Pr1 P TStoppe1pQqq, by the definition of the family Negpe1pQqq. If P R TStoppe1pQqq, then either P " Pr1 P Endpe1pQqq, in which case Pr2 P TStoppe1pQqq, or P  Pr1 and we have Pr1 P TStoppe1pQqq, again by the definition of Negpe1pQqq.
Choosing i P t1, 2u such that Pri P TStoppe1pQqq we see by the definition of TStoppe1pQqq that
0 pQq À pPriq  2° pQq. Since pQq " k°pRq (by the definition of TrckpRq), the above is equivalent to
´° 2pPriq  k°pRq  C0´1pPriq
We have pRq " An0j because R P LjpP, kq, and so it follows that
´C log °  j ` c k log ° ´ c1 log pPriq  C| log 0| " C1 log °.
Recall that k  0 is fixed, and pPriq is equal to either pPr1q or pPr2q, where both of these values depend only on P , which is fixed. Thus, there are at most C2 log ° integers j such that there exists R P LjpP, kq and Q P TrckpRq for which P P T pe1pQqqzNegpe1pQqq.
Case 2. Suppose now that there exists Q P TrckpRq such that P P Negpe1pQqq  T pe1pQqq. In this case, by Lemma 4.5, pP q Á 0´2 pQq. Hence, there are at most C | log 0| « log  cubes Q such that P P T pe1pQqq X Negpe1pQqq.
For each such cube we have pQq " k°pRq " k°An0j. Thus, for each cube Q as above there is exactly one value of j such that there may exist R P Lj with Q P TrckpRq. It follows that there are at most C3 log ° values of j such that there exists R P LjpP, kq and Q P TrckpRq for which P P T pe1pQqq X Negpe1pQqq.
Putting the estimates from both cases together we get that LjpP, kq is non-empty for at most pC2 ` C3q log ° integers j.

The proof of (5.4) is more involved. Its key ingredient is the following auxiliary result.

Lemma 5.4. There exists some positive integer N1 depending on n (with N1  C N0N )

such that the following holds. For a given   0, consider the interval

I

"

` 

´

1 4N

0,



1
 4N

 ° .

Let R1, R2, . . . , RN1 be cubes from Top such that Rk`1 P EndpRkq for k  1. Then at least one of the cubes Rk, with 1  k  N1, satisfies

pRkq R I.

Proof. Recall that

°

"

1´

1 N

and

0

"

´N0

´

1 2N

,

36

D. DBROWSKI AND X. TOLSA

so that

I

"

` 

´N0

´

3 4N

,



1´

3 4N

 .

Consider a sequence R1, R2, . . . , RN1 of cubes from Top such that Rk`1 P EndpRkq for k  1. By the definition of EndpRkq there are only two possibilities: either Rk`1 P HDpRkq, or Rk`1 is a maximal P-doubling cube contained in some cube from LDpRkq. Note that in the former case we have pRk`1q " pRkq, and in the latter case we have pRk`1q  C0pRkq, by (3.5) and the definition of LDpRkq.
The key observation is the following:

(5.5)

pRk q







´1 3N

ñ either pRk`1q R I or pRk`1q "  pRkq.

This follows from the fact that, in the case pRk`1q P I, we have Rk`1 P HDpRkq because

otherwise

pRk`1q  C0 pRkq



C



0



´1 3N



´1
 0  4N .

Analogously,

(5.6)

pRkq







´3 4N

ñ either pRk`1q R I or pRk`1q  C0pRkq,

because, in the case pRk`1q P I, we have Rk`1 R HDpRkq, since otherwise

pRk`1q

"



pRk q





1´

3 4N

.

To prove the lemma, suppose that pR1q P I. Otherwise we are done. By applying (5.5) N0 ` 1 times, we deduce that either pRkq R I for some k P p1, N0 ` 2s, or there exists some k1 P r1, N0 ` 1s such that

pRk1 q





´1
 3N

.

Then, from (5.6), we deduce that either pRk1`1q R I, or

(5.7)

pRk1`1q



C 0

pRk1 q



C

0



1´

3 4N



0



1´

1 3N

.

Now we have:

Claim 5.5. Let k  1 and a P p0, 1q. Suppose that

pRkq

P

p0



´

1 3N

,

0



aq.

Then, either there exists some k2 P rk ` 1, k ` N0 ` 1s such that pRk2q R I, or

pRk`N0`1q

P

p0



´

1 4N

,

0



a´

1 3N

q.

In

case

that

a



1 12N

,

one

should

understand

that

the

second

alternative

is

not

possible.

Proof. Suppose that the first alternative in the claim does not hold. Then we deduce that

pRk`jq " j pRkq for j " 1, . . . , N0,

because, for all j " 1, . . . , N0 ´ 1,

pRk`j q



j

pRkq



0



N0´1`a

"





´1 2N

´1`a





´1
 2N

,

and then (5.5) implies that pRk`j`1q "  pRk`jq. So we infer that

pRk`N0 q

"

N0

pRk q



0



´

1 4N

`N0

"



´

3 4N

.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

37

Then, by (5.6) we have

pRk`N0`1q  C0 pRk`N0q " C0N0 pRkq

"

´1
C  2N

pRk q



´1
C  2N

0

 a



0



a´

1 3N

.

To complete the proof of the lemma observe that, by (5.7) and a repeated application
of the preceding claim, we infer that there exists some k P rk1 ` 2, k1 ` CN0 N s such that pRkq R I, since after CN iterations the second alternative in the lemma is not possible. This concludes the proof of the lemma.

We proceed with the proof of (5.4) from Lemma 5.3, that is, the estimate #LjpP, kq  C2.

Proof of (5.4). For h  1 set

Lhj pP, kq :" LjpP, kq X Lhj .

Notice that each family Lhj pP, kq consists of a single cube, at most. Indeed, we have

(5.8)

R P LjpP, kq ñ P  Bpep3qpRqq

because P P e1pQq for some Q P TrckpRq and Q  Bpe2pRqq by Lemma 4.7. Thus, if R, R1 P Lhj pP, kq, then Bpep3qpRqq X Bpep3qpR1qq  , which can only happen if R " R1 (by
Lemma 5.1 (ii)).

Let R0 be a cube in LjpP, kq with maximal side length, and let h0 be such that R0 P Lhj 0pP, kq. We will show that Lhj 1pP, kq   implies h0  h1  h0 ` C2. Together with the observation #Lhj pP, kq  1 this will conclude the proof of (5.4).

Claim 5.6. Let R1 P LjpP, kqztR0u, and let h1 be such that R1 P Lhj 1pP, kq. Then h1  h0.

Proof. Suppose that h1  h0. Let R0h1 be the cube that contains R0 and belongs to Fhj 1. Observe that

P

(5.8)


Bpep3qpR0qq X Bpep3qpR1qq



BpxR0 ,

3 2

pR0qq

X

BpxR1

,

3 2

pR1qq



BpxRh01 ,

1 2

pR0h1

q

`

3 2

pR0

qq

X

B pxR1 ,

3 2

pR1qq.

So

the

two

balls

BpxRh01 ,

1 2

pR0h1

q

`

3 2

pR0qq

and

B pxR1 ,

3 2

pR1qq

have

non-empty

intersec-

tion. Since pR0h1q  A0 pR0q  A0 pR1q (the last inequality follows by the choice of R0),

we deduce that

Bpep4qpR1qq



BpxR1

,

3 2

pR1qq



B pxRh0 1

,

1 2

pR0h1

q

`

5pR0qq



B pep4q pR0h1 qq.

However, these inclusions contradict the property (i) of the family Lhj 1 in Lemma 5.1 because R1  R0h1 .

Claim 5.7. Let R1 P LjpP, kqztR0u, and let h1 be such that R1 P Lhj 1pP, kq. Then

(5.9)

h1  h0 ` C.

38

D. DBROWSKI AND X. TOLSA

Proof. Suppose that h1  h0 ` 1. This implies that there are cubes tR1huh0`1hh1´1, with R1h P Fhj for each h, such that

R1h0`1  R1h0`2  . . .  R1h1´1  R1h1 " R1.
Observe now that pR1h0`1q  pR0q. Otherwise, there exists some cube R1h0 P Fhj 0 that contains R1h0`1 with
pR1h0q  A0 pR1h0`1q  A0 pR0q.
Since P  Bpep3qpR0qq X Bpep3qpR1qq, arguing as in the previous claim, we deduce that Bpep4qpR0qq  Bpep4qpR1h0qq, which contradicts again the property (i) of the family Lhj 0 in Lemma 5.1, as above. So we have

pR1hq  pR1h0`1q  pR0q for h  h0 ` 1.

By the construction of TrckpR0q, there exists a sequence of cubes S0 " R0, S1, S2, . . . , Sk " Q such that

Si`1 P GHpSiq for i " 0, . . . , k ´ 1, and P P T pe1pSkqq. In case that P is contained in some Q1 P HD1pe1pQqq " HD1pe1pSkqq, we write Sk`1 " Q1, and we let k~ :" k ` 1. Otherwise, we let k~ :" k. All in all, we have

(5.10)

Si`1 P HD1pe1pSiqq for i " 0, . . . , k~ ´ 1,

and Sk~`1 :" P  e1pSk~q is not strictly contained in any cube from HD1pe1pSk~qq. Obviously we have pSi`1q  pSiq for all i. So, for each h with h0 ` 1  h  h1 there
is some i " iphq such that

(5.11)

pSiq  pR1hq  pSi`1q,

with 0  i  k~. We claim that either i À 1 or i " rk, with the implicit constant depending on n. Indeed, in the case i  rk, let T P Dµ be such that T  Si`1 and pT q " pR1hq. Notice that, since 2R1h X 2T   (because both 2R1h and 2T contain P ) and pR1hq " pT q, we have

(5.12)

PpT q « PpR1hq « pR1hq " pR0q,

where in the last equality we used the definition of Lj. On the other hand,

(5.13)

PpT q  0 pSiq

because otherwise T is contained in some cube from LDpSiq, which would imply that Si`1 does not belong to HD1pe1pSiqq. Thus, from (5.12) and (5.13) we derive that
pR0q Á 0 pSiq " 0 i pR0q.
Hence i À 0´1, which yields i Àn 1 if i  rk, as claimed. The preceding discussion implies that, in order to prove (5.9), it suffices to show that,
for each fixed i " 0, . . . , k~, there are at most C " Cpnq cubes R1h satisfying (5.11) with this fixed i.
Case i  k~. Assume first that i  k~. Recall that N1 is the constant given by Lemma 5.4, and suppose that there exist more than N1 cubes R1h satisfying (5.11). Since tR1hu

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

39

is a nested sequence of cubes, this is equivalent to saying that there exists some s P rh0 ` 1, h1 ´ N1s such that

(5.14)

for h P rs, s ` N1s the cubes R1h satisfy (5.11).

Taking  " pSiq, Lemma 5.4 ensures that there exists some cube T P Top such that R1s  T  R1s`N1 which satisfies either

(5.15)

pT

q



´

1 4N

0

pSiq

or

1
pT q   4N ° pSiq.

Now, let T 1 P Dµ be such that Si`1  T 1  e1pSiq and pT 1q " pT q, where we use the fact that pSiq  pR1sq  pT q  pR1s`N1q  pSi`1q and Si`1  e1pSiq. Notice that

(5.16)

PpT 1q « PpT q « pT q,

because 2T X 2T 1  . If the first option in (5.15) holds, we deduce that

P pT

1q



C pT

q



C

´

1 4N

0

pSiq



0

pSiq.

This implies that T 1 is contained in some cube from LDpSiq X Stop°pe1pSiqq, which ensures that Si`1 R HD1pe1pSiqq (notice that we are using the fact that i  k~), which is a contradic-
tion with (5.10). Thus, T must satisfy the second estimate of (5.15). But in this case (5.16) yields PpT 1q  °pSiq, and so T 1 is strictly contained in some cube from HD1pe1pSiqq. Hence, Si`1 R HD1pe1pSiqq, which again gives a contradiction. In consequence, if i  k~,
then (5.14) does not hold for any s.

Case i " k~. Assume again that (5.14) holds for some s P rh0 ` 1, h1 ´ N1s, and let s
be the smallest possible such that (5.14) holds. The same argument as above shows that the cube T 1 from the preceding paragraph is contained in some cube T 2 P Stop°pe1pSiqq. Since we assumed that s is minimal, R1s  T  R1s`N1, and pT 2q  pT 1q " pT q, we get that there are at most N1 cubes R1h satisfying (5.11) such that pSiq  pR1hq  pT 2q. We claim that there is also a bounded number of cubes R1h such that

(5.17)

pT 2q  pR1hq  pP q.

Indeed, by the definition of the family Endpe1pRqq and Lemma 3.3, if we denote by Tm the m-th descendant of T 2 which contains P , for m1  m  0, it follows that

PpTm1 q  A0´|m´m1|{2 PpTmq  A´0 m{2 PpT 2q.
Suppose then that there are two cubes R1h, R1h1 such that pR1h1q  pR1hq  pT 2q. Let Tm and Tm1 be such that pR1hq " pTmq and pR1h1q " pTm1 q. By arguments analogous to the ones in (5.16), we derive that

PpTmq « PpR1hq « pR0q and PpTm1 q « PpR1h1 q « pR0q, where we also used the fact that pR1hq " pR1h1q " pR0q. On the other hand, since |m ´ m1|  |h ´ h1|, we have

pR0q « PpTm1 q  A´0 |h´h1|{2 PpTmq « A´0 |h´h1|{2 pR0q,
which implies that |h ´ h1| À 1. From this fact it follows that there is a bounded number of cubes R1h satisfying (5.17), as claimed. Putting all together, we get (5.9).

40

D. DBROWSKI AND X. TOLSA

This ends the proof of Lemma 5.3.

6. The Riesz transform on the tractable trees: the approximating measures , , and the variational argument
In this section, for a given R P MDW such that T pe1pRqq is tractable (i.e., R P Trc), we will define a suitable measure  that approximates µ at the level of the cubes from T pe1pRqq and we will estimate }R}Lppq from below. To this end, we will apply a variational argument in Lp by techniques inspired by [RT] and [JNRT]. In the next section we will transfer these estimates to Rµ.

6.1. The suppressed Riesz transform and a Cotlar type inequality. Let  : Rn`1 Ñ

r0, 8q be a 1-Lipschitz function. Below we will need to work with the suppressed Riesz

kernel

(6.1)

Kpx, yq

"

` |x

´

y|2

`

x´y pxqpyqpn`1q{2

and the associated operator 
Rpxq " Kpx, yq dpyq,

where  is a signed measure in Rn`1. For a positive measure  and f P L1locpq, we write R,f " Rpf q. The kernel K (or a variant of this) appeared for the first time in the work of Nazarov, Treil and Volberg in connection with Vitushkin's conjecture (see [Vo]). This is a Calderón-Zygmund kernel which satisfies the properties:

(6.2)

|Kpx, yq|

À

` |x

´

y|

`

1 pxq

`

pyqn

and (6.3)

|xKpx, yq|

`

|yKpx, yq|

À

` |x

´

y|

`

1 pxq

`

pyqn`1

for all x, y P Rn`1. Also, if  « pxq, then we have

(6.4)

Rpxq

´

Rpxq

À

sup
rpxq

||pBpx, rn

rqq

,

with the implicit constant in the inequality depending on the implicit constant in the comparability  « pxq. See Lemmas 5.4 and 5.5 in [To3].
The following result is an easy consequence of a T b theorem of Nazarov, Treil and Volberg. See Chapter 5 of [To3], for example. We will use this to prove (6.39).

Theorem 6.1. Let  be a Radon measure in Rn`1 and let  : Rn`1 Ñ r0, 8q be a 1Lipschitz function. Suppose that
(a) pBpx, rqq  c0 rn for all r  pxq, and (b) suppxq |Rpxq|  c1.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

41

Then R, is bounded in Lppq, for 1  p  8, with a bound on its norm depending only on p, c0 and c1. In particular, R is bounded in Lppq on the set tx : pxq " 0u.

We

define

the

energy

W

(with respect 

to

)

of

a

set

F



Rn`1

as

WpF q "

diampF

q

1 |x

´

y|n´1

dpxqdpyq.

F ^F

We say that a ball B  Rn`1 is pa, bq-doubling

paBq  b pBq.

We

denote

by

M f

the

usual

centered

maximal

Hardy-Littlewood 

operator

applied

to

f:

Mf pxq

"

sup
r0

1 pBpx, rqq

|f | d,
Bpx,rq

and by Mpr0,a,bqf the version



Mpr0,a,bqf

pxq

"

sup

1 pBpx,

rqq

|f | d,
Bpx,rq

where the sup is taken over all radii r  r0 such that the ball Bpx, rq is pa, bq-doubling.

Lemma 6.2. Let x P R, r0  0, and 1  0. Suppose that for all r  r0

px, rq  1

and
Then (6.5)

WpBpx, rqq  1 pBpx, rqq if Bpx, rq is p16, 128n`2q-doubling. sup |Rpxq| À Mpr0,16,128n`2qpRqpxq ` 1.
r0

Proof. For a given   r0, let k  0 be minimal so that, for r " 128k , the ball Bpx, rq is p128, 128n`2q-doubling (in particular, this implies that Bpx, 8rq is p16, 128n`2q-doubling). It is easy to see that such k exists using the assumption px, rq  1. By a standard estimate (see Lemma 2.20 from [To3]), it follows that

|Rpxq|



|R8r  pxq|

`

C

pBpx, 8rqq p8rqn



|R8r  pxq|

`

C

1.

It is immediate to check that for any x1 P Bpx, 2rq,

(6.6)

|R8rpxq ´ RBpx,4rqc px1q| À 1.

Consider radial C1 functions 1 and 2 such that

Bpx,4rq  1  Bpx,8rq

and

Bpx,rq  2  Bpx,2rq,

and Lipp1q  r, Lipp2q  r. Given a function f P L1locpq, denote by m2f the p2 q-

mean of f , i.e.,



1

m2f " }2}L1pq f 2 d.

42

D. DBROWSKI AND X. TOLSA

Notice that m2  pR q



1 pBpx, rqq


Bpx,2rq

|R| d

«



´

|R| d  Mpr0,16,128n`2qpRqpxq.

Bpx,2rq

From (6.6) we deduce that

R8r pxq

´

` m2 RpBpx,4rqc

q



` m2 |R8rpxq

´

RpBpx,4rqc

 q|

À

1.

Then we have

|R8r pxq|

À À

1 1

` `

|mm22

 

`pRpBpx,4rqc q| RpBpx,4rqc q ´

Rpp1

´

1qq

`

m2

` Rp1

q

`

m2  pR q

À

1

`

m2



` Rp1

q

`

Mpr0,16,128n`2qpRqpxq.

To estimate the

m2

` Rp1



q

""Àmi}2d}pdB2l}e21pL1}1xtL1e,p1rrpmqqqqon KthKpeypry´ig´hztzq qh`a1rpn|yy1dqp´ys1qi2dzpe|zn2qwp´zd1eqdu´psyepqydt1qhpdzepqzapqnz2tqpiys«yqmWdmpepBptyBrqpyxpdx,o,8fp8rzRrqqqq:q

À

1.

Bpx,8rq^Bpx,8rq

Remark 6.3. In fact, the proof of the preceding lemma shows that, given any measure ,

x P Rn`1 and   0,

(6.7)

|Rpxq| À


´
Bpx,21q

|R| d

`

sup
r

pBpx, rqq rn

`

WpBpx, 81qq pBpx, 81qq

,

where 1 " 27k, with k  0 minimal such that the ball Bpx, 1q is p128, 128n`2q-doubling.

6.2. The family Regpe1pRqq and the approximating measure . In the remaining of

this section we fix a cube R P MDW such that T pe1pRqq is tractable.

We need to define some regularized family of ending cubes for T pe1pRqq. First, let

`



dRpxq

"

inf
QPT pe1pRqq

distpx, Qq ` pQq .

Notice

that

dR

is

a

1-Lipschitz

function.

Given 0 `



0

! pRq, 

we

denote

(6.8)

dR,0 pxq " max 0, dRpxq ,

which is also 1-Lipschitz. For each x P e1pRq we take the largest cube Qx P Dµ such that x P Qx with

(6.9)

1

pQxq



60

inf
yPQx

dR,0

pyq.

We consider the collection of the different cubes Qx, x P e1pRq, and we denote it by Regpe1pRqq (this stands for "regularized cubes").

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

43

The constant 0 is just an auxiliary parameter that prevents pQxq from vanishing.

Eventually 0 will be taken extremely small. In particular, we assume 0 small enough so

that

(6.10)

^ µ





^

Q  1µ



 Q.

2

QPHD1 pepRqq:pQq0

QPHD1 pepRqq

We let TRegpe1pRqq be the family of cubes made up of R and all the cubes of the next generations which are contained in e1pRq but are not strictly contained in any cube from Regpe1pRqq.

Lemma 6.4. The cubes from Regpe1pRqq are pairwise disjoint and satisfy the following properties:
(a) If P P Regpe1pRqq and x P BpxP , 50pP qq, then 10 pP q  dR,0pxq  c pP q, where c is some constant depending only on n.
(b) There exists some absolute constant c  0 such that if P, P 1 P Regpe1pRqq satisfy BpxP , 50pP qq X BpxP 1, 50pP 1qq  , then
c´1pP q  pP 1q  c pP q.

(c) For each P P Regpe1pRqq, there are at most C3 cubes P 1 P Regpe1pRqq such that BpxP , 50pP qq X BpxP 1, 50pP 1qq  ,

where C3 is some absolute constant.

The proof of this lemma is standard. See for example [To2, Lemma 6.6].

Next we define a measure  which, in a sense, approximates µte1pRq at the level of the family Regpe1pRqq. We let



"

ÿ
P PRegpe1pRqq

µpP

q

Ln`1t

Ln`1p

1 2

1 2

BpP

BpP

q
qq

,

where Ln`1 stands for the Lebesgue measure in Rn`1. With each Q P TRegpe1pRqq we associate another "cube" Qpq defined as follows:



Qpq "

1 2

BpP

q.

P PRegpe1pRqq:P Q

Further, we consider a lattice D associated with the measure  which is made up of the cubes Qpq with Q P TRegpe1pRqq and other cubes which are descendants of the cubes from Regpe1pRqq. We assume that D satisfies the first two properties of Lemma 2.1 with
the same parameters A0 and C0 as Dµ. It is straightforward to check that D can be constructed in this way. For S P D such that S " Qpq with Q P TRegpe1pRqq, we let Q " Spµq. Further, we write pSq :" pQq, BS :" BQ, and pSq :" pQq.

44

D. DBROWSKI AND X. TOLSA

6.3.

The

auxiliary

family

H.

Given

p1 ÿ

and

a

family

I

 Dµ,

we

denote

ppIq " pP qp µpP q,

P PI

so that pIq " 2pIq. Recall that

HD°pRq " hdk° pRq,

with

k°

"

kp1

´

1 N

q,

and

that

HD1pepRqq " Stop°pepRqq X HD°pRq,

HD1pe1pRqq " Stop°pe1pRqq X HD°pRq.

For R P MDW and j  0, denote

Hj pe1pRqq " TRegpe1pRqq X hdk° `jpRq,

so that H0pe1pRqq " HD1pe1pRqq X TRegpe1pRqq.

Remark 6.5. Note that for j  k° ` 2 we have Hjpe1pRqq " . Indeed, by the definition of Regpe1pRqq and TRegpe1pRqq, for each Q P TRegpe1pRqq there exists P P T pe1pRqq such that 2BQ  2BP and pQq  pP q  A20pQq. Thus,

µp2BQq pQqn



µp2BP q pQqn



A20n

µp2BP q pP qn

.

Since for each P P T pe1pRqq we have pP q  2°pRq, it follows that pQq  A20n2°pRq.
The fact that maxj0 ppHjpe1pRqqq may be much larger than ppHD1pe1pRqq may cause problems in some estimates. For this reason, we need to introduce an auxiliary family H. We deal with this issue in this section.
Recall that, for R P Dµ,k,
epRq " ehpRqpRq and e1pRq " ehpRq`1,

where

 eipRq " R Y Q,

with the union running over the cubes Q P Dµ,k`1 such that

For j  0, we set

distpxR, Qq



pRq 2

`

2ipQq.



ei,jpRq "

ej pQq,

QPDµ,k`1:QeipRq
and we let Hkpei,jpRqq be the subfamily of the cubes from Hkpe1pRqq which are contained in ei,jpRq.
From now on, we let n be some positive constant depending just on n. In the present paper, later on, we will simply take n " 1{15. However, for another application of the results from this section in [To4] it is convenient to allow n to depend on n.

Lemma 6.6. Let p P p1, 2s. For any R P MDW there exist some j, k, with 10  j  A0{4

and 0  k  k° ` 2 such that

(6.11)

ppHmpehpRq,j`1pRqqq  °n ppHkpehpRq,j pRqqq for all m  0,

assuming A0 big enough (possibly depending on n).

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

45

Proof. For each j, we denote by 0  kj  k° ` 2 the integer such that

ppHkj

pehpRq,j pRqqq

"

max
0kk°

ppHkpehpRq,j pRqqq.

The lemma can be rephrased in the following way: there exists 10  j  A0{4 such that

ppHkj`1 pehpRq,j`1pRqqq  °n ppHkj pehpRq,j pRqqq.

We prove this by contradiction. Suppose the estimate above fails for all 10  j  A0{4, and let j0 be the largest integer smaller than A0{4. Then we have

(6.12) ppHkj0 pehpRq,j0 pRqqq  °n ppHkj0´1pehpRq,j0´1pRqqq

 . . .  °npj0´10qppHk10 pehpRq,10pRqqq  °npj0´10qppH0pehpRq,10pRqqq



°n pj0 ´10q p pH0 pehpRq pRqqq

p6.10q 

1 2

°npj0´10qppHD1pepRqqq,

Concerning the left hand side of the inequality above, since ehpRq,j0 pRq  2R and kj0  k° ` 2, we have
ppHkj0 pehpRq,j0 pRqqq  A20np2°p pRqpµp2Rq.

Due to the fact that R is P-doubling, as in (4.8) we have µp2Rq  C0 Cd A0n`1µpRq. Thus,

(6.13)

ppHkj0 pehpRq,j0 pRqqq  C0 Cd A20np`n`12°pppRq.

Concerning the right hand side of (6.12), observe that, denoting pHD1q " °pRq " pQq for any Q P HD1pepRqq, we have

ppHD1pepRqqq

"

pHD1qp´2pHD1pepRqqq

(4.10)


B´1pHD1qp´2pRq



´° 1p°´2ppRq.

We deduce from (6.12), (6.13), and the above, that

1 2

°npj0´10qp°´3ppRq



C0

Cd

A20np`n`12°pppRq.

Since °  An0 and j0 « A0, it is clear that this inequality is violated if A0 is big enough, depending just on n.

6.4. Some technical lemmas. Let jpRq, kpRq be such that 10  jpRq  A0{4, 0  kpRq  k° ` 2 and
ppHmpehpRq,jpRq`1pRqqq  °n ppHkpRqpehpRq,jpRqpRqqq for all m  0,

We denote



Sµ "

Q,

QPReg:QehpRq,jpRqpRq



S "

1 2

BpQq

QPReg:QehpRq,jpRqpRq

and



Sµ1 "

Q,

QPReg:QehpRq,jpRq`1pRq

Notice that, by construction,



S1 "

1 2

B

pQq.

QPReg:QehpRq,jpRq`1pRq

(6.14)

distpsupp µze1pRq, Sµ1 q  cA´0 1pRq,

where c  0 is an absolute constant.

46

D. DBROWSKI AND X. TOLSA

For m " 1, 2, 3, 4, denote by Vm the mA´0 3pRq-neighborhood of S. Let R be a C1 function which equals 1 in V3, vanishes out of V4, and such that }R}8  1 and }R}8  2A30pRq´1. Observe that, for x P supp µze1pRq, distpx, V4q Á pRq. In fact, from (6.14) one can derive that

(6.15) distpQ, supp µze1pRqq Á pRq for all Q P Regpe1pRqq such that BQ X V4  ,

taking

into

account

that

pQq



A´0 1 60

pRq

for

every

Q

P

Regpe1pRqq.

We consider the measure

 " R 

and the function



Gpxq " 2A30

1 S1 zV2 pRq |x ´ y|n´1 dpyq.

Notice that

Gpxq À pRq for all x P V1.

To shorten notation, we write

H " HkpRqpehpRq,jpRqpRqq,

H1 " HkpRqpehpRq,jpRq`1pRqq

and





H " Qpq,

H1 "

Qpq .

QPH

QPH1

We also set

pHq " Ap0k° `kpRqqn pRq,

so that for any Q P H we have pQq " pHq.

Lemma 6.7. Let A  Rn`1 be the set of those x P Rn`1 which belong to some p16, 128n`2qdoubling (with respect to ) ball B  Rn`1 such that

W pBq  M pHq pBq and pBq  c2 pHq for all   1.

Then, for M  1 big enough,

pAq À °n pHq. M

Proof. Observe first that, for any ball B  Rn`1 with rpBq P rA0´k´1, A´0 ks,

W pB q

À pBq pBq

ÿ

ÿ

`

jk`1 QPD,j :Q2B


xPQ


y:A´0 j´2|x´y|A´0 j´1

1 rpBq |x ´

y|n´1

dpxq dpyq

À

ÿ
QPD :Q2B

pQq rpBq

 p2BQ q

pQq.

To prove the lemma, we apply Vitali's 5r-covering lemma to get a family of p16, 128n`2qdoubling balls Bi, i P I, which satisfy the following:
, the balls 2Bi, i P I, are pairwise disjoint, , A  iPI 10Bi, , WpBiq  M pHq pBiq and pBiq  c2 pHq and for all i P I and   1.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

47

Then we deduce (6.16)

pAq



ÿ  p10Bi q
iPI

À

ÿ  pBi q
iPI



M

1 pHq

ÿ W pBiq
iPI

À

M

1 pHq

ÿÿ
iPI QPD:Q2Bi

pQq rpBiq

p2BQq pQq.

Now we take into account that all the cubes Q which are not contained in any cube P with

P pµq P H1 satisfy p2BQq  p2BQq À pHq. Then, for each i P I,

ÿ
QPD :Q2Bi

pQq rpBiq

p2BQq pQq



ÿ
P pµqPH1

ÿ
QPD :Q2Bi XP

pQq rpBiq

p2BQq pQq

`

pHq

ÿ
QPD :Q2Bi

pQq rpBiq

pQq

Observe that the last term on the right hand side is bounded above by pHqp2Biq «

pHqpBiq. So plugging the previous estimate into (6.16), we get

pAq

À

M

1 pHq

ÿÿ
iPI P pµqPH1

ÿ
QPD :Q2BiXP

pQq rpBiq

p2BQq pQq

`

1 M

ÿ  pBi q.
iPI

Since

Bi



A

for

each

i,

the

last

term

is

at

most

1 2



pAq

for

M

big

enough.

Thus,

(6.17)

pAq

À

M

1 pHq

ÿÿ
iPI P pµqPH1

ÿ
QPD :Q2Bi XP

pQq rpBiq

p2BQq pQq.

To estimate the term on the right hand side above, we denote by Fk the family of cubes from D which are contained in some cube Qpq with Q P H1k :" HkpehpRq,jpRq`1pRqq and are not contained in any cube P pq with P P H1k`1 :" Hk`1pehpRq,jpRq`1pRqq. Notice that

p2BQq À pHk`1q « pHkq,

where pHkq " pQ1q for Q1 P H1k (this does not depend on the specific cube Q1). Then, for each i P I, we have

(6.18)

ÿ

ÿ

P pµqPH1 QPD:Q2BiXP

pQq rpBiq

 p2BQ qpQq

ÿÿ "
kkpRq P pµqPH1k

ÿ
QPFk :Q2Bi XP

pQq rpBiq

 p2BQ qpQq

À

ÿÿ

ÿ

pHk q

kkpRq P pµqPH1k

QPFk :Q2Bi XP

pQq rpBiq

pQq.

We claim now that for Q in the last sum, we have

(6.19)

pQq À A´0 pk´kpRqq rpBiq.

To check this, let P pQ, kq P H1k be such that Q  P pQ, kq. From the condition

(6.20)

pBiq  c2 pHq for all   1

48

D. DBROWSKI AND X. TOLSA

and the fact that P pQ, kq X 2Bi   (because Q  2Bi) we infer that rpBiq  pP pQ, kqq for k big enough. Otherwise we would find a ball Bi containing P pQ, kq with radius comparable to pP pQ, kqq, so that

pBiq  c pP pQ, kqq  c2 pHq

for k big enough (depending on c2), contradicting (6.20). So we have P pQ, kq  6Bi and thus

c2pHq



 p6Bi q

Á

pP pQ, kqqn rpBiqn

pP pQ, kqq

"

pP pQ, kqqn rpBiqn

A0npk´kpRqq

pHq.

This gives pQq  pP pQ, kqq À A´0 pk´kpRqq rpBiq
and proves (6.19) for k big enough, and thus for all k if we choose the implicit constant in (6.19) suitably.
From (6.19) we deduce that the right hand side of (6.18) does not exceed

ÿ
kkpRq

A0´pk´kpRqq{2 pHk q

P

ÿ
pµq PH1k

ÿ
Q2Bi XP
À

^ pQq 1{2 rpBiq

pQq

ÿ A0´pk´kpRqq{2

pHk q

ÿ

p2Bi X P q.

kkpRq

P pµqPH1k

Plugging this estimate into (6.17) and recalling that the balls 2Bi are disjoint, we get

pAq

À

M

1 pHq

ÿ ÿ A0´pk´kpRqq{2
iPI kkpRq

ÿ
P pµqPH1k

pHkq p2Bi

X

Pq



M

1 pHq

ÿ A0´pk´kpRqq{2
kkpRq

ÿ
P pµqPH1k

pHkq pP q.

By Hölder's inequality, for each k  kpRq we have ÿ pHkqpP q  ppH1kq1{p pH1q1{p1 .
P pµqPH1k

We can estimate the right hand side using (6.11):

ppH1kq  °n ppHq,

pH1q "

ppH1q pHqp

 °n

ppHq pHqp

" °n pHq.

Thus,

pAq

À

°n M pHq

ÿ

A0´pk´kpRqq{2

ppHq1{p

pH q1{p1

«

°n M

pH q

«

°n M

 pH q.

kkpRq

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

49

Let TH1 denote the family of all cubes from Dµ made up of R and all the cubes of the

next generations which are contained in ehpRq,jpRq`1pRq but are not strictly contained in

any cube from from H1. We consider the function

`



(6.21)

pxq " inf pQq ` distpx, Qq .

QPTH1

Notice that  is a 1-Lipschitz function. We also have the following result, which will be proven by quite standard arguments.

Lemma 6.8. For all x P Rn`1, we have

(6.22)

sup
rpxq

pBpx, rqq rn



sup
rpxq

pBpx, rqq rn

À

pHq

for all x P Rn`1.

Proof. The first inequality in (6.22) is trivial. Concerning the second one, in the case r  pRq{10 we just use that
pBpx, rqq  µpe1pRqq À µpRq À pRq pRqn À pHq rn.

So we may assume that pxq  r  pRq{10. By the definition of pxq, there exists Q P TH1 such that
pQq ` distpx, Qq  r.

Therefore, BQ  Bpx, 4rq and so there exists an ancestor Q1  Q which belongs to TH1

such that Bpx, rq  2BQ1 , with pQ1q « r. Then, pQ1q  pHq and

ÿ

ÿ

pBpx, rqq 

pP pqq "

µpP q.

P PRegpe1pRqq:P X2BQ1 

P PRegpe1pRqq:P X2BQ1 

Observe now that if P P Regpe1pRqq satisfies P X 2BQ1  , then pP q À pQ1q (this is an easy consequence of Lemma 6.4(b) and the fact that Q1 contains some cube from Regpe1pRqq). So we deduce that P  CBQ1. Hence,

pBpx, rqq  µpCBQ1q À pHq pQ1qn « pHq rn.

In the next subsection we are going to use a variational argument to show that for some constant c3, dependipn|Rg aptxmq|o´st2Gopxnqn´acn3dApH0,qqw`ephdavpexq Á °´p1nppHq.

See Lemma 6.13 for details. We prove this estimate by contradiction, so that in particular

we will (6.23)

assume

that



p|Rpxq|

´

Gpxq

´

c3

pHqq`p

dpxq



ppHq.

Below we prove a few consequences of (6.23) that will be useful in the proof of Lemma 6.13.

2The constant c3 will be chosen of the form c3 " A0Cpnq, and it will not depend on °, n, or other parameters of the construction.

50

D. DBROWSKI AND X. TOLSA

We denote

R°,pxq " sup Rpxq.
pxq

Lemma 6.9. Suppose that (6.23) holds. Then,

(6.24)

` 

x P S :

R°,  pxq



M

( pHq



C4

°n M

 pH q.

Proof. Recall that we denote by V1 the A´0 3pRq-neighborhood of S and that

Gpxq À pRq for all x P V1.

Then the (6.25)

assumption

in

the

lemmaRimppxliqe|sp

that dpxq

À

ppHq.

V1

By Remark 6.3, for any x P S and   pxq,

|Rpxq| À


´
Bpx,21q

|R| d

`

sup
r

pBpx, rqq rn

`

WpBpx, 81qq pBpx, 81qq

,

where 1 " 27k, with k  0 minimal such that the ball Bpx, 1q is p128, 128n`2q-doubling.

In

the

case

1



1 2

A´0 3

pRq,

by

standard

arguments,

|R  pxq|



|R1  pxq|

`

C

pBpx, 1qq p1qn



C

pRq



M

pHq,

for ° (or M ) big enough.

In

the

case

1



1 2

A´0 3pRq,

we

have

Bpx, 21q



V1

and

thus

|R  pxq|

À

Mppxq,16,128n`2qpV1 Rqpxq

`

sup
rpxq

pBpx, rn

rqq

`

sup
rPDpxq:rpxq

WpBpx, rqq pBpx, rqq

,

where Dpxq denotes the set of radii r  0 such that Bpx, rq is p16, 128n`2q-doubling. Also,

as shown in (6.22),

sup
rpxq

pBpx, rqq rn

À

pHq.

We deduce that in any case (i.e., for any 1), assuming M larger than some absolute

constant,

`

(

 x P S : R°,pxq  M pHq

´!   x P S : Mppxq,16,128n`2qpV1 Rqpxq

´! ` x

P

S

: sup
rPDpxq:rpxq

WpBpx, rqq pBpx, rqq



M

M
pHq 3

pHq )3¯

)¯

": T1 ` T2.

To deal with the term T1, we use the weak Lppq boundedness of Mppxq,16,128n`2q and

(6.25) to obtain



T1

À

1 pM pHqqp

V1

|R |p

d

À

1 Mp

pH q.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

51

Concerning T2, by Lemma 6.7,

T2

À

°n M

 pH q.

So we have

` 

x P S

:

( R°,pxq  M pHq À

1 Mp

pH q

`

°n M

pHq À

°n M

 pH q.

For   1, we let

Zpq "

x

P

S1

:

R°,  pxq



°n

( pHq .

Notice that, under the assumption (6.23), by Lemma 6.9 (with M " °n), we have

(6.26)

pZpq X Sq  C4´1 pHq.

For x P Zpq, let

(6.27)

epx, q " supt :   pxq, |Rpxq|  °n pHqu

We define the exceptional set Z1pq as



Z1pq "

Bpx, epx, qq.

xPZ p q

The next lemma shows that pZ1pq X Sq is small if  is taken big enough.

Lemma 6.10. If y P Z1pq, then R°,pyq  p°n ´ c4qpHq, for some c4  0. Thus, under the assumption (6.23), if   2c4, then

(6.28)

 pZ 1 p q

X

S q



2C4 

 pH q.

Proof. The arguments are similar to the ones in Lemma 5.2 from [To3]. However, for the reader's convenience we will explain here the basic details.
By standard arguments (which just use the fact that the Riesz kernel is a CalderónZygmund kernel), for all y P Bpx, epx, qq, with x P Zpq, we have

|Repx,qpxq ´ R2epx,qpyq|

À

sup
repx,q

pBpx, rqq rn

À

pHq,

taking into account that epx, q  pxq and recalling (6.22) for the last estimate. So we have
|R2epx,qpyq|  |Repx,qpxq| ´ c4 pHq   °n pHq ´ c4 pHq.
Observe now that pyq  pxq ` |x ´ y|  2epx, q.

So

R°,pyq  |R2epx,qpyq|  p°n ´ c4qpHq,

which proves the first statement of the lemma.

In particular, taking   2c4, from the last estimate we derive

R°,  py q



 2

°n

pHq,

52

D. DBROWSKI AND X. TOLSA

and so y P Zp{2q, which shows that Z1pq  Zp{2q. Thus, by (6.26), pZ1pq X Sq  pZp{2q X Sq  2C4´1 pHq.

We choose  " maxp1, 2c4, 4C4q, so that, under the assumption (6.23),

(6.29)

 pZ 1 p q

X

S q



1 2

 pH q.

Also we define

pxq " maxppxq, distpx, Rn`1zZ1pqq.

Notice that  is a 1-Lipschitz function which coincides with pxq away from Z1pq and that

(6.30)

pxq  epx, q for all x P Zpq.

Lemma 6.11. The suppressed operator R is bounded in Lppq, with }R}LppqÑLppq À °n pHq.

Proof. This is an immediate consequence of Theorem 6.1 and the construction of  above. Indeed, by (6.22),
pBpx, rqq À pHq rn for all r  pxq.

Also, by (6.30),

sup |Rpxq|  sup |Rpxq|  °n pHq for all x P Zpq.

pxq

epx,q

On the other hand, by the definition of Zpq we also have

sup |Rpxq|  sup |Rpxq|  °n pHq for x P S1 zZpq.

pxq

pxq

So we can apply Theorem 6.1, taking  " pC°npHqq´1  with an appropriate absolute constant C, and then the lemma follows.

Lemma 6.12. Under the assumption (6.23), there exists a subset H0  H such that:

(a) (b)

pH0q



1 2

pH q,

R, is bounded from

LpptH0

q

to

LpptS1

q,

with }R}LpptH0 qÑLpptS1 q

À °n pHq.

Proof. We let so that, by (6.29),

H0 " HzZ1pq,

pH0q

"

 pH0 q



 pH q

´ pZ1pq

X

S q



1 2

 pH q

"

1 2

pH q.

To prove (b), take f P LpptH0q and observe that for x P S1 , by (6.4),

|Rpf qpxq| " |Rpf qpxq|  |Rpxqpf qpxq| ` M,npf qpxq,

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

53

where Rpxq is the pxq-truncated Riesz transform and

(6.31)

M,npxq

"

sup
rpxq

||pBpx, rn

rqq

for any signed Radon measure . Taking into account that pxq  pxq, we can split

Rpxqpf qpxq

"

Rpxqpf qpxq

`


yPH0:pxq|x´y|pxq

|x

x´y ´ y|n`1

f pyq

dpyq.

To estimate the last integral, notice that for y P H0, pyq " pyq, and then the condition pxq  |x ´ y| implies that

pxq  pyq ` |x ´ y| " pyq ` |x ´ y|  pxq ` 2|x ´ y|  3|x ´ y|.

So the last integral above is bounded by



pxq{3|x´y|pxq

|x

1 ´ y|n

|f pyq| dpyq

À

M,npf qpxq.

From the preceding estimate and (6.4) we derive that

|Rpf qpxq|  |Rpxqpf qpxq| ` C M,npf qpxq  |Rpf qpxq| ` C M,npf qpxq.
From the last inequality and Lemma 6.11, taking into account that  coincides with  on V1, we deduce that
}R}LpptH0 qÑLpptV1 q À °n pHq ` }M,n}LppqÑLppq.
From the growth condition (6.22) and standard covering lemmas, it follows easily that

}M,n}LppqÑLppq À pHq.
On the other hand, using the fact that distpH0, Rn`1zV1q Á pRq, it is immediate (by Schur's criterion, for example) to check that also

}R}LpptH0 qÑLpptS1 zV1 q À pRq  pHq.

6.5. The variational argument.

Lemma 6.13. There is a constant c3  0, depending at most on n and A0, such that for any p P p1, 2s, if ° is big enough, we have
 p|Rpxq| ´ Gpxq ´ c3 pHqq`p dpxq Á °´p1n ppHq,

where p1 " p{pp ´ 1q and the implicit constant depends on p.

Proof. Suppose that, for a very small 0    1 to be fixed below,

(6.32)

 `|R| ´ G ´ c3 pHq`p d   ppHq.

54

D. DBROWSKI AND X. TOLSA

Let H0  H be the set found in Lemma 6.12. Consider the measures of the form  " a ,

with a P L8pq, a  0, and let F be the functional

F p q

"



`|R |

´

G

´

c3

pHq`p

d

`

 }a}L8pq

ppHq

`



 pH0 q  pH0q

ppHq.

Let

m " inf F p q,

where the infimum is taken over all the measures  " a , with a P L8pq. We call such

measures admissible. Since  is admissible we infer that

(6.33)

m  F pq  3 ppHq.

So the infimum m is attained over the collection of measures  " a such that }a}L8pq  3

and  pH0q 

1 3

 pH0 q.

In particular,

by taking a weak ° limit in L8pq,

this guaranties

the existence of a minimizer.

Let  be an admissible measure such that

(6.34)

m " F p q  3 ppHq.

To simplify notation, we denote

f pxq " G ` c3 pHq.

We claim that (6.35) `|R pxq|

´

f

pxq`|p

`

p

R° "`|R

|

´

f

`|p´1|R

|´1

R

i pxq

À



pHqp

in supp  ,

where for a vector field U , we wrote

nÿ`1 R° U " R°pU  q " ´ RipUi  q.
i"1

Assume (6.35) for the moment. Since the function on the left hand side is subharmonic in Rn`1z supp  and continuous in Rn`1 (recall that  and  are absolutely continuous with
respect to Lebesgue measure, with bounded densities), we deduce that the same estimate holds in the whole Rn`1.
Next we need to construct an auxiliary function . First we claim that there exists a subfamily of cubes H0  H such that

(i) the balls 3BQ " 3BQpµq, with Qpµq P H0, are disjoint,

(ii)

1
12



pQq



 pQ X H0q  3pQq

for

all

Qpµq

P H0,

and

(iii) QpµqPH0  pQ X H0q « pHq.

The

existence

of

the

family

H0

follows

easily

from

the

fact

that

 pH0q



1 3



pH0q



1 6

 pH q

and  " a  with }a}L8pq  3. Indeed, notice that the family I of cubes Qpµq P H such

that

 pQ

X

H0q



1 12



pQq

satisfies

ÿ

 pQ

X

H0q



1 12

ÿ

pQq



1 12

 pH q



1 2

 pH0q.

QpµqPI

QpµqPI

So

ÿ

 pQq 

ÿ

 pQ

X

H0q



1 2

 pH0q.

QpµqPHzI

QpµqPHzI

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

55

By Vitali's 5r-covering lemma, there exists a subfamily H0  HzI such that the balls t3BQuQpµqPH0 are disjoint and the balls t15BQuQpµqPH0 cover QpµqPHzI Q. From the fact that the cubes from H0 are P-doubling and the properties of the family Regpe1pRqq in

Lemma 6.4, we have pQq « p15BQq if Qpµq P H0, and thus

ÿ

 pQ

X

H0q



1 12

ÿ

pQq «

ÿ

 p15BQ q

Qpµq PH0

Qpµq PH0

Qpµq PH0



ÿ

pQq



1 3

ÿ

 pQq



1 6

 pH0q



1 36

 pH q.

QpµqPHzI

QpµqPHzI

 The converse estimate QpµqPH0  pQ X H0q À pHq follows trivially from }a}L8pq  3.

We consider the function

ÿ

(6.36)

"

pQq Q,

Qpµq PH0

where BQ  Q  1.1BQ, }Q}8 À pQq´1. Remark that

R°p Ln`1q " c~,

where c~ is some non-zero absolute constant. Notice also that

ÿ

(6.37)

}}1 À

pQq pQqn «  pH0q.

Qpµq PH0

Multiplying the left hand side of (6.35) by ||, integrating with respect to the Lebesgue

measure Ln`1, taking into account that the estimate in (6.35) holds on the whole Rn`1,

and using (6.37), we get

(6.38)



`|R | ´ f `|p || dLn`1

 `p

R° "`|R | ´ f `|p´1|R |´1R i || dLn`1

À  ppHq.

Next we estimate the second integral on the left hand side of the preceding inequality,

which we denote by I. For that purpose we will also need the estimate 

(6.39)

|Rp|| dLn`1q|p d À p°nppHq,

which we defer to Lemma 6.14. Using this inequality we get

|I |

"



`|R |

´

f


`

|p´1|R

|´1R

¨

Rp|| Ln`1q d 



^

`|R

|

´

f


`

|p

d

1{p1

^

1{p |Rp|| Ln`1q|p d

^

1{p

 pF p qq1{p1 |Rp|| Ln`1q|p d

p6.34q,(6.39) À

` 

ppHq1{p1 `p°n ppHq1{p

"

1{p1

°n ppHq.

56

D. DBROWSKI AND X. TOLSA

From (6.38) and the preceding estimate we deduce that  `|R | ´ f `|p || dLn`1 À 1{p1 °n ppHq.

Notice now that, for all x P supp ,

Gpxq

"

 2A30
S1 zV2

1 pRq |x ´ y|n´1

dpyq

À

pS1 q pRq distpS1 zV2, Sqn´1

À

pRq,

and so

|f pxq|  C pRq ` c3 pHq  2c3 pHq for all x P supp ,

taking (6.40)

into

account 
|R |p

that

°

"

1.

So 

|| dLn`1 À

we have `|R | ´

f `|p || dLn`1

 `

|f |p || dLn`1

À `1{p1 °n ` cp3 ppHq.

To get a contradiction, note that by the construction of  and by the properties of  ,

we have

(6.41)



R

¨  dLn`1

"



R°p Ln`1q d 

"

 |c~|

 d

 |c~| pHq

ÿ

 pBQq

Á

|c~|

pHq pH0q



|c~| 6

pHq pH q.

Qpµq PH0

However, by Hölder's inequality, (6.37), and (6.40), we have



R

¨  dLn`1



^

1{p ^ |R |p || dLn`1

1{p1 || dLn`1

À

`1{pp

p1q°n{p

`

 c3

pHq pH q,

which contradicts (6.41) if c3 is chosen small enough and   c ´° p1n ,
with c small enough.

Proof of (6.35). Recall that  " a  is a minimizer for F p¨q that in particular satisfies

F p q  3 ppHq, by (6.34). We have to show that, for all x P supp  ,

`|R

pxq|

´

f

pxq`|p

`

p

R° "`|R

|

´

f

`|p´1

|R

|´1

R

i pxq

À



pHqp

.

Let x0 P supp  and let B " Bpx0, q, with   0 small. For 0  t  1 we consider the competing measure t " at  , where at is defined as follows:

at " p1 ´ t Bqa.

Notice that, for each 0  t  1, at is a non-negative function such that

}at}L8pq  }a}L8pq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

57

Taking the above into account we deduce that

F

ptq

" 

 

`|Rt| `|Rt|

´ ´

f f

 p
`
 p
`

dt dt

` `

 

}at}L8pq

ppHq

`



 pH0 q tpH0q

ppHq

}a}L8pq

ppHq

`



 pH0 q tpH0q

ppHq

": Frptq.

Since Frp (6.42)

q

"

F

p

q



F

ptq



Frptq for t 1d
 pBq dt

 0, we infer

Frptq



t"0`

that 0.

Using that

d dt

|Rtpxq|
t"0

"

1 |R pxq|

R

pxq

¨

Rp´B qpxq,

an easy computation gives

d dt

Frptq
t"0

"

 ´

`|R | ´ f `|p d

`

B p

`|R

|

´

f


`

|p´1

1 |R |

R

¨

Rp´B q

d

`



 pH0 q  pH0q2

ppHq

 pBq.

Recalling

that

 pH0q



1 3

 pH0 q



1 6

 pH q,

from

(6.42)

and

the

preceding

calculation

we

derive

(6.43)

1  pBq

 `|R |
B

´

f `|p

d

`

p  pBq



`|R |

´

f `|p´1

1 |R

|

R

¨

RpB q

d



3

ppHq  pH0q

"

3 pHqp

 pH q  pH0q



18 pHqp.

We rewrite the left hand side of (6.43) as

1  pBq

 `|R |
B

´

f


`

|p

d

`

p  pBq


B

R° "`|R |

´

f


`

|p´1

i |R |´1R

d.

Taking into account that the functions in the integrands are continuous on suppp q, letting

the radius  of B tend to 0, it turns out that the above expression converges to

`|R

px0q|

´

f

px0q`|p

`

p

R° "`|R

|

´

f

`|p´1

|R

|´1R

i px0q.

The desired estimate (6.35) follows from the above and (6.43).

In order to complete the proof of Lemma 6.13 we need the following technical result.
Lemma 6.14. Suppose that (6.32) holds with   1 and let  be as in (6.36). Then,  |Rp|| dLn`1q|p d À p°nppHq,

58

D. DBROWSKI AND X. TOLSA

Proof. Recall that

ÿ

"

pQq Q,

Qpµq PH0

with BQ  Q  1.1BQ , }Q}8 À pQq´1. We consider the function

ÿ

g"

gQ,

Qpµq PH0

where gQ " cQ QXH0, with cQ " pQq  |Q| dLn`1 pQ X H0q´1. Observe that





(6.44)

gQ d " pQq |Q| dLn`1

and that

0



cQ

À

pQq pQqn pQ X H0q

«

µpQpµqq pQq

"

1.

The first step of our arguments consists in comparing Rp|| dLn`1qpxq to Rpxqpg qpxq, with  given by (6.21). We will prove that, for each Qpµq P H0,

(6.45)

|RppQq|Q| Ln`1qpxq ´ RpxqpgQ qpxq|

À

`distcpxpx, qpQQq|xqn´`yp1Q|`qnp`xpqQ1 |qxgnQ´`p1yy`q|n

2BQ dpy

pxq q,

|Rpxq

pgQ

qpxq|

for some fixed c  0. The arguments to prove this estimate are quite standard.

Suppose first that x P 2BQ. In this case, we have



|RppQq|Q| Ln`1qpxq| À pQq

1.1BQ

1 pQq |x

´

y|n

dLn`1pyq

À

pQq,

which yields

|RppQq|Q| Ln`1qpxq ´ RpxqpgQ qpxq| À pQq ` |RpxqpgQ qpxq|,

and shows that (6.45) holds in this situation. In the case x R 2BQ we write

RppQq|"(6".4RQ4)|`L`np^`Q|1xq|qx|px´´xyq´|yQ´|yn|`RpLx1qn´`|pxx1q|x´´pxg´Qx´ygQ|´ynx`qQpx1x|QpgnqxQ`q1p`yq"d|x´ppyQyq|q|pxqQ|xpyx´q|´dyL|ynn``11gpQypqy´q dgQppyyqq

 dpyq

": I1pxq ` I2pxq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

59

Concerning |I1pxq| À

th|ext´erpmxQQqI|n1`px1q",rpeQcaql|lingQtphyaqt|

supp Q Y supp gQ  1.1BQ, we obtain

dLn`1pyq

`

 gQpyq dpyq

À

|x

pQq ´ xQ|n`1

pQq.

Regarding I2pxq, we write



I2pxq 

yPQ:|x´y|pxq

|x

1 ´ y|n

gQpyq dpyq.

Notice that for y P Q, since x R 2BQ, we have

(6.21)
C|x ´ y|  pQq  pyq  pxq ´ |x ´ y|.

Thus, |x ´ y|  c pxq, and so



I2pxq 

cpxq|x´y|pxq

|x

1 ´ y|n

gQpyq dpyq.

Gathering the estimates for I1pxq and I2pxq we see that (6.45) also holds in this case. From (6.45) we infer that

|Rp|| Ln`1qpxq ´ Rpxqpg qpxq|

À

ÿ

pQq pQqn`1 distpx, Qqn`1 ` pQqn`1

`

ÿ

2BQ pxq |RpxqpgQ qpxq|

QpµqPH0

Qpµq PH0

`

cpxq|x´y|pxq

|x

1 ´ y|n

gpyq dpyq

" S1pxq ` S2pxq ` S3pxq.

We split

(6.46)



ÿ3 

|Rp|| Ln`1qpxq ´ Rpxqpg qpxq|p dpxq À

|Sipxq|p dpxq.

i"1

We estimate the first summand by duality. Consider a function h P Lp1pq. Then,

(6.47)

 S1pxq hpxq dpxq "

ÿ

 pQq

distpx,

pQq Qqn`1 `

pQqn`1

hpxq

dpxq.

Qpµq PH0

For each Qpµq P H0, using the fact that pQq  C pHq pQqn for every   1, we obtain



distpx,

pQq Qqn`1 `

pQqn`1

hpxq

dpxq

À

C

pHq

inf
yPQ

M hpy q.

Therefore, the right side of (6.47) does not exceed

ÿ



C pHq

pQq

inf
yPQ

M hpy q

À

pHq

Qpµq PH0

Mhpyq dpyq
H

 pHq pHq1{p }Mh}Lp1 pq À pHq pHq1{p }h}Lp1 pq.

So we deduce that

 |S1pxq|p dpxq À ppHq.

60

D. DBROWSKI AND X. TOLSA

Regarding 
|S2pxq|p

the summand ÿ
dpxq "

in (6.46) involving  |RpxqpgQ 

S2, since the balls 2BQ are disjoint, we have qpxq|p dpxq  ÿ }Rp¨qpgQ q}pLppq,

QpµqPH0 2BQ

Qpµq PH0

where Rp¨qpgQ qpxq " RpxqpgQ qpxq. Finally, to estimate the last summand in (6.46),

we take into account that |S3pxq| À M,npg qpxq, where M,npg q is the maximal oper-

ator from (6.31). Hence,



|S3pxq|p dpxq À |M,npg q|p d À pHqp }g}pLppq À ppHq.

Gathering the estimates obtained for Sÿ1, S2, S3, by (6.46) we get

}Rp|| Ln`1q}pLppq À ppHq `

}Rp¨qpgQ q}pLppq ` }Rp¨qpgq}pLppq.

Qpµq PH0

From (6.4), we deduce that

ÿ

}Rp|| Ln`1q}pLppq À ppHq `

}RpgQ q}pLppq ` }Rpgq}pLppq

ÿ QpµqPH0

`

}M,npgQ q}pLppq ` }M,npg q}pLppq.

Qpµq PH0

Using now that, by Lemma 6.12, R, is bounded from LpptH0q to LpptS1 q with }R}LpptH0 qÑLpptS1 q À °n pHq,
and that the same happens for M,n, we get }Rp|| Ln`1q}pLppq À ppHq ` p°npHqp }g}pLppq À p°nppHq.

6.6. Lower estimates for R.

Lemma 6.15. Let R P MDW be such that R P Trc and let V4 and  be as in Section 6.4.

Assume

°



0

big enough p|Rpxq|

V4

and let c3 be as in Lemma 6.13. Then we have

´

c3 2

pHD1qq`p

dpxq

Á

°´p1n p pHD1 pepRqqq,

for any p P p1, 8q, with the implicit constant depending on p.

Proof.

For all x Rpxq

P supp , Rpxq ´

Rusipnxgqth""at}RppxRqRpR}x8q|p´xxq´2´ARyp´0|Ryn3`qpq1ppRRxq´´qp1xy, qqwdeopbyqtain

 2A30

1 yPSzV2 pRq |x ´ y|n´1 dpyq

` 2A30

yPV2 :R pyqR pxq

pRq

1 |x ´

y|n´1

dpyq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

61

Recall that R equals 1 on V3 and vanishes out of V4. Then it is clear that the last integral

on the right hand side above vanishes if x P V3 and it does not exceed C pRq if x P V3c.

So in any case

Rpxq Rpxq ´ Rpxq  Gpxq ` C5 pRq.

From the preceding estimate we infer that

|Rpxq

Rpxq|

´

c3 2

pHD1q



|Rpxq|

´

Gpxq

´

C5

pRq

´

c3 2

pHD1q

 |Rpxq| ´ Gpxq ´ c3 pHD1q.

Therefore, since |p ¨ q`|p is non-decreasing,


V4

p|R|

´

c3 2

pHD1qq`p d

 

 

p|R

R|

´

c3 2

pHD1qq`p

d

p|R| ´ G ´ c3 pHD1qq`p d

  p|R| ´ G ´ c3 pHqq`p d.

By Lemma 6.13,  p|R| ´ G ´ c3 pHqq`p d  c°´p1nppHq  c´° p1nppHD1pepRqqq,
and so the lemma follows.

7. The Riesz transform on the tractable trees: transference estimates
In all this section we assume that R P MDW is such that R P Trc, i.e., T pe1pRqq is tractable, and we consider the measure  constructed in the previous section. Essentially, our objective is to transfer the lower estimate we obtained for R in Lemma 6.15 to the Haar coefficients of Rµ associated with cubes close to T pe1pRqq.
7.1. The operators RTReg, RTr , and Tr R. To simplify notation, in this section we will write
End " Endpe1pRqq, Reg " Regpe1pRqq, T " T pe1pRqq, and TReg " TRegpe1pRqq.
We need to consider an enlarged version of the generalized tree T , due to some technical difficulties that arise because the cubes from Neg :" Negpe1pRqq X End are not P-doubling. To this end, denote by RegNeg the family of the cubes from Reg which are contained in some cube from Neg. Let DNeg be the subfamily of the cubes P P RegNeg for which there exists some P-doubling cube S P TReg that contains P . By the definition of Neg, such cube S is contained in the cube from Q P Neg such that P  Q. We also denote by MNeg the family of maximal P-doubling cubes which belong to TReg and are contained in some cube from Neg, so that, in particular, any cube from DNeg is contained in some cube from MNeg.
We define End " pEndzNegq Y MNeg,

62

D. DBROWSKI AND X. TOLSA

and we let Tr " Trpe1pRqq be the family of cubes which belong to TReg and are not strictly

contained in any cube from End. Further, we write

(7.1)



Z " Zpe1pRqq " e1pRqz

Q

and

Zr " Zrpe1pRqq " e1pRqz  Q

QPEnd

QPEnd

Then we denote

ÿ

RTReg µpxq "

Qpxq Rp2Rz2Qµqpxq,

QPReg

ÿ

RTr µpxq "

Qpxq Rp2Rz2Qµqpxq,

QPEnd

and

ÿ

`



`



Tr Rµpxq "

Qpxq mµ,QpRµq ´ mµ,2RpRµq ` Z pxq Rµpxq ´ mµ,2RpRµq .

QPEnd

Here Rµpxq is understood in the principal value sense (which exists µ-a.e. because we

assume that µ has polynomial growth and that R°µ  8 µ-a.e. Remark that the cubes from Reg have the advantage over the cubes from End that

their size changes smoothly so that, for example, neighboring cubes have comparable side

lengths. However, they need not be P-doubling or doubling, unlike the cubes from End.

We define

QRegpQq "

ÿ

pP q DpP, Qqn`1

µpP

q,

P PReg

where

DpP, Qq " pP q ` distpP, Qq ` pQq.

The coefficient QRegpQq will be used to bound some "error terms" in our transference arguments. We will see later how they can be estimated in terms of the coefficients PpQq by duality. Notice that, unlike PpQq, the coefficient QRegpQq depends on the family Reg.

Lemma

7.1.

For

any

Q

P

Reg

such

that

pQ Y

1 2

B

pQqq

X

V4





and

x

P

Q,

y

P

1 2

BpQq,

RTReg µpxq ´ Rpyq À pRq ` PpQq ` QRegpQq.

Proof. By the triangle inequality, for x, y and Q as in the lemma, we have RTReg µpxq ´ Rpyq  ``RµRRµ2Rp2z12Qe1BzpRQpQqppqxqxcQqpqx`Q`qR´RµRµe1ep1RppRq12zqB2zQQpQppxxqqqQc p´qy´qR `RµRe1ppR21Bqz21p2QBQqppqQxcqpQpxyqQqq " I1 ` . . . ` I6.

To estimate I1, notice that, by (6.14), distpQ, supp µze1pRqq Á pRq. Then it follows that

I1

À

µp2Rq pRqn

À

pRq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

63

Arguing similarly one also gets

I3

À

µp2Qq pQqn

À

P pQq.

By standard arguments involving continuity of the Riesz kernel, we also deduce that

I2 À PpQq, I5 À PpQq.

Concerning

the

term

I6,

using

that



is

a

constant

multiple

of

Ln`1

on

1 2

BpQq,

we

get

I6





1 2

BpQq

|x

1 ´ y|n

dpyq

À

p

1 2

B

pQqq

pQqn

À

P pQq.

Finally we deal with the term I4.

To

this

end,

recall

that

µpP q

"

p

1 2

B

pP

qq

for

all

P P Reg, and so

I4 

ÿ



K pxQ

´

`

zq d



t

1 2

BpP

q

´ µtP pzq

P

PReg:P
ÿ

Q



`





|KpxQ ´ zq ´ KpxQ ´ xP q| d

t

1 2

BpP

q

`

µtP

pzq

P PReg:P Q

À

ÿ
P PReg:P Q

|xQ

pP q ´ xP |n`1

µpP q

«

ÿ
P PReg:P Q

pP q DpQ, P qn`1

µpP q



QReg pQq.

For the estimates in the last line we took into account the properties of the family Reg described in Lemma 6.4. Gathering the estimates above, the lemma follows.

Lemma 7.2. For any Q P End and x, y P Q,

RTr

µpxq

´

Tr

Rµpyq

À

P pRq

`

^

E p4Rq µpRq

1{2

`

P pQq

`

^ E p2Qq µpQq

1{2

.

Proof. For Q P End and x, y P Q, we have

`



(7.2) RTr µpxq ´ Tr Rµpyq " R` p2Rz2Qµqpxq ´ mµ,QpRµq ´ mµ,2RpRµq

" R`p2Rz2Qµqpxq ´ mµ,QpR2Rz2Qµq ´ mµ,QpRp2Qµqqq

´ mµ,QpRp2Rc µqq ´ mµ,2RpRµq .

To estimate the first term on the right hand side, notice that for all x, z P Q, by standard

arguments we have

Rp2Rz2Qµqpxq ´ Rp2Rz2Qµqpzq À PpQq.

Averaging over z P Q, we get Rp2Rz2Qµqpxq ´ mµ,QpR2Rz2Qµq À PpQq.

To estimate mµ,QpRp2Qµqq we use the fact that, by the antisymmetry of the Riesz kernel,

mµ,QpRpQµqq " 0, and thus mµ,QpRp2Qµqq " mµ,QpRp2QzQµqq 



´
zPQ

1 P2QzQ |z ´ |n

dµpqdµpzq.

64

D. DBROWSKI AND X. TOLSA

By Cauchy-Schwarz and Lemma 2.6, we have

(7.3)



´ zPQ

P2QzQ

|z

1 ´ |n

dµpqdµpzq



1

1

"´
zPQ

P2Qz2BQ

|z ´ |n dµpqdµpzq `

´
zPQ

P2BQzQ |z ´ |n dµpqdµpzq



P pQq

`

^


´
zPQ

^


P2BQzQ

|z

1 ´ |n

2

1{2

dµpq dµpzq

À

P pQq

`

^ Ep2Qq 1{2 µpQq

.

Finally we deal with the last term on the right hand side of (7.2). We split it: mµ,QpRp2Rc µqq ´ mµ,2RpRµq  `mmµ,Qµp,QRppRp3R3zR2Rc µµqqqq|´`mmµ,µ2R,2RpRpRpp3R3cRµµqqqq " J1 ` J2 ` J3.

Clearly,

J1

À

µp3Rq pRqn

À

P pRq.

Also, by the antisymmetry of the Riesz kernel and arguing as in (7.3),

J2 "mµ,2RpRp3Rµqq " mµ,2RpRp3Rz2Rµqq




´
zP2R


P3Rz2R

|z

1 ´

|n

dµpqdµpzq

À

P pRq

`

^ Ep4Rq 1{2 µpRq

.

Regarding J3, by standard methods, for all z, z1 P 2Q, Rp3Rc µqpzq ´ Rp3Rc µqpz1q À PpRq.

Hence averaging for z P Q, z1 P 2R, we obtain

J3 À PpRq.

Lemma 7.3. Let 1  p  2. For any Q P End such that 0  pQq,



RTr µ

´

RTReg µp

dµ

À

E

p2Qq

p 2

µpQq1´

p 2

.

Q

Proof. The lemma follows from Hölder's inequality and the estimate

(7.4)

 RTr µ ´ RTReg µ2 dµ À Ep2Qq,

Q

which we prove below.
Notice first that the cube Q as above is covered by the cubes P P DµpQqXReg. Indeed, if Q P MNeg, then Q P TReg and this is trivially true. On the other hand, if Q P EndzMNeg  End, then we have Q P T , and the condition 0  pQq implies that dR,0pxq  pQq. Hence, Q is covered by the cubes P P DµpQq X Reg.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

65

Observe now that, for Q P End, P P Reg such that P  Q, and x P P ,

RTReg µpxq ´ RTr µpxq " Rp2Rz2P µqpxq ´ Rp2Rz2Qµqpxq " Rp2Qz2P µqpxq.

Thus,

RTReg µpxq ´ RTr µpxq À

ÿ

µ p2BS q.

SPDµ:P SQ

Notice now that, if Qp denotes the cube from End that contains Q (which coincides with Q

when P R RegNeg), we have

dRpxq Á distpP, supp µzQpq  distpP, supp µzQq for all x P P .

So by Lemma 6.4 we also have

(7.5)

pP q Á distpP, supp µzQq

Thus,

ÿ

ÿ

µp2BS q À

µp2BS q,

SPDµ:P SQ

SPDrµintpQq:SP

with DrµintpQq defined in (2.9).

So we haveRTr µ ´ RTReg µ2 dµ "

ÿ

 RTr µ ´ RTReg µ2 dµ

Q

P PReg:P Q P

ÿ^

ÿ

2

À

µp2BS q µpP q.

P PReg:P Q SPDrµintpQq:SP

By Hölder's inequality, for any   0,

^

ÿ

2

µ p2BS q

SPDrµintpQq:SP

^



ÿ

^

pQq pSq



µp2BS

q2

^

ÿ

^ pSq   pQq

À

S

PDrµint pQq:S
ÿ

P
^

pQq



SPDrµintpQq:SP pSq

µp2BS q2.

SPDrµpQq:SP

Therefore,


Q

RTr

µ

´

RTReg

µ2

dµ

À"SPPDrPÿ ÿµiRneÿ tgp:QPq^^QppSppQQSSPDrqqqqµintÿpQqµµ:Spp22BBP SS^qq22ppPµQSPpqqSReÿqg.:PµSp2µBpPS

q2µpP q

q

S PDrµint pQq

66

D. DBROWSKI AND X. TOLSA

By Lemma 2.9, for  small enough, the right hand side is bounded above by CEp2Qq, so that (7.4) holds.

7.2. Estimates for the P and QReg coefficients. We will transfer the lower estimate obtained for the Lppq norm of R in Lemma 6.15 to RT µ, RTRegµ, and T Rµ by means of Lemmas 7.1, 7.2, and 7.3. To this end, we will need careful estimates for the P and QReg coefficients of cubes from End and Reg. This is the task we will perform in this section.
Given R P MDW, recall that HD1pe1pRqq " HD°pRqXStop°pe1pRqq. To shorten notation, we will write HD1 " HD1pe1pRqq in this section. Notice also that, by (4.9), we have

(7.6)

End " LD1 Y LD2 Y HD2 Y MNeg,

where we introduced the following notations:

, LD1 is the subfamily of End of those maximal P-doubling cubes which are contained

both in e1pRq and in some cube from LDpRq X Stop1pe1pRqqzNeg.

, LD2 is the subfamily of End of those maximal P-doubling cubes which are contained

,

in somecube Q HD2 " Q1PHD1

P LDpQ1q pHD°pQ1q

X X

Stop°pQ1qzNeg Stop°pQ1qq.

for

some

Q1

P

HD1.

Remark that the splitting in (7.6) is disjoint. Indeed, notice that, by the definition of MNeg,
the cubes from HD2 do not belong to MNeg, since they are strictly contained in some cube from HD1, which is P-doubling, in particular.
For i " 1, 2, we also denote by RegLDi the subfamily of the cubes from Reg which are contained in some cube from LDi, and we define RegHD2, RegNeg, and RegMNeg analogously.3 We let RegOt be the "other" cubes from Reg: the ones which are not contained in any cube from End (which, in particular, have side length comparable to 0 and are contained in T ).
Also, we let RegHE be the subfamily of the cubes from Reg which are contained in some cube from End X HE. Notice that we have the splitting

(7.7)

Reg " RegLD1 Y RegLD2 Y RegHD2 Y RegNeg Y RegOt.

The families above may intersect the family RegHE.

Given a family I P Dµ and 1  p  2, we denote

ÿ Pp pIq " PpQqp µpQq,

ÿ Qp pIq " QRegpQqp µpQq.

QPI

QPI

We also write P pIq " P2 pIq, QpIq " Q2 pIq.

Lemma 7.4. For any Q P End, PpReg X DµpQqq À PpQq2 µpQq ` Ep2Qq.

3Notice that DNeg " RegMNeg .

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

67

Proof. For all S P Reg X DµpQq, by Hölder's inequality, we have

P pS q2

À 

^ ^

ÿ
P :SP Q
ÿ
P :SP Q

pSq pP q
pSq pP q

pP pP

2 q

`

^

pSq pQq

2 P pQq

^ q2

P

ÿ
:SP

Q

pSq pP q



`

P pQq2

À

P

ÿ
:SP

Q

pSq pP q

pP

q2

`

P pQq2 .

We deduce that

ÿ

PpReg X DµpQqq "

PpSq2 µpSq

SPRegXDµpQq

À

ÿ
SPRegXDµpQq

P

ÿ
:SP

Q

pSq pP q

pP

q2

µpSq

`

ÿ
SPRegXDµpQq

P pQq2

µpSq.

Clearly, the last sum is bounded by PpQq2 µpQq. Concerning the first term, arguing as in (7.5), we deduce that the cubes P in the sum belong to DrµintpQq. Thus, by Fubini,

P pReg

X

DµpQqq

À

ÿ pP q2
P PDrÿµintpQq

ÿ
SPReg:SP

pSq pP q

µpSq

`

P pQq2

µpQq



pP q2 µpP q ` PpQq2 µpQq

P PDrµintpQq

À Ep2Qq ` PpQq2 µpQq.

Lemma 7.5. We have:

(i) If Q P LD1, then PpQq  0 pRq.

(ii) If Q P LD2, then PpQq À 0 ° pRq.

(iii) (iv)

If If

Q Q

P P

HD2 Neg

, then P Y MNeg,

pQq

À

2°

pRq. ´

then PpQq À

pQq pRq

¯1{3

pRq.

Proof. The statements (i), (ii), and (iii) follow from the stopping conditions used to define

LDp ¨ q and HD°p ¨ q and Lemma 3.3. Regarding the property (iv), by the definitions of Neg and MNeg and Lemma 3.3, for all
S P Dµ such that Q  S  R, we have

pSq

À

^ pSq 1{2 pRq

P pRq

À

^ pSq 1{2 pRq

pRq.

68

D. DBROWSKI AND X. TOLSA

Thus,

P pQq

«

pQq pRq

P pRq

`

ÿ
S:QSR

pQq pSq

pSq

À

pQq pRq

ÿ pRq `
S:QSR

pQq pSq

^ pSq 1{2 pRq

pRq

À

pQq pRq

pRq `

ÿ
S:QSR

^ pQq 1{2 pRq

pRq

À

pQq pRq

pRq `

^ log 2

`

 pRq pQq

^ pQq 1{2 pRq

pRq

À

^ pQq 1{3 pRq

pRq.

Remark

7.6.

Since

0

"

´N0´

1 2N



´° N0´

1 2N

,

it

follows

that

0 °  01{2, so that by

the preceding lemma

PpQq À 01{2 pRq for all Q P LD1 Y LD2.

Given Q P Dµ, we write Q ,, T if there exists some Q1 P T such that

(7.8)

A´0 2pQq  pQ1q  A20pQq and 20Q1 X 20Q  .

Given  P p0, 1q, we say that the tree T is -nice if ÿ Ep4Qq   pHD1q.
QPHE:Q,,T

Lemma 7.7. Let R P MDW and suppose that T " T pe1pRqq is tractable and -nice. Then

(7.9)

ÿ

ÿ

P pRegHEq À

Ep4Qq 

Ep4Qq   pHD1q,

QPEndXHE

QPHE:Q,,T

(7.10)

P pRegLD1 Y RegLD2 q À

ÿ

E

p4Qq

À

` B

M02

0

`

 

pHD1q,

QPLD1YLD2

(7.11)

ÿ

E p4Qq

À

` B

M02

`

 

pHD1q.

QPHD2

Also, for 1  p  2,

(7.12) (7.13)

Pp pRegHEq

À



1 2

B

2°

ppHD1q,

Pp pRegLD1

Y

RegLD2 q

À

B

2°`M02

0

`

 

ppHD1q,

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

69

(7.14)

Pp pRegHD2 q À Pp pHD2q « ppHD2q À B p°´2 ppHD1q.

Proof. To get (7.9) note that all the cubes in End are P-doubling. Thus, by Lemma 7.4

and the definition of HE

P pRegHEq À P pEnd X HEq ` ÿ Ep4Qq

ÿQPEndXHE

ÿ

ÿ

À

pQq2µpQq `

Ep4Qq «

E p4Qq.

QPEndXHE

QPEndXHE

QPEndXHE

Observe that for all Q P TReg (in particular, for all Q P End) we have Q ,, T . Together with the fact that T is -nice, (7.9) follows.
To see (7.12), we first use Hölder's inequality together with (7.9):

Pp pRegHEq



P

pRegHE

q

p 2

µpe1

pRqq1´

p 2

À

1
2

pHD1q

p 2

µpRq1´

p 2

.

Observe now that, writing HDi " QPHDi Q,

(7.15)

1

1

1

µpHD1q " 2° pRq2 pHD1q  B 2° pRq2 pRq " B 2° µpRq.

Therefore,

Pp pRegHEq

À

1
2

B

2°

pHD1

q

p 2

µpH

D1

q1´

p 2

"

1
2

B 2° ppHD1q,

which proves (7.12). To show (7.10) observe first that, by Lemma 7.5 and Remark 7.6,

pLD1 Y LD2q À 0 pRq2 µpRq À 0 B pHD1q.

Then, by Lemma 7.4 again,

ÿ

P pRegLD1 Y RegLD2q À P pLD1 Y LD2q `

E p4Qq

ÿ QPLD1YLD2

ÿ

 pLD1 Y LD2q `

Ep4Qq `

E p4Qq

À

pLD1

Y

LD2q

`QPMpL0D2 1Y`LpDL2Dqz1HYE

QPHE:Q,,T



LD2qzHE

` À

`BpHMD021q0

`

 

pHD1q.

So, by Hölder's inequality and (7.15),

Pp pRegLD1

Y

RegLD2 q



P pRegLD1

Y

p
RegLD2 q 2

µpe1

pRqq1´

p 2

À

` B

M02

0

`

1 2

p
pHD1q 2

µpRq1´

p 2

À 

` B ` B

M2°02M002`0` p2BpB2°2°q1´pp2pHpDp1HqD, 1q

which yields (7.13).

70

D. DBROWSKI AND X. TOLSA

To prove (7.11), we just write

ÿ

ÿ

ÿ

Ep4Qq 

Ep4Qq `

E p4Qq

QPHD2

QPHD2 zHE

QPHE:Q,,T

 M02 pHD2q `  pHD1q  M02 B pHD1q `  pHD1q.

Finally, regarding (7.14), recall that pQq  2° pRq for all Q P T . This implies that also PpQq À 2° pRq for all Q P T , by Lemma 3.3. Arguing as in Remark 6.5 one gets

(7.16)

PpQq À 2° pRq for all Q P Reg.

Consequently,

Pp pRegHD2 q À 2°p pRqp µpHD2q " ppHD2q « Pp pHD2q.

On the other hand, since R P Trc,

ppHD2q " pHD2qp´2 pHD2q  B pHD2qp´2 pHD1q

"

B

pHD2qp´2 pHD1qp´2

ppHD1q

"

B

p°´2

ppHD1q,

which completes the proof of (7.14).

Lemma 7.8. Let R P MDW and suppose that T " T pe1pRqq is tractable and -nice. Then

(7.17)

P

pMNeg q

À

P

pNegq

À

` 0

B

6°

`

B

´° 4

pHD1q,

and (7.18)

P pRegNegq `

ÿ

E p4S q

À

` 0

B

M02

6°

`

B

´° 4

M02

`

 

pHD1q

S PMNeg

Also, for 1  p  2,

(7.19)

Pp pRegNegq

À

`1 02

B

M02

6°

`

B

´° 1

M0

`

B2°

1 2



ppHD1q.

Proof. Recall that Neg " Negpe1pRqq X End. The first inequality in (7.17) follows from

Lemma 7.17 and the definition of MNeg.

By Lemma 4.5, doubling and that

the cubes´ PpQq À

fpprQRoqqm¯1N{3egpbReqlofnogr

to LDpRq. Recall also they are not all Q P Neg. To estimate P pNegq,

Pwe

split Neg into two subfamilies I and J so that the cubes from I have side length at least

´° 6pRq,

opposite

to

the

ones from ÿ

J.

We

have

ÿ

P pIq " PpQq2 µpQq À pRq2 µpQq

QPI

ÿ

QPI

ÿ

À pRq2 pQq pQqn À 0pRq3 pQqn.

QPI

QPI

Using

now

that

the

balls

1 2

B

pQq,

with

Q

P

I,

are

disjoint

and

that

pQq



´° 6pRq,

we

get

ÿ pQqn
QPI

ÿ 
QPI

6° pQqn`1 pRq

À

6° pRqn`1 pRq

"

6° pRqn.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

71

Therefore,

P pIq À 0 6° pRq3 pRqn « 0 6° pRq À 0 B 6° pHD1q.

In connection with the family J, we have

P

pJ

q

" 

ÿ PpQq2 µpQq À pRq2

QPJ
°´12{3 pRq2

ÿ

µpQq



ÿ
QPJ

^ pQq 2{3 pRq

µpQq

´° 4 pRq  B ´° 4 pHD1q.

QPJ

Hence,

P

pNegq

À

` 0

B

6°

`

B

´° 4

pHD1q.

To deal with (7.18), we split

P pRegNegq " P pRegMNeg q ` P pRegNegzRegMNeg q.

Notice that, for all P P RegNegzRegMNeg such that P  Q P Neg, by Lemma 3.3, PpP q À PpQq. Then it follows that

P pRegNegzRegMNeg q À P pNegq.

Next we estimate P pRegMNegq. By Lemma 7.4, we have

(7.20)

ÿ

ÿ

P pRegMNeg q "

P pRegMNeg X DµpSqq À

Ep4Sq ` P pMNegq

SPMÿNeg

ÿ

S PMNeg



Ep4Sq `

Ep4Sq ` P pMNegq.

SPMNegzHE

SPHEXEnd

By the definition of HE and the fact that PpSq À PpQq whenever S  Q P Neg, we derive

ÿ

ÿ

Ep4Sq ` P pMNegq À M02

pSq ` P pMNegq À M02 P pNegq.

SPMNegzHE

S PMNeg zHE

On the other hand, by (7.9),

ÿ Ep4Sq   pHD1q.
SPHEXEnd

Therefore,

ÿ

ÿ

P pRegMNeg q `

Ep4Sq À

Ep4Sq À M02 PpNegq `  pHD1q.

S PMNeg

S PMNeg

Gathering the estimates above, we deduce

P

pRegNegq

À À

`M002BPMpN02 eg6°q

` `

 B

pHD1q ´° 4 M02

`

 

pHD1q.

72

D. DBROWSKI AND X. TOLSA

Finally, to prove (7.19) we apply Hölder's inequality and (7.15):

Pp pRegNegq



P

pRegNeg

q

p 2

µpe1pRqq1´

p 2

À

` 0

B

M02

6°

`

B

´° 4

M02

`

p 2

p
pHD1q 2

µpRq1´

p 2

À

` 0

B

M02

6°

`

B

´° 4

M02

`

p 2

pB

2°

q1´

p 2

ppHD1q

À

`1 02

B

M02

6°

`

B

´° p

M0p

`

B

2°



1 2



ppHD1q.

Assuming ° big enough, we have ´° 1 M0  1. Then, it is clear that ´° p M0p  ´° 1 M0, and so (7.19) follows.

Next lemma deals with Pp pRegOtq. Below we write RegOtp0q to recall the dependence of the family RegOt on the parameter 0 in (6.8).

Lemma 7.9. For 1  p  2, we have

(7.21)

lim sup Pp pRegOtp0qq À 2°p pRqp µpZq.
0Ñ0

Consequently, if µpZq  Z µpRq, then

(7.22)

lim sup Pp pRegOtp0qq À B 4° Z ppHD1q.
0Ñ0

Proof. Notice that if x P Q P End with pQq  0, then

dR,0 pxq  maxp0, pQqq " pQq

(recall that dR,0 is defined in (6.8)), and thus x is contained in some cube Q1 P Reg with

pQ1q  pQq, by the definition of the family Reg. So Q1  Q and then Q1 P RegzRegOt.

Therefore,





(7.23)

P  e1pRqz

Q,

P PRegOt

QPEnd:pQq0

and thus (7.24)

^

^



lim sup µ

P  µ e1pRqz

Q " µpZq.

0Ñ0

P PRegOtp0q

QPEnd

To complete the proof of (7.21) it just remains to notice that by (7.16) PpP q À 2° pRq

for all P P Reg, and so

^



Pp pRegOtp0qq À 2°p pRqp µ

P.

P PRegOtp0q

Regarding the second statement of the lemma recall that, as in (7.15), µpHD1q 

1 B 2°

µpRq,

which

implies

that

µpZq  B 2° Z µpHD1q.

Plugging this estimate into (7.21) and taking into account that pHD1q " °pRq, we get

lim sup Pp pRegOtp0qq À B p°`2 Z pHD1qp µpHD1q  B 4° Z ppHD1q.
0Ñ0

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

73

Remark 7.10. From (7.23), it is immediate to check that for all x P P P RegOt, we have dRpxq À 0, and so dR,0pxq « 0, which implies that
pP q « 0.

Lemma 7.11. Let R P MDW and suppose that T " T pe1pRqq is tractable and -nice. For

1  p  2, if µpZq  Z µpRq and 0 is small enough, then

(7.25)

Pp pRegq

À

` B

M02

1
6°02

`

B

´° 1M0

`

B

2°

1
2

`

B

4°

Z

`

B

p°´2 ppHD1q.

Proof. This follows by gathering the estimates obtained in Lemmas 7.7, 7.8, and 7.9.

Remark

7.12.

Recall that

0

"

´N0

´

1 2N



´° N0´

1 2N

,

and

also

that

°

" A0kp1´1{N qn

1

and B " °100n . Assuming that N0  20, that k is big enough (depending on M0), and

that  and Z are small enough (depending on k and M0), we have

1
B M02 6°02

`

B

2°



1 2

1
` B M02 4° Z2



´° 1.

In this way, for 0 small enough, under the assumptions of Lemma 7.11 we have Pp pRegq À `´° 1 ` B ´° 1M0 ` B p°´2 ppHD1q.

Assuming again k big enough (depending on M0), and taking p P p1, 3{2s, we have

(7.26)

Pp pRegq À B °´1{2M0 ppHD1q  °´1{4 ppHD1q.

Next lemma shows how to estimate the QReg coefficients in terms of the P coefficients.

Lemma 7.13. For all p P p1, 8q,

Qp pRegq À Pp pRegq.

Proof. By duality,

(7.27)

^ÿ

1{p

ÿ

Qp pRegq1{p "

QRegpQqp µpQq " sup

QRegpQq gQ µpQq,

QPReg

QPReg

where the supremum is taken over all sequences g " tgQuQPReg such that

(7.28)

ÿ |gQ|p1 µpQq  1.

QPReg

We will identify the sequence g with the function

ÿ

rg "

gQ Q,

QPReg

74

D. DBROWSKI AND X. TOLSA

so that the sum in (7.28) equals }gr}pL1p1pµq. By the definition of QReg and Fubini we have

(7.29)

ÿ
QPReg

QRegpQq

gQ

µpQq

" "

ÿ
QPReg
ÿ
P PReg

^Pÿ PQRÿ PegReDg pDPp,pPPQ,pqqPQn`qqn1`µ1pgPQqµgQpQµqpQµqpP

q.

For each P P Reg, we have

(7.30)

ÿ
QPReg

pP q DpP, Qqn`1

|gQ| µpQq

"

ÿ
j0

ÿ
QPReg:2j pP qDpP,Qq2j`1pP q

pP q DpP, Qqn`1

|gQ| µpQq

ÿ

ÿ

2´j


j0

QPReg:DpP,Qq2j`1pP q p2j pP qqn

|gQ| µpQq.

Observe now that the condition pQq ` distpP, Qq  DpP, Qq  2j`1pP q,

implies that

Q  BpxQ, pQqq  BpxP , 2j`3pP qq.

From (7.30) and this fact, we infer that

ÿ
QPReg

pP q DpP, Qqn`1

|gQ|

µpQq

 

ÿ
j0
ÿ
j0

ÿ

2´j

p2j pP qqn

QPR2e´g:jQBpxP ,C2j pP qq p2j pP qqn BpxP ,C2jpP

qq

|gr|

dµ

|gQ|

µpQq

Notice now that, for all x P P ,





|gr| dµ 

|gr| dµ

BpxP ,C2j pP qq

Bpx,C12j pP qq

 µpBpx, C12jpP qqq Mµrgpxq  µpBpxP , C22jpP qqq Mµgrpxq,

where Mµ is the centered Hardy-Littlewood maximal operator. Thus,

ÿ
QPReg

pP q DpP, Qqn`1

|gQ|

µpQq



ÿ jÿ0

2´j µpBpxP , C22j pP qqq p2jpP qqn

Mµgrpxq

« 2´kµp2kBP q Mµgrpxq « PpP q Mµgrpxq.

k0

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

75

Plugging this estimate into (7.29), and taking the infimum for x P P , we get

ÿ

ÿ

QPReg

QReg pQq

|gQ|

µpQq

À

P PReg

PpP q

inf
xPP

Mµrgpxq µpP q

^ 

ÿ

1{p^ PpP qp µpP q

ÿ



1{p1 |Mµrg|p1 dµ

P PReg

P PReg P

" Pp pRegq1{p }Mµgr}Lp1 pµte1pRqq

À Pp pRegq1{p }gr}Lp1 pµq  Pp pRegq1{p,

which concludes the proof of the lemma, by (7.27).

7.3. Transference of the lower estimates for R to Tr Rµ. We denote by Vr4 the

union

of

the

balls

1 2

BpQq,

with

Q

P

Reg,

that

intersect

V4.

Lemma 7.14. Let R P MDW and suppose that T " T pe1pRqq is tractable and -nice, with  small enough. Suppose that µpZq  Z µpRq, and take Z , , M0, °, B and 0 as in Remark 7.12. Then
}Tr Rµ}2L2pµq  ´° 2 pHD1q.

Proof. Recall that in Lemma 6.15 we showed that

(7.31)

I0

:"


V4

p|Rpxq|

´

c3 2

pHD1qq`p

dpxq

Á

´° p1n ppHD1q,

for any p P p1, 8q, with c3 as in Lemma 6.13. The appropriate values of n and p will be

chosen at the end of the proof.

By

Lemma

7.1,

for

all

Q

P

Reg

such

that

1 2

BpQq



Vr4,

all

x

P

1 2

B

pQq,

and

all

y

P

Q,

|Rpxq|  |RTRegµpyq| ` CpRq ` CPpQq ` CQRegpQq.

Thus,

for

°

big

enough,

since

pRq

"

´° 1pHD1q



c3 4

pHD1

q,

p|Rpxq|

´

c3 2

pHD1qq`



p|RTReg µpyq|

´

c3 4

pHD1qq`

`

C P pQq

`

C QReg pQq.

Therefore,

I0

À

ÿ
QPReg


Q

p|RTReg µpyq|

´

c3 4

pHD1qq`p

dµpyq

`

ÿ pP pQqp
QPReg

`

QReg pQqp q

µpQq.

By (7.26) and Lemma 7.13, we have ÿ pPpQqp ` QRegpQqpq µpQq " Pp pRegq ` Qp pRegq À °´1{4 ppHD1q.
QPReg

76

D. DBROWSKI AND X. TOLSA

Taking into account that any cube from RegzRegOt is contained in some cube S P End,

we derive (7.32)

I0

À

ÿ  p|RTReg µpyq| ´

SPEnd S
ÿ `



p|RTReg µpy

QPRegOt Q

c3 4

pHD1

qq`p

dµpyq

q|

´

c3 4

pHD1qq`p

dµpyq

`

°´1{4

ppHD1q

": IEnd ` IOt ` °´1{4 ppHD1q.

Estimate of IEnd. Recall that End " LD1 Y LD2 Y HD2 Y MNeg.

We split (7.33)

IEnd

"

ÿ
SPEnd
`


S

p|RTReg ÿ

µpy 

q|

´

c3 4

pHD1

p|RTReg µpyq|

QPRegNegzRegMNeg Q

qq`p ´ c3
4

dµpyq pHD1

qq`

p

dµpyq.

We claim that the second sum on the right hand side vanishes. Indeed, by (3.5), given
Q P RegNegzRegMNeg, all the cubes S such that Q  S  R satisfy pSq À ^ pSq 1{2 pRq, pRq

and so, for any x P Q,

|RTReg µpxq| À

ÿ

pSq À

ÿ

^ pSq 1{2 pRq

pRq

À

pRq.

S:QSR

S:QSR

Hence,

for

°

big

enough,

p|RTReg µpxq| ´

c3 4

pHD1qq`

"

0,

which

proves

our

claim.

To estimate the first sum on right hand side of (7.33) notice that, for each S P End, by

the

triangle inequality and  p|RTReg µ| ´
S

the fact that p ¨ q`

c3 4

pHD1qq`p

dµ

À

is a 1-Lipschitz function, we

 p|RTr µ|

S `

RTr µ

´ ´

c3 4

pHD1qq`

RTReg µp dµ

p

have dµ

S

By

Lemma

7.3,

the

last

integral

does

not

exceed

C

E

p2S

q

p 2

µpS

q1´

p 2

,

and

thus

we

deduce

that (7.34)

IEnd

À

ÿ
SPEnd S

p|RTr µ|

´

c3 4

pHD1

qq`

p

dµ

`

ÿ

E

p2S

q

p 2

SPEnd

µpS

q1´

p 2

.

Next we apply Lemma 7.2, which ensures that for any S P End and all x P S,

(7.35)

|RTr

µpxq|



|Tr

Rµpxq|

`

C

^

E p4Rq µpRq

1{2

`

C

^

E p2S q µpSq

1{2

`

C

P pRq

`

C P pS q.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

77

Note that since R and S are P-doubling, PpRq is bounded from above by the second term,

and PpSq is bounded by the third term.

In case that R R HE,

(7.36)

C

^ Ep4Rq 1{2 µpRq



C

M0

pRq



c3 20

pHD1q,

When R P HE, since T is -nice, for  small enough we have

(7.37)

E p4Rq µpRq



1 µpRq

ÿ
QPHE:Q,,T

E p4Qq



 µpRq

pHD1q





pHD1q2

!

´

c3 20

¯2 pHD1q

.

So in any case we deduce

p|RTr

µpxq|

´

c3 4

pHD1qq`



|Tr Rµpxq|

`

C

^ Ep2Sq 1{2 µpSq

.

Plugging this estimate into (7.34) and applying Hölder's inequality, we get

(7.38)

IEnd À

ÿ



|Tr Rµ|p dµ `

ÿ

p
Ep2Sq 2

µpS

q1´

p 2



SPEnd S
}Tr Rµ}pL2pµq

µpRq1´

p 2

SPEnÿd `

p
Ep2Sq 2

µpS

q1´

p 2

.

SPEnd

Regarding the second term in (7.38), by Hölder's inequality again,

ÿ

p
Ep2Sq 2

µpS

q1´

p 2

"

ÿ

p
Ep2Sq 2

µpS

q1´

p 2

`

ÿ

p
Ep2Sq 2

µpS

q1´

p 2

SPEnd

S PLD1 YLD2 YMNeg

^

ÿ



SPHD2

p ^ 2

ÿ

1´

p 2

E p2S q

µpSq

S PLD1 YLD2 YMNeg

SPEnd

^ÿ

p ^ 2

ÿ

1´

p 2

`

E p2S q

µpSq .

SPHD2

SPHD2

We estimate the first summand on the right hand side using (7.10), (7.18), (7.15), and the

choice of the constants °, M0, B, and  in Remark 7.12:

^

ÿ

p ^ 2

ÿ

1´

p 2

E p2S q

µpSq

S PLD1 YLD2 YMNeg

SPEnd
^ÿ 

Ep2Sq `

ÿ

p

E p2S q

2

µpRq1´

p 2

S PLD1 YLD2

S PMNeg

À

` B

M02

6°

0

`

B

M02

´° 4

`

p 2

p
pHD1q 2

` B

2°

µpH

D1q1´

p 2

À

` B

M02

2°

0

`

B

M02

´° 4

`

p 2

` B

2°

1´

p 2

ppHD1q

À

` B

M02

1
2° 02

`

BM02´° 1

`

B

2°



1 2

 ppHD1q



´1
°2

ppHD1q.

78

D. DBROWSKI AND X. TOLSA

On the other hand, by (7.11) and using that µpHD2q  B ´° 2µpHD1q (by the definition of the tractable trees), we get

^

ÿ

p ^ 2
E p2S q

ÿ

1´

p 2

µpSq

À

` B

M02

p ` 2

p
pHD1q 2

µpH

D2q1´

p 2

SPHD2

SPHD2



` B

M02

`

p 2

pB

´° 2

q1´

p 2

ppHD1q

À

`BM0pp°´2

`



1 2



ppHD1q.

´1
Assuming p  3{2, the right hand side is at most °4 ppHD1q, From the last estimates and (7.38), we infer that

IEnd

À

}Tr Rµ}pL2pµq

µpRq1´

p 2

`

´1
°4

ppHD1q.

Estimate of IOt. By Remark (7.10), every Q P RegOt satisfies pQq « 0. On the other hand, by Lemma 4.5, the cubes P P Negpe1pRqq, satisfy pP q Á 02 pRq. Thus, assuming 0 ! 02, we have Q R Negpe1pRqq.
To estimate IOt, denote by MOt the family of maximal P-doubling cubes which are

contained

in

some

cube

from

RegOt

and

let 



NOt "

Qz

P.

QPRegOt P PMOt

We claim that

(7.39)

MOt  T and NOt  Z.

To check this, for a given P P MOt with P  Q P RegOt, suppose there exists S P End
such that S  P . We have S  Q because Q P RegOt implies that Q  S. Since Q P RegOtzNegpe1pRqq, we have S R Neg. As S is P-doubling, we deduce that P  S, by the maximality of P as P-doubling cube contained in Q. An analogous argument shows

that NOt  Z.

By Hölder's inequality and (7.24), for 0 small enough we have

IOt



^

ÿ
QPRegOt


Q

p|RTReg µpxq|

´

c3 4

pHD1qq`2

p 2
dµpxq

^

ÿ
QPRegOt

1´

p 2

µpQq

^ 

ÿ



RTReg µ2 dµ ` 

RTReg

µ2

 dµ

p 2

^ µpZ

q

`

op0

1´ q

p 2

,

P PMOt P

NOt

with op0q Ñ 0 as 0 Ñ 0.

Denote

ÿ

RMOt µpxq "

P pxq Rp2Rz2P µqpxq

P PMOt

and

ÿ

`



`



MOtRµpxq "

P pxq mµ,P pRµq ´ mµ,2RpRµq ` Z pxq Rµpxq ´ mµ,2RpRµq .

P PMOt

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

79

Notice that, for x P P P MOt and Q P RegOtzNegpe1pRqq such that Q  P , since there are no P-doubling cubes P 1 such that P  P 1  Q,

RMOtµpxq ´ RTReg µpxq " |Rp2Qz2P µqpxq| À

ÿ

pP

1q

(3.5)
À

P pQq

(7.16)
À

°

pHD1q.

P :P P 1Q

Almost the same argumenRtpsh2oRwµsqpaxlsqo´thRaTtR,egfoµrpxxqPÀNOt°,pHD1q.

Then, for 0 small enough, we deduce that

^ IOt À

ÿ



RMOtµ2 dµ ` 

Rp2Rµq2

dµ

`

2°

pHD1q2

 µpRq

p 2

` Z

µpRq1´

p 2

.

P PMOt P

Z

Almost the same arguments as in Lemma 7.2 show that for x P P P MOt,

RMOt µpxq

´

MOt Rµpxq

À

P pRq

`

^ E p4Rq µpRq

1{2

`

P pP

q

`

^ Ep2P q µpP q

1{2

and that, for x P Z,

Rp2Rµqpxq

´

MOt Rµpxq

À

P pRq

`

^ E p4Rq µpRq

1{2

.

Therefore, by (7.36) and (7.37) and the fact that PpP q À ° pHD1q for P P MOt, we

deduce

^

IOt À

|MOtRµ|2 dµ `

ÿ

E p2P

q

`

2°

pHD1q2

 µpRq

p 2

` Z

µpRq1´

p 2

.

P PMOt

By

the

orthogonality

of

the 

functions

QRµ,

Q

P

Dµ

and

(7.39),

it

is

clear

that

|MOt Rµ|2 dµ  }Tr Rµ}2L2pµq.

On the other hand, since the tree T

ÿ

ÿ

is

-nice and ÿ

MOt



T

,

Ep2P q 

Ep2P q `

Ep2P q  M02 pMOtq `  pHD1q

P PMOt

P PMOtzHE

P PT XHE

 M022° pHD1q2 µpRq `  pHD1q À M022° pHD1q2 µpRq.

Thus, using also (7.15),

IOt

À

}Tr Rµ}pL2pµq

µpRq1´

p 2

`

1Z´

p 2

M0p

p°

pHD1qp

µpRq

À

}Tr Rµ}pL2pµq

µpRq1´

p 2

`

1Z´

p 2

M0p

B

2°`p

ppHD1q

À

}Tr Rµ}pL2pµq

µpRq1´

p 2

`

1
Z2

M02

B

4°

ppHD1q.

1
Remark that, by the choice of Z in Remark 7.12, we have Z2 M02 B 4°  ´° 1.

From (7.31), (7.32), and the estimates for IEnd and IOt, with p " 3{2, we derive

°´3n 3{2pHD1q À I0 À }Tr Rµ}3L{22pµqµpRq1{4 ` °´1{4 3{2pHD1q.

80

D. DBROWSKI AND X. TOLSA

Thus, taking

we get

n

"

1, 15

°´1{53{2pHD1q À }Tr Rµ}3L{22pµqµpRq1{4.

Hence,

}Tr Rµ}2L2pµq

Á

´ °´1{53{2pHD1q

µpRq´1{4¯4{3

(7.15)
Á

´ °´1{53{2pHD1q

`B2°

µpH D1 q´1{4 ¯4{3

Á

´° 2

pHD1q,

which proves the lemma.

8. The proof of Main Lemma 3.5

We have to show that

pTopq  C `}Rµ}2L2pµq ` 02 }µ} `

ÿ

 Ep4Qq .

QPDµP XHE

Recall that by Lemma 5.2, we have

ÿÿ

ÿ

pTopq À B5{4

B´k{2

pHD1pepQqqq ` 02 }µ}.

RPL k0

QPTrck pRq

By Lemma 7.14 we know that, for each cube Q in the last sum, one of the following alternatives holds:
, T pe1pQqq is not -nice, so that ÿ Ep4P q   pHD1pepQqqq,
P PHE:P ,,T pe1pQqq
or

, µpZpQqq  Z µpQq, where ZpQq is the set Z appearing in (7.1) (replacing R by Q there), which implies that

pHD1pepQqqq  02 µpepQqq À ´Z1 02 µpZpQqq,

or

, }Trpe1pQqqRµ}2L2pµq  ´° 2 pHD1pepQqqq.

So the following holds in any case:

ÿ

pHD1pepQqqq À 2° }Trpe1pQqqRµ}2L2pµq ` ´1

Ep4P q ` ´Z1 02 µpZpQqq.

P PHE:P ,,T pe1pQqq

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

81

Consequently,

(8.1)

ÿÿ

ÿ

pTopq À B5{4 2°

B´k{2

}Tr pe1pQqqRµ}2L2pµq

RPL k0
ÿÿ

QPTrck pÿRq

` B5{4 ´1

B´k{2

ÿ Ep4P q

RPL ÿk0 ÿ

QPTrckpÿRq P PHE:P ,,T pe1pQqq

` B5{4 ´Z1 02

B´k{2

µpZ pQqq

RPL k0

QPTrck pRq

": T1 ` T2 ` T3.

A basic tool to estimate the terms T1, T2, T3 is Lemma 5.3, which asserts that for all P P Dµ and all k  0,
# R P L : D Q P TrckpRq such that P P T pe1pQqq(  C1 log °.

8.1. Estimate of T1. Recall that ÿ Trpe1pQqqRµpxq "

`



P pxq mµ,P pRµq ´ mµ,2QpRµq

P PEndpe1pQqq`



` ZpQqpxq Rµpxq ´ mµ,2RpRµq .

For Q P MDW, we write S  Q if S P Dµ is a maximal cube that belongs to T pe1pQqq.

Then we denote

p QRµ "

ÿ



pmµ,S pRµq ´ mµ,2QpRµq S

SQ

and

ErpQq "  P,

GrpQq " ErpQq Y ZpQq.

P PEndpe1pQqq

Notice that it may happen that GrpQq  e1pQq because of the presence of negligible cubes.

Then we have

ÿ

`



P mµ,P pRµq ´ mµ,2QpRµq "

ÿ

^

P

ÿ

 SRµ ` p QRµ

P PEndpe1pQqq

P PEndpe1pQÿqq

SPTr pe1pQqq:P S
ÿ

"

S Rµ

P

SPTr pe1pQqqzEndpe1pQqq

P PEndpe1pQqq:P S

` ErpQ^qp QRµ ÿ " ErpQq

 SRµ ` p QRµ .

SPTr pe1pQqqzEndpe1pQqq

A similar argument shows that

`



^

ZpQqpxq Rµpxq ´ mµ,2QpRµq " ZpQq

ÿ

 SRµ ` p QRµ .

SPTr pe1pQqq

82

D. DBROWSKI AND X. TOLSA

Hence,

^

ÿ



Trpe1pQqqRµ " GrpQq

P Rµ ` p QRµ .

P PTr pe1pQqqzEndpe1pQqq

It is also immediate to check that, for a fixed Q and P P Trpe1pQqqzEndpe1pQqq, the functions

p QRµ and P Rµ are mutually orthogonal in L2pµq. Then, since all the cubes P P

Trpe1pQqq satisfy P ,, T pe1pQqq, we get ÿ
}Trpe1pQqqRµ}2L2pµq 

}P Rµ}2L2pµq ` }p QRµ}2L2pµq



P PTrÿ pe1pQqqzEndpe1pQqq }P Rµ}2L2pµq

`

}p QRµ}2L2pµq.

P ,,T pe1pQqq

Therefore,

ÿÿ

ÿ

T1 À°

B´k{2

ÿ }P Rµ}2L2pµq

`

ÿ RPL

ÿ k0 B´k{2

QPTÿrck

pRq P ,,T pe1pQqq
}p QRµ}2L2

pµq

RPL k0

QPTrck pRq

": T1,1 ` T1,2.

Regarding

the

term

T1,1,

by

Fubini ÿ

we

have

ÿ

T1,1 

}P Rµ}2L2pµq B´k{2 #ApP, kq,

P PDµ

k0

where (8.2)

ApP, kq " R P L : D Q P TrckpRq such that P ,, T pe1pQqq(.

From the definition (7.8) and Lemma 5.3, it follows that

#ApP, kq 

ÿ

#

R P L : D Q P TrckpRq

such

that

P1

P

T

pe1

( pQqq

P 1PDµ:20P 1X20P 

A´0 2pP

qpP 1
ÿ

qA20

pP

q

À

log ° À log °.

P 1PDµ:20P 1X20P  A´0 2pP qpP 1qA20pP q

Hence,

ÿ

T1,1 À°

}P Rµ}2L2pµq " }Rµ}2L2pµq.

P PDµ

Concerning

T1,2,

we

argue analogously: T1,2  ÿ }p QRµ}2L2pµq

ÿ

B´k{2

#ArpQ, kq,

QPMDW

k0

where Since

ArpQ, kq "

( R P L : Q P TrckpRq .

#ArpQ, kq  #ApQ, kq À log °,

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

83

we deduce that

T1,2 À° ÿ }p QRµ}2L2pµq.
QPMDW

As the next lemma shows, the right hand side above is also bounded by C}Rµ}2L2pµq. So we have
T1 À° }Rµ}2L2pµq.

Lemma 8.1. For any f P L2pµq, we have ÿ }p Qf }2L2pµq À }f }2L2pµq.
QPMDW
We defer the proof of this result to Section 8.4.

8.2. Estimate of T2. By the same argument we used to deal with T1,1 above, we get

ÿ

ÿ

T2 

Ep4P q B´k{2 #ApP, kq,

P PHE

k0

where ApP, Kq is given by (8.2). Since #ApP, kq À log °, we obtain ÿ

T2 À°

Ep4P q.

P PHE

8.3.

Estimate

of

T3.

We have ÿÿ

ÿ

T3 "

B´k{2

02 ´Z1 µpZpQqq

RPL k0
ÿÿ

QPTrck
ÿ

pRq

"

B´k{2

02 ´Z1 dµ

RPL


k0

^

QPTrck pRq
ÿÿ

Z pQq
ÿ



" 02 ´Z1

B´k{2

ZpQq dµ.

RPL k0

QPTrck pRq

By Fubini, we have

ÿÿ

ÿ

ÿ

B´k{2

ZpQq  B´k{2 #Dpx, kq,

RPL k0

QPTrck pRq

k0

where

( Dpx, kq " R P L : D Q P TrckpRq such that x P ZpQq .

Observe now that, given j  1, if we let

Djpx, kq " R P L : D Q PTrckpRq such that T pe1pQqq contains

every

P

P

Dµ

such

that

x

P

P

and

pP q



A´0 j

( ,

then we have

 Dpx, kq " Djpx, kq,
j1

84

D. DBROWSKI AND X. TOLSA

and moreover Djpx, kq  Dj`1px, kq for all j. From Lemma 5.3 we deduce that

#Djpx, kq  C log ° for all j  1.

Thus,

#Dpx, kq



C

log °

too. Consequently,

ÿÿ

ÿ

B´k{2

ZpQq À° 1,

RPL k0

QPTrck pRq

and so

T3 À° ´Z102 }µ}.

Together with the estimate we obtained for T1ÿand T2, this yields

pTopq À° }Rµ}2L2pµq `

Ep4P q ` ´Z102 }µ},

P PHE

which concludes the proof of Main Lemma 3.5, modulo the proof of Lemma 8.1.

8.4. Proof of Lemma 8.1. For Q P MDW, denote by ApQq the family of cubes R P Dµ
such that R X 2Q   and pRq " A0 pQq. Also, let FpQq be the family of cubes P which
are contained in some cube from ApQq and satisfy pQq  pP q  A0 pQq. Notice that, by Lemma 3.1, the cubes from ApQq belong to Dµdb. So taking into account that Q  2BR for any R P ApQq, that R  CQ, and that Q is P doubling,

(8.3)

µpQq « µpRq for all R P ApQq.

Denote

q Qf "

ÿ

`



mµ,Rpf q ´ mµ,2Qpf q R.

RPApQq

It is immediate to check that }p Qf }L2pµq À

ÿ

}P f }L2pµq ` }q Qf }L2pµq.

P PF pQq

Remark that the main advantage of the operator q Q over p Q is that the cubes R P ApQq

involved in the definition of q Q are doubling, which may not be the case for the cubes

S



Q

in

the definition ÿ

of

p Q.

From ÿ

the

last ÿ

inequality,

we

get ÿ

}p Qf }2L2pµq À

}P f }2L2pµq `

}q Qf }2L2pµq

QPMDW

QPMDW P PF pQq

QPMDW

Since

ÿÿ

ÿ

ÿ

}P f }2L2pµq 

}P f }2L2pµq

1

QPMDW P PF pQq

PÿPDµ

QPMDW:P PF pQq

À

}P f }2L2pµq À }f }2L2pµq,

P PDµ

the lemma follows from the next result.

Lemma 8.2. For any f P L2pµq, we have ÿ }q Qf }2L2pµq À }f }2L2pµq.
QPDµP

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

85

Proof. For Q P DµP and P P Dµ such that P P ApQq, let

^



Q,P "

1 µpP q

P

´

1 µp2Qq

2Q

µpP q1{2.

Observe that

}q Qf }2L2pµq "

ÿ

mµ,P pf q ´ mµ,2Qpf q2 µpP q "

ÿ xf, Q,P y2.

P PApQq

P PApQq

So we have to show that

ÿÿ xf, Q,P y2 À }f }2L2pµq.
QPDµP P PApQq

To shorten notation, we denote by I the set of allpairs pQ, P q with Q P DµP and P P ApQq, so that the double sum above can be written as pQ,P qPI.
Arguing by duality, we have

^

ÿ

xf,

1{2 Q,P y2

"

sup 

ÿ xf, Q,P y bQ,P  " sup Bf,

ÿ

bQ,P Q,P F ,

pQ,P qPI

pQ,P qPI

pQ,P qPI

where the supremum is taken over all the sequences b :" tbQ,P upQ,P qPI such that }b}2  1.

Since

^

ÿ

1{2 xf, Q,P y2



>>f

>>
L2

pµq

sup >>>>

ÿ

bQ,P Q,P >>>>

,

pQ,P qPI

pQ,P qPI

L2 pµq

to prove the lemma it suffices to show that

>>>> ÿ bQ,P Q,P >>>>

À 1 for all b " tbQ,P upQ,P qPI such that }b}2  1.

pQ,P qPI

L2 pµq

To this end, we write

(8.4)

>>>> ÿ bQ,P Q,P >>>>2

"

ÿ@

D

bQ,P Q,P , bR,S R,S

pQ,P qPI

L2pµq

pQ,P q,ÿ pR,Sq

2

|bQ,P bR,S| @Q,P , R,S D.

pQ,P q,pR,Sq pQqpRq

Denote



apQq "

P.

P PApQq

Observe that, for some C depending just on A0,

supp Q,P  apQq  CQ, supp R,S  apRq  CR,

and

>>Q,P

>>
L8

pµq

À

1 µpQq1{2 ,

>>R,S

>>
L8

pµq

À

1 µpRq1{2 ,

86

D. DBROWSKI AND X. TOLSA

taking into account (8.3). Thus, for pQ, P q, pR, Sq P I with pQq  pRq, we have

@Q,P ,

R,S D

"

apQq Q,P

R,S

dµ

À

µpapQqq µpQq1{2 µpRq1{2

«

^ µpQq 1{2 µpRq .

Further, using that Q,P@has zero meDan and that R,S is constant in 2R X S, in 2RzS, and in Sz2R, it follows that Q,P , R,S " 0 in the following cases:
(i) if apQq X p2R Y Sq " , (ii) if apQq  2R X S, (iii) if apQq  2RzS, (iv) if apQq  Sz2R.
For d  0, denote

NdpSq " tx P supp µzS : distpx, Sq  du Y tx P S : distpx, supp µzSq  du

and, analogously,

Ndp2Rq " tx P supp µz2R : distpx, 2Rq  du Y tx P 2R : distpx, supp µz2Rq  du.

Observe that if none of the conditions (i), (ii), (iii), (iv), holds, then

(8.5)

apQq  NdiampapQqqpSq Y NdiampapQqqp2Rq.

From the thin boundary condition (2.4) and the fact that 2R is a finite number of cubes

of the same generation as R, using also that R is P-doubling and S is doubling, we deduce

that

(8.6)

`



µ NdpSq

`

`



µ Ndp2Rq

À

^ d 1{2 pRq

µpRq

for all d P p0, CpRq),

with the implicit constant depending on C. Consequently, denoting by "pQ, P q % pR, Sq"

the situation when pQq  pRq and (8.5) holds, by (8.4) we get

>>>>

ÿ
pQ,P qPI

bQ,P

Q,P >>>>2
L2 pµq



2

ÿ
pQ,P q%pR,Sq

|bQ,P

bR,S |

^ µpQq 1{2 µpRq

^ÿ

1{2 ~ ÿ ~

2

|bR,S |2

ÿ

|bQ,P

|

^

µpQq µpRq

1{2¸2¸1{2

pR,SqPI

pR,SqPI

pQ,P qPI:

pQ,P q%pR,Sq

~

~

ÿ

À

pR,SqPI

ÿ

|bQ,P

|2

^

pQq pRq

1{4¸

~

pQ,P qPI:

ÿ
pQ,P qPI:

^

pRq pQq

1{4

µpQq µpRq

¸¸1{2 .

pQ,P q%pR,Sq

pQ,P q%pR,Sq

We consider now the last sum on the right hand side, which equals

ÿ
pQ,P qPI:

^ pRq 1{4 µpQq pQq µpRq

"

ÿ
k0

ÿ

Ak0{4

µpQq µpRq

pQ,P qPI:

pQ,P q%pR,Sq

pQ,P q%pR,Sq

pQq"A´0 kpRq

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

87

Notice that, by (8.5) and (8.6), we have

ÿ
pQ,P qPI:

µpQq

À

`



µ NCA´0 kpRqpSq

`

`



µ NCA´0 kpRqp2Rq

À

A0´k{2

µpRq.

pQ,P q%pR,Sq

pQq"A´0 kpRq

Therefore,

ÿ
pQ,P qPI:

^ pRq 1{4 µpQq pQq µpRq

À ÿ Ak0{4
k0

A0´k{2 µpRq µpRq

À 1.

pQ,P q%pR,Sq

We deduce that

>>>> ÿ bQ,P Q,P >>>>2

~

~

ÿ

À

pQ,P qPI

L2 pµq

pR,SqPI

ÿ

|bQ,P

|2

^

pQq pRq

1{4¸¸1{2

pQ,P qPI:

pQ,P q%pR,Sq

~

ÿ

"

|bQ,P |2

pQ,P qPI

ÿ ^ pQq 1{4¸1{2

pRq

.

pR,S qPI :

pQ,P q%pR,Sq

Since we infer that as wished.

ÿ

^ pQq 1{4 pRq

À

pR,S qPI :

ÿ
RPDµ :

^ pQq 1{4 pRq

À

1,

pQ,P q%pR,Sq

pRqpQq

apQqXapRq

>>>> ÿ bQ,P Q,P >>>>2

À 1,

pQ,P qPI

L2 pµq

9. The proof of the Main Theorem 3.4

Recall that, for a cube R P Top, TreepRq denotes the subfamily of the cubes from DµpRq which are not strictly contained in any cube from EndpRq. In this section we will prove the following result.

Lemma 9.1. For each R P Top, the following holds:

ÿ

ÿ

µ,2p2BQq2 pQq µpQq À,0

}QRµ}2L2pµq

QPTreepRq

QPTrÿ eepRq

`

Ep4Qq ` pRq2 µpRq.

QPTreepRqXHE

It is clear that together with Main Lemma 3.5, this yields Main Theorem 3.4.

88

D. DBROWSKI AND X. TOLSA

9.1. The approximating measure  on a subtree Tz ree0pRq. To prove Lemma 9.1 for a given cube R0 P Top (in place of R), we will consider a corona decomposition of TreepR0q into subtrees by introducing appropriate new stopping conditions. In this section we will
deal with the construction of each subtree and an associated AD-regular measure which
approximates µ in that subtree. To this end we need some additional notation. First, for a cube R P TreepR0q X DµP , we write Q P BRpRq (which stands for "big Riesz
transform") if Q is a P-doubling maximal cube which does not belong to HDpR0q Y LDpR0q and satisfies

|Rµ2Rz2QpxQq|  K pRq,

where K is some big constant to be fixed below, depending on , 0, and M0. Also, for a cube Q P TreepR0q, we denote by CxhpQq the family of maximal cubes P P DµpQqztQu that satisfy one of the following conditions:
, P P DµP, i.e. P is P-doubling, or , P P LDpR0q.
From Lemma 3.3, it is immediate to check that if Q is not contained in any cube from LDpR0q, then the cubes from CxhpQq cover Q, and also

(9.1)

pP q «,0 pQq for each P P CxhpP q,

Given R P DµP P TreepR0qzEndpR0q, we will construct a tree Tz ree0pRq inductively, consisting just of P-doubling cubes and stopping cubes from LDpR0q. At the same time
we will construct an approximating AD-regular measure for this tree. We will do this by "spreading" the measure of the cubes from Tz ree0pRq X LDpR0q among the other cubes from Tz ree0pRq. To this end, we will consider some coefficients spQq, Q P DµP X Tz ree0pRq, that, in a sense, quantify the additional measure µ spreaded on Q due to the presence of close
cubes from LDpR0q. The algorithm is the following. First we choose R as the root of Tz ree0pRq, and we set spRq " 0. Next, suppose that
Q P Tz ree0pRq (in particular, this implies that Q P TreepR0q), and assume that we have not decided yet if the cubes from CxhpQq belong to Tz ree0pRq. First we decide that Q P Sz toppRq
if one of the following conditions hold:

(i) Q P HDpR0q Y LDpR0q Y BRpRq, or

(ii) spQq  µpQq and (i) does not hold, or

(iii)

 P PCxhpQqXLDpR0q µpP q 

1 2

µpQq

and

neither

(i)

nor

(ii)

hold.

If Q P Sz toppRq, no descendants of Q are allowed to belong to Tz ree0pRq. Otherwise, all the cubes from CxhpQq are chosen to belong to Tz ree0pRq, and for each P P CxhpQq, we define

spP q " ´µpP q if P P LDpR0q,

and, otherwise, we set

(9.2)

tpQq "

ÿ

µpSq

and

spP

q

"

` spQq

`

 tpQq

µpP µpQq ´

q tpQq

.

S PCxhpQqXLDpR0 q

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

89

Observe that

ÿ

ÿ

ÿ

spP q "

spP q `

spP q

P PCxhpQq

P PCxhpQqXL`DpR0q

P PCxhpQqzLDpR0q

" ´tpQq ` spQq ` tpQq " spQq.

By induction, the coefficients sp¨q satisfy the following. If Q P Tz ree0pRq and I is some

finite family of cubes from Tz ree0pRq XÿDµpQq which cover Q and are disjoint, then

(9.3)

spP q " spQq.

P PI

Further, spQq  0 for all Q P Tz ree0pRqzLDpR0q.

Now we are ready to define an approximating measure  associated with Tz ree0pRq. First,

we denote

GppRq " R z  Q,

QPSz toppRq

and for each Q P Dµ we let DQ be an n-dimensional disk passing through xQ with radius

1 2

rpQq

(recall

that

rpQq

is

the

radius

of

BpQq).

In

case

that

µpGppRqq

"

0,

we

define



"

ÿ
QPSz toppRq

` spQq

`

 µpQq

HntDQ HnpDQq

.

Observe that pDQq " µpQq ` spQq for all Q P Sz toppRq and, in particular pDQq " 0 if Q P Sz toppRq X LDpR0q.
In case that µpGppRqq  0, we have to be a little more careful. For a given N  1 we let Sz topN pRq be the family consisting of all the cubes from Sz toppRq with side length larger that A´0 N pRq, and we let IN be the family of the cubes from Tz ree0pRq which have side length smaller than A´0 N pRq and are maximal. We denote

(9.4)

N

"

ÿ`



spQq ` µpQq

QPSz topN pRq

HntDQ HnpDQq

ÿ`

`

spQq

QPIN pRq

 ` µpQq

µtQ µpQq

,

and we let  be a weak limit of N as N Ñ 8.

As in Section 6.2, we use the following notation. To each Q P Tz ree0pRq we associate

another "cube" Qpq defined as follows:



Qpq " pGpRq X Qq Y

DP .

P PSz toppRq:P Q

We let

Tz ree0pqpRq " Tz ree0pqpRpqq :" tQpq : Q P Tz ree0pRqu.

For S " Qpq P Tz ree0pqpRq with Q P Tz ree0pRq, we denote Q " Spµq and we write pSq :" pQq.

Observe now that, from (9.3) and the definition of , we have the key property

(9.5)

pQpqq " µpQq ` spQq for all Q P Tz ree0pRq.

90

D. DBROWSKI AND X. TOLSA

So spQq is the measure added to µpQq to obtain pQpqq.

Lemma 9.2. The measure pR0q´1 is AD-regular (with a constant depending on  and 0), and pQpqq " 0 for all Q P LDpR0q X Tz ree0pRq.

Proof. The fact that pQpqq " 0 for all Q P LDpR0q X Tz ree0pRq follows by construction and has already been mentioned above. To prove the AD-regularity of , by standard arguments, it is enough to show that

pQpqq «,0 pR0q pQqn for all Q P Tz ree0pRqzLDpR0q,

taking into account (9.1). Given such a cube Q, the fact that Q R LDpR0q ensures that

pQpqq  µpQq Á 0 pR0q pQqn.

To show the converse estimate we can assume Q  R. By the condition (ii) in the definition
of Sz toppQpq, where Qp is the first ancestor of Q in Tz ree0pRq (i.e., Qp is the smallest cube from Tz ree0pRq that strictly contains Q), we have

spQpq  µpQpq.

Also, by (iii) (which does not hold for Qp), the coefficient tpQpq in (9.2) satisfies

tpQpq "

ÿ

µpP q  1 µpQpq.

2

P PCxhpQpqXLDpR0q

Therefore,

(9.6)

spQq

"

`spQpq

`

tpQpq

µpQq µpQpq ´ tpQpq



2`µpQpq

`

1 2

µpQpq

µpQq µpQpq

"

3 µpQq,

and so

pQpqq " spQq ` µpQq  4 µpQq  4 µpQpq À  pR0q pQpqn «,0 pR0q pQqn,

taking into account that Qp R HDpR0q, by (i).

Remark 9.3. For the record, notice that from (9.6) it follows that, for all Q P Tz ree0pRq, either

(9.7)

0  spQq  3 µpQq,

or spQq " ´µpQq.
The latter case happens if and only if Q P LDpR0q.

Remark 9.4. Consider the measure defined by

1

"

ÿ
QPSz toppRqzLDpR0q

µpQq

HntDQ HnpDQq

`

µtGppRq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

91

This measure is mutually absolutely continuous with . Further, since the coefficients spQq, with Q P Tz ree0pRq, are uniformly bounded (by the previous remark), it turns out that
1 "  ,
for some function  P L8pq satisfying  « 1. Consequently, by Lemma 9.2, 1 is also
AD-regular.

For a family of cubes I  TreepR0q, we denote CxhpIq "  CxhpQq.
QPI

For Q P Tz ree0pRq, we write Q P piqR, if Q P Sz toppRq and the condition (i) in the definition of Sz toppRq holds for Q, and analogously regarding the notations Q P piiqR and Q P piiiqR.

Lemma 9.5. The following holds:

ÿ

µpQq `

ÿ

µpQq ` µpGppRqq « µpRq.

QPSz toppRqXpLDpR0 qYHDpR0 qYBRpRqq

QPCxhppiiiqR qXLDpR0 q

Proof. It is clear that the left hand side above is bounded by µpRq. For the converse

estimate, we write

(9.8) µpRq "

ÿ

µpQq ` µpGppRqq "

ÿ µpQq `

ÿ

µpQq `

ÿ

µpQq ` µpGppRqq.

QPSz toppRq

QPpiqR

QPpiiqR

QPpiiiqR

By construction, (9.9)

ÿ

ÿ

µpQq "

µpQq.

QPpiqR

QPSz toppRqXpHDpR0 qYLDpR0 qYBRpRqq

Also, if Q P piiiqR, then

ÿ

µpQq  2

µpP q,

P PCxhpQqXLDpR0q

and thus (9.10)

ÿ

ÿ

µpQq  2

µpP q.

QPpiiiqR

P PCxhpSz toppRqqXLDpR0q

On the other hand, if Q P piiqR, then 0  µpQq  spQq, and so

ÿ

ÿ

ÿ

µpQq 

spQq "

spQq.

QPpiiqR

QPSz toppQq:spQq0

QPSz toppRqzLDpR0 q

For a given N  1, consider the families Sz topN pRq and IN defined just above (9.4). Notice

that JN :" Sz topN pRq Y IN is a finite family of cubes which cover R, and thus, from the

property (9.3), it follows that

ÿ

ÿ

ÿ

0 " spRq "

spQq "

spQq `

spQq.

QPJN

QPJN XLDpR0q

QPJN zLDpR0q

92

D. DBROWSKI AND X. TOLSA

Since

spQq

"

´µpQq

for

all

Q

ÿ P JN

X

LDpR0q,

we

deduce ÿ

spQq "

µpQq.

QPJN zLDpR0q

QPJN XLDpR0q

Letting

N

Ñ

8

and

taking

into ÿ

account

that

spQq

0 ÿ

for

all

Q

P

JN zLDpR0q,

we

get

spQq 

µpQq,

QPSz toppRqzLDpR0q

QPSz toppRqXLDpR0q

and thus (9.11)

ÿ

ÿ

µpQq 

µpQq.

QPpiiqR

QPSz toppRqXLDpR0q

The lemma follows from the splitting (9.8) and the inequalities (9.9), (9.10), (9.11).

Lemma 9.6. The operator R is bounded in L2pq, with

}R}L2pqÑL2pq À,0,K pRq.

Proof. To prove this lemma we will use the suppressed kernel K introduced in Section

6.1, with the following 1-Lipchitz function:

`



pxq " inf pQq ` distpx, Qq .

QPTz ree0pRq

We will prove first that R,µt2R is bounded in L2pµt2Rq by applying Theorem 6.1, and later on we will show that R is bounded in L2pq by approximation.
In order to apply Theorem 6.1, we will show that

(a) (b)

µpBpx, rq suprpxq

XR2rRpq2RµCqpxqpRq

rn for all C pRq,

r

 pxq,

and

with C possibly depending on , 0, and K. Once these conditions are proven, then Theorem 6.1 applied to the measure pRq´1 µt2R ensures that

(9.12)

}R,µt2R }L2pµt2RqÑL2pµt2Rq À,0,K pRq.

The proof of (a) is quite similar to the proof of Lemma 6.8. However, we repeat here

the arguments for the reader's convenience. In the case r  pRq{10 we just use that

µpBpx, rq X 2Rq  µp2Rq À pRq pRqn À pRq rn.

So we may assume that pxq  r  pRq{10. By the definition of pxq, there exists Q P Tz ree0pRq such that
pQq ` distpx, Qq  r.

Therefore, BQ  Bpx, 4rq and so there exists an ancestor Q1  Q which belongs to Tz ree0pRq such that Bpx, rq  2BQ1 , with pQ1q « r. Then,

µpBpx, rq X 2Rq  µp2BQ1q À  pR0q pQ1qn «,0 pRq rn,

as wished. Let us turn our attention to the property (b). In the case r  pRq{10 we have

Rr p2R µqpxq



µp2Rq rn

À

pRq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

93

In the case pxq  r  pRq{10 we consider the same cube Q1 P Tz ree0pRq as above, which satisfies Bpx, rq  2BQ1 and pQ1q « r. Further, by replacing Q1 by the first ancestor in Tz ree0pRq if necessary, we may assume that
|Rµ2Rz2Q1 pxQ1 q| À K pRq. Since |x ´ xQ1| À pQ1q, by standard arguments which use the fact that K is a CalderónZygmund kernel (see (6.2) and (6.3)), it follows that
Rµ2Rz2Q1 pxQ1q ´ Rrp2Rµqpxq À PpQ1q À  pR0q «,0 pRq.
Thus, Rrp2Rµqpxq  Rµ2Rz2Q1 pxQ1 q ` Rµ2Rz2Q1 pxQ1 q ´ Rrp2Rµqpxq À,0,K pRq.
So both (a) and (b) hold, and then (9.12) follows.

Next we deal with the L2pq boundedness of R. First notice that RµtGppRq is bounded in L2pµtGppRqq with norm at most CpRq because pxq " 0 on GppRq. Since tGppRq "  µtGppRq for some function  « 1, RtGppRq is also bounded in L2ptGppRqq with norm bounded by CpRq. So it suffices to show that RtGppRqc is bounded in L2ptGppRqc q. This follows from the fact that if  and  are Radon measures with polynomial growth of degree n such

that R is bounded in L2pq and R is bounded in L2pq, then R` is bounded in L2p ` q, and then choosing  " pRq´1µtGppRq and  " pRq´1µtGppRqc . See for example Proposition 3.1 from [NToV2].

It remains to show that RtGppRqc is bounded in L2ptGppRqc q with norm bounded above by C pRq. Notice first that, by (2.4), there exists some constant b  0 depending at most

on C0, A0, n such that

` µ tx

P

Q

:

distpx,

supp

µzQq



b

 pQqu



1 2

µpQq.

We denote

(9.13)

Qp0q " tx P Q : distpx, supp µzQq  b pQqu,

so

that

µpQp0qq



1 2

µpQq.

We have to show that

(9.14)

}Rpg tGppRqc q}L2ptGppRqc q À,0,K pRq }g}L2pq

for any given g P L2ptGppRqc q, with Rpg tGppRqc q understood in the principal value sense.

To this (9.15)

end,

we

take

the

function f"

f PÿL2pµt2Rq
QPSz toppRq DQ

defined as follows:

g d

Qp0q µpQp0q

q

.

We also consider the signed measures

 " f µ,  " g ,

so that pQq " pQp0qq " pDQq for all Q P Sz toppRq.

94

D. DBROWSKI AND X. TOLSA

As a preliminary step to obtain (9.14), we will show first

(9.16)

}R}L2ptGppRqc q À,0,K pRq }g}L2pq.

For that purpose, first we will estimate the term |Rpxq´Rpyq|, with x P Qp0q, y P DQ, for Q P Sz toppRq, in terms of the coefficients

PpQq

:"

ÿ
P PDµ:P Q

pQq pP qn`1

||p2BP

q

and

QpQq

:"

ÿ
P PSz toppRq

pP q DpP, Qqn`1

||pP

q,

and

P pQq

:"

ÿ
P PDµ:P Q

pQq pP qn`1

||p2BP

q

and

QpQq :"

ÿ

pP q DpP, Qqn`1

||pDP

q.

P PSz toppRq

We claim that

(9.17)

|Rpxq ´ Rpyq| À PpQq ` QpQq ` PpQq ` QpQq

for all x P Qp0q, y P DQ, with Q P Sz toppRq. The arguments to prove this are quite similar to the ones in Lemma 7.1, but we will show the details for completeness. By the triangle inequality, for x, y and Q as above, we have
Rpxq ´ Rpyq  `RRpxpqx´QqR´RpxQpqx Qq ` RpxQq ´ Rpyq
": I1 ` I2 ` I3.

First we estimate I1 using the properties of the kernel K in (6.2) and (6.3), and taking into account that for x P Qp0q (and thus for xQ) pxq «b pQq, because of the separation
condition in the definition of Qp0q in (9.13). Then we get



|I1|  |Kpx, zq ´ KpxQ, zq| d||pzq

^

ÿ



"

`

|Kpx, zq ´ KpxQ, zq| d||pzq

2BQ P PDµ:P Q 2BPp z2BP

À

ÿ
P PDµ:P Q

pQq pP qn`1

||p2BPp q

À

PpQq,

where above we denoted by Pp the parent of P . The same estimate holds for the term I3

(with



replaced

by

),

using

that

pxq

«

pQq

for

all

x

P

DQ,

since

DQ



1 2

B

pQq

and

BpQq X supp µ  Q. So

|I3| À PpQq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

95

Finally we deal with the term I2. Since pP p0qq " pDP q for all P P Sz toppRq, we have

I2 

ÿ



KpxQ

` ´ zq d tP p0q

´ tDP pzq

P

PSz toppRq
ÿ



`





|KpxQ ´ zq ´ KpxQ ´ xP q| d ||tP p0q ` ||tDP pzq

P PSz toppRq

From

the

separation

condition

in

(9.13)

and

the

fact

that

DP



1 2

B

pP

q,

we

infer

that,

for

P, Q P Sz toppRq with P  Q and z P P p0q Y DP ,

|xQ ´ z| « |xQ ´ xP | Á pQq ` pP q.

Hence, in the case P  Q,



`



|KpxQ ´ zq ´ KpxQ ´ xP q| d ||tP p0q ` ||tDP pzq

À

pP q DpP, Qqn`1

` ||pP

p0q q

`

||pDP

 q.

The same inequality holds in the case P " Q using (6.2) and the fact that pxQq « pQq. So we deduce that

I2 À QpQq ` QpQq.

Gathering the estimates obtained for I1, I2, I3, the claim (9.17) follows. Now we are ready to show (9.16). By the claim just proven and using that pBQq À µpQq,
we obtain

(9.18)

ÿ

}R}2L2ptGppRqc q "
QPSz toppRq

|R|2 d
BQ

ÿ À

inf |Rpxq|2 µpQq ` ÿ `PpQq2 ` QpQq2 µpQq

QPSz toppRq xPQp0q

QPSz toppRq

`

ÿ

` P

pQq2

`

Q

pQq2

pDQ

q.

QPSz toppRq

Since R,µt2R is bounded in L2pµt2Rq with norm bounded by Cp, 0, Kq pRq, we infer

that

ÿ



inf |Rpxq|2 µpQq 
QPSz toppRq xPQp0q

R |R|2dµ  }Rpf µq}2L2pµt2Rq À,0,K pRq2 }f }2L2pµq.

To estimate the second sum on the right hand side of (9.18) we use the fact that

ÿ

ÿ

QpQq2 µpQq À

PpQq2 µpQq.

QPSz toppRq

QPSz toppRq

This follows by the same argument as in Lemma 7.13, with p " 2. Indeed, in that lemma one does not use any specific property of the measure µ or the family Reg, apart from

96

D. DBROWSKI AND X. TOLSA

the fact the cubes from Reg are pairwise disjoint. So the lemma applies to Sz toppRq too.

Observe also that, for every x P Q, 2BP  Bpx, 2pP qq  CBP , for some C  1, and thus

PpQq



ÿ
P PDµ:P Q

pQq pP qn`1

||pBpx, 2pP qqq µpBpx, 2pP qqq

µpCBP q

À PpQq Mµf pxq À,0 pRq Mf pxq.

Consequently,

ÿ

` P

pQq2

`

QpQq2

µpQq

À

ÿ

PpQq2 µpQq

QPSz toppRq

QPSz toppRq 

À,0 pRq2 |Mµf |2 dµ À,0 pRq2 }f }2L2pµq.

The last sum on the right hand side of (9.18) is estimated similarly. Indeed, by Lemma

7.13 we also have

ÿ

ÿ

QpQq2 pDQq À

PpQq2 pDQq,

QPSz toppRq

QPSz toppRq

and as above,

PpQq À,0 pRq Mgpxq.

Then it follows that ÿ

` P

pQq2

`

Q pQq2

µpQq

À,0

pRq2

}g}2L2 pq .

QPSz toppRq

By (9.18) and the preceding esitmates, to complete the proof of (9.16) it just remains to
notice that, by the definition of f in (9.15) and Cauchy-Schwarz, }f }L2pµq À }g}L2pq. In order to prove (9.14), we denote

RrpQq{4pxq " Rpxq ´ RrpQq{4pxq,

and we split

(9.19)

ÿ

}Rpg

tGppRqc q}2L2ptGppRqc q

"

QPSz ÿtoppRq^

DQ


|R|2

d





À

|RrpQq{4|2 d `

|RrpQq{4 ´ R|2 d

QPSz toppRq DQ

DQ

`

}R



}2
L2ptGppRqc

q.

Using the fact that RtDQ is bounded in L2ptDQq with norm comparable to pBQq{rpQnq

(because DQ is an n-dimensional disk), we deduce that





|RrpQq{4|2 d "

|RrpQq{4pDQ g q|2 d À,0 pRq2 }DQ g}2L2pq.

DQ

DQ

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

97

Regarding the second integral in (9.19), observe that, by (6.4), for all x P DQ with Q P Sz toppRq,

RrpQq{4pxq ´ Rpxq

À

sup
rpxq

||pBpx, rqq rn

À,0

pRq Mµgpxq.

Then, by the last estimates and (9.16), we get

}Rpg tGppRqc q}2L2ptGppRqc q

À,0

pRq2

ÿ
QPSz toppRq DQ

`|g|2

`

|Mg|2 d

`

}R

}2
L2ptGppRqc

q

À,0,K pRq2 }g}2L2pq,

which concludes the proof of the lemma.

Next, for each R P DµP zEndpR0q, we define the family EyndpRq and Tz reepRq, which can be considered as an enlarged version of Tz ree0pRq. First we define
S{ top°pRq " piqR Y piiqR Y CxhppiiiqRq.
Let EyndpRq be the family of maximal P-doubling cubes which are contained in the cubes from Sz top°pRq. Notice that R R EyndpRq. Further, the cubes from Sz toppRq X pHDpR0q Y BRpRq Y piiqRq belong to EyndpRq because they are P-doubling. Then we let Tz reepRq be the family of cubes from Dµ which are contained in R and are not strictly contained in any cube from EyndpRq. Observe that we do not ask the cubes from Tz reepRq to be P-doubling. Similarly, we define Tz ree°pRq as the family of cubes from Dµ which are contained in R and are not strictly contained in any cube from Sz top°pRq.

9.2. Estimating the  numbers on Tz reepRq. Our goal is now to prove the following estimate.
Lemma 9.7. For each R P DµP zEndpR0q, we have ÿ µ,2p2BQq2 µpQq À,0,K pR0q µpRq.
QPTz reepRq
We split the proof into several steps. Fix R P DµP zEndpR0q. First we deal with cubes in Tz reepRqzTz ree°pRq.
Lemma 9.8. We have ÿ µ,2p2BQq2µpQq À pR0qµpRq.
QPTz reepRqzTz ree°pRq

98

D. DBROWSKI AND X. TOLSA

Proof. We use the trivial bound µ,2p2BQq2 À µp2BQq and Lemma 3.3 to get

ÿ

ÿ

µ,2p2BQq2µpQq À

µp2BQqµpQq

QPTz reepRqzTz ree° pRq

ÿQPTz reepRqzTz rÿee° pRq

"

µp2BQqµpQq

PÿPSz top°

pRq QPTz reepRq:
ÿ

QP
ÿ

"

µp2BQqµpQq

m0 P PSz top°pRq

QPTz reepRq

ÿ 

ÿ

QP, pQÿq"A´0 mpP q A´0 m{2PpP qµpQq

m0 P PSz top°pRq

QPTz reepRq

ÿ 

ÿ

QP, pQq"A´0 mpP q
A´0 m{2PpP qµpP q «

ÿ

PpP qµpP q.

m0 P PSz top°pRq

P PSz top°pRq

Recall that for Q P TreepR0q we have PpQq À pR0q, and so

ÿ

ÿ

PpP qµpP q À pRq

µpP q  pR0qµpRq.

P PSz top°pRq

P PSz top°pRq

It remains to prove ÿ

µ,2p2BQq2 µpQq À,0,K pR0q µpRq.

QPTz ree°pRq

Consider the set

 " supp  " GppRq Y



DQ.

QPSz toppRqzLDpR0q

Denote  " Hn|. We showed in Lemma 9.2 that pR0q´1 is an AD-regular measure, and so it follows by standard arguments (using e.g. [Ma, Theorem 6.9]) that  is an AD-regular

set, and that  "  for some density  satisfying  «,0 pR0q. It is also immediate to check that Lemma 9.6 implies that R is bounded in L2pq, with

}R }L2pqÑL2pq À,0,K 1.

Hence, by the main result of [NToV1] we know that  is uniformly n-rectifiable. This

allows us to use the  numbers characterization of uniform rectifiability [DS1] to get

(9.20)
B pz ,r0 q

 r0
0

,2px, rq2

dr dpxq r

À,0,K

r0n,

for z P supp , r0 P p0, diampsupp qq.

To transfer these estimates back to the measure µ we will argue similarly as in Section 7 of [AT]. It will be convenient to work with regularized cubes, as we did in Section 6.2. Consider a function
dR,°pxq " inf pdistpx, Qq ` pQqq.
QPTz ree° pRq

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

99

Note that dR,°pxq " 0 for x in the closure of GppRq, and dR,°pxq  0 everywhere else.
Moreover, dR,° is 1-Lipschitz. For each x P RzGppRq we define Qx to be the maximal cube from Dµ that contains x and satisfies

pQxq



1 60

inf
yPQx

dR,°pyq.

The family of all the cubes Qx, x P RzGppRq, will be denoted by Reg°pRq. We define also

the regularized tree Treg°pRq consisting of the cubes from Dµ that are contained in R and

are not strictly contained in any of the Reg°pRq cubes.

It follows easily from the definition of Reg°pRq that Tz ree°pRq  Treg°pRq. Observe also

that

Reg°pRq

consists

of

pairwise disjoint ^^ 
µ Rz

cubes and satisfies 
P Y GppRq " 0.

P PReg°pRq

The following is an analogue of Lemma 6.4.

Lemma 9.9. The cubes from Reg°pRq satisfy the following properties: (a) If P P Reg°pRq and x P BpxP , 50pP qq, then 10 pP q  dR,°pxq  c pP q, where c is some constant depending only on n. (b) There exists some absolute constant c  0 such that if P, P 1 P Reg°pRq satisfy BpxP , 50pP qq X BpxP 1, 50pP 1qq  , then
c´1pP q  pP 1q  c pP q.
(c) For each P P Reg°pRq, there are at most N cubes P 1 P Reg°pRq such that BpxP , 50pP qq X BpxP 1, 50pP 1qq  ,
where N is some absolute constant.

As before, we omit the proof.

Lemma 9.10. For all Q P Treg°pRq there exists some P P Tz ree°pRq such that pQq « pP q and 2BQ  CBP  C1BQ, where C and C1 are some absolute constants. In consequence,

(9.21)

PpQq À pR0q.

Proof. Let Q P Treg°pRq. If Q X GppRq  , then Q P Tz ree°pRq and we can take P " Q. If Q X GppRq " , then there exists some Q0 P Reg°pRq such that Q0  Q. By the definition of dR,° and Lemma 9.9 (a), there exists P0 P Tz ree°pRq such that

distpxQ0, P0q ` pP0q  2dR,°pxQ0q « pQ0q.

In particular, pP0q À pQ0q  pQq. If pP0q  pQq, set P " P0, otherwise let P be the ancestor of P0 with pP q " pQq. Clearly, pP q « pQq, and moreover

distpxQ, xP q  distpxQ0, P0q ` pQq ` pP q À pQ0q ` pQq ` pP q « pQq « pP q,
which implies 2BQ  CBP  C1BQ for some absolute C and C1. Finally, to see PpQq À pR0q recall that PpP q À pR0q for all P P Tz ree°pRq 
TreepR0q, and we have PpQq À PpP q because BQ  CBP and pQq « pP q.

100

D. DBROWSKI AND X. TOLSA

The following lemma states that the uniformly rectifiable set  lies relatively close to all the cubes from Reg°pRq. This property will be crucial in our subsequent estimates.

Lemma 9.11. There exists C° " C°p, 0q such that for all Q P Reg°pRq we have

(9.22)

C° 2

BQ

X





.

Proof. Let Q P Reg°pRq and let P P Tz ree°pRq be the cube from Lemma 9.10. In particular, we have

(9.23)

2BP  CBQ

for some absolute constant C.

If P contains some cube P1 P Sz toppRqzLDpR0q, then we are done, because in that case

DP1  2BP  CBQ, and DP1  . Similarly, if GppRq X P  , then there is nothing to

prove.

Now suppose that P XGppRq "  and P does not contain any cube from Sz toppRqzLDpR0q.

Since P P Tz ree°pRq and P X GppRq " , there exists some P1 P Sz top°pRq such that P1  P .

By our assumption P1 R Sz toppRqzLDpR0q, and so

´

¯

´

¯

P1 P Sz top°pRqz Sz toppRqzLDpR0q " CxhppiiiqRq Y Sz toppRq X LDpR0q .

There are two cases to consider. Suppose that P1 P CxhppiiiqRq. Let S P piiiqR be such that P1 P CxhpSq. Since S R LDpR0q (otherwise we'd have S P piqR), (9.1) gives
pP1q «,0 pSq. Thus, there exists some constant Cp, 0q such that

(9.23)
DS  Cp, 0qBP1  Cp, 0qBP  C Cp, 0qBQ.

Since DS  , we get (9.22) as soon as C°  2C Cp, 0q. Finally, suppose that P1 P Sz toppRq X LDpR0q. Let P0 P Tz ree0pRqzSz toppRq be the unique
cube such that P1 P CxhpP0q. By (9.1) we have pP0q «,0 pP1q, and so

2BP0  Cp, 0qBP1  Cp, 0qBP  C Cp, 0qBQ.

We claim that 2BP0 X   , and so (9.22) is satisfied if we assume C°  2C Cp, 0q. First, if 2BP0 XGppRq  , then there is nothing to prove. Assume the contrary. In that case P0 is covered by cubes from Sz toppRq. We claim that there exists some S P Sz toppRqzLDpR0q such that S  P0. Indeed, otherwise P0 would be covered by cubes from Sz toppRqXLDpR0q,
but then

´µpP0q "

ÿ

´µpP 1q "

ÿ

spP

1q

(9".3)

spP0q

(9.7)


0,

P 1PSz toppRqXLDpR0q

P 1PSz toppRqXLDpR0q

which is a contradiction. Thus, there exists S P Sz toppRqzLDpR0q such that S  P0, which implies DS  2BP0. Since DS  , we are done.

In the following lemma we define functions supported on  that approximate µ at the level of Reg°pRq.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

101

Lemma 9.12. There exist functions gP :  Ñ R, P P Reg°pRq, such that each gP is

supported in  X C°BP ,



(9.24)

gP d " µpP q,


and (9.25)

ÿ gP À,0 pRq.
P PReg°pRq

Proof. Assume first that the family Reg°pRq is finite. We label the cubes from Reg°pRq in

the order of increasing sidelength, that is we let P1 be a cube with the minimal sidelength,

and then we label all the remaining cubes so that pPiq  pPi`1q.

The functions gi :" gPi will be of the form gi " iAi where i  0 and Ai  XC°BPi .

We begin by setting 1 " µpP1q{pC°BP1q and A1 " C°BP1 X . Clearly, (9.24) holds for

P1.

Moreover,

using

the

fact

that



is

AD-regular

and

C° 2

BP1

X





we

get

}g1}8

" 1

"

µpP1q  pC° BP1 q

«,0

µpP1q pP1qn

(9.21)
À pR0q.

We define the remaining gk, k  2 inductively. Suppose that g1, . . . , gk´1 have already been constructed, and they satisfy

(9.26)

kÿ´1 gi  C1pRq

i"1

for some constant C1 " C1p, 0q to be fixed below. Let Pi1, . . . , Pim be the subfamily of

P1, . . . , Pk´1 consisting of cubes such that C°BPk XC°BPij  . Due to the non-decreasing

sizes of Pi's we have Pij  C°BPij  3C°BPk . Hence, applying (9.24) to gij we get

ÿ

gij

d

"

ÿ µpPij q



µp3C°BPk q

(9.21)


Cp, 0qpR0qpPkqn



C2pR0qpXC°BPk q,

j

j

for some C2 depending on , 0. By the Chebyshev's inequality

´  X


j

gij



2C

2pR0

(¯ q



1 2



p

X

C°BPk

q.

Set

Ak "  X C°BPk X


j

gij



2C 2 pR0 q(,

and then by the preceding estimate pAkq  p X C°BPk q{2. We define

k

"

µpPk q  pAk q

,



so that for gk " kAk we have gk d " µpPkq. Moreover, using AD-regularity of  and

the

fact

that

C° 2

BPk

X





k



2 µpPkq pC°BPk q



C

p,

0

q

µpPk q pPk qn

(9.21)


C 3 pR0 q

102

D. DBROWSKI AND X. TOLSA

for some C3 depending on , 0. Hence, by the definition of Ak ÿ
gkpxq ` gij pxq  C3pR0q ` 2C2pR0q, for x P Ak.
j

For x R Ak we have gk " 0, and so it follows from the above and the inductive assumption (9.26) that for C1 " C3 ` 2C2 we have

ÿk gi  C1pRq,
i"1

which closes the induction. Suppose now that the family Reg°pRq is infinite. We can relabel it so that Reg°pRq "
tP iuiPN. For each N we consider the family tP iu1iN . We construct functions gPN1, . . . , gPNN as above, so that they satisfy

 gPN1 d " µpP 1q,

ÿN gPNi  C1pRq.
i"1

There of L8

exists pq to

a subsequence some function

I1  gP 1

N such P L8p

that tgPk 1ukPI1 is convergent in the weak-° topology q. We take another subsequence I2  I1 such that

tgPk 2ukPI2 is convergent in the weak-° topology of L8pq to some gP 2 P L8pq. Proceeding

in this fashion we obtain a family tgP i uiPN such that supp gP i  C°BP i, and the properties

(9.24), (9.25) are preserved (because of the weak-° convergence).

Recall that by the uniform rectifiability of  we have a good estimate on the ,2 numbers (9.20). We will now use Lemmas 9.11 and 9.12 to transfer these estimates to the measure

µ and obtain

ÿ µ,2p2BQq2 µpQq À,0,K pR0q µpRq.

QPTz ree°pRq

In fact, we will show that ÿ

µ,2p2BQq2 µpQq À,0,K pR0q µpRq,

QPTreg°pRq

and the former estimate will follow, since Tz ree°pRq  Treg°pRq. Let Q P Treg°pRq, and let LQ be an n-plane minimizing ,2pC°1 BQq, where C°1  2 is
some constant depending on C°, to be chosen in Lemma 9.13. We estimate

(9.27)

µ,2p2BQq2µpQq ~

À(9À.2µp1pQ)QqqnpR20BqQ2^BQdi^stdppxiQs,tqLppxQQ,qqLQ2qdµ2pxdqµpxq 



¸

" pR0q

. . . dµpxq `

. . . dµpxq `

. . . dµpxq

2BQ XRzGp pRq

2BQ XGp pRq

2BQ zR

": pR0qpI1 ` I2 ` I3q.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

103

Concerning I3, we use the trivial estimate

(9.28)

I3 À µp2BQzRq.

Estimating I2 is simple because on GppRq we have µ " 1 for some 1 À pR0q, and so

(9.29)

I2

À

 pR0q
2BQ XGp pRq

^ distpx, LQq 2 pQq

dpxq



 pR0q
C°1 BQ

^ distpx, LQq 2 pQq

dpxq

«C°1 pR0q,2pC°1 BQq2pQqn.

Bounding I1 requires more work. First, we use the fact that RzGppRq is covered µ-a.e. by Reg°pRq:

I1

 "

ÿ

 ^ distpx, LQq 2 dµpxq

P

PReg°pRq: P
ÿ

X2BQ



P
^

`P PRe^g°dpRisqÿ t:pPpxQX,2qLBQQq2


pP

pQq

^

distpx, LQ pQq

q

2

gP

pxq

dpxq



pxqdµpxq ´ gP pxqdpxqq

":

pI11pP q ` I12pP qq .

P PReg°pRq: P X2BQ

We need the following auxiliary result.

Lemma 9.13. If P P Reg°pRq is such that P X 2BQ  , then pP q À pQq and in consequence C°BP  C°1 BQ for some C°1 " C°1 pC°q  C°.
Proof. If pP q  pQq then there is nothing to prove, so suppose pP q  pQq (in particular pP q  A0pQqq. In that case we have 2BQ  2BP .
Note that if we had QzGppRq " , then dR,°pxQq " 0, but by Lemma 9.9 (a) we know that dR,°pxQq  10pP q. Hence, there exists some S P Reg°pRq such that S  Q. Together with the fact that 2BQ  2BP this implies BS X 2BP  . By Lemma 9.9 (b) this gives
pP q « pSq  pQq.

By the lemma above and the preceding estimate we get

(9.30)

ÿ

ÿ

I1 

I11pP q `

I12pP q.

P PReg°pRq: C°BP C°1 BQ

P PReg°pRq: C°BP C°1 BQ

104

D. DBROWSKI AND X. TOLSA

We estimate the first sum as follows:

(9.31)

P

PReg°pRsuqp:ÿ "pCg°PBPC^°CdB°1iPsBtQppxQX,qLC^Q°1 BdqQist^2ppPxdQP,iRsqLteQpgpx°Qqp,RqLq2Q:ÿgCqP°Bpx2PqPdPCR°1ÿ epBgx°QqpgRPq

pxq d gP pxq

pxq dpxq

(9.25)
À ,0

 pR0q
XC°1 BQ

^ distpx, LQq 2 pQq

dpxq

«C°1

pR0q,2pC°1 BQq2pQqn.

 Concerning I12pP q, observe that since gP d " µpP q by (9.24), we have

I12pP q

"



~^ distpx, LQq 2 pQq

´

^

distpxP , LQq pQq

2¸

pP

pxqdµpxq

´

gP pxqdpxqq .

For x P supppP pxqdµpxq ´ gP pxqdpxqq  C°BP  C°1 BQ we have

^

distpx, LQ pQq

q

2

´

^

distpxP , LQ pQq

q

2



|x ´ xP | pQq

¨

distpx, LQq ` distpxP pQq

,

LQq

À

C°pP q pQq

¨

C°1 pQq pQq

«C°,C°1

pP q pQq

.

Hence,

(9.32)

I12pP q

ÀC° ,C°1

pP q pQq

µpP

q.

Recall that C° depends on , 0, and C°1 depends on C°. Thus, putting together the estimates (9.30), (9.31), and (9.32) yields

I1 À,0 pR0q,2pC°1 BQq2pQqn `

ÿ

pP q pQq

µpP

q.

P PReg°pRq:

C°BP C°1 BQ

Together with (9.27), (9.28), and (9.29) this gives

µ,2p2BQq2µpQq À,0 pR0q2,2pC°1 BQq2pQqn

` pR0q

ÿ

pP q pQq

µpP

q

`

pR0

qµp2BQ

zRq.

P PReg°pRq:

C°BP C°1 BQ

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

105

Summing over Q P Treg°pRq we get

ÿ

ÿ

µ,2p2BQq2µpQq À,0 pR0q2

,2pC°1 BQq2pQqn

QPTreg° pRq

QPTreg°pRq

ÿ ` pR0q

ÿ

pP q pQq

µpP

q

`

pR0q

ÿ

µp2BQzRq

QPTreg°pRq P PReg°pRq:

QPTreg°pRq

C°BP C°1 BQ

": pR0q2S1 ` pR0qS2 ` pR0qS3.

Concerning S1, note that by (9.22) we know that if Q P Treg°pRq, then pC°BQ X q «,0 pQqn and for all x P C°BQ X  we have C°1 BQ  Bpx, 2C°1 pQqq. Thus, ,2pC°1 BQq À ,2px, rq for 2C°1 pQq  r  3C°1 pQq. Observe also that the sets C°BQ X  corresponding to cubes of the same generation have bounded intersection. It follows easily

that

S1

"

ÿ ,2pC°1 BQq2pQqn
QPTreg°pRq

À,0


5C°1 BR

 5C°1 pRq
0

,2px, rq2

dr dpxq r

(9.20)
À ,0,K pRqn.

To estimate S2 we change the order of summation:

ÿ

S2 "

µpP q

ÿ

pP q pQq

.

P PReg°pRq

QPTreg° pRq:

C°BP C°1 BQ

Note that the inner sum is essentially a geometric series, and so

ÿ

S2 ÀC°,C°1

µpP q  µpRq.

P PReg°pRq

Finally, we can bound S3 using the small boundaries property of the David-Mattila
lattice (2.1). To be more precise, note that for Q P Treg°pRq if 2BQzR   and pQq " A´0 kpRq, then necessarily Q  Nk´1pRq, and even 2BQ  Nk´1pRq. Furthermore, the balls 2BQ for cubes of the same generation have only bounded intersection. Thus,

ÿÿ

ÿ

(2.1)

S3 

µp2BQq À µpNk´1pRqq À µp90BpRqq « µpRq.

k1 QNk´1pRq, pQq"A´0 kpRq

k1

Putting the estimates for S1, S2 and S3 together we arrive at ÿ µ,2p2BQq2µpQq À,0,K pR0q2pRqn ` pR0qµpRq À0 pR0qµpRq,
QPTreg° pRq
where in the last estimate we used the fact that pR0q À 0´1pRq (note that R R LDpR0q because DµP X LDpR0q  EndpR0q and we assume R P DµPzEndpR0q). This finishes the proof of Lemma 9.7.

106

D. DBROWSKI AND X. TOLSA

9.3. The corona decompostion and the proof of Lemma 9.1. Now we define Tyop " TyoppR0q inductively. We set Tyop0 " tR0u and, assuming Tyopk to be defined, we let
Tyopk`1 "  pEyndpRqzEndpR0qq.
RPTyopk

Then we let

Tyop "  Tyopk.
k0

In this way, we have

TreepR0q "  Tz reepRq.

RPTyop

Lemma 9.14. We have pTyopq À,0 pR0q ` ÿ }QRµ}2L2pµq `

ÿ E p4Qq.

QPTreepR0 q

QPTreepR0 qXHE

Proof. By Lemma 9.5, we have

ÿ

µpQq `

ÿ

µpQq ` µpGppRqq « µpRq.

QPSz toppRqXpLDpR0 qYHDpR0 qYBRpRqq

QPCxhppiiiqR qXLDpR0 q

By the construction of Tz reepRq, the cubes from Sz toppRq Y CxhppiiiqRq belong to Tz reepRq

and the ones from Sz toppRq X BRpRq belong to EyndpRq, and so

µpRq «

ÿ

µpQq `

ÿ

µpQq ` µpGppRqq.

QPTz reepRqXpLDpR0 qYHDpR0 qq

QPEyndpRqXBRpRq

Notice that the families Tz reepRq, with R P Tyop, are disjoint, with the possible exception of

the roots and ending cubes of the trees Tz reep¨q, which may belong to two different trees.

Then ÿ

we

deducÿ e tha^t

µpRq «

ÿ

µpQq `

ÿ

 µpQq `

ÿ µpGppRqq

RPTyop

RPTyop QPTÿ z reepRqXpLDpÿR0qYHDpR0qq

À µpR0q `

µpQq.

QPEyndpRqXBRpRq

RPTyop

RPTyop QPEyndpRqXBRpRq

Since the cubes Q P BRpRq do not belong to LDpR0q, we have pQq «,0 pR0q for such

cubes. The same happens for R P Tyop, and thus

(9.33)

pTyopq À,0 pR0q ` ÿ pRq2

ÿ

µpQq.

RPTyop

QPEyndpRqXBRpRq

To estimate the last sum above, we claim that for a given Q P BRpRq X EyndpRq we have

Rp2Rz2QµqpxQ

` q´ mµ,Q

pRµq´mµ,R

pRµq

À

P

^ pRq`

E p4Rq µpRq

1{2 `P

^ pQq`

E p2Qq µpQq

1{2

.

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

107

This is proved exactly in the same way as Lemma 7.2 (see also (7.2)) and so we omit the

arguments. In case that both R, Q R HE, then

^ Ep4Rq 1{2 µpRq



M0

pRq

and

^ Ep2Qq 1{2 µpQq



M0

pQq,

and so we get

Rp2Rz2QµqpxQ

q

´

` mµ,QpRµq

´

mµ,R

pRµq



C

p,

0

,

M0qpRq.

Thus, by the BRpRq condition, K pRq  |Rp2Rz2QµqpxQq|  mµ,QpRµq ´ mµ,RpRµq ` Cp, 0, M0qpRq.

Hence, for K  2 Cp, 0, M0q, we obtain

1 2

K

pRq



mµ,QpRµq

´

mµ,RpRµq.

In the general case where Q and R may belong to HE, by analogous arguments, we get

1 2

K

pRq



mµ,QpRµq

´

mµ,RpRµq

`

HEpRq

^

E p4Rq µpRq

1{2

`

HEpQq

^

E p2Qq µpQq

1{2

,

where HEpP q " 1 if P P HE and HEpP q " 0 otherwise. Since

ÿ

mµ,QpRµq ´ mµ,RpRµq " Q

P pRµq,

P PTz reepRqzEyndpRq

assuming K  1, we get

(9.34) pRq2

ÿ

µpQq À

ÿ

 

ÿ

P pRµq2 dµ

QPEyndpRqXBRpRq

QPEyndpRqXBRpRq Q P PTz reepRqzEyndpRq

ÿ ` HEpRq

E p4Rq µpRq

µpQq

`

ÿ

E p2Qq.

QPEyndpRqXBRpRq

QPEyndpRqXHE

By orthogonality, the first sum on the right hand is bounded by

 

ÿ

P pRµq2 dµ "

ÿ

}P pRµq}2L2pµq.

P PTz reepRqzEyndpRq

P PTz reepRqzEyndpRq

Also, it is clear that the second sum on the right had side of (9.34) does not exceed

HEpRq Ep4Rq. Therefore,

ÿ pRq2

µpQq

QPEyndpRqXBRpRq ÿ À

}P pRµq}2L2pµq ` HEpRq Ep4Rq `

ÿ E p2Qq.

P PTz reepRqzEyndpRq

QPEyndpRqXHE

108

D. DBROWSKI AND X. TOLSA

Plugging the previous estimate into (9.33), we obtain

pTyopq À,0 pR0q ` ÿ

ÿ }P pRµq}2L2pµq

ÿ

RPTyop P PTz rÿeepRqzEyndpRÿq

`

Ep4Rq `

E p2Qq

RPTyopXHE

ÿ RPTyop QPEyndpRqXHE

ÿ

À,0 pR0q `

}P pRµq}2L2pµq `

E p4Qq,

P PTreepR0q

QPTreepR0 qXHE

as wished.

Proof of Lemma 9.1. Given R0 P Top, combining Lemmas 9.7 and 9.14, we obtain

ÿ

ÿ

ÿ

µ,2p2BQq2 pQq µpQq À,0

pRq

µ,2p2BQq2 µpQq

QPTreepR0 q

Rÿ PTyop

QPTz reepRq

À,0

pRq2µpRq

RPTyop

ÿ

ÿ

À,0 pR0q `

}QRµ}2L2pµq `

E p4Qq.

QPTreepR0 q

QPTreepR0 qXHE

Appendix A. A list of parameters

Here is the list of the most important constants and parameters that appear in the paper, in the order of appearance. We also point out the dependence of different constants on each other (usually we do not track dependence on dimension).

, C0, A0 are the constants from the David-Mattila lattice, and they depend only on

dimension, see Remark 2.2. Moreover, A0 is assumed big enough that Lemma 4.3

and Lemma 6.6 hold. Starting from Section 3, A0 and C0 are considered to be

fixed constants, and all the subsequent estimates and parameters may depend on

them. We do not track this dependence.

, Cd is the constant from the definition of P-doubling cubes in Subsection 3.1, and we have Cd " 4An0 .
, M0 is the constant from the definition of the HE family. It is an arbitrarily large

parameter chosen in Theorem 3.4 (the Main Theorem).

,  is the HD constant, and it is of the form  " Ak0n for some large integer k. It

depends on M0, see the end of the proof of Lemma 7.8, as well as Remark 7.12.

,

°

is

the

HD°

constant,

and

it

is

of

the

form

°

"

1´

1 N

,

where

N

is

a

large

dimensional constant fixed above Lemma 4.2 (for example, N " 500n works).

,

0

is the LD constant, and it is of the form 0

"

´N0

´

1 2N

for some large integer

N0 depending on dimension. See also Remark 7.12. 1
, B is the MDW constant, and it is of the form B " °100n .

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

109

, 0  0 is the parameter used in the definition of function dR,0 at the beginning of Section 6.2. It is assumed to be small enough in Lemma 7.11 (depending on Lemma 7.9), and in Lemma 7.14. We have no control over how small 0 is (it comes from a "qualitative argument"), but none of the other constants depend on it.
, n  0 is a small auxiliary parameter introduced above Lemma 6.6. In the present paper one can take n " 1{15, but for the application of some of the results from Section 6 in [To4], we allow n to be an arbitrarily small parameter depending on dimension.
,  appears in the paper twice; in Lemma 2.6 it is an auxiliary parameter with  P p0, 1q, and it retains that meaning until the end of Section 2. Later on, in Section 7,   0 is the constant from the definition of -nice trees, introduced below Remark 7.6. It is chosen to be small enough depending on  and M0 in Remark 7.12.
, Z  0 is a small constant introduced in Lemma 7.9. It is fixed in Remark 7.12, depending on  and M0.
, K  0 is the BR constant. It is chosen in the proof of Lemma 9.14, and it is big enough depending on , 0 and M0.
, C°  0 is a constant from Lemma 9.11. It depends on  and 0.

Appendix B. A list of cube families and related objects
Below we list the most important families of cubes that appear in the paper, along with a link to the section where they were defined. We also list some other notions related to cubes (e.g., the approximating measures, or enlarged cubes).
, Dµ is the family of David-Mattila cubes from Section 2. , DµP is the family of P-doubling cubes from Subsection 3.1. , HE are the high energy cubes defined in Subsection 3.2. , HDpRq, LDpRq, StoppRq, EndpRq, TreepRq, Top are defined in Subsection 3.3. , MDW, HD°pRq, BadpRq, Stop°pRq are defined in Subsection 4.1. , ejpRq, epRq, e1pRq, e2pRq, epkqpRq are various enlarged cubes, defined in Subsec-
tion 4.2. , StoppejpRqq is defined in Subsection 4.2. , Stop°pepRqq, Stop°pe1pRqq, HD1pRq, HD1pepRqq, HD1pe1pRqq, HD2pe1pRqq,
Stop2pe1pRqq, TStoppe1pRqq, Negpe1pRqq, Endpe1pRqq, T pe1pRqq are defined in Subsection 4.3. , Trc  MDW is the family of tractable cubes (which are the roots of tractable trees). It is defined in Subsection 4.4. , GHpRq is the family of good high density cubes, and it is defined in Lemma 4.6. , GenpRq are the cubes generated by R, and TrcpRq " GenpRq X Trc. These families are constructed below Lemma 4.6. , Fj, Fhj , Lj, Lhj , L are defined in Section 5. , Regpe1pRqq is the family of regularized stopping cubes, and TReg is the corresponding tree. They are defined in Subsection 6.2. ,  is used to denote two different approximating measures; first, in Sections 6-7 it is a measure approximating µ at the level of Regpe1pRqq. It is defined below

110

D. DBROWSKI AND X. TOLSA

Lemma 6.4. Later, in Section 9, it is an AD-regular measure approximating µ at the level of Sz toppRq. It is defined above Lemma 9.2. , Hjpe1pRqq are auxiliary families defined in Subsection 6.3. , H and H1 are defined in Subsection 6.4.
,  is a smoother version of the approximating measure , and it is defined in Sub-
section 6.4.
, TH1 is defined above (6.21). , RegNeg, DNeg, MNeg, End, Tr, Z, Zr are defined in Subsection 7.1. , -nice trees are defined below Remark 7.6.
, BRpRq is the family of cubes with big Riesz transform. It is introduced in Subsec-
tion 9.1. , CxhpQq, Sz toppRq, Tz ree0pRq are defined at the beginning of Subsection 9.1.
, piqR, piiqR, piiiqR are defined above Lemma 9.5. , EyndpRq, Tz reepRq, Sz top°pRq, Tz ree°pRq are defined at the end of Subsection 9.1. , Reg°pRq and Treg°pRq are constructed above Lemma 9.9. , Tyop is defined above Lemma 9.14.

References

[AH] H. Aikawa and K. Hirata. Doubling conditions for harmonic measure in John domains. Ann.

Inst. Fourier (Grenoble) 58 (2008), no. 2, 429­445.

[AHM+] J. Azzam, S. Hofmann, J.M. Martell, S. Mayboroda, M. Mourgoglou, X. Tolsa, and A. Volberg.

Rectifiability of harmonic measure. Geom. Funct. Anal. (GAFA), 26(3) (2016), 703­728.

[AMTV] J. Azzam, M. Mourgoglou, X. Tolsa and A. Volberg. On a two-phase problem for harmonic

measure in general domains. Amer. J. Math. 141(5) (2019), 1259­1279.

[AT] J. Azzam and X. Tolsa. Characterization of n-rectifiability in terms of Jones' square function:

Part II. Geom. Funct. Anal. 25 (2015), no. 5, 1371­1412.

[DM] G. David and P. Mattila. Removable sets for Lipschitz harmonic functions in the plane. Rev.

Mat. Iberoamericana 16(1) (2000), 137­215.

[DS1] G. David and S. Semmes. Singular integrals and rectifiable sets in Rn: Beyond Lipschitz graphs,

Astérisque No. 193 (1991).

[ENV] V. Eiderman, F. Nazarov and A. Volberg. The s-Riesz transform of an s-dimensional measure

in R2 is unbounded for 1  s  2. J. Anal. Math. 122 (2014), 1­23.

[Gi]

D. Girela-Sarrión. Geometric conditions for the L2-boundedness of singular integral operators

with odd kernels with respect to measures with polynomial growth in Rd. J. Anal. Math. 137

(2019), no. 1, 339­372.

[JNRT] B. Jaye, F. Nazarov, and M.C. Reguera, and X. Tolsa. The Riesz transform of codimension

smaller than one and the Wolff energy. Mem. Amer. Math. Soc. 266 (2020), no. 1293.

[Ma] P. Mattila. Geometry of sets and measures in Euclidean spaces, Cambridge Stud. Adv. Math. 44,

Cambridge Univ. Press, Cambridge, 1995.

[NToV1] F. Nazarov, X. Tolsa and A. Volberg. On the uniform rectifiability of AD-regular measures with

bounded Riesz transform operator: the case of codimension 1. Acta Math. 213 (2014), no. 2,

237­321.

[NToV2] F. Nazarov, X. Tolsa and A. Volberg. The Riesz transform, rectifiability, and removability for

Lipschitz harmonic functions. Publ. Mat. 58 (2014), 517­532.

[NTrV1] F. Nazarov, S. Treil, and A. Volberg. Cauchy integral and Calderón­Zygmund operators on non-

homogeneous spaces. Internat. Math. Res. Notices 15 (1997), 703­726.

[NTrV2] F. Nazarov, S. Treil, and A. Volberg. The T b-theorem on non-homogeneous spaces. Acta Math.

190 (2) (2003).

THE MEASURES WITH L2-BOUNDED RIESZ TRANSFORM

111

[RT] [To1] [To2] [To3] [To4] [Vo]

M.C. Reguera and X. Tolsa. Riesz transforms of non-integer homogeneity on uniformly disconnected sets. Trans. Amer. Math. Soc. 368 (2016), no. 10, 7045­7095. X. Tolsa. Bilipschitz maps, analytic capacity, and the Cauchy integral. Ann. of Math. 162:3 (2005), 1241­1302. X. Tolsa. Rectifiable measures, square functions involving densities, and the Cauchy transform. Mem. Amer. Math. Soc. 245 (2016), no. 1158, 1­130. X. Tolsa. Analytic capacity, the Cauchy transform, and non-homogeneous Calderón-Zygmund theory. Progress in Mathematics, vol. 307, Birkhäuser/Springer, Cham, 2014. X. Tolsa. The measures with L2 bounded Riesz transform and the Painlevé problem for Lipschitz harmonic functions. Preprint (2021). A. Volberg, Calderón­Zygmund capacities and operators on nonhomogeneous spaces. CBMS Regional Conf. Ser. in Math. 100, Amer. Math. Soc., Providence, 2003.

Damian Dbrowski, Departament de Matemàtiques, Universitat Autònoma de Barcelona, and Barcelona Graduate School of Mathematics (BGSMath)
Edifici C Facultat de Ciències, 08193 Bellaterra, Barcelona, Catalonia, Spain Current address: P.O. Box 35 (MaD), 40014 University of Jyväskylä, Finland Email address: damian.m.dabrowski "at" jyu.fi
Xavier Tolsa, ICREA, Passeig Lluís Companys 23 08010 Barcelona, Catalonia, Departament de Matemàtiques, and BGSMath, Universitat Autònoma de Barcelona, 08193 Bellaterra (Barcelona), Catalonia.
Email address: xtolsa "at" mat.uab.cat

