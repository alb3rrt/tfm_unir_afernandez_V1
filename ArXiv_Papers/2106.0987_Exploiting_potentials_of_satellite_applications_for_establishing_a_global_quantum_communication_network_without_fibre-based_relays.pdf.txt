Exploiting potentials of satellite applications for establishing a global quantum communication network without fibre-based relays

Xingyu Wang 1,2 Chen Dong 1 , Shanghong Zhao 2 , Tianyi Wu 1, Lei Shi 2, Boyu Deng 3, Haonan Zhu 2 and Yijun Zhang 1

Recent the large-scale quantum network that connects metropolitan area quantum networks between the cities is realized by integrating the free-space and fibre QKD links, yet the fiber-based trusted nodes in such network could be subject to constant surveillance and probes. To remove these fiber-channel risks, we consider a network where a space-based relay, Micius satellite, executes a sequence of keys delivery missions, allowing thus any two cities to have a shared key. In this work, we develop a comprehensive framework integrated with the precise orbital modeling and the cloud statistics model to enable a pre-assessment on the satellite-based QKD applications. Using this framework, we consider three different scheduling strategies and estimate the keys possible to deliver to the cities, respectively. Results show that the strategy of pursing the total final keys maximized significantly embodies space-based QKD advantage, while the strategy of considering different levels of missions achieves more keys delivered to a higher priority mission. Most importantly, the targeted strategy of pursuing the distribution of final keys delivered being coincident with network traffic distribution, guarantees the individual needs, further promoting the utilization of delivered keys in practice. We also provide a comparison between the total number of delivered keys by the satellite with different altitude orbits. It is demonstrated that the plans for constructing a low earth orbit (LEO) satellite constellation, are more effective than that for employing an expensive high-orbit satellite, for a realization of the potential applications. Our works not only provides a practical method in the near term but also gives the aforehand exploration to establish satellite-based quantum communication network.

.
INTRODUCTION
Quantum key distribution (QKD) is a family of protocols can provide information-theoretic security to share keys between two distant parties1­3. Apart from the matured fibre-based QKD approaches, free-space QKD has progressed out of laboratories into real-world scenarios4­7. Several pioneering experiments8-11 such as the Chinese Quantum Experiments at Space Scale (QUESS) missions contributing to the full in-orbit demonstrations of the satellite-based QKD approaches, provides a most feasible option to achieve an ultralong-distance QKD with today's technology. Very recently, by integrating the fibre and free-space QKD links, a spaceto-ground QKD network has been successfully extended to a distant optical ground station (OGS) site, up to a total distance of 4,600 kilometers, which sparked a worldwide interest in design for the future global quantum network12.
In such an integrated space-to-ground network, the fiber-based trusted nodes have been built for extending these limited point-topoint QKD distances from one backbone node to another but are fixed locations that could be subject to constant surveillance and probes13. To remove these fiber-channel risks, one could consider a hypothetical but possible network (illustrated in Fig.1) evolved from the paradigm, consisting of a space-based mobile platform (i.e., the Micius satellite) and the selected cities with OGSs (i.e., the built and planned backbone nodes for the future national network). Here,

the only relay, i.e., Micius satellite, operates as either `trusted node' or `untrusted node' and directly mediates the distribution of secure encryption keys pairwise between these cities. The remarkable fact that, the `untrusted node' configuration such as the implemented entanglement-based QKD11 or future space-based measurementdevice-independent (MDI)14 QKD is more secure but feasible only when both OGSs are within the satellite coverage simultaneously. Moreover, though a constellation of satellites that provides a continuous, on-demand entanglement distribution service to cities appears to be viable in future term, the limitation of orbit resources and the costs of construction should be considered before a widely deployment15,16. Instead, in the current `trusted node' configuration, the Micius satellite carries out QKD operations with distinct OGSs to establish independent keys with each of them, and subsequently broadcasts over a public channel the XOR hash17 of both delivered keys allowing thus any two cities to have a shared key. Therefore, the encrypted-communication in such a possible network could be implemented without the need for fibre-based relays.
However, one major challenging bottleneck putting the network in extensive use is so far the satellite-based QKD has not been efficient enough to support the for the one-time-pad encryption. In seeking a higher key rate, there have been proposals for free-space continuous-variable (CV) QKD18, asymmetric MDI-QKD19, whereas, directly applying the modifications to space environment is difficult yet to be achieved. For instance, in a high-loss regime adopting CV-

1Information and Communication College, National University of Defense Technology, Xi'an, 710006, China. 2School of Information and Navigation, Air Force Engineering University, Xi'an 710077, China. 3Department of Electronic Engineering, Tsinghua University, Beijing 100084, China. Email: dongchengfkd@163.com; zhaoshangh@aliyun.com

Fig. 1 an illustration of a hypothetical but possible network evolved from the integrated space-to-ground network reported in ref. 12. The network consists of a space-based mobile platform (i.e., the Micius satellite) and the 11 selected cities of China with OGSs, including Urumqi, Lhasa, Xi'an, Chengdu, Shenyang, Beijing, Jinan, Hefei, Wuhan, Shanghai, and Guangzhou. Consider that the simulation results can help for the future in-orbit operations, the actual longitude-latitude-altitude (LLA) data of cities are considered in the scenario, as well as the Micius orbit elements (see the embed table) updated by the Two-Line Element (TLE) datasets. Here, the encrypted-communication in such network is assisted by the several backbone fibre link (yellow line), using the satellite as the only trusted relay. Specially, the satellite carries out QKD operations with distinct OGSs to establish independent keys with each of them, and subsequently broadcasts over a public channel the XOR hash of both keys allowing thus any two nodes to have a shared key. Since no fibre-based QKD exists in such a large-scale encrypted communication network, there is an urgent need to solve the design of scheduling strategy of the satellite-based QKD to the cities.

QKD takes no substantial superiority for key generation. Also, the loss of uplink is more severe than that of downlink due to the atmospheric properties20,21 such as turbulence cause the optical beam to wander, which results in a more complicated situation in the two arms of MDI-QKD. Another way to the improvement on key rate is to raise the technical realization level of the space-based QKD systems. It is suggested that a state-of-the-art transmission system installed in a geosynchronous orbit (GEO) satellite could be employed to run a 24-hour QKD22,23. Unfortunately, yields of a longterm satellite-based QKD in daytime is unclear due to the cyclical changes in solar radiation24. Moreover, improving the experimental settings (e.g., employing a larger lens or an efficient detector) is regarded to be beneficial for a higher link performance, while from the system engineering perspective, a tradeoff in how to determine the space-qualified parameters exists25.
The other approach is to consider a delay in the delivery of final keys in practice. It was shown in refs. 12 that raw keys downloaded from a satellite are first stored in a buffer of the OGS and then be used for post-processing after enough collected. Thus, the final keys used for Advanced Encryption Standard (AES)-256 protocol are refreshed every period, which provides adequate security in the foreseeable future26. Thus, the approach gives an efficient method to achieve encryption and has been adopted in the existed QKD network27-29. However, the aforementioned works have been confined to the in-orbit analysis of the protocols involving a satellite

and one or two OGSs, lacking a consideration in the promotion of keys generation through the satellite applications. Recently, the authors of ref. 30 elegantly extended the idea of scheduling radio downlink in the Earth Observation missions to the scenario of satellite-to-ground QKD. By modeling several realistic constraints of space environments, they proposed the formulation to schedule an optical downlink from one satellite to the cities allocating them time suitable to download the number of final keys. Nevertheless, as for the given example of a small-scale network scenario, this neither shows the advantage of employing the space-based QKD in a longdistance transmission nor a comparative study with the different schedule strategies. In addition, kindly note that the view periods of OGSs have variable durations which depends on the geometry of the orbit relative to the OGS. Therefore, the modeling incorporating simple circular orbital propagation needs to be modified to close the gap between theory and practice.
In this work we follow the method of delaying keys delivery to address the problem of encryption needs in the future large-scale QKD network. The critical ingredient to the implementation is an improvement on the final key rates by considering a sequence of keys delivery missions the satellite should execute, i.e., a schedule, which could be designed by a prior comparison of the results of all possible satellite operations. For this, we develop a comprehensive framework integrated with our designed orbital modeling21 and the cloud statistics model based on the Himawari-8 data statistics31.

Using this framework, we consider three different scheduling strategies and estimate the keys possible to deliver to the cities. Assigned weights on the cities to quantify the individual needs, we modified the genetic algorithm (GA) 32 to perform the optimizations. With Kullback-Leibler (KL) divergence33 that progressively tightens a match between the resulting keys distribution and the expectations, we find that the strategy of pursuing the distribution of final keys delivered being coincident with that of the data traffic, guarantees the individual needs, further promoting the utilization of delivered keys. We also provide a comparison between the total number of
(a)

delivered keys by the satellite with different altitude orbits, whose comparisons could support decisions involving the orbital selection of the future quantum satellite.
RESULTS
Integrating a precise orbit modeling and cloud statistics model to provide a pre-assessment framework for the satellite-based QKD applications. Scheduling the QKD downlink from a satellite to the cities requires a prior comparison of the expected results of all possible satellite's operations to design a sequence of missions a
(d)

(b)

(c)

Fig. 2 Results of the framework on the modeling of satellite-to-ground QKD operation during the week of the 22th of September 2016. a. illustration of the timeline where the cities feasible to access the Micius satellite in each interval (10 seconds) are labelled with different colors; b variations in total loss budget during a common-visible interval of the cites, Wuhan, Chengdu, and Xi'an. c the map of the cloud distribution over China at Sep 23 2016, 16:32:40 UTC, which is obtained from the Himawari-8 datasets. The cloud cover statistics for each city was encoded as an integer value ranging from 0 to 150. Specifically, the value of 0 and 150 corresponds to sunny and heavy cloudy, respectively. For more details, see the Methods; d the expected results of final keys delivered to the cites in different days of the week. For a comparison, the sending intensities are same as reported in ref. 12, where  = 0.5,  = 0.08 and  = 0, respectively. The source repetition
rate Ms is assumed as 200 MHz, and other parameters are listed in Table 2.

satellite should execute, ultimately achieving the best performance of the network measured in terms of keys delivered. What makes the satellite applications unique, are the time-varying properties of the satellite-to-ground transmission channel, which are critical for the formulation of the optimization problem of scheduling a QKD link in the practical constraints. Thus, a comprehensive modeling framework considering the optical beam propagation as well as the satellite orbit will be necessary for minimizing the gaps with reality. For this, our proposed framework is integrated with the AGI System Tool Kit's modeling capabilities, which is achieved by our secondary development of the tool using the involved codes. Here, one of the advantages is that, the orbital elements of a given satellite could be periodically updated per time step, for covering the orbital drift. As such, the reports of a specific scenario about visibility, relative elevation angle and distance from a satellite to a city, are more precise than that from a naive circular orbit modeling.
In this work, the week of September 22, 2016 in Universal Time Coordinated (UTC) format is taken as an example time period to demonstrate a course of the Micius satellite flying cross the cities over China. We simulated the satellite operations under the specific scenario associated with the TLE dataset (see Data availability) and the experimental settings, and estimated the intervals available for access. As depicted in Fig. 2a, the available intervals are separated into two or three durations in umbra of sun due to the sunsynchronous orbit cycle. Consistently, within a total of 30 minutes available for performing the satellite-to-ground QKD per day, the cities dispersed in western China, such as Lhasa and Urumqi, could immediately access to the Micius satellite since seldom sharing their visible windows with other cities. While for the cities densely distributed in the eastern China, pre-adoption of an appropriate schedule could achieve the reduction in spending time on the handoff resulting from random access.
Though the available intervals are predictable with the orbital dynamics, the days with severe transmission disturbance resulting from the cloudy weather are often excluded from the design of the QKD missions. Given that the predictions on the link budget like the proposal by Pirandola34 or Villoresi35 are based on the generalized modeling of the various effects including geometric loss, turbulent disturbance, and atmospheric loss etc., we modified the calculation modeling by incorporating with the cloud statistic information, and estimated the weather induced attenuation. Quantitative image of the cloud cover and resulting link budget are illustrated in Fig. 2b and 2c. Notably, the cities of Xi'an and Chengdu on the day of 23th are suffered from a serious obstruction, and the total budgets in the worst case are up to 37.6 dB and 33.8 dB, among which the effect of clouds accounts for about 4.7 dB and 2.1 dB, respectively. This extra loss will be further detrimental to the efficiency in receiving the photons.
To the end, using the results to estimate key generation rate per time step, we can obtain the possible final keys delivered during an arbitrary interval. For simplicity, the estimation of key rate with the Gottesman­Lo­Lütkenhaus­ Preskill (GLLP) security analysis36 is calculated in asymptotic case. The expected number of keys delivered to the cites in different days of the week are shown in Fig. 2d. As a

demonstration, the cities of Xi'an and Chengdu on the day of 24th having no keys generated, whereas a thin cloud thickness over the city of Wuhan promotes more final keys to deliver within the same visible window, which indicates that the situation where clouds prevent the delivery of raw keys could be mitigated through a flexible schedule. See the "Methods" section for a full description of our framework. In conclusion, our framework not only could be used as a function to further formulate the optimization problems, but also these assessments related to the satellite-to-ground transmissions could be used for a pan-design in a future quantum space-based network.
Scheduling under S-TD guarantees the individual needs, further promoting the utilization of delivered keys. The previous section implies that conducting a schedule in the network improves the performance of the number of keys delivered, but still remains the question of whether performing scheduling from one satellite to cities in the network can guarantee their different encryption needs. To answer it, we here considered the cities are assigned normalized weights whose values are proportional to a possible network traffic distribution (i.e., the data traffic between a city and all other cities relative to the sum of that in the network). Targeting at the total number of final keys maximization while preserving the individual needs, we then adopted different scheduling strategies to deliver keys, including (1) general delivery to the cities without considering the weights (S-GD), only pursing the total final keys maximized; (2) prioritized delivery to the city with higher weight (S-PD), ensuring the high-priority tasks first; (3) targeted delivery to the cities with distinct weights (S-TD), making the proportions be coincident with network traffic distribution. All these strategies are achieved by using our modified algorithms, which will be introduced latter.
Fig. 3a shows the resulting final keys delivered under each strategy, for the different cities. The following observations made from the results are that:
(1) Employing S-GD unsurprisingly improved the total number of final keys beyond that achieved with S-PD or S-TD. Moreover, as a demonstration of the 7,468 kbits delivered to the city of Urumqi, it even embodied a same final-key rate that of the fiber-based QKD that relayed by at least 5 ideal nodes to the city of Xi'an (see Fig. 3b). However, as be seen in Fig. 3d, there is a great difference between the delivered proportion distribution and an expected distribution by the weights. In fact, the communication between the two cities is encrypted by the shared key, which are from the XOR hash of the final keys of a specific city and any destinated cities. In other words, a utilization of delivered final keys is the proportion of the resulting number of shared keys determined by a network traffic distribution to that of the final keys. Therefore, though more final keys were delivered to the Urumqi city or the Lhasa city, delivering final keys that exceeds the individual needs has no substantial improvement on the utilization of keys, especially in a one-time-pad encryption. (2) Employing S-PD promoted more final keys delivered to higher weighted cities, while the keys cannot be promised to deliver to the lower-priority cities. For instance, for the city, Shanghai, the number of final keys delivered by S-PD is 8,332 kbits, achieving 2,551 kbits

Fig. 3 Comparison for the delivery of final keys under different scheduling strategies. a. displays the number of final keys delivered to the cities under strategies: pursuing the distribution of final keys delivered being consistent with that of the data traffic (dark green), prioritized deliver to a higher weighted city (light green); only pursuing the total number of final keys maximized (yellow). b. a comparison between the

total final-key bits in the week and the bits of fiber-based quantum repeater schemes, where the key rate by fiber-based QKD with Grep ideal

relay

nodes

is

given

by

the

PLOB

bound

Rrep fib

=

- log2 (1-

 Grep +1 fib

)

37.

c.

Comparison

of

the

KL

divergence

and

total

final

keys

for

the

three

different

strategies in the iteration procedure. d. represents the comparison of delivered proportion distributions. For convenience, the values of the

assigned weights are temporarily proportional to the number of populations in a given city. These values could also be modified by a practical

network traffic statistic.

gain against the S-GD, while no keys are delivered to the cities, Hefei, and Jinan. This is due to the iteration on finding an optimal solution. Specifically, the cities with a lower priority such as the cities, Hefei, and Jinan, rarely are chosen in cases where a higher-priority city is feasible to communicate in the same time. On the other hand, the total number of final keys delivered under S-PD is lower than that under S-GD since the city under a chosen based on the priority is usually suboptimal in terms of link loss budget. Therefore, S-PD may be more suitable for different levels of encryption missions.
(3) Instead, adoption of S-TD achieves not only achieves a flexible scheduling to improve the number of final keys delivered, but also makes the delivery distribution be coincident with the expectation to guarantee the individual needs. In Fig. 3d, we further verify the superiority of S-TD by conducting a comparison for the iteration procedure. In the iterative optimization based on the idea of the genetic algorithm, we introduce the KL divergence to characterize the degree of a matching between the distribution of delivered final keys and the traffic distribution, which can be represented by33

 DKL

=

N n =1

 p(xn ) log 


p( xn q( xn

) )

  

(1)

Here, N is the number of cities, p(xn ) is the proportion of the
number of final keys delivered to the city i to all of that to all cities.
q(xn ) is the value of assigned normalized weight to the city i .That
is, if two distributions perfectly match, DKL =0 otherwise it takes values between 0 and inf . Lower KL divergence value, the better we have matched the distribution of delivered keys with the traffic distribution.
As can be seen, when pursuing a higher number of final keys, KL divergence inevitably increases under S-GD and S-PD, which makes a distribution mismatch, resulting in a lower utilization in practice. Apparently, though the promotion on the total number of final keys delivered under S-TD is lower than others, the lowest KL divergence of that indicates the best performance in preserving the individual needs. Specifically, the KL divergence under S-TD finally reached to 9.7x10-2. Kindly note that, a higher degree of the matching could be achieved with a finer time step in the time discretization model. From the perspective of a practical design, this is also a feasible scheduling to avoid an inefficient work of a spacecraft with limited coverage time. Moreover, by introducing the KL divergence in such iterations, an idea of adopting the general divergence-based deep learning algorithms38 is inspired to be efficiently solving the

optimization problems of a network of tremendous ground nodes. The above results validate that scheduling under S-TD has a great potential in guarantee of the individual needs, further promoting the utilization of delivered final keys.
The scenario where the LEO satellites deployed is more suitable for performing scheduling. Despite the promising results from the proposed scheduling under the current experimental settings of Micius satellite, we also seek to explore possibility of using the satellite with different orbits to perform the proposed schedule in the future network. However, it is reported that the space-based QKD by Medium Earth Orbit (MEO) or GEO satellite is difficult to achieve, at least under the current settings parameters in ref. 12. In order to show the benefits of scheduling under the S-TD more intuitively, we adopt the suggested parameters, in which the divergence angle of the satellite-based transmitting telescope is assumed to a set of fixed values as 1, 3, 5 and 10 rad, and the diameter of the ground-based receiving telescope to 2 m. For a comparison, the rest parameters remain unchanged. We include the following orbit types for the Micius satellite in the simulation: (1) the initial orbits of the Micius satellite, i.e., an altitude of about 500 km, denoted as LEO; (2) the orbit altitudes of about 2,500 km and 5,000 km, denoted as MEO1 and MEO2, respectively; (3) the orbit altitudes of about 35,863 km, denoted as GEO, where the Right Ascension of Ascending Node (RAAN) of the GEO is chosen as 50.0591 degree for a full coverage to all the cities. Similarly, for all the orbit types, other orbital parameters are consistent with those of the Micius satellite. Here, the length of duration available and the variations on the link budget in the implementations of spacebased QKD are first investigated, where the results in the week are exhibited in Table 1. We can see that for the satellite at GEO, the duration available in the umbra of sun is increased to about 358,700 s (99 h 25 mins), which is longer than that at the LEO (204 mins), the MEO1 (12 h 36 mins), and the MEO2 (22 h 45 mins). However, for

Fig. 4 Comparison of the total number of final keys delivered under different satellite altitudes and divergence angles. The final keys for the Micius satellite with an orbit altitude of 500 km (blue), 2,500 km (cyan) and 5,000 km (green), and different values of the divergence angle:1, 3, 5 and 10  rad. For a comparison, these resulting keys are obtained under the S-TD strategy, where the KL divergences of the delivery distributions are lower than 0.01.
all of the divergence angles we consider, the link budgets from the satellite at GEO to all these cities have exceeded to the maximal tolerable one (about 35 dB in the recent experiment12) that can generate a secure key. It implies that, scheduling appears to be hard when the transmissions from the satellite at GEO to these cities are presence of the severe geometric losses, since few feasible alternatives even within the long duration. Fortunately, as the orbit altitude descends, the link budget from the MEO2 to the cities at a

Fig. 5 Geometric loss vs. satellite altitude. Trend of the geometric loss as a function of the satellite altitude for several values of the divergence angle.
loss less than 35 dB is possible for a divergence angle lower than 5 rad.
We now predict the total final keys separately delivered under a same S-TD scheduling strategy. In particular, by setting a threshold of the KL divergence as same value of 0.01, we can further compare the results for the satellite at different orbits and divergence angles. Consider that no secure key would be possible generated in the case where the channel from the satellite at GEO to the ground suffers a serious attenuation, we only showed the resulting keys by the satellite at LEO, MEO1 and MEO2 in Fig. 4. As for the satellite with a divergence angle of 10 rad, the final keys delivered from the MEO1 significantly less than LEO1. This is because the delivery distribution must be lower than the threshold of a KL divergence, even in the case where some cities are faced with high budgets. For the satellite at MEO2, similar performances exist, which restricts the yields.
Another observation attained from the results is that with the ascent of orbit altitude, the total number of keys delivered decrease. Indeed, choosing the satellite at higher orbit altitude can effectively increase the duration, but can also introduce more budgets because of the increment of received beam width. Specifically, for the divergence angles of 3, 5, 10  rad, the link budgets of the satellite at MEO2 are generally lower by more than one and two orders of magnitude than that of the satellite at MEO1 and at LEO, respectively. Therefore, the key generation rates calculated by the GLLP, are also decreased by the corresponding orders of magnitude. While the duration available for access to the satellite at MEO2 only increased by 4 and 8 compared to that at MEO1 and LEO. Therefore, in terms of the total number of keys delivered, the negative effect of the increased link loss is greater than the positive effect of the extended duration. The remarkable note that, by increasing the aperture of the transmitting telescope to decrease the diffractionlimited induced divergence angle to 1 rad, a slight increase in the geometric loss (see Fig.5) can mitigate the total link budget when satellite orbit altitudes raised, whereas, the current manufacture technologies, along with the in-orbit load limits make its

implementation challenging in practice. Contrary to expectations of an improvement on total number of keys delivered by an ascent of orbit altitude to increase the duration available, these results verify that the plans for constructing a LEO satellite constellation, are more effective than that for employing an expensive high-orbit satellite even with the payload allowing for larger optics.
DISCUSSION
In this paper, we explored the possibility of scheduling a satellite for QKD in the integrated space-to-ground network without fibrebased relays. Evolved from an existed paradigm, the hypothetical but possible network consists of the Micius satellite and the main 11 cities of China. To design a sequence of missions a satellite needs execute, a comprehensive framework integrated with the precise orbital modeling and the cloud model based on the Himawari-8 data statistics is proposed to enable an accurate pre-assessment on the satellite-based QKD applications. By formulating a problem that considers both the individual needs of cities as well as a target on the number of final keys maximized to deliver, we designed three different optimization methods to find the optimal solution for different scheduling strategies, respectively. With a set of defined weights on the cities based on an assumed traffic distribution, along with the scheduling strategy i.e., S-PD, to prioritized deliver to the city with higher weight, more keys are significantly promoted to deliver for a high priority. Additionally, with the general scheduling strategy (S-GD) to pursue the total number of final keys maximized, it is possible to obtain the 7,468 kbits delivered to the city of Urumqi in a week. which embody a same final-key rate that of the fiberbased QKD that relayed by at least 5 ideal nodes to a separation 2,115 km of the Xi'an city.
However, the satellite-based QKD operating under these two scheduling strategies can in certain cases, outperform fiber-based QKD with relays, with drawbacks being that a difference between a delivered distribution and an expected distribution emerges, and that the mismatch limits the XOR hash operations, and thus reduce a utilization of delivered final keys. For this, we considered the S-TD strategy and introduced the KL divergence to the algorithm to make the delivery distribution be coincident with the expectation. As a result, we found that the benefits of the S-TD strategy are apparent in terms of ensuing the individual needs, even promoting the utilization of delivered keys in a practical use. Finally, we explored possibility of using the satellite with different orbits to perform the proposed schedule. Contrary to expectations of an improvement on total number of keys delivered by an ascent of orbit altitude to increase the duration available, the results demonstrated that mitigating the geometric loss is the first consideration in a future selection of the satellite orbit. In summary, constructing the LEO quantum satellite constellation for exploiting the potentials of applications is the best that can be expected.
There is no denying that a satellite operated as the `trusted node' to distribute keys will be replaced as `untrusted node' in the near future, especially with the decreasing loss budget of uplink or the improving fidelity of entanglement sources. Nonetheless, once the schedules employed, the current configuration could show a higher flexibility than the entanglement-based QKD scheme, because the

latter even requires that the two downlinks are feasible at the same time. Moreover, a network traffic graph is also needed to distribute the pairwise keys when employing the entanglement-based QKD. Notably, these two schemes, in fact, are not in conflict and to be integrated together for different encryption tasks. This allows to make full use of the limited time to distribute more keys. Given that the increasingly complex situation, the satellite applications like the design of schedule would be urgently needed. Conveniently, our proposed framework may be used for exploring this issue in future work. In summary, our works not only provide a practical solution to achieve the network encryption without the need for fiber-based relays, but also can be used as a pathfinder to support the decisions involving as the selection of the future quantum communication.

METHODS
In this section, we will first introduce the framework stated in the main text; then we will discuss how to formulate the satellite-based QKD scheduling problem. More specifically, the scenario modeling and link budget modeling are key components in the framework, which lays the groundwork for scheduling optimization by providing the key rate estimation.
Space-based QKD modeling framework
We now discuss the components in the space-based QKD modeling framework including the scenario modeling, link budget modeling and estimation of the transferred final keys. Figure 6 illustrates the individual components and how the components interact. Details of each component are given in the following texts.
Scenario modeling. The time-varying scenario constraints due to the satellite movement can be predictable with orbital dynamics. Specifically, by using the involved ephemeris data of a simulation

Scenario modeling

Predict orbital parameters based on Two-Line Element (TLE)

Define the location of a city based on Latitude-Longitude-Altitude (LLA)

Establish the integrated network scenario and Determine visibility, elevation angle and link length

Satellite orbit

Cloud disturbance

divergence angle

Vacuum

Link budget modeling
Transmitter (Satellite)
Telescope-like optics: divergence angle
Photon source: signal wavelength signal/decoy state intensity
repetition rate

Sea-level atmosphere effects

Atmosphere limit

10°Invisible zone

Transmission Channel
Adsorption Scattering based on
extinction coefficients
Cloud disturbance based on cloud statistics

Receiver (OGS)
Telescope-like optics: receiver lens aperture
Detector: photon detection efficiency
misalignments dark counts

Total link budget contains:
geometric loss atmospheric loss
coupling loss pointing loss detection loss

Estimation of the transferred final keys.

Determine visible durations

Estimate key rate using decoy-state QKD method

Calculate the total final keys

Fig. 6. The framework for modeling space-based QKD. First, based on the data file format referred to as TLE sets, an exact orbital element of a specific satellite together with practical geographic locations of a given city can be used as inputs to determine the visibility, elevation angle together with the relative distance. Then, the link budget is estimated by combining with the QKD experimental transceiver parameters and cloud cover statistics involving three procedures relevant for the optical signal attenuation in the sending, the transmission, and the receiving in the satellite-based QKD system. Using a general decoy-state QKD method to estimate the key generation rate per second, the total final keys in a determined interval can be calculated as the sum of them.

time ranging om a start date to an end date, the orbital elements of the satellite are periodically updated in modeling, thus covering the orbital drift cases. With the latitude-longitude-altitude (LLA) of the specific cities, we directly obtain the report of a specific scenario about visibility, relative elevation angle and distance from a satellite to the destination. Subsequently, the available intervals can be defined as time when the satellite is in umbra, and the elevation angle between a satellite and a city is greater or equal to 10 degree. Lastly, the elevation angle together with the relative distance from the satellite to a given city will be passed to be used as an input for the next link budget modeling.

Loss budget modeling. As for the satellite-based QKD experimental configuration shown in Fig. 6, the optical power launched from the transmitter is affected by various factors until finally detected at the receiver. The prediction on the geometric loss owing to the beam takes the divergence angle, the link distance, and the receiver lens aperture size as inputs, which scales as the inverse square of the propagation distance with the final beam width typically several times larger than the diameter of the receiving telescope. In

consequence, the geometric loss G can be expressed as

G

 = 1- exp  -


Dr 2 2r 2

  

r =

  

 

2  

+

( L )2

(2)

where r is final beam width, Dr is the receiver lens aperture,  is
the divergence angle,  is the wavelength and L denotes the link length. On the other hand, for the optical beam propagates through the atmosphere in downlinks, there are beam spreading leading to

a less significant pointing loss p compared to the uplink. However,

aerosols that absorb or scatter light are present throughout the

atmosphere, particularly in clouds. As a consequence, the days with

heavy cloud cover were often excluded from the design of QKD

missions. We focused our analysis on the cloud disturbance in the

presence of cloud thickness. To evaluate the contribution, the

historical cloud statistics was obtained from the Himawari-8, in

which the cloud cover for each city was encoded as an integer value

ranging from 0 to 150. Kindly note that the used cloud cover, can be

updated per ten minutes, and thus the atmospheric transmittance

model can be modified by

A

=

 A,0

csc



150 - 150

,

0





 150

,

where



is the

elevation and A,0 is the sea-level extinction coefficient, which typically are 0.5 and 0.22 for 808 nm and 1550nm, respectively39.

The system loss resulting from coupling operation inefficiencies c

and non-ideal detection efficiency d , highly depends on the design
specifications and is specified by the manufacturers. And for the convenience of analysis, we here replicate the specific experimental values (see Table 2) reported in 12. To summarize, we calculate the link budget within the available intervals separately for each step and exported these values for key rate estimation.

Estimation of the transferred final keys. We here present a general procedure for estimating the transferred final keys over an available interval. The polarization-encoded decoy-state BB84 protocol for an implementation of space-based QKD. The standard channel model40 using a known transmittance is employed to estimate the gain Q and quantum bit error rate (QBER) E for all the photon number component. Using the GLLP security analysis, the key generation rate in the asymptotic case is given by41

 ( ) ( )  ( ) RGLLP = q - fe E Qh2 E + Q1 1- h2 e1 

(3)

where q depends on the implementation (1/2 for the BB84 protocol due to the fact that half of the time Alice and Bob disagree with the bases, and if one uses the efficient BB84 protocol, q 1 ),

and fe is error correction inefficiency function,  is the intensity

of the signal state and h2 is the binary entropy function. The Q1

and e1 are, respectively, gain and error rate of the single photon

states estimated using the decoy-state theory. Therefore, the total final keys over the interval from a start time a to an end time b can

be calculated as the sum of the rates in per second,

b

 Ka,b = RGLLP[(ti )]

(4)

i=a

where (ti ) is the link budget at a time ti .

Scheduling Optimization

problem formulation. The scheduling problem formulation is allocating the time for delivering final keys to a given ground station. Before formally introducing the problem, we first repeat some fundamental definitions that will be used. For simplicity, let the simulation period T be divided into intervals as in Fig. 2a, where the intervals have a same length of 10 seconds. Here, we denoted that the number of intervals is M . Without loss of generality, M could be a variable value based on the length of simulation period.

Thus, Kmn represents the number of final keys that could be sent to

the cities n [1,...., N ] during an arbitrary interval m [1,..., M ] .

Kindly note that, all physical constraints are handled in the

definition of

K

n m

.

For

instance,

in

the

interval

m

when the OGS

located in a given city n is out of Earth's shadow (umbra) or the

elevation angle between the satellite and the OGS is smaller than

10 degree, Kmn will return 0. Moreover, consider that the time
spent on switching between consecutive the delivery from a one to another, we add that an interval to represent the switch before next one access, which could be expressed as:

Box 1 Three algorithms in the optimizations

Initialize: t =1 , cross ratio Rcross , mutate ratio Rmutate ,

population number Pnum , stopping criterion tmax , parent population X .
Repeat 1. Select, Crossover and Mutate for generating new population

X new ;

2. for each individual I do Algorithm 1 for S-GD

Calculating the cost function

 Fitness(I )=

E N T
n=1 n

end for

3. Sort X new by their fitness value and Pick the top j individuals; Algorithm 2 for S-PD

 Calculating the cost function Fitness(I )=

N n=1

EnT

wn

end for

3. Sort X new by their fitness value and Pick the top j individuals; Algorithm 3 for S-TD

Calculating the cost function

 Fitness(I )=

E N T
n=1 n

 Compute

KL

divergence

DKL (I )

=

N n=1

p(xn ) log

  

p( xn q( xn

) )

  

end for

3. Sort X new by their fitness value and Pick the top j  2 individuals;

Sort the j  2 individuals by their KL divergence and Pick the last j

individuals;

4. Sort X by their fitness value and Pick the last j individuals;

5. Update parent population X by replacing the j individuals with

that in new population X new t =t +1
Until t = tmax

  

xmn  1

 nN mM

, n [1,..., N ], m [1,..., M ]

(5)



xn m+1



xmn

+

xm0

Where the binary variable xmn describes whether the interval m is assigned to the city n . In the constraint (5), the first inequality

implies that every time in the simulation period at most one city

could be assigned. The second ensures that the required switching

period xm0 before a handoff to other cities is considered. That is, if

the interval m +1 is assigned to a city, then either the preceding interval m should be scheduled for the same transmission or the

requested switch xm0 is should be performed at the interval m .

With the above constraints, we formally define the optimization

problem. Our goal of the optimization is to find the best optimal

schedule which pursues the total number of final keys maximization

under the different strategies involving: (1) S-GD; (2) S-PD (3) S-TD.

For this, a general problem formulation for these strategies can be

formulated as:

Max

N
 EnT
n=1

Subject to

M
 EnT = Kmn xmn m=1

NM
  xmn  1
n=1 m=1

xn m+1



xmn

+

xm0

n [1,..., N ],m [1,..., M ]

(6)

where EnT is the number of final keys delivered to the city n over

the simulation period T , which is the product of the number of

final keys and the resulting binary variable xmn .

Algorithm Statement. To obtain the optimal solutions in different

strategies, we performed the optimization based on the logic rule

of the GA. In general, exploration of the search space is assured by

the crossover and mutation driven recombination of solutions,

whereas fitness-based selection ensures the property of

convergence. In this case, we start with a population of randomly

generated individuals. For S-GD, we consider the cost function is

only the sum of final keys, which is calculated as

 Fitness(I )=

E N T
n=1 n

.

Thus, we solve the problem by finding the maxima (i.e., the

maximum fitness); For S-PD, the cost function is modified to

 Fitness(I )=

, N
n=1

EnT

wn

where wn

is the weight assigned to the city

n . Similarly, this allows the iterative process tends to the city in

higher priority when searching a higher fitness. For S-TD, apart from

finding higher fitness individuals by the same cost function used in

S-GD, we further compare KL divergence of these individuals after

every fitness-based selection, which is calculated by the Formula (1),

in which the relative lower-value solutions are more likely to be

chosen to be a subset of the new population. Hence, with different

modifications on the GA, solving the problems of maximizing the

total number of final keys under different strategies can be

achieved. The code snippets of the above methods are illustrated in

Algorithms 1­3.

DATA AVAILABILITY
TLE database of the Micius satellite acknowledges support from the Celestrak (http://celestrak.com/satcat/search.php).

CODE AVAILABILITY
The code that contributed to the results of this study is available on request from the corresponding authors.

REFERENCES
1. Gisin, N., Ribordy, G., Tittel, W., and Zbinden, H. Quantum cryptography, Rev. Mod. Phys. 74, 145 (2002).
2. Bennett, C. H., Brassard, G. & Mermin, N. D. Quantum cryptography without Bell's theorem. Phys. Rev. Lett. 68, 557-559 (1992).
3. Mayers, D. Unconditional security in quantum cryptography. J. ACM 48, 351-406 (2001).
4. Buttler, W. T. et al. Practical free-space quantum key distribution over 1 km. Phys. Rev. Lett. 81, 3283 (1998).
5. Peng, C. Z. et al. Experimental free-space distribution of entangled photon pairs over 13 km: Towards satellite-based global quantum communication. Phys. Rev. Lett. 94, 150501 (2005).
6. Yin, J. et al. Quantum teleportation and entanglement distribution over 100kilometre free-space channels. Nature 488, 185 (2012).
7. Schmitt-Manderbach T. et al. Experimental demonstration of free-space decoy-state quantum key distribution over 144 km. Phys. Rev. Lett. 98, 010504 (2007).
8. Liao, S.-K. et al. Satellite-to-ground quantum key distribution. Nature 549, 43 ­47 (2017).
9. Ren, J. G. et al. Ground-to-satellite quantum teleportation. Nature 549, 70­ 73 (2017).
10. Yin, J. et al. Space-based entanglement distribution over 1200 kilometers. Science 356, 1140­1144 (2017).

11. Yin, J. et al. Entanglement-based secure quantum cryptography over 1,120 kilometers. Nature 582, 501-505 (2020).
12. Chen, YA. et al. An integrated space-to-ground quantum communication network over 4,600 kilometres. Nature 589, 214­219 (2021).
13. Diamanti, E., Lo, H.-K., Qi, B. & Yuan, Z. Practical challenges in quantum key distribution. npj Quantum Inf. 2, 16025 (2016).
14. Cao, Y. et al. Long-distance free-space measurement-device-independent quantum key distribution. Phys. Rev. Lett. 125, 260503 (2020).
15. Wang, J., Chen, H. & Zhu, Z. Modeling research of satellite-to-ground quantum key distribution constellations. Acta Astronaut. 173, 164­171 (2020).
16. Khatri, S., Brady, J. A., Desporte, A. R., Bart, P. M., Dowling, P. J. Spooky action at a global distance: analysis of space-based entanglement distribution for the quantum internet. npj Quantum Inf. 7, 4 (2021).
17. Liao, S. K. et al. Satellite-relayed intercontinental quantum network. Phys. Rev. Lett. 120, 030501 (2018).
18. Dequal, D. et al Feasibility of satellite-to-ground continuous-variable quantum key distribution. npj Quantum Inf. 7, 3 (2021).
19. Wang, W., Xu F. & Lo, H.-K. Asymmetric protocols for scalable high-rate measurement-device-independent quantum key distribution networks. Phys. Rev. X 9, 041012 (2019).
20. Khaligh, M.-A. & Uysal, M. Survey on free space optical communication: a communication theory perspective, IEEE Commun. Surv. Tut., 16, 22312258 (2014).
21. Wang, X.-Y., Dong C., Zhao S.-H., Liu Y., Liu X.-W. & Zhu H.-N. Feasibility of space-based measurement-device-independent quantum key distribution. New J. Phys. 23, 045001 (2021).
22. Liao, S.-K. et al. Long-distance free-space quantum key distribution in daylight towards inter-satellite communication. Nature Photonics, 11, 509513 (2017).
23. Vallone, G. et al. Satellite quantum communication towards GEO distances. Proc. SPIE 9900, 99000J (2016).
24. Anisimova, E. Mitigating radiation damage of single photon detectors for space applications. EPJ Quantum Technol. 4, 10 (2017).
25. Bedington, R, Arrazola, J. M. & Ling A. Progress in satellite quantum key distribution. npj Quantum Inf. 3, 30 (2017).
26. Shannon, C. E. Communication theory of secrecy systems. Bell Syst. Tech. J. 28, 656­715 (1949).
27. Peev, M. et al. The SECOQC quantum key distribution network in Vienna, New J. Phys. 11, 075001 (2009).
28. Stucki, D. et al. Long-term performance of the SwissQuantum quantum key distribution network in a field environment, New J. Phys. 13, 123001 (2011).
29. Sasaki, T., Yamamoto, Y. & Koashi, M. Practical quantum key distribution protocol without monitoring signal disturbance. Nature 509, 475­478 (2014).
30. Polnik, M., Mazzarella, L., Di Carlo, M., KL Oi D. Annalisa R. & Ashwin A. Scheduling of space to ground quantum key distribution. EPJ Quantum Technol. 7, 3 (2020).
31. JAXA Himawari Monitor: Service Homepage. Last accessed 15/3/2021. https://www.eorc.jaxa.jp/ptree/.
32. Holland, H.-J. et al. Adaptation in natural and artificial systems: an introductory analysis with applications to biology, control, and artificial intelligence (MIT press, 1992).
33. Barz, B., Rodner, E., Garcia Y.-G. & Denzler, J. Detecting Regions of Maximal Divergence for Spatio-Temporal Anomaly Detection. IEEE T. Pattern. Anal., 41, 1088-1101 (2019).
34. Pirandola, S. Satellite Quantum Communications: Fundamental Bounds and Practical Security. Phys. Rev. Research 3, 023130 (2021).
35. Bonato, C. et al. Feasibility of satellite quantum key distribution. New J. Phys. 11, 045017 (2009).
36. Gottesman, D., Lo, H.-K., Lütkenhaus, N. & Preskill, J. Security of quantum key distribution with imperfect devices. Quantum Inf. Comput. 4, 325 (2004).

37. Pirandola, S. Limits and security of free-space quantum communications. Phys. Rev. Research 3, 013279 (2021).
38. Salakhutdinov, R. & Hinton, G. An efficient learning procedure for deep boltzmann machines. Neural Computation 24, 1967-2006 (2012).
39. Kerstel, E., Gardelein, A., Barthelemy, M., Fink, M., Joshi, S.-K. & Ursin, R. Nanobob: a CubeSat mission concept for quantum communication experiments in an uplink configuration, EPJ Quantum Technol. 5, 6 (2018).
40. Lo, H.-K., Ma, X. & Chen, K. Decoy-state quantum key distribution. Phys. Rev. Lett. 94, 230504 (2005).
41. Ma, X., Qi, K., & Lo, H.-K. Practical decoy state for quantum key distribution. Phys. Rev. Lett. 72, 012326 (2005).
ACKNOWLEDGEMENTS
This work has been supported by the National Natural Science Foundation of China (Grants No. 61971436); the National University of Defense Technology (19-QNCXJ-009); the Innovative Talents Promotion Plan in Shaanxi Province (Grant No.2020KJXX011) Key Research and Development Program of Shaanxi (Program No. 2019ZDLGY09-01. We gratefully thank Stefano Pirandola, Xuan Han for helpful discussions.
AUTHOR CONTRIBUTIONS
Xingyu Wang performed the bulk of this work at National University of Defense Technology during an exchange stay. Major of Satellitebased QKD modeling framework was worked by Xingyu Wang in this study. Chen Dong designed the optimization methods. Boyu Deng and Yijun Zhang modified the manuscript. With thanks to Lei Shi, Haonan Zhu and Tianyi Wu from a research group who mooted the concept of the space-based QKD network with us. Shanghong Zhao supervised Wang at School of Information and Navigation.
COMPETING INTERESTS
The authors declare that there are no conflicts of interest related to this paper.
ADDITIONAL INFORMATION
Correspondence and requests for materials should be addressed to Z. S. H or D. C.

